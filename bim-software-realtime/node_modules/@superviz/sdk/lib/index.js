var _o=Object.create;var Mt=Object.defineProperty,So=Object.defineProperties,Li=Object.getOwnPropertyDescriptor,Oo=Object.getOwnPropertyDescriptors,Lo=Object.getOwnPropertyNames,Si=Object.getOwnPropertySymbols,Io=Object.getPrototypeOf,Ii=Object.prototype.hasOwnProperty,Ro=Object.prototype.propertyIsEnumerable;var Oi=(p,i,t)=>i in p?Mt(p,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[i]=t,f=(p,i)=>{for(var t in i||(i={}))Ii.call(i,t)&&Oi(p,t,i[t]);if(Si)for(var t of Si(i))Ro.call(i,t)&&Oi(p,t,i[t]);return p},x=(p,i)=>So(p,Oo(i));var Ri=(p,i)=>()=>(p&&(i=p(p=0)),i);var Mo=(p,i)=>()=>(i||p((i={exports:{}}).exports,i),i.exports),ko=(p,i)=>{for(var t in i)Mt(p,t,{get:i[t],enumerable:!0})},No=(p,i,t,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let o of Lo(i))!Ii.call(p,o)&&o!==t&&Mt(p,o,{get:()=>i[o],enumerable:!(e=Li(i,o))||e.enumerable});return p};var Do=(p,i,t)=>(t=p!=null?_o(Io(p)):{},No(i||!p||!p.__esModule?Mt(t,"default",{value:p,enumerable:!0}):t,p));var w=(p,i,t,e)=>{for(var o=e>1?void 0:e?Li(i,t):i,s=p.length-1,n;s>=0;s--)(n=p[s])&&(o=(e?n(i,t,o):n(o))||o);return e&&o&&Mt(i,t,o),o};var T=(p,i,t)=>new Promise((e,o)=>{var s=l=>{try{r(t.next(l))}catch(c){o(c)}},n=l=>{try{r(t.throw(l))}catch(c){o(c)}},r=l=>l.done?e(l.value):Promise.resolve(l.value).then(s,n);r((t=t.apply(p,i)).next())});var a=Ri(()=>{});var $i={};ko($i,{version:()=>ns});var ns,Fi=Ri(()=>{a();ns="5.9.0-beta.1"});var Gi=Mo((xp,zi)=>{a();zi.exports={remoteConfig:{apiUrl:"https://dev.nodeapi.superviz.com",conferenceLayerUrl:"https://video-frame.superviz.com/lab/index.html"}}});a();a();var kt=(C=>(C.MEETING_START="meeting.start",C.MEETING_LEAVE="meeting.leave",C.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",C.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",C.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",C.MEETING_PARTICIPANT_LEFT="meeting.participant-left",C.MEETING_JOIN="meeting.join",C.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",C.MEETING_HOST_CHANGE="meeting.host-change",C.MEETING_HOST_AVAILABLE="meeting.host-available",C.MEETING_NO_HOST_AVAILABLE="meeting.no-host-available",C.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",C.MEETING_DEVICES_CHANGE="meeting.devices-change",C.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",C.MEETING_STATE_UPDATE="meeting.state-update",C.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",C.MEETING_WAITING_FOR_HOST="meeting.waiting-for-host",C.MY_PARTICIPANT_UPDATED="my-participant.update",C.MY_PARTICIPANT_LEFT="my-participant.left",C.MY_PARTICIPANT_JOINED="my-participant.joined",C.MEETING_KICK_PARTICIPANT="meeting.kick-participant",C.DESTROY="destroy",C))(kt||{}),Nt=(l=>(l.FRAME_LOAD="frame.load",l.FRAME_DIMENSIONS_UPDATE="frame.dimensions-update",l.FRAME_PARENT_SIZE_UPDATE="frame.parent-window-size-update",l.FRAME_LOCALE_UPDATE="frame.locales-update",l.FRAME_AVATAR_LIST_UPDATE="frame.avatar-list-update",l.FRAME_COLOR_LIST_UPDATE="frame.color-list-update",l.FRAME_STYLES_UPDATE="frame.styles-update",l.FRAME_CALLBACKS_UPDATE="frame.callbacks-update",l))(Nt||{}),Dt=(l=>(l.TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",l.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",l.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",l.TOGGLE_CAM="meeting-controls.toggle-cam",l.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",l.TOGGLE_TRANSCRIPT="meeting-controls.toggle-transcript",l.HANG_UP="hang-up",l.CALLBACK_CALLED="callback-called",l))(Dt||{}),D=(h=>(h.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",h.REALTIME_HOST_CHANGE="realtime.host-change",h.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",h.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",h.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",h.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",h.REALTIME_GATHER="realtime.gather",h.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",h.REALTIME_LOCAL_FOLLOW_PARTICIPANT="realtime.local-follow-participant",h.REALTIME_SET_AVATAR="realtime.set-avatar",h.REALTIME_DRAWING_CHANGE="realtime.drawing-change",h.REALTIME_TRANSCRIPT_CHANGE="realtime.transcript-change",h.REALTIME_PRIVATE_MODE="realtime.private-mode",h))(D||{});var de=(d=>(d[d.MEETING_FAILED=-1]="MEETING_FAILED",d[d.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",d[d.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",d[d.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",d[d.MEETING_CONNECTING=3]="MEETING_CONNECTING",d[d.MEETING_CONNECTED=4]="MEETING_CONNECTED",d[d.MEETING_RECONNECT=5]="MEETING_RECONNECT",d[d.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",d[d.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",d[d.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",d))(de||{}),me=(r=>(r.JOINED="participant.joined",r.LOCAL_JOINED="participant.local-joined",r.LEFT="participant.left",r.LOCAL_LEFT="participant.local-left",r.LOCAL_UPDATED="participant.updated",r.LIST_UPDATED="participant.list-updated",r.SAME_ACCOUNT_ERROR="participant.same-account-error",r))(me||{}),Bt=(r=>(r[r.NOT_AVAILABLE=0]="NOT_AVAILABLE",r[r.GOOD=1]="GOOD",r[r.BAD=2]="BAD",r[r.POOR=3]="POOR",r[r.DISCONNECTED=4]="DISCONNECTED",r[r.RECONNECTING=5]="RECONNECTING",r[r.LOST_CONNECTION=6]="LOST_CONNECTION",r))(Bt||{}),Ne=(r=>(r.NO_CAM="devices.no-cam",r.NO_DEVICES="devices.no-devices",r.DEVICES_BLOCKED="devices.blocked",r.DEVICES_CAM_BLOCKED="devices.cam-blocked",r.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",r.DEVICES_UNKNOWN_ERROR="devices.unknown-error",r.DEVICES_ALLOWED="devices.allowed",r))(Ne||{}),he=(t=>(t.PIN_ACTIVE="pin-mode.active",t.PIN_INACTIVE="pin-mode.inactive",t))(he||{}),gt=(t=>(t.MOUNT="mount",t.UNMOUNT="unmount",t))(gt||{}),ue=(l=>(l.START_FOLLOWING_PARTICIPANT="who-is-online.start-following-participant",l.STOP_FOLLOWING_PARTICIPANT="who-is-online.stop-following-participant",l.ENTER_PRIVATE_MODE="who-is-online.enter-private-mode",l.LEAVE_PRIVATE_MODE="who-is-online.leave-private-mode",l.GATHER_ALL="who-is-online.gather-all",l.GO_TO_PARTICIPANT="who-is-online.go-to-participant",l.START_FOLLOW_ME="who-is-online.start-follow-me",l.STOP_FOLLOW_ME="who-is-online.stop-follow-me",l))(ue||{});a();var bt=(e=>(e.HOST="host",e.GUEST="guest",e.AUDIENCE="audience",e))(bt||{});a();a();a();a();a();var I=(o,s,n,...r)=>T(void 0,[o,s,n,...r],function*(p,i,t,e={}){let l=yield fetch(p,{method:i,headers:f({"Content-Type":"application/json"},e),body:t?JSON.stringify(t):null});if(!l.ok)throw l;try{return yield l.json()}catch(c){return l.ok}});a();import Bo from"debug";var A=class{constructor(i){this.debug=Bo(i)}log(i,...t){this.debug(i,...t)}};a();a();import $o from"lodash/throttle";var E=class{constructor(i={}){this.subscribe=i=>{this.callbacks.push(i)};this.unsubscribe=i=>{this.callbacks=this.callbacks.filter(t=>t!==i)};this.publish=(...i)=>{!this.callbacks||this.callbacks.forEach(t=>{this.callListener(t,i).catch(e=>{var o;(o=this.logger)==null||o.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${t.name}
            Event: ${JSON.stringify(i)}
            Error: ${e}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(i,t)=>new Promise((e,o)=>{try{let s=i(...t);e(s)}catch(s){o(s)}});let{logger:t,throttleTime:e}=i;this.logger=t||new A("@superviz/sdk/observer-helper"),this.throttle=e,this.callbacks=[],this.throttle&&(this.publish=$o(this.publish,this.throttle))}};var V=class{constructor(){this.observers={};this.subscribe=(i,t)=>{this.logger.log(`subscribed to ${i} event`),this.observers[i]||(this.observers[i]=new E({logger:this.logger})),this.observers[i].subscribe(t)};this.unsubscribe=(i,t)=>{if(this.logger.log(`unsubscribed from ${i} event`),!!this.observers[i]){if(!t){this.observers[i].destroy(),delete this.observers[i];return}this.observers[i].unsubscribe(t)}};this.publish=(i,t)=>{i in this.observers&&this.observers[i].publish(t)}}};a();a();a();import Fo from"lodash";var De=class{setConfig(i){this.configuration=i}get(i,t){return this.configuration?Fo.get(this.configuration,i,t):t}},b=new De;var L=class{static createUrl(i,t,e={}){let o=new URL(t,i);return Object.keys(e).forEach(s=>o.searchParams.append(s,e[s])),o.toString()}static validateApiKey(i,t){let e="/user/checkapikey",o=this.createUrl(i,e);return I(o,"POST",{apiKey:t})}static fetchConfig(i,t){let e="/immersive-config",o=this.createUrl(i,e);return I(o,"POST",{apiKey:t})}static fetchLimits(i,t){return T(this,null,function*(){let e="/user/check_limits",o=this.createUrl(i,e);return(yield I(o,"GET","",{apikey:t})).usage})}static fetchWaterMark(i,t){return T(this,null,function*(){let e="/user/watermark",o=this.createUrl(i,e),{message:s}=yield I(o,"POST",{apiKey:t});return s})}static createAnnotations(i,t,e){return T(this,null,function*(){let o="/annotations",s=this.createUrl(i,o);return I(s,"POST",f({},e),{apikey:t})})}static updateComment(i,t,e,o){return T(this,null,function*(){let s=`/comments/${e}`,n=this.createUrl(i,s);return I(n,"PUT",{text:o},{apikey:t})})}static createComment(i,t,e){return T(this,null,function*(){let o="/comments",s=this.createUrl(i,o);return I(s,"POST",f({},e),{apikey:t})})}static fetchAnnotation(i,t,e){return T(this,null,function*(){let o="/annotations",s=this.createUrl(i,o,{roomId:e.roomId,url:e.url});return I(s,"GET",void 0,{apikey:t})})}static resolveAnnotation(i,t,e){return T(this,null,function*(){let o=`/annotations/resolve/${e}`,s=this.createUrl(i,o);return I(s,"POST",{},{apikey:t})})}static deleteComment(i,t,e){return T(this,null,function*(){let o=`/comments/${e}`,s=this.createUrl(i,o);return I(s,"DELETE",{},{apikey:t})})}static deleteAnnotation(i,t,e){return T(this,null,function*(){let o=`/annotations/${e}`,s=this.createUrl(i,o);return I(s,"DELETE",{},{apikey:t})})}static createOrUpdateParticipant(i){return T(this,null,function*(){let t=b.get("apiUrl"),e="/participants",o=this.createUrl(t,e);return I(o,"POST",f({},i),{apikey:b.get("apiKey")})})}static sendActivity(i,t,e,o){return T(this,null,function*(){let s="/activity",n=b.get("apiUrl"),r=b.get("roomId"),l=b.get("apiKey"),c=this.createUrl(n,s);return I(c,"POST",{groupId:t,groupName:e,meetingId:r,product:o,userId:i},{apikey:l})})}static fetchParticipantsByGroup(i){return T(this,null,function*(){let t=`/groups/participants/${i}`,e=b.get("apiUrl"),o=this.createUrl(e,t,{take:1e4});return I(o,"GET",void 0,{apikey:b.get("apiKey")})})}static createMentions(i){return T(this,null,function*(){let t="/mentions",e=b.get("apiUrl"),o=this.createUrl(e,t);return I(o,"POST",i,{apikey:b.get("apiKey")})})}};a();a();a();a();function Mi(){return{set value(p){this.instance=p,setTimeout(()=>Object.freeze(this))},get value(){return this.instance}}}a();import{BehaviorSubject as zo,distinctUntilChanged as Go,shareReplay as Ho}from"rxjs";var Be=class{constructor(i,t,e){this.subscriptions=new Map;this.setValue=i=>{this.state=i,this.subject.next(this.state)};this.subscribe=(i,t)=>{let e=this.subject.subscribe(t);this.subscriptions.set(i,e)};this.state=i,this.showLog=!!e,this.subject=t.pipe(Go(),Ho({bufferSize:1,refCount:!0}))}getValue(){return this.state}unsubscribe(i){var t;(t=this.subscriptions.get(i))==null||t.unsubscribe(),this.subscriptions.delete(i)}destroy(){this.subscriptions.forEach(i=>i.unsubscribe()),this.subscriptions.clear()}expose(){let i=this.subscribe.bind(this),t=this.unsubscribe.bind(this),e=this.getValue.bind(this),o=this.setValue.bind(this);return{get value(){return e()},set value(s){o(s)},subscribe:i,unsubscribe:t}}};function $t(p,i){let t=new zo(p);return new Be(p,t,i)}var $e=Mi(),Fe=class{constructor(){this.localParticipant=$t(null,!0);this.participants=$t(new Map);this.group=$t(null);if($e.value)throw new Error("CommentsStore is a singleton. There can only be one instance of it.");$e.value=this}destroy(){this.localParticipant.destroy(),$e.value=null}},Ft=new Fe,Uo=Ft.destroy.bind(Ft),Wo=Ft.group.expose(),Vo=Ft.participants.expose(),jo=Ft.localParticipant.expose();function ft(){return{localParticipant:jo,participants:Vo,destroy:Uo,group:Wo}}var Jo={["global-store"]:ft};function Ko(p,i,t){i.subscribe(this,()=>{this[p]=i.value,t&&t(i.value)}),this.unsubscribeFrom.push(i.unsubscribe),this.requestUpdate&&this.requestUpdate()}function yt(p){let i=Jo[p](),t=Ko.bind(this);return new Proxy(i,{get(o,s){return{subscribe(n){t(s,o[s],n)},subject:o[s],publish(n){this.subject.value=n}}}})}var k=class extends V{constructor(){super(...arguments);this.isAttached=!1;this.unsubscribeFrom=[];this.useStore=yt.bind(this);this.attach=t=>{if(Object.values(t).includes(null)||Object.values(t).includes(void 0)){let r=`${this.name} @ attach - params are required`;throw this.logger.log(r),new Error(r)}let{realtime:e,config:o,eventBus:s,ioc:n}=t;if(!e.isDomainWhitelisted){let r=`Component ${this.name} can't be used because this website's domain is not whitelisted. Please add your domain in https://dashboard.superviz.com/developer`;this.logger.log(r);return}if(b.setConfig(o),this.realtime=e,this.eventBus=s,this.isAttached=!0,this.ioc=n,this.room=n.createRoom(this.name),!this.realtime.isJoinedRoom){this.logger.log(`${this.name} @ attach - not joined yet`),setTimeout(()=>{this.logger.log(`${this.name} @ attach - retrying`),this.attach(t)},1e3);return}this.logger.log(`${this.name} @ attached`),this.start(),this.publish("mount")};this.detach=()=>{if(!this.isAttached){this.logger.log(`${this.name} @ detach - component is not attached`);return}this.logger.log("detached"),this.publish("unmount"),this.destroy(),this.unsubscribeFrom.forEach(t=>t(this)),Object.values(this.observers).forEach(t=>{t.reset(),t.destroy()}),this.observers=void 0,this.realtime=void 0,this.isAttached=!1}}};a();var ze=(s=>(s.presence3dMatterport="presence",s.presence3dAutodesk="presence",s.presence3dThreejs="presence",s.realtime="presence",s.whoIsOnline="presence",s))(ze||{});a();var zt=(t=>(t.LEFT="left",t.RIGHT="right",t))(zt||{}),Ge=(o=>(o.TOP_LEFT="top-left",o.TOP_RIGHT="top-right",o.BOTTOM_LEFT="bottom-left",o.BOTTOM_RIGHT="bottom-right",o))(Ge||{});var Gt=class extends k{constructor(t,e){var n,r,l;super();this.sidebarOpen=!1;this.layoutOptions={};this.openThreads=()=>{var t;this.sidebarOpen||((t=this.element)==null||t.setAttribute("open",""),this.sidebarOpen=!0,document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0})))};this.closeThreads=()=>{var t;!this.sidebarOpen||((t=this.element)==null||t.removeAttribute("open"),this.sidebarOpen=!1,document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0})))};this.togglePinActive=()=>{if(this.pinActive){this.disable();return}this.enable()};this.onPinFixed=t=>{this.coordinates=t};this.toggleAnnotationSidebar=()=>{this.element.toggleAttribute("open"),this.sidebarOpen=this.element.hasAttribute("open"),document.body.dispatchEvent(new CustomEvent("prepare-to-create-annotation",{detail:void 0,composed:!0,bubbles:!0})),document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0}))};this.onSelectAnnotation=t=>{this.sidebarOpen||this.toggleAnnotationSidebar()};this.positionFloatingButton=()=>{var l,c;this.button=document.createElement("superviz-comments-button");let t=(l=this.layoutOptions)==null?void 0:l.buttonLocation,e=(c=this.layoutOptions)==null?void 0:c.position;if(!t){document.body.appendChild(this.button),this.button.commentsPosition=e;return}let o="",s=Object.values(Ge),n=!1,r=!s.includes(t.toLocaleLowerCase());if(r){let d=window.document.body.querySelector(`#${t}`);d?(d.appendChild(this.button),o="position: relative"):(n=!0,t="top-left")}if(!r||n){document.body.appendChild(this.button);let[d,v]=t.split("-");o=`${d}: 20px; ${v}: 20px;`}this.button.positionStyles=o,this.button.commentsPosition=e};this.positionComments=()=>{var o;this.element=document.createElement("superviz-comments"),this.element.setAttribute("comments",JSON.stringify([])),this.element.side="left",this.element.offset=this.offset,document.body.appendChild(this.element);let t=(o=this.layoutOptions)==null?void 0:o.position;if(!t)return;let e=t.toUpperCase();!zt[e]||(this.element.side=zt[e])};this.createAnnotation=e=>T(this,[e],function*({detail:t}){try{let{text:o,mentions:s}=t,{url:n}=this,r=f({},this.coordinates),l=yield L.createAnnotations(b.get("apiUrl"),b.get("apiKey"),{roomId:b.get("roomId"),position:JSON.stringify(r),url:n,userId:this.localParticipantId}),c=yield this.createComment(l.uuid,o,s);this.addAnnotation(x(f({},l),{comments:[c]})),this.pinAdapter.removeAnnotationPin("temporary-pin"),document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:l.uuid,haltGoToPin:!0,newPin:!0},composed:!0,bubbles:!0}))}catch(o){this.logger.log("error when creating annotation",o)}});this.deleteAnnotation=e=>T(this,[e],function*({detail:t}){try{let{uuid:o}=t;yield L.deleteAnnotation(b.get("apiUrl"),b.get("apiKey"),o);let s=this.annotations.filter(n=>n.uuid!==o);this.updateAnnotationList(s),this.pinAdapter.removeAnnotationPin(o),this.element.updateAnnotations(this.annotations)}catch(o){this.logger.log("error when deleting annotation",o)}});this.updateComment=e=>T(this,[e],function*({detail:t}){try{let{uuid:o,text:s,mentions:n}=t,r=yield L.updateComment(b.get("apiUrl"),b.get("apiKey"),o,s);yield L.createMentions({commentsId:r.uuid,participants:n.map(c=>({id:c.userId}))});let l=this.annotations.map(c=>Object.assign({},c,{comments:c.comments.map(d=>d.uuid===o?Object.assign({},d,{text:s,mentions:n}):d)}));this.updateAnnotationList(l)}catch(o){this.logger.log("error when updating comment",o)}});this.resolveAnnotation=e=>T(this,[e],function*({detail:t}){try{let{uuid:o}=t,{resolved:s}=yield L.resolveAnnotation(b.get("apiUrl"),b.get("apiKey"),o),n=this.annotations.map(r=>r.uuid===o?Object.assign({},r,{resolved:s}):r);if(this.updateAnnotationList(n),s){this.pinAdapter.removeAnnotationPin(o);return}this.pinAdapter.updateAnnotations(this.annotations)}catch(o){this.logger.log("error when resolve annotation",o)}});this.deleteComment=e=>T(this,[e],function*({detail:t}){try{let{uuid:o,annotationId:s}=t;if(!o||!s)return;yield L.deleteComment(b.get("apiUrl"),b.get("apiKey"),o);let n=this.annotations.find(l=>l.uuid===s);n.comments=n.comments.filter(l=>l.uuid!==o);let r=this.annotations.map(l=>l.uuid===s?n:l);this.element.updateAnnotations(r),this.updateAnnotationList(r)}catch(o){this.logger.log("error when deleting comment",o)}});this.onAnnotationListUpdate=t=>{let{data:e,clientId:o}=t;this.localParticipantId!==o&&(this.annotations=e,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations))};this.name="comments",this.logger=new A("@superviz/sdk/comments-component"),this.annotations=[],this.layoutOptions={buttonLocation:(n=e==null?void 0:e.buttonLocation)!=null?n:"top-left",position:(r=e==null?void 0:e.position)!=null?r:"left"},this.hideDefaultButton=(l=e==null?void 0:e.hideDefaultButton)!=null?l:!1,this.setStyles(e==null?void 0:e.styles),this.offset=e==null?void 0:e.offset,setTimeout(()=>{var c,d;t.setCommentsMetadata((d=(c=this.layoutOptions)==null?void 0:c.position)!=null?d:"left")}),this.pinAdapter=t;let{group:o,localParticipant:s}=this.useStore("global-store");o.subscribe(),s.subscribe(c=>{this.localParticipantId=c.id})}enable(){this.pinAdapter.setActive(!0),this.pinActive=!0,this.publish("pin-mode.active"),document.body.dispatchEvent(new CustomEvent("toggle-pin-active",{detail:{isActive:!0}}))}disable(){this.pinAdapter.setActive(!1),this.pinActive=!1,this.publish("pin-mode.inactive"),document.body.dispatchEvent(new CustomEvent("toggle-pin-active",{detail:{isActive:!1}}))}get url(){let t=new URL(this.clientUrl);return t.search="",t.toString()}start(){this.clientUrl=window.location.href,this.positionComments(),this.hideDefaultButton||this.positionFloatingButton(),this.fetchAnnotations(),this.waterMarkState(),this.participantsList(),this.addListeners(),this.pinAdapter.setPinsVisibility(!0)}destroy(){var t;this.logger.log("comments component @ destroy"),this.destroyListeners(),(t=this.button)==null||t.remove(),this.element.remove(),this.element=void 0,this.pinAdapter.destroy()}addListeners(){var t;(t=this.button)==null||t.addEventListener("toggle",this.togglePinActive),this.element.addEventListener("close-threads",this.closeThreads),document.body.addEventListener("create-annotation",this.createAnnotation),this.element.addEventListener("resolve-annotation",this.resolveAnnotation),this.element.addEventListener("delete-annotation",this.deleteAnnotation),this.element.addEventListener("create-comment",({detail:e})=>{this.createComment(e.uuid,e.text,e.mentions,!0)}),this.element.addEventListener("update-comment",this.updateComment),this.element.addEventListener("delete-comment",this.deleteComment),document.body.addEventListener("select-annotation",this.onSelectAnnotation),this.realtime.commentsObserver.subscribe(this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.subscribe(this.onPinFixed)}destroyListeners(){var t;(t=this.button)==null||t.removeEventListener("toggle",this.togglePinActive),this.element.removeEventListener("close-threads",this.closeThreads),this.element.removeEventListener("resolve-annotation",this.resolveAnnotation),this.element.removeEventListener("create-comment",({detail:e})=>{this.createComment(e.uuid,e.text,e.mentions,!0)}),this.element.removeEventListener("update-comment",this.updateComment),this.element.removeEventListener("delete-comment",this.deleteComment),document.body.removeEventListener("select-annotation",this.onSelectAnnotation),document.body.removeEventListener("create-annotation",this.createAnnotation),this.realtime.commentsObserver.unsubscribe(this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.unsubscribe(this.onPinFixed)}setStyles(t=""){if(!t)return;let e=document.createElement("style");e.textContent=t,e.id="superviz-comments-styles",document.head.appendChild(e)}createComment(n,r){return T(this,arguments,function*(t,e,o=[],s=!1){try{let l=yield L.createComment(b.get("apiUrl"),b.get("apiKey"),{annotationId:t,userId:this.localParticipantId,text:e});return yield L.createMentions({commentsId:l.uuid,participants:o.map(c=>({id:c.userId,readed:0}))}),l.mentions=o,s&&this.addComment(t,l),l}catch(l){this.logger.log("error when creating comment",l)}})}addAnnotation(t){let e=[t,...this.annotations];this.element.updateAnnotations(e),this.pinAdapter.updateAnnotations(e),this.updateAnnotationList(e)}updateAnnotationList(t){this.annotations=t,this.realtime.updateComments(t)}addComment(t,e){let o=this.annotations.find(n=>n.uuid===t);o.comments.push(e);let s=this.annotations.map(n=>n.uuid===t?o:n);this.updateAnnotationList(s),this.element.updateAnnotations(s)}fetchAnnotations(){return T(this,null,function*(){try{let t=yield L.fetchAnnotation(b.get("apiUrl"),b.get("apiKey"),{roomId:b.get("roomId"),url:this.url});this.annotations=t,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations)}catch(t){this.logger.log("error when fetching annotations",t)}})}waterMarkState(){return T(this,null,function*(){try{let t=yield L.fetchWaterMark(b.get("apiUrl"),b.get("apiKey"));this.element.waterMarkStatus(t)}catch(t){this.logger.log("error when fetching waterMark",t)}})}participantsList(){return T(this,null,function*(){try{let e=(yield L.fetchParticipantsByGroup(this.group.id)).data;this.pinAdapter.participantsList=e,this.element.participantsList=e}catch(t){this.logger.log("error when fetching participantsList",t)}})}};a();a();var Ut=(t=>(t.ADD="add",t.SHOW="show",t))(Ut||{});var Wt=class{constructor(i,t){this.isPinsVisible=!0;this.selectedPin=null;this.temporaryPinCoordinates=null;this.commentsSide="left";this.setCommentsMetadata=i=>{this.commentsSide=i};this.resetPins=i=>{i&&(i==null?void 0:i.key)!=="Escape"||(this.resetSelectedPin(),this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates=null)};this.animate=()=>{(this.isActive||this.isPinsVisible)&&(this.renderAnnotationsPins(),this.divWrapper=this.renderDivWrapper()),this.temporaryPinCoordinates&&this.renderTemporaryPin(),requestAnimationFrame(this.animate)};this.setMouseDownCoordinates=({x:i,y:t})=>{this.mouseDownCoordinates={x:i,y:t}};this.annotationSelected=({detail:{uuid:i,haltGoToPin:t,newPin:e}})=>{var n,r;if(!i)return;e&&this.pins.get(i).setAttribute("newPin","");let o=JSON.parse((r=(n=this.selectedPin)==null?void 0:n.getAttribute("annotation"))!=null?r:"{}");if(this.resetPins(),(o==null?void 0:o.uuid)===i)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let s=this.pins.get(i);!s||(s.setAttribute("active",""),this.selectedPin=s,!t&&this.goToPin(i))};this.onClick=i=>{if(!this.isActive)return;let t=this.canvas.getBoundingClientRect(),{x:e,y:o}=this.mouseDownCoordinates,s=e-t.x,n=o-t.y,r=i.clientX-t.left,l=i.clientY-t.top;if(Math.hypot(r-s,l-n)>10)return;let y=this.canvas.getContext("2d").getTransform().inverse(),h=new DOMPoint(r,l-31).matrixTransform(y);this.onPinFixedObserver.publish({x:h.x,y:h.y,type:"canvas"}),this.resetSelectedPin(),this.temporaryPinCoordinates={x:h.x,y:h.y},this.renderTemporaryPin();let g=document.getElementById("superviz-temporary-pin");this.movedTemporaryPin=!this.movedTemporaryPin,g.setAttribute("movedPosition",String(this.movedTemporaryPin)),!this.selectedPin&&document.body.dispatchEvent(new CustomEvent("unselect-annotation"))};this.onToggleAnnotationSidebar=({detail:i})=>{let{open:t}=i;t||(this.pins.forEach(e=>{e.removeAttribute("active")}),this.pins.has("temporary-pin")&&this.removeAnnotationPin("temporary-pin"))};this.hideTemporaryPin=i=>{var v;let t=i.target,e=t.contains(this.canvas),{x:o,y:s}=i,{left:n,top:r,right:l,bottom:c}=this.canvas.getBoundingClientRect(),d=o>n&&o<l&&s>r&&s<c;this.canvas.contains(t)||((v=this.pins.get("temporary-pin"))==null?void 0:v.contains(t))||e&&d||(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates=null)};if(this.logger=new A("@superviz/sdk/comments-component/canvas-pin-adapter"),this.canvas=document.getElementById(i),this.isActive=!1,this.pins=new Map,this.goToPinCallback=t==null?void 0:t.onGoToPin,!this.canvas){let e=`Canvas with id ${i} not found`;throw this.logger.log(e),new Error(e)}this.canvasSides=this.canvas.getBoundingClientRect(),document.body.style.position="relative",this.onPinFixedObserver=new E({logger:this.logger}),this.divWrapper=this.renderDivWrapper(),this.annotations=[],this.renderAnnotationsPins(),this.animateFrame=requestAnimationFrame(this.animate),document.body.addEventListener("select-annotation",this.annotationSelected),document.body.addEventListener("keyup",this.resetPins)}destroy(){this.removeListeners(),this.removeAnnotationsPins(),this.pins=new Map,this.divWrapper.remove(),this.onPinFixedObserver.destroy(),this.onPinFixedObserver=null,this.canvas.style.cursor="default",this.annotations=[],cancelAnimationFrame(this.animateFrame),document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("keyup",this.resetPins)}setPinsVisibility(i){if(this.isPinsVisible=i,this.isPinsVisible){this.renderAnnotationsPins();return}this.removeAnnotationsPins()}setActive(i){if(this.isActive!==i){if(this.isActive=i,this.isActive){this.originalCanvasCursor=this.canvas.style.cursor,this.canvas.style.cursor='url("https://production.cdn.superviz.com/static/pin-html.png") 0 100, pointer',this.addListeners();return}this.resetPins(),this.removeListeners(),this.canvas.style.cursor=this.originalCanvasCursor}}updateAnnotations(i){this.logger.log("updateAnnotations",i),this.annotations=i,!(!this.isActive&&!this.isPinsVisible)&&(this.removeAnnotationsPins(),this.renderAnnotationsPins())}removeAnnotationPin(i){let t=this.pins.get(i);!t||(t.remove(),this.pins.delete(i),i!=="temporary-pin"&&(this.annotations=this.annotations.filter(e=>e.uuid!==i)))}renderTemporaryPin(){let i=document.getElementById("superviz-temporary-pin");i||(i=document.createElement("superviz-comments-annotation-pin"),i.id="superviz-temporary-pin",i.setAttribute("type","add"),i.setAttribute("showInput",""),i.setAttribute("containerSides",JSON.stringify(this.canvasSides)),i.setAttribute("commentsSide",this.commentsSide),i.setAttribute("position",JSON.stringify(this.temporaryPinCoordinates)),i.setAttribute("annotation",JSON.stringify({})),i.setAttribute("participantsList",JSON.stringify(this.participants)),i.setAttributeNode(document.createAttribute("active")),this.divWrapper.appendChild(i));let{x:t,y:e}=this.temporaryPinCoordinates,s=this.canvas.getContext("2d").getTransform(),n=s.e,r=s.f,l=s.a,c=s.d,d=t*l+n,v=e*c+r;i.setAttribute("position",JSON.stringify({x:d,y:v})),this.pins.set("temporary-pin",i)}addListeners(){this.canvas.addEventListener("click",this.onClick),this.canvas.addEventListener("mousedown",this.setMouseDownCoordinates),document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}removeListeners(){this.canvas.removeEventListener("click",this.onClick),this.canvas.removeEventListener("mousedown",this.setMouseDownCoordinates),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}resetSelectedPin(){!this.selectedPin||(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}renderDivWrapper(){let i=this.canvas.getBoundingClientRect(),t=this.divWrapper;return t||(t=document.createElement("div"),t.id="superviz-canvas-wrapper",["","static"].includes(this.canvas.parentElement.style.position)&&(this.canvas.parentElement.style.position="relative")),t.style.position="absolute",t.style.top=`${this.canvas.offsetTop}px`,t.style.left=`${this.canvas.offsetLeft}px`,t.style.width=`${i.width}px`,t.style.height=`${i.height}px`,t.style.pointerEvents="none",t.style.overflow="hidden",document.getElementById("superviz-canvas-wrapper")||this.canvas.parentElement.appendChild(t),t}renderAnnotationsPins(){if((!this.annotations.length||this.canvas.style.display==="none")&&!this.pins.get("temporary-pin")){this.removeAnnotationsPins();return}this.annotations.forEach(i=>{if(i.resolved)return;let t=JSON.parse(i.position);if((t==null?void 0:t.type)!=="canvas")return;let{x:e,y:o}=t,n=this.canvas.getContext("2d").getTransform(),r=n.e,l=n.f,c=n.a,d=n.d,v=e*c+r,y=o*d+l;if(this.pins.has(i.uuid)){let g=this.pins.get(i.uuid);if(this.divWrapper.clientWidth>v&&this.divWrapper.clientHeight>y){g.setAttribute("style","opacity: 1"),this.pins.get(i.uuid).setAttribute("position",JSON.stringify({x:v,y}));return}g.setAttribute("style","opacity: 0");return}let h=document.createElement("superviz-comments-annotation-pin");h.setAttribute("type","show"),h.setAttribute("participantsList",JSON.stringify(this.participants)),h.setAttribute("annotation",JSON.stringify(i)),h.setAttribute("position",JSON.stringify({x:v,y})),h.id=i.uuid,this.divWrapper.appendChild(h),this.pins.set(i.uuid,h)})}removeAnnotationsPins(){this.pins.forEach(i=>{i.remove()}),this.pins.clear()}set participantsList(i){this.participants=i}goToPin(i){let t=this.annotations.find(h=>h.uuid===i);if(!t)return;let e=JSON.parse(t.position);if((e==null?void 0:e.type)!=="canvas")return;let o=this.canvas.getBoundingClientRect(),{width:s,height:n}=o,{x:r,y:l}=e,c=s/2,d=n/2,v=c-r,y=d-l;this.goToPinCallback&&this.goToPinCallback({x:v,y})}};a();import{isEqual as qo}from"lodash";var Vt=class{constructor(i,t={}){this.isPinsVisible=!0;this.selectedPin=null;this.dataAttribute="data-superviz-id";this.commentsSide="left";this.temporaryPinCoordinates={};this.elementsWithDataId={};this.divWrappers=new Map;this.voidElementsWrappers=new Map;this.VOID_ELEMENTS=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr","svg","rect","ellipse"];this.animate=()=>{this.voidElementsWrappers&&(this.updatePinsPositions(),this.animateFrame=requestAnimationFrame(this.animate))};this.setCommentsMetadata=i=>{this.commentsSide=i};this.hideTemporaryPin=i=>{var n;let t=i.target,e=this.divWrappers.get(this.temporaryPinCoordinates.elementId);if(!e)return;let o=e.contains(t),s=(n=this.pins.get("temporary-pin"))==null?void 0:n.contains(t);o||s||(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates={})};this.resetPins=i=>{i&&(i==null?void 0:i.key)!=="Escape"||(this.resetSelectedPin(),this.resetHoveredWrapper(),this.temporaryPinCoordinates.elementId&&(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates={}))};this.annotationSelected=({detail:{uuid:i,newPin:t}})=>{if(!i)return;t&&this.pins.get(i).setAttribute("newPin","");let e=this.annotations.find(n=>{var r;return n.uuid===((r=this.selectedPin)==null?void 0:r.id)});if(this.resetPins(),(e==null?void 0:e.uuid)===i)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let o=this.pins.get(i);if(!o)return;o.setAttribute("active",""),this.selectedPin=o;let s=this.annotations.find(n=>n.uuid===i);this.selectedPin.setAttribute("elementId",JSON.parse(s.position).elementId)};this.onClick=i=>{if(!this.isActive||i.target===this.pins.get("temporary-pin"))return;let t=i.target,e=i.currentTarget;if(t!==e&&this.pins.has(t.id))return;let o=e.getAttribute("data-wrapper-id"),s=e.getBoundingClientRect(),{x:n,y:r}=this.mouseDownCoordinates,l=i.clientX-s.left,c=i.clientY-s.top,d=n-s.x,v=r-s.y;if(Math.hypot(l-d,c-v)>10)return;let{width:h,height:g}=e.getBoundingClientRect(),S=32,O=e.getBoundingClientRect().width/e.offsetWidth||1;l=l*100/h,c=(c-S*O)*100/g,this.onPinFixedObserver.publish({x:l,y:c,type:"html",elementId:o}),this.resetSelectedPin(),this.temporaryPinCoordinates=x(f({},this.temporaryPinCoordinates),{x:l,y:c}),this.renderTemporaryPin(o);let u=this.pins.get("temporary-pin");this.movedTemporaryPin=!this.movedTemporaryPin,u.setAttribute("movedPosition",String(this.movedTemporaryPin)),document.body.dispatchEvent(new CustomEvent("unselect-annotation"))};this.onMouseDown=({x:i,y:t})=>{this.mouseDownCoordinates={x:i,y:t}};this.handleMutationObserverChanges=i=>{i.forEach(t=>{var c;let{target:e,oldValue:o}=t,s=e.getAttribute(this.dataAttribute);if(!s&&!o||s===o)return;let n=this.dataAttributeValueFilters.some(d=>o.match(d));if(!s&&o&&!n){this.removeAnnotationPin("temporary-pin"),this.clearElement(o),((c=this.selectedPin)==null?void 0:c.getAttribute("elementId"))===o&&(document.body.dispatchEvent(new CustomEvent("unselect-annotation")),this.selectedPin=null);return}let l=this.dataAttributeValueFilters.some(d=>s.match(d));(o&&this.elementsWithDataId[o]||l)&&this.clearElement(o),!l&&(this.setElementReadyToPin(e,s),this.renderAnnotationsPins())})};this.onToggleAnnotationSidebar=({detail:i})=>{let{open:t}=i;t||(this.resetSelectedPin(),this.pins.has("temporary-pin")&&(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates.elementId=void 0))};this.onMouseEnter=i=>{var s;let t=i.target;if(this.hoveredWrapper=t,!((s=t.getAttribute("data-wrapper-type"))==null?void 0:s.includes("ellipse"))){this.hoveredWrapper.style.setProperty("outline","1px solid rgb(var(--sv-primary))");return}let o=t.querySelector("ellipse");o.setAttribute("stroke","rgb(var(--sv-primary))"),o.setAttribute("stroke-width","1")};this.onMouseLeave=i=>{var s;let t=i.target;if(this.hoveredWrapper=t,!((s=t.getAttribute("data-wrapper-type"))==null?void 0:s.includes("ellipse"))){this.hoveredWrapper.style.setProperty("outline","");return}let o=t.querySelector("ellipse");o.removeAttribute("stroke"),o.removeAttribute("stroke-width")};if(this.logger=new A("@superviz/sdk/comments-component/container-pin-adapter"),this.container=document.getElementById(i),!this.container){let s=`Element with id ${i} not found`;throw this.logger.log(s),new Error(s)}if(typeof t!="object")throw new Error("Second argument of the HTMLPin constructor must be an object");let{dataAttributeName:e,dataAttributeValueFilters:o}=t;if(e==="")throw new Error("dataAttributeName must be a non-empty string");if(e===null)throw new Error("dataAttributeName cannot be null");if(e!==void 0&&typeof e!="string")throw new Error("dataAttributeName must be a non-empty string");this.dataAttribute=e||this.dataAttribute,this.dataAttributeValueFilters=o||[],this.isActive=!1,this.prepareElements(),this.mutationObserver=new MutationObserver(this.handleMutationObserverChanges),this.observeContainer(),this.pins=new Map,this.onPinFixedObserver=new E({logger:this.logger}),this.annotations=[],document.body.addEventListener("select-annotation",this.annotationSelected),document.body.addEventListener("keyup",this.resetPins),this.voidElementsWrappers.size&&(this.animateFrame=requestAnimationFrame(this.animate))}destroy(){var i;this.logger.log("Destroying HTML Pin Adapter for Comments"),this.removeListeners(),this.removeObservers(),this.divWrappers.forEach(t=>t.remove()),this.divWrappers.clear(),this.pins.forEach(t=>t.remove()),this.pins.clear(),this.divWrappers=void 0,this.pins=void 0,this.elementsWithDataId=void 0,this.logger=void 0,this.onPinFixedObserver.destroy(),this.onPinFixedObserver=void 0,this.container=void 0,this.voidElementsWrappers.clear(),this.voidElementsWrappers=void 0,this.annotations=[],(i=this.svgWrappers)==null||i.remove(),this.svgWrappers=void 0,document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),cancelAnimationFrame(this.animateFrame)}addElementListeners(i){this.divWrappers.get(i).addEventListener("click",this.onClick,!0),this.divWrappers.get(i).addEventListener("mousedown",this.onMouseDown),this.divWrappers.get(i).addEventListener("mouseenter",this.onMouseEnter),this.divWrappers.get(i).addEventListener("mouseleave",this.onMouseLeave)}removeElementListeners(i){this.divWrappers.get(i).removeEventListener("click",this.onClick,!0),this.divWrappers.get(i).removeEventListener("mousedown",this.onMouseDown),this.divWrappers.get(i).removeEventListener("mouseenter",this.onMouseEnter),this.divWrappers.get(i).removeEventListener("mouseleave",this.onMouseLeave)}set participantsList(i){this.participants=i}removeObservers(){this.mutationObserver.disconnect(),this.mutationObserver=void 0}addListeners(){this.divWrappers.forEach((i,t)=>this.addElementListeners(t)),document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}removeListeners(){this.divWrappers.forEach((i,t)=>this.removeElementListeners(t)),document.body.removeEventListener("keyup",this.resetPins),document.body.removeEventListener("click",this.hideTemporaryPin)}observeContainer(){this.mutationObserver.observe(this.container,{subtree:!0,attributes:!0,attributeFilter:[this.dataAttribute],attributeOldValue:!0})}prepareElements(){this.container.querySelectorAll(`[${this.dataAttribute}]`).forEach(t=>{let e=t.getAttribute(this.dataAttribute);this.dataAttributeValueFilters.some(s=>e.match(s))||this.setElementReadyToPin(t,e)})}addAllCursors(){this.divWrappers.forEach((i,t)=>{this.addCursor(i,t)})}removeAddCursor(){this.divWrappers.forEach((i,t)=>{let e=i,o=i.getAttribute("data-wrapper-type");if(o){let s=o.split("-")[1];e=this.divWrappers.get(t).querySelector(s)}e.style.setProperty("cursor","default"),e.style.setProperty("pointer-events","none")})}setPinsVisibility(i){this.isPinsVisible=i,this.isPinsVisible&&this.renderAnnotationsPins(),this.removeAnnotationsPins()}removeAnnotationPin(i){let t=this.pins.get(i);!t&&i==="temporary-pin"||(t&&(t.remove(),this.pins.delete(i)),i!=="temporary-pin"&&(this.annotations=this.annotations.filter(e=>e.uuid!==i)))}updateAnnotations(i){this.logger.log("updateAnnotations",i),this.annotations=i,this.isPinsVisible&&(this.removeAnnotationsPins(),this.renderAnnotationsPins())}setActive(i){if(this.isActive!==i){if(this.isActive=i,this.isActive){this.addListeners(),this.addAllCursors(),this.prepareElements();return}this.resetPins(),this.removeListeners(),this.removeAddCursor()}}renderTemporaryPin(i){var s,n;(s=this.temporaryPinCoordinates).elementId||(s.elementId=i);let t=this.pins.get("temporary-pin");if(i&&i!==this.temporaryPinCoordinates.elementId&&(this.pins.get("temporary-pin").remove(),this.pins.delete("temporary-pin"),this.temporaryPinCoordinates.elementId=i,t=null),!t){let r=(n=this.elementsWithDataId[i])==null?void 0:n.getBoundingClientRect();t=document.createElement("superviz-comments-annotation-pin"),t.id="superviz-temporary-pin",t.setAttribute("type","add"),t.setAttribute("showInput",""),t.setAttribute("containerSides",JSON.stringify(r)),t.setAttribute("commentsSide",this.commentsSide),t.setAttribute("position",JSON.stringify(this.temporaryPinCoordinates)),t.setAttribute("annotation",JSON.stringify({})),t.setAttribute("participantsList",JSON.stringify(this.participants)),t.setAttribute("keepPositionRatio",""),t.setAttributeNode(document.createAttribute("active")),this.addTemporaryPinToElement(i,t)}let{x:e,y:o}=this.temporaryPinCoordinates;t.setAttribute("position",JSON.stringify({x:e,y:o})),this.pins.set("temporary-pin",t)}renderAnnotationsPins(){if(!this.annotations.length){this.removeAnnotationsPins();return}this.annotations.forEach(i=>{if(i.resolved)return;let{x:t,y:e,elementId:o,type:s}=JSON.parse(i.position);if(s!=="html"||this.pins.has(i.uuid)||!this.elementsWithDataId[o])return;let r=this.divWrappers.get(o);if(!r)return;let l=this.createPin(i,t,e);r.appendChild(l),this.pins.set(i.uuid,l)})}updatePinsPositions(){this.voidElementsWrappers.forEach((i,t)=>{let e=JSON.stringify(i.getBoundingClientRect()),o=this.elementsWithDataId[t].getBoundingClientRect();this.elementsWithDataId[t].tagName.toLowerCase()==="ellipse"&&(o=this.elementsWithDataId[t].viewportElement.getBoundingClientRect()),!qo(JSON.stringify(o),e)&&(i.style.setProperty("top",`${o.top}px`),i.style.setProperty("left",`${o.left}px`),i.style.setProperty("width",`${o.width}px`),i.style.setProperty("height",`${o.height}px`))})}clearElement(i){if(!this.elementsWithDataId[i])return;let e=this.divWrappers.get(i);if(e){let o=e.children,{length:s}=o;for(let n=0;n<s;++n){let r=o.item(n);this.pins.delete(r.id)}e.remove()}this.voidElementsWrappers.delete(i),this.removeElementListeners(i),this.divWrappers.delete(i),this.elementsWithDataId[i]=void 0,this.voidElementsWrappers.size||(cancelAnimationFrame(this.animateFrame),this.animateFrame=void 0)}resetSelectedPin(){!this.selectedPin||(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}resetHoveredWrapper(){!this.hoveredWrapper||this.onMouseLeave({target:this.hoveredWrapper})}removeAnnotationsPins(){this.pins.forEach(i=>{i.remove()}),this.pins.clear()}setElementReadyToPin(i,t){if(!this.elementsWithDataId[t]){if(this.elementsWithDataId[t]=i,!this.divWrappers.get(t)){let e=this.createWrapper(i,t);this.divWrappers.set(t,e)}!this.isActive||!this.isPinsVisible||(this.addCursor(this.divWrappers.get(t),t),this.addElementListeners(t))}}handleSvgElement(i,t){let e=i.viewportElement;if(e===void 0)return;if(i.tagName.toLowerCase()==="svg"){let u=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return u.setAttribute("height","100%"),u.setAttribute("width","100%"),u.style.setProperty("overflow","visible"),u.appendChild(t),i.appendChild(u),i.style.setProperty("overflow","visible"),t}let n=i.tagName.toLowerCase(),r=n==="ellipse",l=n==="rect";if(!r&&!l)return;let c=document.createElementNS("http://www.w3.org/2000/svg","svg"),d=document.createElementNS("http://www.w3.org/2000/svg",n),v,y,h,g,S,O;if(l){let u=i;v=u.getAttribute("x"),y=u.getAttribute("y"),h=u.getAttribute("width"),g=u.getAttribute("height"),S=u.getAttribute("rx"),O=u.getAttribute("ry"),d.setAttribute("fill","transparent"),d.setAttribute("stroke","transparent"),d.setAttribute("x","0"),d.setAttribute("y","0"),d.setAttribute("rx",S),d.setAttribute("ry",O)}if(r){let u=i.getAttribute("cx"),R=i.getAttribute("cy");S=i.getAttribute("rx"),O=i.getAttribute("ry"),v=Number(u)-Number(S),y=Number(R)-Number(O);let{width:M,height:$}=e.getBoundingClientRect();h=`${M}px`,g=`${$}px`,d.setAttribute("fill","transparent"),d.setAttribute("stroke","transparent"),d.setAttribute("cx",u),d.setAttribute("cy",R),d.setAttribute("rx",S),d.setAttribute("ry",O)}return d.setAttribute("height",g),d.setAttribute("width",h),c.setAttribute("height",g),c.setAttribute("width",h),c.appendChild(d),t.appendChild(c),i.style.setProperty("overflow","visible"),t.setAttribute("data-wrapper-type",`svg-${n}`),t}addTemporaryPinToElement(i,t){if(!this.elementsWithDataId[i])return;let o=this.divWrappers.get(i);!o||o.appendChild(t)}createPin(i,t,e){let o=document.createElement("superviz-comments-annotation-pin");return o.setAttribute("type","show"),o.setAttribute("annotation",JSON.stringify(i)),o.setAttribute("position",JSON.stringify({x:t,y:e})),o.setAttribute("keepPositionRatio",""),o.setAttribute("participantsList",JSON.stringify(this.participants)),o.id=i.uuid,o}addCursor(i,t){let e=i,o=i.getAttribute("data-wrapper-type");if(o){let s=o.split("-")[1];e=this.divWrappers.get(t).querySelector(s)}e.style.setProperty("cursor",'url("https://production.cdn.superviz.com/static/pin-html.png") 0 100, pointer'),e.style.setProperty("pointer-events","auto")}createWrapper(i,t){var l;let e=`superviz-id-${t}`;if(this.divWrappers.get(t))return;let o=i.getBoundingClientRect(),s=document.createElement("div");s.setAttribute("data-wrapper-id",t),s.id=e,s.style.position="absolute",s.style.pointerEvents="none",s.style.transform="translateX(0) translateY(0) scale(1)",s.style.cursor="default",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.pointerEvents="none";let n=window.getComputedStyle(i).getPropertyValue("border-radius");if(s.style.borderRadius=n,!this.VOID_ELEMENTS.includes(this.elementsWithDataId[t].tagName.toLowerCase()))return this.elementsWithDataId[t].appendChild(s),this.setPositionNotStatic(this.elementsWithDataId[t]),s;s=(l=this.handleSvgElement(i,s))!=null?l:s,s.style.position="fixed",s.style.top=`${o.top}px`,s.style.left=`${o.left}px`,s.style.width=`${o.width}px`,s.style.height=`${o.height}px`;let r=this.elementsWithDataId[t].parentElement;return(!r||i.viewportElement)&&(r=document.body),this.setPositionNotStatic(r),r.appendChild(s),this.voidElementsWrappers.set(t,s),this.animateFrame||(this.animateFrame=requestAnimationFrame(this.animate)),s}setPositionNotStatic(i){let{position:t}=window.getComputedStyle(i);t==="static"&&i.style.setProperty("position","relative")}};a();import{isEqual as Ni}from"lodash";a();import z from"bowser";var jt=class{constructor(){this.browser=z.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(z.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(z.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(z.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(z.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(z.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(z.PLATFORMS_MAP.mobile)||this.browser.is(z.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(z.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};a();var ve=class{constructor(){this.updateMeetingConnectionStatus=i=>{this.oldConnectionStatus=this.connectionStatus,this.connectionStatus=i,this.connectionStatusObserver.publish(i),this.logger.log("CONNECTION STATUS CHANGE",i)};this.onUpdateBrowserOnlineStatus=i=>{let{type:t}=i;if(t==="online"){this.updateMeetingConnectionStatus(1);return}this.updateMeetingConnectionStatus(4)};this.logger=new A("@superviz/sdk/connection-service"),this.connectionStatus=0,this.connectionStatusObserver=new E({logger:this.logger})}addListeners(){window.addEventListener("online",this.onUpdateBrowserOnlineStatus),window.addEventListener("offline",this.onUpdateBrowserOnlineStatus)}removeListeners(){window.removeEventListener("online",this.onUpdateBrowserOnlineStatus),window.removeEventListener("offline",this.onUpdateBrowserOnlineStatus)}};a();a();var ge=class{build(i,t,e,o={},s={}){let n=document.querySelector(`#${i}`),r=new URL(t);if(this.wrapperId||this.element)throw new Error("Tried to initialize two frames with the same FrameBricklayer instance");this.element=document.createElement("iframe"),Object.entries(o).forEach(([l,c])=>{r.searchParams.set(l,c)}),Object.entries(s).forEach(([l,c])=>{this.element.setAttribute(l,c)}),this.element.src=r.toString(),this.element.id=e,n.appendChild(this.element),this.wrapperId=i}destroy(){if(!this.wrapperId)throw new Error("Tried to destroy a frame before it was initialized");let i=document.querySelector(`#${this.wrapperId}`);!!i&&!!i.querySelector(`#${this.element.id}`)&&i.removeChild(this.element),this.wrapperId=null,this.element=null}};a();var be=class{constructor(i){this.observers={};this.sourceBlockList=["vue-devtools-proxy","vue-devtools-backend"];this.originBlockList=["https://sketchfab.com"];this.publish=(i,t={})=>{this.logger.log("MessageBridge","Posting message to frame",i,t),this.contentWindow.postMessage({type:i,data:t},this.allowedOrigins)};this.listen=(i,t)=>{this.observers[i]||(this.observers[i]=new E({logger:this.logger})),this.observers[i].subscribe(t)};this.onReceiveMessage=i=>{let{type:t,data:e,source:o}=i.data;if(this.sourceBlockList.includes(o)||this.originBlockList.includes(i.origin))return;let s=!!t,n=!this.domains.length||this.domains.includes(i.origin),r=this.observers.hasOwnProperty(t);if(this.logger.log("MessageBridge",`Message received -
        TYPE: ${i.type}
        ORIGIN: ${i.origin}
        DATA: ${JSON.stringify(i.data)} `),!s||!n||!r){this.logger.log("MessageBridge","Message discarded");return}this.observers[t].publish(e)};let{contentWindow:t,domains:e=[],allowedOrigins:o="*",sourceBlockList:s=[],logger:n}=i;if(this.logger=n,this.domains=e,this.allowedOrigins=o,this.sourceBlockList.push(...s),typeof window=="undefined")throw new Error("MessageBridge: window is undefined");this.contentWindow=t,window.addEventListener("message",this.onReceiveMessage)}destroy(){Object.entries(this.observers).forEach(([i,t])=>{t.reset(),delete this.observers[i]}),window.removeEventListener("message",this.onReceiveMessage),delete this.logger,delete this.allowedOrigins,delete this.contentWindow,delete this.domains,delete this.observers,delete this.sourceBlockList}};a();var Jt=(e=>(e.RIGHT="right",e.CENTER="center",e.LEFT="left",e))(Jt||{}),fe=(t=>(t.GRID="grid",t.LIST="list",t))(fe||{}),ye=(o=>(o.RIGHT="right",o.LEFT="left",o.TOP="top",o.BOTTOM="bottom",o))(ye||{});var ki="sv-video-frame",Kt=class{constructor(i){this.logger=new A("@superviz/sdk/video-conference-manager");this.frameStateObserver=new E({logger:this.logger});this.frameSizeObserver=new E({logger:this.logger});this.waitingForHostObserver=new E({logger:this.logger});this.realtimeEventsObserver=new E({logger:this.logger});this.sameAccountErrorObserver=new E({logger:this.logger});this.devicesObserver=new E({logger:this.logger});this.meetingStateObserver=new E({logger:this.logger});this.meetingConnectionObserver=new E({logger:this.logger});this.participantJoinedObserver=new E({logger:this.logger});this.participantLeftObserver=new E({logger:this.logger});this.participantListObserver=new E({logger:this.logger});this.frameState=0;this.layoutModalsAndCamerasConfig=(i,t)=>{let e=i,o=t,s=["left","right","bottom","top"].includes(o),n=["left","right","center"].includes(e);return s||(o="right"),n||(e="right"),this.browserService.isMobileDevice?(o="bottom",{layoutPosition:e,camerasPosition:o}):(e==="left"&&o==="right"&&(e="right"),e==="right"&&o==="left"&&(e="left"),{layoutPosition:e,camerasPosition:o})};this.onFrameLoad=()=>{this.messageBridge=new be({logger:this.logger,contentWindow:this.bricklayer.element.contentWindow}),this.addMessagesListeners(),this.updateFrameState(2),this.updateFrameLocale(),this.updateMeetingAvatars(),this.onWindowResize(),this.setCustomColors(),this.setCallbacks()};this.setFrameOffset=i=>{let t=i!=null?i:{};["top","bottom","left","right"].forEach(e=>{Object.keys(t).includes(e)||(t[e]=0)}),this.frameOffset=t};this.setCustomColors=()=>{this.customColors&&this.messageBridge.publish("frame.color-list-update",this.customColors),this.styles&&this.messageBridge.publish("frame.styles-update",this.styles)};this.setCallbacks=()=>{if(!this.callbacks)return;let i={onToggleMicrophone:!!this.callbacks.onToggleMicrophone,onToggleCam:!!this.callbacks.onToggleCam,onToggleTranscript:!!this.callbacks.onToggleTranscript,onToggleChat:!!this.callbacks.onToggleChat,onToggleScreenShare:!!this.callbacks.onToggleScreenShare,onClickHangup:!!this.callbacks.onClickHangup,onToggleMeetingSetup:!!this.callbacks.onToggleMeetingSetup};this.messageBridge.listen("callback-called",t=>{var e,o;(o=(e=this.callbacks)[t])==null||o.call(e)}),this.messageBridge.publish("frame.callbacks-update",JSON.stringify(i))};this.setFrameStyle=i=>{let t=document.createElement("style"),{bottom:e,left:o,right:s,top:n}=this.frameOffset;if(t.innerHTML=`
      :root {
        --superviz-offset-top: ${n}px;
        --superviz-offset-right: ${s}px;
        --superviz-offset-left: ${o}px;
        --superviz-offset-bottom: ${e}px;
      }     
    `,document.head.appendChild(t),this.browserService.isMobileDevice){this.bricklayer.element.classList.add("sv-video-frame--bottom");return}this.bricklayer.element.classList.add(`sv-video-frame--${i}`)};this.onFrameDimensionsUpdate=({width:i,height:t})=>{let e=document.getElementById(ki),{bottom:o,right:s,left:n,top:r}=this.frameOffset,l=this.isWaterMarkEnabled?40:0,c=`${i}px`,d=`${t+l}px`;(i>=window.innerWidth||this.isHorizontalCameraEnabled)&&(c=`calc(100% - ${s}px - ${n}px)`),t>=window.innerHeight&&(d=`calc(100% - ${r}px - ${o}px)`),e.style.width=c,e.style.height=d,this.frameSizeObserver.publish({width:e.offsetWidth,height:e.offsetHeight})};this.onWindowResize=()=>{let{top:i,bottom:t,right:e,left:o}=this.frameOffset,{innerHeight:s,innerWidth:n}=window,r=s-i-t,l=n-e-o;!this.messageBridge||this.messageBridge.publish("frame.parent-window-size-update",{height:r,width:l})};this.updateFrameLocale=()=>{var s,n;if(!this.frameLocale||!((s=this.frameLocale)!=null&&s.language)&&((n=this.frameLocale)==null?void 0:n.locales))return;let{language:i,locales:t}=this.frameLocale,e=t.map(r=>r==null?void 0:r.language),o=["en",...e];if(i&&!o.includes(i))throw new Error("The default language is not available in the language listing.");this.messageBridge.publish("frame.locales-update",this.frameLocale)};this.updateMeetingAvatars=()=>{this.messageBridge.publish("frame.avatar-list-update",this.meetingAvatars)};this.onParticipantJoined=i=>{this.participantJoinedObserver.publish(i)};this.onParticipantLeft=i=>{this.participantLeftObserver.publish(i)};this.onMeetingHostChange=i=>{this.realtimeEventsObserver.publish({event:"realtime.host-change",data:i})};this.onMeetingKickParticipant=i=>{this.realtimeEventsObserver.publish({event:"meeting.kick-participant",data:i})};this.onFollowParticipantDidChange=i=>{this.realtimeEventsObserver.publish({event:"realtime.follow-participant",data:i})};this.onGoToDidChange=i=>{this.realtimeEventsObserver.publish({event:"realtime.go-to-participant",data:i})};this.onGather=()=>{this.realtimeEventsObserver.publish({event:"realtime.gather",data:!0})};this.onGridModeChange=i=>{this.realtimeEventsObserver.publish({event:"realtime.grid-mode-change",data:i})};this.onDrawingChange=i=>{this.realtimeEventsObserver.publish({event:"realtime.drawing-change",data:i})};this.onTranscriptChange=i=>{this.realtimeEventsObserver.publish({event:"realtime.transcript-change",data:i})};this.onSameAccountError=i=>{this.sameAccountErrorObserver.publish(i)};this.onDevicesChange=i=>{this.devicesObserver.publish(i)};this.meetingStateUpdate=i=>{this.meetingStateObserver.publish(i)};this.onConnectionStatusChange=i=>{this.meetingConnectionObserver.publish(i)};this.onWaitingForHostDidChange=i=>{this.waitingForHostObserver.publish(i)};this.onParticipantListUpdate=i=>{this.participantListObserver.publish(i)};var Ot,Lt,It,Rt;let{language:t,canUseCams:e,canUseChat:o,canUseScreenshare:s,canUseDefaultAvatars:n,canUseFollow:r,canUseGoTo:l,canUseGather:c,canShowAudienceList:d,canUseDefaultToolbar:v,canUseTranscription:y,browserService:h,offset:g,locales:S,avatars:O,customColors:u,styles:R,waterMark:M,layoutPosition:$,camerasPosition:ut,skipMeetingSettings:C,devices:N,layoutMode:le,collaborationMode:pe,callbacks:ce}=i;this.browserService=h;let vt=this.layoutModalsAndCamerasConfig($,ut),W=document.createElement("div");this.frameConfig={apiKey:b.get("apiKey"),apiUrl:b.get("apiUrl"),ablyKey:b.get("ablyKey"),debug:b.get("debug"),roomId:b.get("roomId"),limits:b.get("limits"),collaborationMode:pe,canUseFollow:r,canUseGoTo:l,canUseCams:e,canUseChat:o,canUseGather:c,canUseScreenshare:s,canUseDefaultAvatars:n,canUseTranscription:y,canShowAudienceList:d,camerasPosition:(Ot=vt.camerasPosition)!=null?Ot:"right",canUseDefaultToolbar:v,devices:{audioInput:(Lt=N==null?void 0:N.audioInput)!=null?Lt:!0,audioOutput:(It=N==null?void 0:N.audioOutput)!=null?It:!0,videoInput:(Rt=N==null?void 0:N.videoInput)!=null?Rt:!0},waterMark:M,layoutMode:le,skipMeetingSettings:C,layoutPosition:vt.layoutPosition},this.customColors=u,this.callbacks=ce,this.styles=R,W.classList.add("sv_video_wrapper"),W.id="sv-video-wrapper",document.body.appendChild(W),this.updateFrameState(1),this.bricklayer=new ge,this.bricklayer.build(W.id,b.get("conferenceLayerUrl"),ki,void 0,{allow:"camera *;microphone *; display-capture *;"}),this.setFrameOffset(g),this.setFrameStyle(vt.camerasPosition),this.bricklayer.element.addEventListener("load",this.onFrameLoad),this.frameLocale={language:t,locales:S},this.meetingAvatars=O,window.addEventListener("resize",this.onWindowResize),window.addEventListener("orientationchange",this.onWindowResize)}get isWaterMarkEnabled(){return this.browserService.isMobileDevice?!1:this.frameConfig.waterMark}get isHorizontalCameraEnabled(){return this.browserService.isMobileDevice?!1:["top","bottom"].includes(this.frameConfig.camerasPosition)}addMessagesListeners(){this.messageBridge.listen("meeting.waiting-for-host",this.onWaitingForHostDidChange),this.messageBridge.listen("meeting.participant-joined",this.onParticipantJoined),this.messageBridge.listen("meeting.participant-list-update",this.onParticipantListUpdate),this.messageBridge.listen("meeting.participant-left",this.onParticipantLeft),this.messageBridge.listen("meeting.host-change",this.onMeetingHostChange),this.messageBridge.listen("meeting.kick-participant",this.onMeetingKickParticipant),this.messageBridge.listen("meeting.same-participant-error",this.onSameAccountError),this.messageBridge.listen("meeting.state-update",this.meetingStateUpdate),this.messageBridge.listen("meeting.connection-status-change",this.onConnectionStatusChange),this.messageBridge.listen("meeting.devices-change",this.onDevicesChange),this.messageBridge.listen("realtime.grid-mode-change",this.onGridModeChange),this.messageBridge.listen("realtime.drawing-change",this.onDrawingChange),this.messageBridge.listen("realtime.transcript-change",this.onTranscriptChange),this.messageBridge.listen("frame.dimensions-update",this.onFrameDimensionsUpdate),this.messageBridge.listen("realtime.follow-participant",this.onFollowParticipantDidChange),this.messageBridge.listen("realtime.go-to-participant",this.onGoToDidChange),this.messageBridge.listen("realtime.gather",this.onGather)}updateFrameState(i){i!==this.frameState&&(this.frameState=i,this.frameStateObserver.publish(this.frameState));let t={[1]:6,[2]:7,[0]:8};this.meetingStateUpdate(t[i])}start(i){this.messageBridge.publish("meeting.start",x(f({},i),{config:this.frameConfig}))}leave(){this.messageBridge.publish("meeting.leave"),this.destroy()}destroy(){var i,t,e,o,s,n,r,l,c,d;(i=this.messageBridge)==null||i.destroy(),(t=this.bricklayer)==null||t.destroy(),(e=this.frameSizeObserver)==null||e.destroy(),(o=this.realtimeEventsObserver)==null||o.destroy(),(s=this.sameAccountErrorObserver)==null||s.destroy(),(n=this.devicesObserver)==null||n.destroy(),(r=this.meetingStateObserver)==null||r.destroy(),(l=this.meetingConnectionObserver)==null||l.destroy(),(c=this.participantJoinedObserver)==null||c.destroy(),(d=this.participantLeftObserver)==null||d.destroy(),this.bricklayer=null,this.frameState=null,window.removeEventListener("resize",this.onWindowResize),window.removeEventListener("orientationchange",this.onWindowResize)}publishMessageToFrame(i,t){!this.messageBridge||this.messageBridge.publish(i,t)}};var Zo=1e3*60,qt=null,Yt=class extends k{constructor(t){var s,n;super();this.participantToFrameList=[];this.participantsOnMeeting=[];this.kickParticipantsOnHostLeave=!1;this.startVideo=()=>{var t,e,o,s,n,r,l,c,d,v,y,h,g,S,O,u,R,M,$,ut,C,N,le,pe,ce,vt,W,Ot,Lt,It,Rt,Pi,Ti,Ai,xi,Ci,_i;this.videoConfig={language:(t=this.params)==null?void 0:t.language,canUseTranscription:((e=this.params)==null?void 0:e.transcriptOff)===!1,canShowAudienceList:(s=(o=this.params)==null?void 0:o.showAudienceList)!=null?s:!0,canUseChat:!((n=this.params)!=null&&n.chatOff),canUseCams:!((r=this.params)!=null&&r.camsOff),canUseScreenshare:!((l=this.params)!=null&&l.screenshareOff),canUseDefaultAvatars:!!((c=this.params)!=null&&c.defaultAvatars)&&!((v=(d=this.localParticipant)==null?void 0:d.avatar)!=null&&v.model3DUrl),canUseGather:!!((y=this.params)!=null&&y.enableGather),canUseFollow:!!((h=this.params)!=null&&h.enableFollow),canUseGoTo:!!((g=this.params)!=null&&g.enableGoTo),canUseDefaultToolbar:(O=(S=this.params)==null?void 0:S.defaultToolbar)!=null?O:!0,camerasPosition:(R=(u=this.params)==null?void 0:u.collaborationMode)==null?void 0:R.position,devices:(M=this.params)==null?void 0:M.devices,skipMeetingSettings:($=this.params)==null?void 0:$.skipMeetingSettings,browserService:this.browserService,offset:(ut=this.params)==null?void 0:ut.offset,locales:(N=(C=this.params)==null?void 0:C.locales)!=null?N:[],avatars:(pe=(le=this.params)==null?void 0:le.avatars)!=null?pe:[],customColors:b.get("colors"),waterMark:b.get("waterMark"),styles:(ce=this.params)==null?void 0:ce.styles,collaborationMode:(Ot=(W=(vt=this.params)==null?void 0:vt.collaborationMode)==null?void 0:W.enabled)!=null?Ot:!0,layoutPosition:((It=(Lt=this.params)==null?void 0:Lt.collaborationMode)==null?void 0:It.enabled)===!1?"center":(Ti=(Pi=(Rt=this.params)==null?void 0:Rt.collaborationMode)==null?void 0:Pi.modalPosition)!=null?Ti:"center",layoutMode:(Ci=(xi=(Ai=this.params)==null?void 0:Ai.collaborationMode)==null?void 0:xi.initialView)!=null?Ci:"list",callbacks:(_i=this.params)==null?void 0:_i.callbacks},this.logger.log("video conference @ start video",this.videoConfig),this.videoManager=new Kt(this.videoConfig),this.subscribeToVideoEvents()};this.subscribeToVideoEvents=()=>{this.logger.log("video conference @ subscribe to video events"),this.videoManager.meetingConnectionObserver.subscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.subscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.subscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.subscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.subscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.subscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.subscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.subscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.subscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.subscribe(this.onSameAccountError),this.videoManager.devicesObserver.subscribe(this.onDevicesChange)};this.unsubscribeFromVideoEvents=()=>{this.logger.log("video conference @ unsubscribe from video events"),this.videoManager.meetingConnectionObserver.unsubscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.unsubscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.unsubscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.unsubscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.unsubscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.unsubscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.unsubscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.unsubscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.unsubscribe(this.onSameAccountError),this.videoManager.devicesObserver.unsubscribe(this.onDevicesChange)};this.suscribeToRealtimeEvents=()=>{this.logger.log("video conference @ subscribe to realtime events"),this.realtime.kickAllParticipantsObserver.subscribe(this.onKickAllParticipantsDidChange),this.realtime.kickParticipantObserver.subscribe(this.onKickLocalParticipant),this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.subscribe(this.onRealtimeParticipantsDidChange)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("video conference @ unsubscribe from realtime events"),this.realtime.kickAllParticipantsObserver.unsubscribe(this.onKickAllParticipantsDidChange),this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.unsubscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.unsubscribe(this.onRealtimeParticipantsDidChange)};this.createParticipantFromAblyPresence=t=>{var e;return{id:t.clientId,color:this.realtime.getSlotColor((e=t.data)==null?void 0:e.slotIndex).color,avatar:t.data.avatar,type:t.data.type,name:t.data.name,isHost:this.realtime.hostClientId===t.clientId}};this.onFrameSizeDidChange=t=>{this.publish("frame.dimensions-update",t)};this.onWaitingForHost=t=>{this.publish("meeting.waiting-for-host",t)};this.onConnectionStatusChange=t=>{this.logger.log("video conference @ on connection status change",t);let e=[2,4,3,6];e.includes(t)&&this.realtime.freezeSync(!0),e.includes(this.connectionService.oldConnectionStatus)&&!e.includes(t)&&this.realtime.freezeSync(!1),this.publish("meeting.connection-status-change",t)};this.onMeetingStateChange=t=>{this.logger.log("video conference @ on meeting state change",t),this.publish("meeting.state-update",t)};this.onSameAccountError=t=>{this.publish("meeting.same-participant-error",t),this.detach()};this.onDevicesChange=t=>{this.publish("meeting.devices-change",t)};this.onFrameStateChange=t=>{this.logger.log("video conference @ on frame state change",t),t===2&&(this.params.userType!=="guest"&&(this.localParticipant=Object.assign(this.localParticipant,{type:this.params.userType}),this.realtime.updateMyProperties(f({},this.localParticipant))),this.videoManager.start({group:this.group,participant:this.localParticipant,roomId:b.get("roomId")}),this.publish("meeting.start"))};this.onRealtimeEventFromFrame=({event:t,data:e})=>{this.logger.log("video conference @ on realtime event from frame",t,e);let o={["realtime.host-change"]:s=>this.realtime.setHost(s),["realtime.gather"]:s=>this.realtime.setGather(s),["realtime.grid-mode-change"]:s=>this.realtime.setGridMode(s),["realtime.drawing-change"]:s=>{this.realtime.setDrawing(s)},["realtime.follow-participant"]:s=>{this.realtime.setFollowParticipant(s)},["meeting.kick-participant"]:s=>{this.realtime.setKickParticipant(s)},["realtime.transcript-change"]:s=>{this.realtime.setTranscript(s)},["realtime.go-to-participant"]:s=>{this.eventBus.publish("realtime.go-to-participant",s)}}[t](e);this.publish(t,e)};this.onParticipantJoined=t=>{var e;if(this.logger.log("video conference @ on participant joined",t),this.localParticipant=t,this.publish("meeting.participant-joined",t),this.publish("my-participant.joined",t),this.kickParticipantsOnHostLeave=!((e=this.params)!=null&&e.allowGuests),this.videoConfig.canUseDefaultAvatars){this.realtime.updateMyProperties({avatar:t.avatar,name:t.name,type:t.type});return}this.realtime.updateMyProperties({name:t.name,type:t.type})};this.onParticipantLeft=t=>{this.logger.log("video conference @ on participant left",this.localParticipant),this.publish("my-participant.left",this.localParticipant),this.detach()};this.onParticipantListUpdate=t=>{this.logger.log("video conference @ on participant list update",t);let e=t.map(o=>{var n;let s=this.realtime.getParticipants[o.id];return{id:o.id,color:(n=o.color)!=null?n:this.realtime.getSlotColor(s.data.slotIndex).color,avatar:o.avatar,name:o.name,type:o.type,isHost:o.isHost}});Ni(this.participantsOnMeeting,e)||(this.publish("meeting.participant-list-update",e),this.participantsOnMeeting.length!==e.length&&this.publish("meeting.amount-of-participants-update",e.length),this.participantsOnMeeting=e)};this.onKickAllParticipantsDidChange=t=>{this.logger.log("video conference @ on kick all participants did change",t),this.publish("meeting.kick-all-participants",t),this.detach()};this.onKickLocalParticipant=()=>{this.logger.log("video conference @ on kick local participant"),this.publish("meeting.kick-participant",this.localParticipant),this.detach()};this.onRoomInfoUpdated=t=>{this.logger.log("video conference @ on room info updated",t);let{isGridModeEnable:e,followParticipantId:o,gather:s,drawing:n,transcript:r,hostClientId:l}=t;this.videoManager.publishMessageToFrame("realtime.host-change",l),this.onHostParticipantDidChange(l),this.videoManager.publishMessageToFrame("realtime.grid-mode-change",e),this.videoManager.publishMessageToFrame("realtime.drawing-change",n),this.videoManager.publishMessageToFrame("realtime.follow-participant",o),this.videoManager.publishMessageToFrame("realtime.transcript-change",r),this.realtime.hostClientId===this.localParticipant.id&&s&&this.realtime.setGather(!1)};this.onRealtimeParticipantsDidChange=t=>{this.logger.log("video conference @ on participants did change",t);let e=Object.values(t).map(o=>({timestamp:o.timestamp,connectionId:o.connectionId,participantId:o.clientId,color:this.realtime.getSlotColor(o.data.slotIndex).name,name:o.data.name,isHost:this.realtime.hostClientId===o.clientId,avatar:o.data.avatar,type:o.data.type}));Ni(this.participantToFrameList,e)||this.videoManager.publishMessageToFrame("realtime.participant-list-update",e),this.participantToFrameList=e,this.validateIfInTheRoomHasHost(t)};this.onHostParticipantDidChange=t=>{this.logger.log("video conference @ on host participant did change",t),this.videoManager.publishMessageToFrame("realtime.host-change",t);let e=this.participantsOnMeeting.find(o=>o.id===t);this.realtime.isLocalParticipantHost&&(this.realtime.setSyncProperty("meeting.host-change",e),this.publish("meeting.host-change",e))};this.onHostAvailabilityChange=t=>{if(this.logger.log("launcher service @ onHostAvailabilityChange"),t){this.publish("meeting.host-available");return}this.publish("meeting.no-host-available")};this.onParticipantJoinedOnRealtime=t=>{this.logger.log("video conference @ on participant joined on realtime",t),this.publish("meeting.participant-joined",this.createParticipantFromAblyPresence(t))};this.onParticipantLeftOnRealtime=t=>{this.logger.log("video conference @ on participant left on realtime",t),this.publish("meeting.participant-left",this.createParticipantFromAblyPresence(t))};this.validateIfInTheRoomHasHost=t=>{let e=Object.values(t).filter(n=>n.data.type==="host"),o=e.some(n=>n.clientId===this.realtime.hostClientId);if(!e.length&&this.kickParticipantsOnHostLeave&&this.localParticipant.type!=="host"&&!qt&&(this.logger.log("video conference @ validate if in the room has host - init kick all participants timeout"),qt=setTimeout(()=>{this.logger.log("video conference @ validate if in the room has host - kick all participants"),this.onKickLocalParticipant()},Zo)),e.length&&qt&&(this.logger.log("video conference @ validade if in the room has host - clear kick all participants timeout"),clearTimeout(qt),qt=null),this.onHostAvailabilityChange(!!e.length),!e.length||o)return;let s=e.reduce((n,r)=>(this.logger.log("video conference @ validade if in the room has host - reducing participants",{previus:n,current:r}),!n||r.clientId===this.realtime.hostClientId||r.timestamp>n.timestamp?r:n),null);s.clientId===this.realtime.hostClientId||s.clientId!==this.localParticipant.id||(this.logger.log("video conference @ validade if in the room has host - set host",s),this.realtime.setHost(s.clientId))};this.params=x(f({},t),{userType:(n=(s=t==null?void 0:t.participantType)!=null?s:t==null?void 0:t.userType)!=null?n:"guest"}),this.name="videoConference";let{localParticipant:e,group:o}=this.useStore("global-store");e.subscribe(),o.subscribe(),this.logger=new A(`@superviz/sdk/${"videoConference"}`),this.browserService=new jt,this.connectionService=new ve,this.connectionService.addListeners(),this.connectionService.connectionStatusObserver.subscribe(this.onConnectionStatusChange)}toggleMeetingSetup(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-setup")}toggleMicrophone(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-microphone")}toggleCam(){this.videoManager.publishMessageToFrame("meeting-controls.toggle-cam")}toggleScreenShare(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-screenshare")}toggleChat(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-chat")}toggleTranscript(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-transcript")}hangUp(){this.videoManager.publishMessageToFrame("hang-up")}start(){this.logger.log("video conference @ start"),this.suscribeToRealtimeEvents(),this.startVideo()}destroy(){this.logger.log("video conference @ destroy");let{data:t}=this.realtime.participant,e=t.activeComponents.filter(o=>o!=="videoConference");this.realtime.updateMyProperties({activeComponents:e,type:"guest"}),this.kickParticipantsOnHostLeave=!1,this.publish("destroy"),this.unsubscribeFromRealtimeEvents(),this.unsubscribeFromVideoEvents(),this.videoManager.leave(),this.connectionService.removeListeners()}};a();a();import*as j from"@superviz/socket-client";import{throttle as Xo}from"lodash";var Ee=class extends k{constructor(t,e){var s;super();this.transformation={translate:{x:0,y:0},scale:1};this.subscribeToRealtimeEvents=()=>{this.logger.log("presence-mouse component @ subscribe to realtime events"),this.room.presence.on(j.PresenceEvents.JOINED_ROOM,this.onPresenceJoinedRoom),this.room.presence.on(j.PresenceEvents.LEAVE,this.onPresenceLeftRoom),this.room.presence.on(j.PresenceEvents.UPDATE,this.onPresenceUpdate)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("presence-mouse component @ unsubscribe from realtime events"),this.room.presence.off(j.PresenceEvents.JOINED_ROOM),this.room.presence.off(j.PresenceEvents.LEAVE),this.room.presence.off(j.PresenceEvents.UPDATE)};this.setParticipantPrivate=t=>{this.isPrivate=t,this.room.presence.update({visible:!t})};this.onPresenceJoinedRoom=t=>{t.id===this.localParticipant.id&&this.room.presence.update(this.localParticipant)};this.onPresenceLeftRoom=t=>{this.removePresenceMouseParticipant(t.id)};this.onPresenceUpdate=t=>{if(this.following&&this.presences.get(this.following)&&this.goToMouse(this.following),t.id===this.localParticipant.id)return;let e=t.data;if(this.following&&e.id!==this.following&&this.presences.has(e.id)){this.removePresenceMouseParticipant(e.id);return}this.presences.set(e.id,e)};this.animate=()=>{this.renderDivWrapper(),this.updateParticipantsMouses(),requestAnimationFrame(this.animate)};this.goToMouse=t=>{let e=this.presences.get(t);if(!e)return;let o=this.canvas.getBoundingClientRect(),{width:s,height:n}=o,{x:r,y:l}=e,c=s/2,d=n/2,v=c-r,y=d-l;this.goToMouseCallback&&this.goToMouseCallback({x:v,y})};this.onMyParticipantMouseMove=Xo(t=>{let e=this.canvas.getContext("2d"),o=this.canvas.getBoundingClientRect(),s=t.x-o.left,n=t.y-o.top,l=(e==null?void 0:e.getTransform()).inverse(),c=new DOMPoint(s,n).matrixTransform(l),d={x:(c.x-this.transformation.translate.x)/this.transformation.scale,y:(c.y-this.transformation.translate.y)/this.transformation.scale};this.room.presence.update(x(f(f({},this.localParticipant),d),{visible:!this.isPrivate}))},100);this.onMyParticipantMouseOut=t=>{let{x:e,y:o,width:s,height:n}=this.canvas.getBoundingClientRect();t.x>0&&t.y>0&&t.x<e+s&&t.y<o+n||this.room.presence.update({visible:!1})};this.updateParticipantsMouses=()=>{this.presences.forEach(t=>{if(!(t!=null&&t.visible)){this.removePresenceMouseParticipant(t.id);return}this.renderPresenceMouses(t)})};this.renderPresenceMouses=t=>{let o=document.getElementById(`mouse-${t.id}`);o||(o=this.createMouseElement(t));let s=document.getElementById(`mouse-${t.id}`),n=document.getElementById(`mouse-${t.id}`);if(!s||!n)return;let r=s.getElementsByClassName("mouse-user-name")[0],l=n.getElementsByClassName("pointer-mouse")[0];l&&(l.style.backgroundImage=`url(https://production.cdn.superviz.com/static/pointers-v2/${t.slot.index}.svg)`),r&&(r.style.color=t.slot.textColor,r.style.backgroundColor=t.slot.color,r.innerHTML=t.name);let{x:c,y:d}=t,v=this.canvas.getContext("2d"),y=v==null?void 0:v.getTransform(),h=y==null?void 0:y.e,g=y==null?void 0:y.f,S=this.transformation.translate.x+(c+h)*this.transformation.scale,O=this.transformation.translate.y+(d+g)*this.transformation.scale,u=this.divWrapper.clientWidth>S&&this.divWrapper.clientHeight>O&&t.visible;o.style.opacity=u?"1":"0",o.style.left=`${S}px`,o.style.top=`${O}px`};this.followMouse=t=>{this.following=t};if(this.name="presence",this.logger=new A(`@superviz/sdk/${"presence"}`),this.canvas=document.getElementById(t),this.presences=new Map,!this.canvas){let n=`Canvas with id ${t} not found`;throw this.logger.log(n),new Error(n)}this.divWrapper=this.renderDivWrapper(),this.animateFrame=requestAnimationFrame(this.animate),this.goToMouseCallback=(s=e==null?void 0:e.callbacks)==null?void 0:s.onGoToPresence;let{localParticipant:o}=this.useStore("global-store");o.subscribe()}start(){this.logger.log("presence-mouse component @ start"),this.canvas.addEventListener("mousemove",this.onMyParticipantMouseMove),this.canvas.addEventListener("mouseout",this.onMyParticipantMouseOut),this.eventBus.subscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.subscribe("realtime.local-follow-participant",this.followMouse),this.eventBus.subscribe("realtime.private-mode",this.setParticipantPrivate),this.subscribeToRealtimeEvents()}destroy(){this.logger.log("presence-mouse component @ destroy"),this.eventBus.unsubscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.unsubscribe("realtime.local-follow-participant",this.followMouse),this.eventBus.unsubscribe("realtime.private-mode",this.setParticipantPrivate),this.unsubscribeFromRealtimeEvents(),cancelAnimationFrame(this.animateFrame),this.canvas.removeEventListener("mousemove",this.onMyParticipantMouseMove),this.canvas.removeEventListener("mouseout",this.onMyParticipantMouseOut),this.divWrapper.remove()}renderDivWrapper(){let t=this.canvas.getBoundingClientRect(),e=document.getElementById("superviz-presence-mouse-wrapper");return e||(e=document.createElement("div"),e.id="superviz-presence-mouse-wrapper",this.canvas.parentElement.style.position="relative",this.canvas.parentElement.appendChild(e)),e.style.position="fixed",e.style.top=`${t.top}px`,e.style.left=`${t.left}px`,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`,e.style.pointerEvents="none",e.style.overflow="hidden",e.style.zIndex="2",e}removePresenceMouseParticipant(t){let e=document.getElementById(`mouse-${t}`);e&&(e.remove(),this.presences.delete(t))}createMouseElement(t){let e=document.createElement("div");e.setAttribute("id",`mouse-${t.id}`),e.setAttribute("class","mouse-follower");let o=document.createElement("div");o.setAttribute("class","pointer-mouse");let s=document.createElement("div");return s.setAttribute("class","mouse-user-name"),s.innerHTML=t.name,e.appendChild(o),e.appendChild(s),e.style.left="0px",e.style.top="0px",this.divWrapper.appendChild(e),e}transform(t){this.transformation=t}};a();import*as J from"@superviz/socket-client";import{isEqual as Qo}from"lodash";import{fromEvent as ts,throttleTime as es}from"rxjs";a();var we=(g=>(g.AREA="area",g.BASE="base",g.BR="br",g.COL="col",g.EMBED="embed",g.HR="hr",g.IMG="img",g.INPUT="input",g.LINK="link",g.META="meta",g.PARAM="param",g.SOURCE="source",g.TRACK="track",g.WBR="wbr",g))(we||{}),Pe=(e=>(e.RECT="rect",e.ELLIPSE="ellipse",e.SVG="svg",e))(Pe||{});var Te=class extends k{constructor(t,e){var s;super();this.presences=new Map;this.mouses=new Map;this.transformation={translate:{x:0,y:0},scale:1};this.onMyParticipantMouseMove=t=>{if(this.isPrivate)return;let e=t.currentTarget,{left:o,top:s}=e.getBoundingClientRect(),n=(t.x-o-this.transformation.translate.x)/this.transformation.scale,r=(t.y-s-this.transformation.translate.y)/this.transformation.scale;this.room.presence.update(x(f({},this.localParticipant),{x:n,y:r,visible:!0}))};this.onMyParticipantMouseLeave=()=>{this.room.presence.update({visible:!1})};this.goToMouse=t=>{let e=this.mouses.get(t);if(!!e){if(this.goToPresenceCallback){let{x:o,y:s}=this.mouses.get(t).getBoundingClientRect();this.goToPresenceCallback({x:o,y:s});return}e.scrollIntoView({block:"center",inline:"center",behavior:"smooth"})}};this.followMouse=t=>{this.userBeingFollowedId=t};this.setParticipantPrivate=t=>{this.isPrivate=t,this.room.presence.update({visible:!t})};this.onPresenceJoinedRoom=t=>{t.id===this.localParticipant.id&&this.room.presence.update(this.localParticipant)};this.onPresenceLeftRoom=t=>{this.removePresenceMouseParticipant(t.id)};this.onPresenceUpdate=t=>{if(t.id===this.localParticipant.id)return;let e=t.data;if(this.userBeingFollowedId&&e.id!==this.userBeingFollowedId&&this.presences.has(e.id)){this.removePresenceMouseParticipant(e.id);return}this.presences.set(e.id,e),this.animate(),this.updateParticipantsMouses()};this.animate=()=>{we[this.containerTagname]&&this.updateVoidElementWrapper(),Pe[this.containerTagname]&&this.updateSVGElementWrapper(),this.animationFrame=requestAnimationFrame(this.animate)};this.updateParticipantsMouses=()=>{this.presences.forEach(e=>{if(e.id!==this.localParticipant.id){if(!(e!=null&&e.visible)){this.removePresenceMouseParticipant(e.id);return}this.renderPresenceMouses(e)}}),this.presences.has(this.userBeingFollowedId)&&this.goToMouse(this.userBeingFollowedId)};this.renderPresenceMouses=t=>{if(t.id===this.localParticipant.id)return;let e=document.getElementById(`mouse-${t.id}`);if(e||(e=this.createMouseElement(t)),!e)return;let o=e.getElementsByClassName("mouse-user-name")[0],s=e.getElementsByClassName("pointer-mouse")[0];s&&(s.style.backgroundImage=`url(https://production.cdn.superviz.com/static/pointers-v2/${t.slot.index}.svg)`),o&&(o.style.color=t.slot.textColor,o.style.backgroundColor=t.slot.color,o.innerHTML=t.name);let{x:n,y:r}=t,{translate:{x:l,y:c},scale:d}=this.transformation;e.style.transform=`translate(${l+n*d}px, ${c+r*d}px)`};this.renderVoidElementWrapper=()=>{let t=document.createElement("div"),e=this.container,{width:o,height:s,left:n,top:r}=this.container.getBoundingClientRect(),l=e.offsetLeft-n,c=e.offsetTop-r;t.style.position="absolute",t.style.width=`${o}px`,t.style.height=`${s}px`,t.style.top=`${r}px`,t.style.left=`${n}px`,t.style.overflow="visible",t.style.pointerEvents="none",this.container.parentElement.appendChild(t),this.wrapper=t};this.renderSVGElementWrapper=()=>{let t=this.containerTagname.toLowerCase();if(t==="svg"){this.createSVGWrapper();return}if(t==="rect"){this.createRectWrapper();return}t==="ellipse"&&this.createEllipseWrapper()};if(this.container=document.getElementById(t),this.logger=new A(`@superviz/sdk/${"presence"}`),!this.container){let n=`Element with id ${t} not found`;throw this.logger.log(n),new Error(n)}this.name="presence";let{localParticipant:o}=this.useStore("global-store");o.subscribe(),this.containerTagname=this.container.tagName.toUpperCase(),this.goToPresenceCallback=(s=e==null?void 0:e.callbacks)==null?void 0:s.onGoToPresence}start(){this.logger.log("presence-mouse component @ start"),this.renderWrapper(),this.addListeners(),this.subscribeToRealtimeEvents(),this.eventBus.subscribe("realtime.private-mode",this.setParticipantPrivate),this.animationFrame=requestAnimationFrame(this.animate),this.eventBus.subscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.subscribe("realtime.local-follow-participant",this.followMouse)}destroy(){cancelAnimationFrame(this.animationFrame),this.logger.log("presence-mouse component @ destroy"),this.removeListeners(),this.wrapper.remove(),this.presences.clear(),this.presences=void 0,this.container=void 0,this.wrapper=void 0,this.unsubscribeFromRealtimeEvents(),this.eventBus.unsubscribe("realtime.private-mode",this.setParticipantPrivate),this.eventBus.unsubscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.unsubscribe("realtime.local-follow-participant",this.followMouse),this.logger=void 0}subscribeToRealtimeEvents(){this.logger.log("presence-mouse component @ subscribe to realtime events"),this.room.presence.on(J.PresenceEvents.JOINED_ROOM,this.onPresenceJoinedRoom),this.room.presence.on(J.PresenceEvents.LEAVE,this.onPresenceLeftRoom),this.room.presence.on(J.PresenceEvents.UPDATE,this.onPresenceUpdate)}unsubscribeFromRealtimeEvents(){this.logger.log("presence-mouse component @ unsubscribe from realtime events"),this.room.presence.off(J.PresenceEvents.JOINED_ROOM),this.room.presence.off(J.PresenceEvents.LEAVE),this.room.presence.off(J.PresenceEvents.UPDATE)}addListeners(){this.pointerMoveObserver=ts(this.container,"pointermove").pipe(es(200)).subscribe(this.onMyParticipantMouseMove),this.container.addEventListener("pointerleave",this.onMyParticipantMouseLeave)}removeListeners(){var t;(t=this.pointerMoveObserver)==null||t.unsubscribe(),this.container.removeEventListener("pointerleave",this.onMyParticipantMouseLeave)}setPositionNotStatic(){let{position:t}=window.getComputedStyle(this.container);t==="static"&&this.container.style.setProperty("position","relative")}createMouseElement(t){if(!this.wrapper)return;let e=document.createElement("div");e.setAttribute("id",`mouse-${t.id}`),e.setAttribute("class","mouse-follower");let o=document.createElement("div");o.setAttribute("class","pointer-mouse");let s=document.createElement("div");return s.setAttribute("class","mouse-user-name"),s.innerHTML=t.name,e.appendChild(o),e.appendChild(s),e.style.left="0px",e.style.top="0px",this.wrapper.appendChild(e),this.mouses.set(t.id,e),e}updateSVGPosition(){let t=this.container.parentElement.getBoundingClientRect(),e=this.container.getBoundingClientRect(),o=e.left-t.left,s=e.top-t.top,{width:n,height:r}=this.container.getBoundingClientRect();this.wrapper.style.setProperty("width",`${n}px`),this.wrapper.style.setProperty("height",`${r}px`),this.wrapper.style.setProperty("top",`${s}px`),this.wrapper.style.setProperty("left",`${o}px`)}createSVGWrapper(){let t=document.createElement("div"),e=this.container.parentElement.getBoundingClientRect(),o=this.container.getBoundingClientRect(),s=o.left-e.left,n=o.top-e.top,{width:r,height:l}=this.container.getBoundingClientRect();t.style.position="fixed",t.style.width=`${r}px`,t.style.height=`${l}px`,t.style.top=`${n}px`,t.style.left=`${s}px`,t.style.overflow="visible",t.style.pointerEvents="none",t.id="superviz-svg-wrapper",this.container.parentElement.appendChild(t),this.wrapper=t}createRectWrapper(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","rect"),o=document.createElement("div"),s=this.container.getAttribute("width"),n=this.container.getAttribute("height"),r=this.container.getAttribute("rx"),l=this.container.getAttribute("ry");e.setAttribute("fill","transparent"),e.setAttribute("stroke","transparent"),e.setAttribute("x","0"),e.setAttribute("y","0"),e.setAttribute("rx",r),e.setAttribute("ry",l),e.setAttribute("height",n),e.setAttribute("width",s),t.setAttribute("height",n),t.setAttribute("width",s),t.appendChild(e),o.appendChild(t);let c=this.container.getBoundingClientRect();o.style.position="fixed",o.style.top=`${c.top}px`,o.style.left=`${c.left}px`,o.style.width=`${c.width}px`,o.style.height=`${c.height}px`,o.style.overflow="visible",o.style.pointerEvents="none",o.id="superviz-rect-wrapper";let d=this.container.viewportElement;for(;d.viewportElement;)d=d.viewportElement;d.parentElement.appendChild(o),this.wrapper=o}createEllipseWrapper(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),o=document.createElement("div"),s=this.container.getAttribute("cx"),n=this.container.getAttribute("cy"),r=this.container.getAttribute("rx"),l=this.container.getAttribute("ry"),c=Number(s)-Number(r),d=Number(n)-Number(l),v=String(2*Number(s)),y=String(2*Number(n));e.setAttribute("fill","transparent"),e.setAttribute("stroke","transparent"),e.setAttribute("x","0"),e.setAttribute("y","0"),e.setAttribute("rx",r),e.setAttribute("ry",l),e.setAttribute("cx",`${Number(s)-c}`),e.setAttribute("cy",`${Number(n)-d}`),e.setAttribute("height",y),e.setAttribute("width",v),t.setAttribute("height",y),t.setAttribute("width",v),t.appendChild(e),o.appendChild(t);let h=this.container.getBoundingClientRect();o.style.position="fixed",o.style.top=`${h.top}px`,o.style.left=`${h.left}px`,o.style.width=`${h.width}px`,o.style.height=`${h.height}px`,o.style.overflow="visible",o.style.pointerEvents="none",o.id="superviz-ellipse-wrapper";let g=this.container.viewportElement;for(;g.viewportElement;)g=g.viewportElement;g.parentElement.appendChild(o),this.wrapper=o}transform(t){this.transformation=t}updateVoidElementWrapper(){let t=this.container.getBoundingClientRect(),e=this.wrapper.getBoundingClientRect(),o=this.container;if(Qo(t,e))return;let s=o.offsetLeft,n=o.offsetTop;this.wrapper.style.setProperty("width",`${t.width}px`),this.wrapper.style.setProperty("height",`${t.height}px`),this.wrapper.style.setProperty("top",`${n}px`),this.wrapper.style.setProperty("left",`${s}px`),this.wrapper.id="superviz-void-wrapper"}updateSVGElementWrapper(){let{left:t,top:e,width:o,height:s}=this.container.getBoundingClientRect(),{left:n,top:r,width:l,height:c}=this.wrapper.getBoundingClientRect();if(!(t===n&&e===r&&o===l&&s===c)){if(this.containerTagname.toLowerCase()==="svg"){this.updateSVGPosition();return}this.wrapper.style.setProperty("width",`${o}px`),this.wrapper.style.setProperty("height",`${s}px`),this.wrapper.style.setProperty("top",`${e}px`),this.wrapper.style.setProperty("left",`${t}px`)}}renderWrapper(){if(!this.wrapper){if(we[this.containerTagname]){this.renderVoidElementWrapper();return}if(Pe[this.containerTagname]){this.renderSVGElementWrapper();return}this.renderElementWrapper()}}removePresenceMouseParticipant(t){let e=document.getElementById(`mouse-${t}`);e&&(e.remove(),this.presences.delete(t),this.mouses.delete(t))}renderElementWrapper(){let t=document.createElement("div");t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.top="0",t.style.left="0",t.style.overflow="visible",t.style.pointerEvents="none",this.setPositionNotStatic(),this.container.appendChild(t),this.wrapper=t}};var Zt=class{constructor(i,t){let e=document.getElementById(i);if(!e)throw new Error(`[Superviz] Container with id ${i} not found`);return e.tagName.toLowerCase()==="canvas"?new Ee(i,t):new Te(i,t)}};a();import*as Di from"@superviz/socket-client";import is from"lodash/throttle";a();var Ae=(t=>(t.STARTED="STARTED",t.STOPPED="STOPPED",t))(Ae||{}),xe=(i=>(i.REALTIME_STATE_CHANGED="realtime-component.state-changed",i))(xe||{});var Xt=class extends k{constructor(){super();this.callbacksToSubscribeWhenJoined=[];this.state="STOPPED";this.publish=is((t,e)=>{if(Object.values(gt).includes(t)){this.publishEventToClient(t,e);return}if(this.state!=="STARTED"){let o=`Realtime component is not started yet. You can't publish event ${t} before start`;this.logger.log(o);return}this.room.emit("message",{name:t,payload:e})},200);this.subscribe=(t,e)=>{if(this.state!=="STARTED"){this.callbacksToSubscribeWhenJoined.push({event:t,callback:e});return}this.observers[t]||(this.observers[t]=new E),this.observers[t].subscribe(e)};this.unsubscribe=(t,e)=>{!this.observers[t]||this.observers[t].unsubscribe(e)};this.publishEventToClient=(t,e)=>{this.logger.log("pubsub service @ publishEventToClient",{event:t,data:e}),this.observers[t]&&this.observers[t].publish(e)};this.name="realtime",this.logger=new A("@superviz/sdk/realtime-component");let{localParticipant:t}=this.useStore("global-store");t.subscribe()}destroy(){this.logger.log("destroyed"),this.changeState("STOPPED"),this.room.disconnect()}start(){this.logger.log("started"),this.subscribeToRealtimeEvents()}fetchHistory(t){return T(this,null,function*(){return yield new Promise((o,s)=>{let n=r=>{var c;(c=r.events)!=null&&c.length||o(null);let l=r.events.reduce((d,v)=>(d[v.data.name]||(d[v.data.name]=[]),d[v.data.name].push({data:v.data.payload,name:v.data.name,participantId:v.presence.id,timestamp:v.timestamp}),d),{});t&&!l[t]&&s(new Error(`Event ${t} not found in the history`)),t&&o(l[t]),o(l)};this.room.history(n)})})}changeState(t){this.logger.log("realtime component @ changeState - state changed",t),this.state=t,this.publishEventToClient("realtime-component.state-changed",this.state)}subscribeToRealtimeEvents(){this.room.presence.on(Di.PresenceEvents.JOINED_ROOM,t=>{t.id===this.localParticipant.id&&(this.logger.log("joined room"),this.changeState("STARTED"),this.callbacksToSubscribeWhenJoined.forEach(({event:e,callback:o})=>{this.subscribe(e,o)}))}),this.room.on("message",t=>{this.logger.log("message received",t),this.publishEventToClient(t.data.name,{data:t.data.payload,participantId:t.presence.id,name:t.data.name,timestamp:t.timestamp})})}};a();import{isEqual as os}from"lodash";a();var He=(o=>(o.TOP_LEFT="top-left",o.TOP_RIGHT="top-right",o.BOTTOM_LEFT="bottom-left",o.BOTTOM_RIGHT="bottom-right",o))(He||{});var Qt=class extends k{constructor(t){var e;super();this.participants=[];this.onParticipantListUpdate=t=>{let o=Object.values(t).filter(({data:s})=>{var n;return(n=s.activeComponents)==null?void 0:n.includes("whoIsOnline")}).filter(({data:{isPrivate:s,id:n}})=>!s||s&&n===this.localParticipantId).map(({data:s})=>{let{slotIndex:n,id:r,name:l,avatar:c,activeComponents:d}=s,{color:v}=this.realtime.getSlotColor(n),y=this.localParticipantId===r,h=d.some(g=>g.includes("presence"));return this.setLocalData(y,!h,h),{name:l,id:r,slotIndex:n,color:v,isLocal:y,joinedPresence:h,avatar:c}});os(o,this.participants)||(this.following&&(o.find(({id:n})=>n===this.following)||this.stopFollowing({clientId:this.following})),this.participants=o,this.element.updateParticipants(this.participants))};this.setLocalData=(t,e,o)=>{!t||(this.element.disableDropdown=e,this.element.localParticipantData=x(f({},this.element.localParticipantData),{joinedPresence:o}))};this.goToMousePointer=({detail:{id:t}})=>{t!==this.localParticipantId&&(this.eventBus.publish("realtime.go-to-participant",t),this.publish("who-is-online.go-to-participant",t))};this.followMousePointer=({detail:t})=>{if(this.eventBus.publish("realtime.local-follow-participant",t.id),this.following=t.id,this.following){this.publish("who-is-online.start-following-participant",this.following);return}this.publish("who-is-online.stop-following-participant")};this.setPrivate=({detail:{isPrivate:t,id:e}})=>{if(this.eventBus.publish("realtime.private-mode",t),this.realtime.setPrivateWIOParticipant(e,t),t){this.publish("who-is-online.enter-private-mode");return}this.publish("who-is-online.leave-private-mode")};this.setFollow=t=>{var e;if(t.clientId!==this.localParticipantId){if(this.followMousePointer({detail:{id:(e=t==null?void 0:t.data)==null?void 0:e.id}}),!t.data.id){this.element.following=void 0;return}this.following=t.data.id,this.element.following=t.data}};this.follow=t=>{var e;if(this.realtime.setFollowWIOParticipant(f({},t.detail)),this.following=(e=t.detail)==null?void 0:e.id,this.following){this.publish("who-is-online.start-follow-me",this.following);return}this.publish("who-is-online.stop-follow-me")};this.stopFollowing=t=>{var e;t.clientId===((e=this.element.following)==null?void 0:e.id)&&(this.element.following=void 0,this.following=void 0,this.eventBus.publish("realtime.local-follow-participant",void 0),this.publish("who-is-online.stop-following-participant"))};this.gather=t=>{this.realtime.setGatherWIOParticipant(f({},t.detail)),this.publish("who-is-online.gather-all",t.detail.id)};if(this.name="whoIsOnline",this.logger=new A("@superviz/sdk/who-is-online-component"),typeof t!="object"){this.position=t!=null?t:"top-right";return}this.position=(e=t.position)!=null?e:"top-right",this.setStyles(t.styles)}start(){let{localParticipant:t}=this.useStore("global-store");t.subscribe(e=>{this.localParticipantId=e.id}),this.subscribeToRealtimeEvents(),this.positionWhoIsOnline(),this.addListeners(),this.realtime.enterWIOChannel(t.subject.value)}destroy(){this.unsubscribeToRealtimeEvents(),this.realtime.leaveWIOChannel(),this.removeListeners(),this.element.remove(),this.element=null,this.participants=null}addListeners(){this.element.addEventListener("realtime.local-follow-participant",this.followMousePointer),this.element.addEventListener("realtime.go-to-participant",this.goToMousePointer),this.element.addEventListener("realtime.private-mode",this.setPrivate),this.element.addEventListener("realtime.follow-participant",this.follow),this.element.addEventListener("realtime.gather",this.gather)}removeListeners(){this.element.removeEventListener("realtime.local-follow-participant",this.followMousePointer),this.element.removeEventListener("realtime.go-to-participant",this.goToMousePointer),this.element.removeEventListener("realtime.private-mode",this.setPrivate),this.element.removeEventListener("realtime.follow-participant",this.follow),this.element.removeEventListener("realtime.gather",this.gather)}subscribeToRealtimeEvents(){this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate),this.realtime.participantLeaveObserver.subscribe(this.stopFollowing),this.realtime.privateModeWIOObserver.subscribe(this.onParticipantListUpdate),this.realtime.followWIOObserver.subscribe(this.setFollow),this.realtime.gatherWIOObserver.subscribe(this.goToMousePointer)}unsubscribeToRealtimeEvents(){this.realtime.participantsObserver.unsubscribe(this.onParticipantListUpdate),this.realtime.participantLeaveObserver.unsubscribe(this.stopFollowing),this.realtime.privateModeWIOObserver.unsubscribe(this.onParticipantListUpdate),this.realtime.followWIOObserver.unsubscribe(this.setFollow),this.realtime.gatherWIOObserver.unsubscribe(this.goToMousePointer)}setStyles(t=""){if(!t)return;let e=document.createElement("style");e.textContent=t,e.id="superviz-who-is-online-styles",document.head.appendChild(e)}positionWhoIsOnline(){if(this.element=document.createElement("superviz-who-is-online"),Object.values(He).includes(this.position.toLowerCase())){document.body.appendChild(this.element);let[o,s]=this.position.split("-");this.element.position=`${o}: 20px; ${s}: 40px;`;return}let e=document.getElementById(this.position);if(!e){this.element.position="top: 20px; right: 40px;",document.body.appendChild(this.element);return}e.appendChild(this.element),this.element.position="position: relative;"}};a();import{debug as qi}from"debug";a();var Ue=(u=>(u.svPrimary="sv-primary",u.svPrimary900="sv-primary-900",u.svPrimary200="sv-primary-200",u.svSecondary="sv-secondary",u.svGray="sv-gray",u.svSuccess="sv-success",u.svDanger="sv-danger",u.svBlack="sv-black",u.svWhite="sv-white",u.svGray100="sv-gray-100",u.svGray200="sv-gray-200",u.svGray300="sv-gray-300",u.svGray400="sv-gray-400",u.svGray500="sv-gray-500",u.svGray600="sv-gray-600",u.svGray700="sv-gray-700",u.svGray800="sv-gray-800",u))(Ue||{});a();a();function ss(p,i){return T(this,null,function*(){try{return(yield L.validateApiKey(p,i))===!0}catch(t){if(t.status===404)return!1;throw new Error("Unable to validate API key")}})}var Bi=ss;a();var Et=class{static getRemoteConfig(){return T(this,arguments,function*(i="prod"){let{version:t}=yield Promise.resolve().then(()=>(Fi(),$i));if(i==="local"){let{remoteConfig:s}=yield Promise.resolve().then(()=>Do(Gi()));return s}let e={version:t,environment:i},o=this.createUrl(e);return I(o,"GET",null)})}static createUrl({version:i,environment:t}){return`${this.REMOTE_CONFIG_BASE_URL}/${i}?env=${t}`}};Et.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";a();import*as K from"@superviz/socket-client";import{isEqual as Ji}from"lodash";a();var te=class{constructor(){this.observers=new Map;this.subscribe=(i,t)=>{this.logger.log("event bus service @ subscribe",{event:i,callback:t}),this.observers.has(i)||this.observers.set(i,new E),this.observers.get(i).subscribe(t)};this.unsubscribe=(i,t)=>{this.logger.log("event bus service @ unsubscribe",{event:i,callback:t}),this.observers.has(i)&&(this.observers.get(i).reset(),this.observers.delete(i))};this.publish=(i,t)=>{this.logger.log("event bus service @ publish",{event:i,data:t}),this.observers.has(i)&&this.observers.get(i).publish(t)};this.destroy=()=>{this.logger.log("event bus service @ destroy"),this.observers.forEach(i=>{i.reset(),i.destroy()}),this.observers.clear()};this.logger=new A("@superviz/sdk/event-bus"),this.logger.log("event bus created")}};a();import*as Hi from"@superviz/socket-client";import{Subject as as}from"rxjs";var Ce=class{constructor(i){this.stateSubject=new as;this.client=new Hi.Realtime(b.get("apiKey"),b.get("environment"),{id:i.id,name:i.name}),this.subscribeToDefaultEvents()}destroy(){this.client.destroy(),this.client.connection.off()}onStateChange(i){this.stateSubject.subscribe(i)}subscribeToDefaultEvents(){this.client.connection.on(i=>{this.state=i,this.stateSubject.next(i)})}createRoom(i){let t=b.get("roomId");return this.client.connect(`${t}:${i}`)}};a();var ee=class{static checkComponentLimit(i){var o,s;let t=(o=ze[i])!=null?o:i,e=b.get("limits");return(s=e==null?void 0:e[t])!=null?s:!1}};a();a();import Ui from"ably";import Wi from"lodash/throttle";a();var wt=(u=>(u[u.turquoise=0]="turquoise",u[u.orange=1]="orange",u[u.blue=2]="blue",u[u.pink=3]="pink",u[u.purple=4]="purple",u[u.green=5]="green",u[u.red=6]="red",u[u.bluedark=7]="bluedark",u[u.pinklight=8]="pinklight",u[u.purplelight=9]="purplelight",u[u.greenlight=10]="greenlight",u[u.orangelight=11]="orangelight",u[u.bluelight=12]="bluelight",u[u.redlight=13]="redlight",u[u.brown=14]="brown",u[u.yellow=15]="yellow",u[u.gray=16]="gray",u))(wt||{}),Pt=[1,3,4,6,7,14,16],ie=(p=>(p[p["#31E0B0"]=0]="#31E0B0",p[p["#FF5E10"]=1]="#FF5E10",p[p["#00ABF7"]=2]="#00ABF7",p[p["#FF00BB"]=3]="#FF00BB",p[p["#9C29FF"]=4]="#9C29FF",p[p["#6FDD00"]=5]="#6FDD00",p[p["#E30000"]=6]="#E30000",p[p["#304AFF"]=7]="#304AFF",p[p["#FF89C4"]=8]="#FF89C4",p[p["#D597FF"]=9]="#D597FF",p[p["#C6EC5C"]=10]="#C6EC5C",p[p["#FFA115"]=11]="#FFA115",p[p["#75DEFE"]=12]="#75DEFE",p[p["#FAA291"]=13]="#FAA291",p[p["#BB813F"]=14]="#BB813F",p[p["#FFEF33"]=15]="#FFEF33",p[p["#878291"]=16]="#878291",p))(ie||{});a();var We=(l=>(l[l.DISCONNECTED=0]="DISCONNECTED",l[l.INITIALIZING=1]="INITIALIZING",l[l.READY_TO_JOIN=2]="READY_TO_JOIN",l[l.CONNECTING=3]="CONNECTING",l[l.CONNECTED=4]="CONNECTED",l[l.JOINED=5]="JOINED",l[l.FAILED=-1]="FAILED",l[l.RETRYING=-2]="RETRYING",l))(We||{});a();var _e=class{constructor(){this.participantObservers=[],this.participants3DObservers=[],this.logger=new A("@superviz/sdk/realtime-service"),this.participantsObserver=new E({logger:this.logger}),this.participantJoinedObserver=new E({logger:this.logger}),this.participantLeaveObserver=new E({logger:this.logger}),this.reconnectObserver=new E({logger:this.logger}),this.sameAccountObserver=new E({logger:this.logger}),this.roomInfoUpdatedObserver=new E({logger:this.logger}),this.roomListUpdatedObserver=new E({logger:this.logger}),this.realtimeStateObserver=new E({logger:this.logger}),this.kickAllParticipantsObserver=new E({logger:this.logger}),this.kickParticipantObserver=new E({logger:this.logger}),this.authenticationObserver=new E({logger:this.logger}),this.commentsObserver=new E({logger:this.logger}),this.presenceMouseObserver=new E({logger:this.logger}),this.privateModeWIOObserver=new E({logger:this.logger}),this.followWIOObserver=new E({logger:this.logger}),this.gatherWIOObserver=new E({logger:this.logger}),this.presence3dObserver=new E({logger:this.logger}),this.presence3dLeaveObserver=new E({logger:this.logger}),this.presence3dJoinedObserver=new E({logger:this.logger})}subscribeToParticipantUpdate(i,t){this.participantObservers[i]||(this.participantObservers[i]=new E({logger:this.logger})),this.participantObservers[i].subscribe(t)}unsubscribeFromParticipantUpdate(i,t){this.participantObservers[i]&&this.participantObservers[i].unsubscribe(t)}subscribeToParticipant3DUpdate(i,t){this.participants3DObservers[i]||(this.participants3DObservers[i]=new E({logger:this.logger})),this.participants3DObservers[i].subscribe(t)}unsubscribeFromParticipant3DUpdate(i,t){this.participants3DObservers[i]&&this.participants3DObservers[i].unsubscribe(t)}getSlotColor(i){let t=i!=null?i:16;return{color:ie[t],name:wt[t]}}};var Vi=6e4,ls=1e4,ps=1e3;var Tt=class extends _e{constructor(t,e){super();this.participants={};this.participantsWIO={};this.participantsMouse={};this.participantsOn3d={};this.hostParticipantId=null;this.myParticipant=null;this.commentsChannel=null;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.presenceWIOChannel=null;this.presence3DChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.isReconnecting=!1;this.isJoinedRoom=!1;this.isJoinedPresence3D=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.left=!1;this.domainWhitelisted=!0;this.state=0;this.setHost=t=>{this.updateRoomProperties({hostClientId:t})};this.setKickParticipant=t=>{if(!t)return;let e=this.participants[t];this.updateRoomProperties({kickParticipant:e})};this.freezeSync=t=>{var e,o;if(this.isSyncFrozen=t,t){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(e=this.broadcastChannel)==null||e.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(o=this.broadcastChannel)==null||o.unsubscribe();return}this.join()};this.setParticipantData=t=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,t),this.updateMyProperties(this.myParticipant.data),this.updatePresence3D(this.myParticipant.data)};this.updateLocalRoomState=t=>T(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,t),this.roomInfoUpdatedObserver.publish(this.localRoomProperties),this.updateParticipants(),t.kickParticipant&&t.kickParticipant.clientId===this.myParticipant.clientId&&(this.updateRoomProperties({kickParticipant:null}),this.kickParticipantObserver.publish(this.myParticipant.clientId))});this.updateMyProperties=(t={})=>{let e=t;this.isMessageTooBig(e)||this.left||!this.enableSync||this.isSyncFrozen||(e.avatar===void 0&&delete e.avatar,this.myParticipant.data=f(f({},this.myParticipant.data),e),this.isJoinedRoom&&(this.supervizChannel.presence.update(this.myParticipant.data),this.logger.log("REALTIME","updating my properties",this.myParticipant.data)))};this.updateRoomProperties=t=>{if(this.isMessageTooBig(t)||this.isSyncFrozen||this.left)return;let e=f(f({},this.localRoomProperties),t);this.supervizChannel.publish("update",e)};this.updateParticipants=()=>{let t={};this.supervizChannel.presence.get((e,o)=>{o.forEach(s=>{t[s.clientId]=f({},s)}),this.participants=t,this.participantsObserver.publish(this.participants)})};this.initializeRoomProperties=()=>{let t={isGridModeEnable:!1,hostClientId:null,followParticipantId:null,gather:!1,drawing:null};this.updateParticipants(),this.updateRoomProperties(t)};this.onParticipantJoin=t=>{this.updateParticipants(),this.participantJoinedObserver.publish(t),this.updateMyProperties()};this.syncBroadcast=Wi(()=>{let t=btoa(this.ablyKey),e=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(e,{headers:{Authorization:`Basic ${t}`}}).then(o=>o.json()).then(o=>{this.broadcastChannel.publish("update",o)})},1e3);this.isMessageTooBig=(t,e=Vi)=>{let o=JSON.stringify(t);return new TextEncoder().encode(o).length>e?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.onCommentsChannelUpdate=t=>{this.logger.log("REALTIME","Comments channel update",t),this.commentsObserver.publish(t)};this.updateComments=t=>{this.commentsChannel.publish("update",t)};this.enterWIOChannel=t=>{this.presenceWIOChannel||(this.presenceWIOChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-wio`)),this.presenceWIOChannel.attach(),this.presenceWIOChannel.subscribe("private",this.onSetPrivate),this.presenceWIOChannel.subscribe("follow",this.onSetFollow),this.presenceWIOChannel.subscribe("gather",this.onSetGather)};this.leaveWIOChannel=()=>{!this.presenceWIOChannel||(this.presenceWIOChannel.unsubscribe(),this.presenceWIOChannel.detach(),this.presenceWIOChannel=null)};this.onSetPrivate=({data:{id:t,isPrivate:e}})=>{this.participants[t].data.isPrivate=e,this.privateModeWIOObserver.publish(this.participants)};this.onSetFollow=t=>{this.followWIOObserver.publish(t)};this.onSetGather=({data:t})=>{this.gatherWIOObserver.publish({detail:{id:t.id}})};this.setPrivateWIOParticipant=(t,e)=>{this.presenceWIOChannel.publish("private",{id:t,isPrivate:e})};this.setFollowWIOParticipant=t=>{this.presenceWIOChannel.publish("follow",f({},t))};this.setGatherWIOParticipant=t=>{this.presenceWIOChannel.publish("gather",f({},t))};this.leavePresence3DChannel=()=>{!this.presence3DChannel||(this.presence3DChannel.presence.leave(),this.presence3DChannel=null)};this.updatePresence3D=Wi(t=>{var o,s,n;if(!t||!t.id)return;let e=Object.assign({},(s=(o=this.participantsOn3d[t.id])==null?void 0:o.data)!=null?s:{},t);this.participantsOn3d[t.id]=x(f({},this.participants[e.id]),{data:f(f({},e),(n=this.participants[e.id])==null?void 0:n.data)}),this.presence3DChannel&&this.presence3DChannel.presence.update(e)},ps);this.onPresence3DChannelEnter=t=>{var o;t.clientId===this.myParticipant.clientId&&(this.isJoinedPresence3D=!0);let e=this.getParticipantSlot(t.clientId);this.presence3dJoinedObserver.publish(x(f({},t),{data:x(f(f({},t.data),(o=this.participants[t.clientId])==null?void 0:o.data),{slotIndex:e,color:this.getSlotColor(e).color})}))};this.onPresence3DChannelLeave=t=>{delete this.participantsOn3d[t.clientId],this.presence3dLeaveObserver.publish(t)};this.publish3DUpdate=t=>{var s;let e=this.getParticipantSlot(t.clientId),o=x(f({},t),{data:x(f(f({},t.data),(s=this.participants[t.clientId])==null?void 0:s.data),{slotIndex:e,color:this.getSlotColor(e).color})});this.participantsOn3d[t.clientId]=o,this.participants3DObservers[t.clientId]&&this.participants3DObservers[t.clientId].publish(o),this.presence3dObserver.publish(this.participantsOn3d)};this.ablyKey=e,this.apiUrl=t,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this)}get roomProperties(){return this.localRoomProperties}get hostClientId(){var t;return(t=this.roomProperties)==null?void 0:t.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get isDomainWhitelisted(){return this.domainWhitelisted}get getParticipants(){return this.participants}get participant(){return this.myParticipant}get localParticipantId(){var t,e;return(e=(t=this.myParticipant.data)==null?void 0:t.participantId)!=null?e:null}get isBroadcast(){return Object.values(this.participants).some(t=>t.data.type==="audience")}start({participant:t,roomId:e,apiKey:o}){this.myParticipant={data:x(f({},t),{participantId:t.id}),timestamp:null,action:null,clientId:t.id,connectionId:null,encoding:null,id:null,extras:null},this.enableSync=t.type!=="audience",this.roomId=`superviz:${e.toLowerCase()}-${o}`,this.apiKey=o,this.client||this.buildClient()}auth(t,e){if(!this.domainWhitelisted)return;let o=new Ui.Rest({key:this.ablyKey}),{origin:s}=window.location;o.auth.requestToken(t,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:s,apiKey:this.apiKey}},(n,r)=>{var l;n&&this.authenticationObserver.publish("realtime.authentication-failed"),(l=n==null?void 0:n.message)!=null&&l.includes("this domain don't have permission")&&(this.domainWhitelisted=!1),e(n,r)})}join(t){let e=t?Object.assign({},t,{participantId:t.id}):this.myParticipant.data;this.logger.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(e),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.commentsChannel=this.client.channels.get(`${this.roomId}:comments`),this.commentsChannel.subscribe("update",this.onCommentsChannelUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){this.logger.log("REALTIME","Disconnecting from ably servers"),this.supervizChannel.presence.leave(),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(t){let e=this.localRoomProperties;this.updateRoomProperties(Object.assign({},e,{isGridModeEnable:t}))}setDrawing(t){let e=this.localRoomProperties;this.updateRoomProperties(Object.assign({},e,{drawing:t}))}setTranscript(t){let e=this.localRoomProperties;this.updateRoomProperties(Object.assign({},e,{transcript:t}))}setSyncProperty(t,e){let o=(s,n)=>({name:s,data:n,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isMessageTooBig(o(t,e),ls)&&(this.logger.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.logger.log("adding to queue",t,e),this.clientSyncPropertiesQueue[t]||(this.clientSyncPropertiesQueue[t]=[]),this.clientSyncPropertiesQueue[t].push(o(t,e))}setFollowParticipant(t){this.updateRoomProperties({followParticipantId:t})}setGather(t){this.updateRoomProperties({gather:t})}getParticipantSlot(t){var e,o;if(t){let s=t.toString();if(this.participants&&this.participants[s])return(o=(e=this.participants[t])==null?void 0:e.data)==null?void 0:o.slotIndex}return 16}onAblyPresenceEnter(t){if(t.clientId===this.myParticipant.data.participantId&&this.isJoinedRoom){this.sameAccountObserver.publish(!0);return}t.clientId===this.myParticipant.data.participantId?this.onJoinRoom(t):this.onParticipantJoin(t)}onAblyPresenceUpdate(t){if(!this.isJoinedRoom)return;let{clientId:e}=t,o=Object.assign({},t,{participantId:t.clientId});this.publishParticipantUpdate(o),this.participants&&this.participants[e]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast()}onAblyPresenceLeave(t){this.onParticipantLeave(t)}onReceiveBroadcastSync(t){t.data.forEach(o=>{var n;let s=o.clientId;this.participants[s]=o,(n=o.data)!=null&&n.isAudience||(this.participants[s].data=JSON.parse(this.participants[s].data),this.publishParticipantUpdate(this.participants[s]))})}onAblyRoomUpdate(t){this.logger.log("REALTIME","Room update received",t.data),this.updateLocalRoomState(t.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let t={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new Ui.Realtime(t),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(t){this.participants[t.clientId]=t,this.participantsObserver.publish(this.participants),this.participantObservers[t.clientId]&&this.participantObservers[t.clientId].publish(t)}forceReconnect(){if(this.logger.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){this.logger.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join();return}this.logger.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(t){throw this.logger.log(t),new Error(t)}publishStateUpdate(t){this.state!==t&&(this.state=t,this.logger.log("REALTIME",`Realtime state did change. New state: ${We[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((t,e)=>{this.supervizChannel.history((o,s)=>{var r;o&&e(o);let n=(r=s.items[0])==null?void 0:r.data;t(n||null)})})}onStateChange(){var d,v,y;let t=(d=this.supervizChannelState)==null?void 0:d.current,e=(v=this.connectionState)==null?void 0:v.current,o=e==="connected",s=["initialized","connecting"].includes(e),n=["closed","closing"].includes(e)||["detaching","detached"].includes(t),r={[0]:n,[1]:s,[2]:!t&&o,[3]:t==="attaching",[4]:t==="attached"&&o,[-1]:t==="failed"||e==="failed",[-2]:e==="suspended"||t==="suspended"},l=Object.entries(r).find(([h,g])=>g&&h)[0],c=Number(l);if(!!this.domainWhitelisted){if(c===2&&(this.currentReconnectAttempt=0),o&&this.isReconnecting&&this.onJoinRoom(this.participant),(c===-2||c===-1)&&this.forceReconnect(),(y=this.connectionState)!=null&&y.retryIn){this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt);return}this.publishStateUpdate(c)}}onAblyConnectionStateChange(t){this.connectionState=t,this.onStateChange()}onAblyChannelStateChange(t){this.supervizChannelState=t,this.onStateChange()}onJoinRoom(t){return T(this,null,function*(){this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.myParticipant=t,this.localRoomProperties?(this.updateParticipants(),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)):this.initializeRoomProperties(),this.isReconnecting=!1,this.publishStateUpdate(4),this.participantJoinedObserver.publish(t),this.logger.log("REALTIME","Joined realtime room")})}onParticipantLeave(t){if(this.state===2)return;t.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(t),this.updateParticipants()}spliceArrayBySize(t,e=Vi){let o=l=>{let c=JSON.stringify(l);return new TextEncoder().encode(c).length},s=0,n=[],r=[];for(let l=0;l<t.length;l++){let c=o(t[l]);s+c<=e?(r.push(t[l]),s+=c):(n.push(r),r=[t[l]],s=c)}return r.length>0&&n.push(r),{data:n[0],lengthToBeSplitted:n[0].length}}enterPresence3DChannel(t){if(!this.isJoinedRoom){this.logger.log("REALTIME","Cannot enter presence 3D channel because the participant is not in the room"),setTimeout(()=>{this.enterPresence3DChannel(t)},1e3);return}this.presence3DChannel||(this.presence3DChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-presence-3d`),this.presence3DChannel.attach(),this.presence3DChannel.presence.subscribe("enter",this.onPresence3DChannelEnter),this.presence3DChannel.presence.subscribe("leave",this.onPresence3DChannelLeave),this.presence3DChannel.presence.subscribe("update",this.publish3DUpdate)),this.presence3DChannel.presence.enter(t)}};a();a();import*as ji from"@superviz/socket-client";var G=class{constructor(i,t){this.onPresenceUpdate=i=>{var e,o,s,n;if(!i.data.slot||!((e=this.participant)!=null&&e.slot))return;if(i.id===this.participant.id){this.participant=i.data,this.slotIndex=i.data.slot.index;return}let t=i.data.slot.timestamp<((s=(o=this.participant)==null?void 0:o.slot)==null?void 0:s.timestamp);((n=i.data.slot)==null?void 0:n.index)===this.slotIndex&&t&&this.assignSlot()};this.room=i,this.participant=t,this.assignSlot(),this.room.presence.on(ji.PresenceEvents.UPDATE,this.onPresenceUpdate)}static register(i,t){return G.instance||(G.instance=new G(i,t)),G.instance}assignSlot(){return T(this,null,function*(){let i=Math.floor(Math.random()*16);new Promise((t,e)=>{this.room.presence.get(o=>{if((!o||!o.length)&&t(!1),o.length>=16){e(new Error("[SuperViz] - No more slots available"));return}o.forEach(s=>{var n,r;s.id!==this.participant.id&&((r=(n=s.data)==null?void 0:n.slot)==null?void 0:r.index)===i&&t(!0)}),t(!1)})}).then(t=>T(this,null,function*(){if(t){this.assignSlot();return}let e={index:i,color:ie[i],textColor:Pt.includes(i)?"#fff":"#000",colorName:wt[i],timestamp:Date.now()};this.slotIndex=i,this.participant=x(f({},this.participant),{slot:e}),this.room.presence.update({slot:e})})).catch(t=>{this.room.presence.update({slot:null})})})}};a();var Ve=class extends V{constructor({participant:t,group:e}){super();this.isDestroyed=!1;this.activeComponents=[];this.componentsToAttachAfterJoin=[];this.activeComponentsInstances=[];this.eventBus=new te;this.addComponent=t=>{if(!!this.canAddComponent(t)){if(!this.realtime.isJoinedRoom){this.logger.log("launcher service @ addComponent - not joined yet"),this.componentsToAttachAfterJoin.push(t);return}t.attach({ioc:this.ioc,realtime:this.realtime,config:b.configuration,eventBus:this.eventBus,useStore:yt}),this.activeComponents.push(t.name),this.activeComponentsInstances.push(t),this.realtime.updateMyProperties({activeComponents:this.activeComponents}),L.sendActivity(this.participant.value.id,this.group.value.id,this.group.value.name,t.name)}};this.attachComponentsAfterJoin=()=>{this.logger.log("launcher service @ attachComponentsAfterJoin"),this.componentsToAttachAfterJoin.forEach(t=>{this.logger.log("launcher service @ attachComponentsAfterJoin - attaching component",t.name),this.addComponent(t)}),this.componentsToAttachAfterJoin=[]};this.removeComponent=t=>{if(!this.activeComponents.includes(t.name)){let e=`Component ${t.name} is not initialized yet.`;this.logger.log(e);return}t.detach(),this.activeComponentsInstances=this.activeComponentsInstances.filter(e=>e.name!==t.name),this.activeComponents.splice(this.activeComponents.indexOf(t.name),1),this.realtime.updateMyProperties({activeComponents:this.activeComponents})};this.destroy=()=>{this.logger.log("launcher service @ destroy"),this.activeComponentsInstances.forEach(t=>{this.logger.log("launcher service @ destroy - removing component",t.name),this.removeComponent(t)}),this.activeComponents=[],this.activeComponentsInstances=[],this.participant=void 0,ft().destroy(),this.eventBus.destroy(),this.eventBus=void 0,this.LauncherRealtimeRoom.presence.off(K.PresenceEvents.JOINED_ROOM),this.LauncherRealtimeRoom.presence.off(K.PresenceEvents.LEAVE),this.LauncherRealtimeRoom.presence.off(K.PresenceEvents.UPDATE),this.ioc.destroy(),this.realtime.authenticationObserver.unsubscribe(this.onAuthentication),this.realtime.sameAccountObserver.unsubscribe(this.onSameAccount),this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.realtime.participantsObserver.unsubscribe(this.onParticipantListUpdate),this.realtime.leave(),this.realtime=void 0,this.isDestroyed=!0,window.SUPERVIZ=void 0};this.canAddComponent=t=>{let e=ee.checkComponentLimit(t.name),o=this.activeComponents.includes(t.name),s=[{isValid:!this.isDestroyed,message:"Component can not be added because the superviz room is destroyed. Initialize a new room to add and use components."},{isValid:!o,message:`Component ${t.name} is already active. Please remove it first`},{isValid:e,message:`You reached the limit usage of ${t.name}`}];for(let n=0;n<s.length;n++){let{isValid:r,message:l}=s[n];if(!r)return this.logger.log(l),!1}return!0};this.startAbly=()=>{this.logger.log("launcher service @ startAbly"),this.realtime.start({participant:this.participant.value,apiKey:b.get("apiKey"),roomId:b.get("roomId")}),this.realtime.join(),this.subscribeToAblyEvents()};this.subscribeToAblyEvents=()=>{this.realtime.authenticationObserver.subscribe(this.onAuthentication),this.realtime.sameAccountObserver.subscribe(this.onSameAccount),this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate)};this.onAuthentication=t=>{t==="realtime.authentication-failed"&&this.destroy()};this.onParticipantListUpdate=t=>{this.logger.log("launcher service @ onParticipantListUpdate",t);let o=Object.values(t).map(s=>{var n,r,l,c,d,v;return{id:s.data.id,name:(n=s.data)==null?void 0:n.name,type:(r=s.data)==null?void 0:r.type,avatar:(l=s.data)==null?void 0:l.avatar,avatarConfig:(c=s.data)==null?void 0:c.avatarConfig,isHost:this.realtime.hostClientId===s.clientId,color:this.realtime.getSlotColor((d=s.data)==null?void 0:d.slotIndex).color,activeComponents:(v=s.data)==null?void 0:v.activeComponents}}).find(s=>{var n;return(s==null?void 0:s.id)===((n=this.participant.value)==null?void 0:n.id)});o&&!Ji(this.participant.value,o)&&this.LauncherRealtimeRoom.presence.update(o)};this.onParticipantJoined=t=>{t.clientId===this.participant.value.id&&(this.logger.log("launcher service @ onParticipantJoined - local participant joined"),this.attachComponentsAfterJoin())};this.onSameAccount=()=>{this.publish("participant.same-account-error"),this.destroy()};this.startIOC=()=>{this.logger.log("launcher service @ startIOC"),this.LauncherRealtimeRoom.presence.on(K.PresenceEvents.JOINED_ROOM,this.onParticipantJoinedIOC),this.LauncherRealtimeRoom.presence.on(K.PresenceEvents.LEAVE,this.onParticipantLeaveIOC),this.LauncherRealtimeRoom.presence.on(K.PresenceEvents.UPDATE,this.onParticipantUpdatedIOC)};this.onParticipantJoinedIOC=t=>{t.id===this.participant.value.id&&(G.register(this.LauncherRealtimeRoom,this.participant.value),this.LauncherRealtimeRoom.presence.update(this.participant.value)),this.participants.value.set(t.id,f({id:t.id,name:t.name},t.data)),t.id===this.participant.value.id&&(this.logger.log("launcher service @ onParticipantJoined - local participant joined"),this.publish("participant.local-joined",this.participant.value)),this.logger.log("launcher service @ onParticipantJoined - participant joined",t.data),this.publish("participant.joined",this.participants.value.get(t.id))};this.onParticipantLeaveIOC=t=>{this.participants.value.delete(t.id),t.id===this.participant.value.id&&(this.logger.log("launcher service @ onParticipantLeave - local participant left"),this.publish("participant.local-left",t.data)),this.logger.log("launcher service @ onParticipantLeave - participant left",t.data),this.publish("participant.left",t.data)};this.onParticipantUpdatedIOC=t=>{var o,s,n,r;t.id===this.participant.value.id&&!Ji(this.participant.value,t.data)&&(this.activeComponentsInstances=this.activeComponentsInstances.filter(l=>t.data.activeComponents?this.activeComponents.includes(l.name):!0),this.participant.value=t.data,this.publish("participant.updated",t.data),this.logger.log("Publishing ParticipantEvent.UPDATED",t.data),((s=(o=t.data)==null?void 0:o.slot)==null?void 0:s.index)!==void 0&&((r=(n=t.data)==null?void 0:n.slot)==null?void 0:r.index)!==this.realtime.participant.data.slotIndex&&this.realtime.updateMyProperties({slotIndex:t.data.slot.index})),this.participants.value.set(t.id,t.data);let e=Array.from(this.participants.value.values());this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",this.participants.value),this.publish("participant.list-updated",e)};let{localParticipant:o,participants:s,group:n}=ft();this.participant=o,this.participants=s,this.group=n,this.participant.value=x(f({},t),{type:"guest"}),this.group.value=e,this.logger=new A("@superviz/sdk/launcher"),this.realtime=new Tt(b.get("apiUrl"),b.get("ablyKey")),this.ioc=new Ce(this.participant.value),this.LauncherRealtimeRoom=this.ioc.createRoom("launcher"),this.eventBus=new te,this.logger.log("launcher created"),this.startAbly(),this.startIOC()}},Ki=p=>{if(window.SUPERVIZ)return{destroy:window.SUPERVIZ.destroy,subscribe:window.SUPERVIZ.subscribe,unsubscribe:window.SUPERVIZ.unsubscribe,addComponent:window.SUPERVIZ.addComponent,removeComponent:window.SUPERVIZ.removeComponent};let i=new Ve(p);return window.SUPERVIZ=i,{destroy:i.destroy,subscribe:i.subscribe,unsubscribe:i.unsubscribe,addComponent:i.addComponent,removeComponent:i.removeComponent}};var cs=({group:p,participant:i,roomId:t,customColors:e})=>{if(e&&ds(e),!p||!p.name||!p.id)throw new Error("Group fields is required");if(!i||!i.id||!i.name)throw new Error("Participant name and id is required");if(!t)throw new Error("Room id is required")},ds=p=>{Object.entries(p).forEach(([i,t])=>{if(!Object.values(Ue).includes(i))throw new Error(`Color ${i} is not a valid color variable name. Please check the documentation for more information.`);if(!/^(\d{1,3}\s){2}\d{1,3}$/.test(t))throw new Error(`Color ${i} is not a valid color variable value. Please check the documentation for more information.`)})},ms=p=>{!p||Object.entries(p).forEach(([i,t])=>{let e=t.replace(/\s/g,", ");document.documentElement.style.setProperty(`--${i}`,e)})},hs=(p,i)=>T(void 0,null,function*(){var h,g;if(!(p&&p.trim()))throw new Error("API key is required");if(!i)throw new Error("Options is required");cs(i),i.debug?qi.enable("*"):qi.disable();let{apiUrl:e,conferenceLayerUrl:o}=yield Et.getRemoteConfig(i.environment);if(!(yield Bi(e,p)))throw new Error("Failed to validate API key");let[n,r,l]=yield Promise.all([L.fetchConfig(e,p),L.fetchLimits(e,p),L.fetchWaterMark(e,p)]).catch(()=>{throw new Error("Failed to load configuration from server")});if(!n||!n.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:c}=n,{participant:d,roomId:v,customColors:y}=i;return b.setConfig({apiUrl:e,ablyKey:c,apiKey:p,conferenceLayerUrl:o,environment:(h=i.environment)!=null?h:"prod",roomId:v,debug:i.debug,limits:r,waterMark:l,colors:i.customColors}),ms(i.customColors),L.createOrUpdateParticipant({name:d.name,participantId:d.id,avatar:(g=d.avatar)==null?void 0:g.imageUrl}),Ki(i)}),je=hs;a();a();import{LitElement as us,css as vs,html as gs}from"lit";import{customElement as bs}from"lit/decorators.js";var q=class extends us{render(){return gs` <div>Hello from SuperViz, ${this.name}</div> `}};q.properties={name:{type:String}},q.styles=vs`
    div {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      color: white;
    }
  `,q=w([bs("superviz-hello-world")],q);a();import{LitElement as Ps,css as Ts,html as As}from"lit";import{customElement as xs}from"lit/decorators.js";a();a();a();import{css as fs}from"lit";var Je=fs`
  * {
    --sv-primary: 98, 16, 204;
    --sv-primary-900: 56, 7, 136;
    --sv-primary-200: 193, 161, 234;
    --sv-secondary: 193, 251, 223;
    --sv-gray: 126, 122, 136;
    --sv-success: 12, 185, 71;
    --sv-danger: 229, 65, 30;
    --sv-black: 19, 18, 21;
    --sv-white: 255, 255, 255;
    --sv-gray-100: 250, 250, 252;
    --sv-gray-200: 233, 229, 239;
    --sv-gray-300: 201, 196, 209;
    --sv-gray-400: 174, 169, 184;
    --sv-gray-500: 126, 122, 136;
    --sv-gray-600: 87, 83, 95;
    --sv-gray-700: 57, 54, 62;
    --sv-gray-800: 38, 36, 42;
  }

  .sv-gray-200 {
    color: rgb(var(--sv-gray-200));
  }

  .sv-gray-400 {
    color: rgb(var(--sv-gray-400));
  }

  .sv-gray-500 {
    color: rgb(var(--sv-gray-500));
  }

  .sv-gray-600 {
    color: rgb(var(--sv-gray-600));
  }

  .sv-gray-700 {
    color: rgb(var(--sv-gray-700));
  }
`;a();import{css as ys}from"lit";var Ke=ys`
  .text {
    font-family: Roboto;
    font-size: 12px;
    font-style: normal;
    font-weight: 400;
    line-height: 20px;
  }

  .text-bold {
    font-weight: 700;
  }

  .text-big {
    font-size: 14px;
  }

  .text-small {
    font-size: 10px;
  }
`;a();import{css as Es}from"lit";var qe=Es`
  .sv-hr {
    width: 100%;
    height: 1px;
    background: rgb(var(--sv-gray-200));
    padding: 0px;
    margin: 0px;
    position: relative;
  }
`;a();import{css as ws}from"lit";var Ye=ws`
  .icon-button {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(0, 0, 0, 0);
    border: 0px;
    width: 32px;
    height: 32px;
  }

  .icon-button > superviz-icon {
    display: flex !important;
  }

  .icon-button--xsmall {
    width: 18px;
    height: 18px;
  }

  .icon-button--small {
    width: 24px;
    height: 24px;
  }

  .icon-button--medium {
    width: 32px;
    height: 32px;
  }

  .icon-button--large {
    width: 40px;
    height: 40px;
  }

  .icon-button--clickable {
    cursor: pointer;
    border-radius: 100%;
  }

  .icon-button--clickable:hover:not(.icon-button--no-hover) {
    background: rgb(var(--sv-gray-300));
    transition: 0.25s background-color ease-in;
  }
  
  .icon-button--clickable:focus:not(.icon-button--no-hover) {
    transition: 0.25s background-color ease-in;
    background: rgb(var(--sv-gray-300));
  }
`;var P=p=>{var t;class i extends p{constructor(){super(...arguments);this.unsubscribeFrom=[];this.useStore=yt.bind(this)}connectedCallback(){setTimeout(()=>{var l,c;let s=document.getElementById("superviz-style"),n=this.createCustomColors(),r=document.createElement("style");r.innerHTML=(s==null?void 0:s.innerHTML)||"",(l=this.shadowRoot)==null||l.appendChild(r),n&&((c=this.shadowRoot)==null||c.appendChild(n))}),super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback(),this.unsubscribeFrom.forEach(s=>s(this))}createCustomColors(){if(!b.get("colors"))return;let s=document.createElement("style"),n=Object.entries(b.get("colors")).map(([r,l])=>`--${r}: ${l} !important;`).join(" ");return s.innerHTML=`
      * {
        ${n}
      }
    `,s}emitEvent(s,n,r={composed:!0,bubbles:!0}){let l=new CustomEvent(s,f({detail:n},r));this.dispatchEvent(l)}}return i.styles=[Je,Ke,qe,Ye,(t=p.styles)!=null?t:[]],i};a();var Ze=(s=>(s[s.xs=14]="xs",s[s.sm=18]="sm",s[s.md=24]="md",s[s.lg=36]="lg",s[s.xl=44]="xl",s))(Ze||{});var Yi=P(Ps),Cs=[Yi.styles],Y=class extends Yi{constructor(){super();this.name="",this.size="md"}get iconSize(){return Ze[this.size]}render(){var t;return this.color||(this.color="black"),As`
      <i
        class="sv-icon sv-icon-${this.name}_${(t=this.suffix)!=null?t:this.size} ${this.color}"
        style="font-size: ${this.iconSize}px"
      ></i>
    `}};Y.properties={name:{type:String},size:{type:String},color:{type:String},suffix:{type:String}},Y.styles=[Cs,Ts`
      div {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: black;
        color: white;
      }

      i,
      i.black {
        color: rgba(var(--sv-gray-600));
      }

      i.white {
        color: white;
      }
    `],Y=w([xs("superviz-icon")],Y);a();import{LitElement as Ss,html as At}from"lit";import{customElement as Os}from"lit/decorators.js";import{classMap as Xi}from"lit/directives/class-map.js";a();function _(p){let i=document.getElementById(`superviz-${p}-styles`);if(!i)return;let t=new CSSStyleSheet;t.replaceSync(i.textContent),this.shadowRoot.adoptedStyleSheets=[...this.shadowRoot.adoptedStyleSheets,t]}a();import{css as _s}from"lit";var Zi=_s`
  .dropdown {
    position: relative;
    z-index: 100;
  }

  .dropdown-content {
    display: flex;
  }

  .select-clicked {
    border: 2px #26489a solid;
  }

  .dropdown-list {
    position: relative;
    z-index: 101;
  }

  .header {
    display: grid;
    grid-template-rows: 1fr 1px;
    align-items: center;
    padding: 0 10px;
    min-height: 42px;
    font-size: 16px;
    color: rgb(var(--sv-gray-600));
  }

  .menu {
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    opacity: 0;
    display: none;
    background: #fff;
    padding: 0;
    z-index: 1;
    transition: 0.2s;
    border-radius: 3px;
  }

  .items {
    list-style: none;
    padding: 0;
    color: #9fa5b5;
    margin: 0;
  }

  .text.username {
    font-size: 14px;
    text-align: left;

    display: inline-block;
    vertical-align: middle;
    line-height: normal;
    padding: 8px 0;
  }

  .items li {
    color: rgb(var(--sv-gray-600));
    text-transform: uppercase;
    padding: 0 10px;
    cursor: pointer;
    min-width: 103px;
    min-height: 32px;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 5px;
    height: 42px;
  }

  .sv-icon {
    width: 40px;
    height: 40px;
    background-color: red;
  }

  .active {
    background: rgb(var(--sv-gray-200));
  }

  .items li:hover {
    background: rgb(var(--sv-gray-200));
  }

  .menu-open {
    display: block;
    opacity: 1;
    position: fixed;
  }

  .sv-hr {
    width: 100%;
    height: 1px;
    background: rgb(var(--sv-gray-300));
    padding: 0px;
    margin: 0px;
    justify-self: flex-end;
  }

  .option-label {
    white-space: nowrap;
    line-height: 1;
  }

  .who-is-online__controls__item__icon {
    line-height: 1;
  }

  .who-is-online__controls__item {
    align-items: center;
  }

  @media (max-width: 780px) {
    .menu--top-left,
    .menu--top-center,
    .menu--top-right {
      bottom: 36px;
    }
  }
`;var Qi=P(Ss),Ls=[Qi.styles,Zi],Z=class extends Qi{constructor(){super();this.menu=void 0;this.onClickOutDropdown=t=>{if(t.stopPropagation(),!this.open)return;let e=t.composedPath(),o=this.shadowRoot.querySelector(".dropdown-content"),s=this.shadowRoot.querySelector(".dropdown-list"),r=this.shadowRoot.querySelector('slot[name="dropdown"]').assignedElements()[0],l=e.includes(o),c=e.includes(s),d=e.includes(r);l||c||d||this.close()};this.close=()=>{this.open=!1,this.emitEvent("close",{bubbles:!1,composed:!1})};this.callbackSelected=t=>{this.open=!1;let e=this.returnTo?t[this.returnTo]:t;this.emitEvent("selected",e,{bubbles:!1,composed:!0})};this.adjustPosition=()=>{if(!this.open){cancelAnimationFrame(this.animationFrame);return}this.setHorizontalPosition(),this.setPositionVertical(),this.animationFrame=requestAnimationFrame(this.adjustPosition)};this.tooltip=()=>{if(!this.canShowTooltip)return"";let t=this.lastParticipant?"tooltip-top":"tooltip-bottom";return At` <superviz-tooltip
      tooltipData=${JSON.stringify(this.onHoverData)}
      ?shiftTooltipLeft=${this.shiftTooltipLeft}
      tooltipVerticalPosition=${t}
      classesPrefix="${this.tooltipPrefix}__tooltip"
      parentComponent=${this.parentComponent}
    ></superviz-tooltip>`};this.showTooltip=!1}firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{this.menu=this.shadowRoot.querySelector(".menu"),_.call(this,[this.parentComponent])})}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("click",this.onClickOutDropdown);let t=this.shadowRoot.querySelector(".dropdown");t==null||t.removeEventListener("mouseenter",()=>{this.showTooltip=!0}),t==null||t.removeEventListener("mouseleave",()=>{this.showTooltip=!1})}updated(t){if(!!t.has("open")){if(this.emitEvent("toggle-dropdown-state",{open:this.open,font:this.name},{bubbles:!1,composed:!1}),this.open){document.addEventListener("click",this.onClickOutDropdown),this.animationFrame=requestAnimationFrame(this.adjustPosition);return}document.removeEventListener("click",this.onClickOutDropdown)}}setHorizontalPosition(){let t=this.shadowRoot.querySelector('slot[name="dropdown"]'),{left:e,right:o,width:s}=t.parentElement.getBoundingClientRect(),{width:n}=this.menu.getBoundingClientRect(),r=e-(n-s)/2<0,l=o+(n-s)/2>window.innerWidth;if(this.shiftTooltipLeft){this.menu.style.left=`${e+8}px`,this.menu.style.right="",this.menu.style.transform="translate(0, 0)";return}if(!r&&!l){this.menu.style.left=`${e}px`,this.menu.style.right="",this.menu.style.transform=`translate(calc(-50% + ${s/2}px), 0)`;return}if(!r){this.menu.style.left="",this.menu.style.right=`${window.innerWidth-o}px`,this.menu.style.transform="translate(0, 0)";return}l||(this.menu.style.right="",this.menu.style.left=`${o-s}px`,this.menu.style.transform="translate(0, 0)")}setPositionVertical(){let t=this.shadowRoot.querySelector('slot[name="dropdown"]'),{top:e,bottom:o}=t.parentElement.getBoundingClientRect(),{height:s}=this.menu.getBoundingClientRect(),n=this.shiftTooltipLeft?-2:8;if(!(o+s+n>window.innerHeight)){this.menu.style.bottom="",this.menu.style.top=`${o+n}px`;return}this.menu.style.top="auto",this.menu.style.bottom=`${window.innerHeight-e+n}px`}get renderHeader(){return this.name?At` <div class="header ${this.getClass("header")}">
      <span class="text username ${this.getClass("title")}">${this.name}</span>
      <span class="sv-hr ${this.getClass("divisor")}"></span>
    </div>`:At``}toggle(){this.disabled||(this.open=!this.open,this.emitEvent("open",{open:this.open}))}get supervizIcons(){var t;return(t=this.icons)==null?void 0:t.map(e=>At`<superviz-icon name="${e}" size="sm"></superviz-icon>`)}get listOptions(){return this.options.map((t,e)=>{var s;let o={text:!0,[this.getClass("item")]:!0,"text-bold":!0,active:(t==null?void 0:t[this.returnTo])&&this.active===(t==null?void 0:t[this.returnTo])};return At`<li @click=${()=>this.callbackSelected(t)} class=${Xi(o)}>
        <span class=${this.getClass("item__icon")}>${(s=this.supervizIcons)==null?void 0:s.at(e)}</span>
        <span class="option-label ${this.getClass("item__label")}">${t[this.label]}</span>
      </li>`})}getClass(t){return`${this.classesPrefix}__${t}`}render(){let t={menu:!0,"menu-open":this.open,"menu-left":this.align==="left","menu-right":this.align==="right","who-is-online-dropdown":this.name};return At`
      <div class="dropdown">
        <div class="dropdown-content" @click=${this.toggle}>
          <slot name="dropdown"></slot>
        </div>
        ${this.tooltip()}
      </div>
      <div class="dropdown-list">
        <div class=${Xi(t)}>
          ${this.renderHeader}
          <ul class="${this.getClass("items")} items">
            ${this.listOptions}
          </ul>
        </div>
      </div>
    `}};Z.styles=Ls,Z.properties={open:{type:Boolean},disabled:{type:Boolean},align:{type:String},options:{type:Array},label:{type:String},returnTo:{type:String},active:{type:[String,Object]},icons:{type:Array},name:{type:String},onHoverData:{type:Object},showTooltip:{type:Boolean},dropdown:{type:Object},canShowTooltip:{type:Boolean},drodpdownSizes:{type:Object},shiftTooltipLeft:{type:Boolean},lastParticipant:{type:Boolean},classesPrefix:{type:String},parentComponent:{type:String},tooltipPrefix:{type:String}},Z=w([Os("superviz-dropdown")],Z);a();import{LitElement as Rs,html as Xe}from"lit";import{customElement as Ms}from"lit/decorators.js";import{classMap as ks}from"lit/directives/class-map.js";a();import{css as Is}from"lit";var to=Is`
  .superviz-who-is-online__tooltip {
    --host-height: 0px;
    --host-width: 0px;
    --vertical-offset: 12px;

    background-color: rgb(var(--sv-gray-600));
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
    position: fixed;
    opacity: 0;
    border-radius: 2px;
    cursor: default;
    visibility: hidden;
    transition: opacity 0.2s ease-in-out display 0s;
    z-index: 100;
    overflow-x: clip;
  }

  .superviz-who-is-online__tooltip-arrow {
    width: 13px;
    height: 13px;
    position: absolute;
    background-color: rgb(var(--sv-gray-600));
    transform: rotate(45deg);
    border-top-left-radius: 1px;
    border-bottom-right-radius: 1px;
  }

  .show-tooltip {
    opacity: 1;
    visibility: visible;
  }

  .tooltip-name,
  .tooltip-action {
    margin: 0;
    font-family: roboto;
    white-space: nowrap;
    text-align: center;
    line-height: 1.2;
  }

  .tooltip-name {
    color: white;
    font-size: 14px;
  }

  .tooltip-action {
    color: rgb(var(--sv-gray-400));
    font-size: 12px;
  }

  .tooltip-top {
    bottom: calc(var(--host-height) + var(--vertical-offset));
  }

  .tooltip-bottom {
    bottom: auto;
  }

  .tooltip-center {
    right: auto;
  }

  .tooltip-bottom .superviz-who-is-online__tooltip-arrow {
    top: -6.5px;
  }

  .tooltip-top .superviz-who-is-online__tooltip-arrow {
    bottom: -6.5px;
  }

  .tooltip-center .superviz-who-is-online__tooltip-arrow {
    left: 0;
    margin-left: 50%;
    translate: -50% 0;
  }

  .tooltip-left .superviz-who-is-online__tooltip-arrow {
    translate: 50% 0;
    border-radius: 0;
    right: 0;
  }

  .tooltip-right .superviz-who-is-online__tooltip-arrow {
    translate: -50% 0;
    border-radius: 0;
    left: 0;
  }

  .shift-left {
    --vertical-offset: 2px;
  }
`;a();var eo=P(Rs),Ns=[eo.styles,to],X=class extends eo{constructor(){super();this.positionFixedTooltip=()=>{var S,O,u,R,M;if(!this.canAnimate||!this.parentElement){this.hide();return}this.adjustTooltipPosition();let{bottom:t,left:e,width:o,right:s,top:n}=this.parentElement.getBoundingClientRect(),{width:r}=this.tooltip.getBoundingClientRect(),l="auto",c="auto",d="auto",v="auto",y="",h=window.innerWidth>780,g=h?14:12;this.tooltipHorizontalPosition.includes("right")&&(d=`${e+o/2}px`),this.tooltipHorizontalPosition.includes("left")&&(v=`${window.innerWidth-(s-o/2)}px`),this.tooltipHorizontalPosition.includes("center")&&(d=`${e}px`,y=`translateX(-${(r-o)/2}px)`),this.tooltipVerticalPosition.includes("bottom")&&(l=`${t+g}px`,g=-10),this.tooltipVerticalPosition.includes("top")&&(c=`${window.innerHeight-(n-g)}px`,g=10),this.shiftTooltipLeft&&(y=`translate(-${(r-(h?18:10)-42)/2}px, ${g}px)`),(S=this.tooltip)==null||S.style.setProperty("top",l),(O=this.tooltip)==null||O.style.setProperty("left",d),(u=this.tooltip)==null||u.style.setProperty("right",v),(R=this.tooltip)==null||R.style.setProperty("bottom",c),(M=this.tooltip)==null||M.style.setProperty("transform",y),this.animationFrame=window.requestAnimationFrame(this.positionFixedTooltip)};this.hide=()=>{this.canAnimate=!1,this.showTooltip=!1,window.cancelAnimationFrame(this.animationFrame)};this.show=()=>{this.canAnimate=!0,this.showTooltip=!0,this.positionFixedTooltip()};this.adjustTooltipVerticalPosition=()=>{let{bottom:t,top:e,width:o}=this.tooltip.getBoundingClientRect(),s=window.innerHeight;if(this.tooltipVerticalPosition.includes("top")&&e<0){this.tooltipVerticalPosition=this.tooltipVerticalPosition.replace("top","bottom");return}this.tooltipVerticalPosition.includes("bottom")&&t>s&&(this.tooltipVerticalPosition=this.tooltipVerticalPosition.replace("bottom","top"))};this.adjustTooltipHorizontalPosition=()=>{let{left:t,right:e,width:o}=this.tooltip.getBoundingClientRect(),s=window.innerWidth,{left:n,width:r,right:l}=this.parentElement.getBoundingClientRect(),c=n+r/2-o/2>0,d=o/2+l-r/2<s;if(c&&d){this.tooltipHorizontalPosition=this.tooltipHorizontalPosition.replace(/left|right/,"center");return}if(t<0){this.tooltipHorizontalPosition=this.tooltipHorizontalPosition.replace("center","right");return}e>s&&(this.tooltipHorizontalPosition=this.tooltipHorizontalPosition.replace("center","left"))};this.adjustTooltipPosition=()=>{if(!this.parentElement){this.hide();return}this.tooltip||(this.tooltip=this.shadowRoot.querySelector(".superviz-who-is-online__tooltip")),this.adjustTooltipVerticalPosition(),this.adjustTooltipHorizontalPosition()};this.tooltipVerticalPosition="tooltip-bottom",this.tooltipHorizontalPosition="tooltip-center",this.showTooltip=!1,this.parentSizes={height:0,width:0}}firstUpdated(t){let{parentElement:e}=this;e==null||e.addEventListener("mouseenter",this.show),e==null||e.addEventListener("mouseleave",this.hide),this.adjustTooltipPosition(),_.call(this,this.parentComponent)}disconnectedCallback(){super.disconnectedCallback();let{parentElement:t}=this;t==null||t.removeEventListener("mouseenter",this.show),t==null||t.removeEventListener("mouseleave",this.hide)}updated(t){if(t.has("showTooltip")&&this.showTooltip){let{parentElement:e}=this;if(!e)return;let{height:o,width:s}=e.getBoundingClientRect();(this.parentSizes.height!==o||this.parentSizes.width!==s)&&(this.parentSizes={height:o,width:s})}}getClass(t){return t?`${this.classesPrefix}__${t}`:this.classesPrefix}renderTooltip(){var s,n,r,l,c;let t=this.tooltipVerticalPosition,e=this.tooltipHorizontalPosition,o={"superviz-who-is-online__tooltip":!0,[this.getClass("")]:!0,[t]:!0,[e]:!0,"tooltip-extras":this.tooltipOnLeft,"show-tooltip":this.showTooltip,"shift-left":this.shiftTooltipLeft};return Xe`<div
      class=${ks(o)}
      style="--host-height: ${(s=this.parentSizes)==null?void 0:s.height}px; --host-width: ${(n=this.parentSizes)==null?void 0:n.width}px;"
    >
      <p class="tooltip-name ${this.getClass("title")}">${(r=this.tooltipData)==null?void 0:r.name}</p>
      ${(l=this.tooltipData)!=null&&l.action?Xe`<p class="tooltip-action ${this.getClass("action")}">${(c=this.tooltipData)==null?void 0:c.action}</p>`:""}
      <div class="superviz-who-is-online__tooltip-arrow ${this.getClass("")}"></div>
    </div>`}render(){return Xe`${this.renderTooltip()}`}};X.styles=Ns,X.properties={tooltipData:{type:Object},tooltipOnLeft:{type:Boolean},showTooltip:{type:Boolean},tooltip:{type:Object},tooltipVerticalPosition:{type:String},tooltipHorizontalPosition:{type:String},parentSizes:{type:Object},shiftTooltipLeft:{type:Boolean},classesPrefix:{type:String},parentComponent:{type:String}},X=w([Ms("superviz-tooltip")],X);a();a();import{LitElement as Bs}from"lit";import{customElement as $s}from"lit/decorators.js";a();import{css as Ds}from"lit";var Se=Ds`
  .modal--overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(var(--sv-gray-400), 0.8);

    z-index: 999;
  }

  .modal--container {
    display: flex;
    align-items: center;
    justify-content: center;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: transparent;

    z-index: 1000;
  }

  .modal--container > .modal {
    background: #fff;
    min-width: 370px;
    min-height: 150px;
    border-radius: 6px;
  }

  .modal--container > .modal > .modal--header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 16px;
    background: rgb(var(--sv-gray-200));
    border-radius: 6px 6px 0 0;
  }

  .modal--container > .modal > .modal--header > .text {
    display: flex;
    align-items: center;
  }

  .modal--container > .modal > .modal--header > .close {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: rgb(var(--sv-gray-600));
    cursor: pointer;
  }

  .modal--container > .modal > .modal--body {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px 24px 0 24px;
  }

  .modal--container > .modal > .modal--body > .modal--body-content {
    padding: 8px 0;
    text-align: center;
  }

  .modal--container > .modal > .modal--footer {
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    padding: 24px;
  }

  .btn {
    width: 150px;
    height: 40px;
    text-transform: uppercase;
  }

  .btn--confirm {
    background: rgb(var(--sv-primary));
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-primary));
    color: #fff;
    cursor: pointer;
  }

  .btn--cancel {
    background: transparent;
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-gray-400));
    color: rgb(var(--sv-gray-400));
    cursor: pointer;
  }
`;var io=P(Bs),Fs=[io.styles,Se],xt=class extends io{constructor(){super(...arguments);this.getContainer=()=>window.document.querySelector("superviz-modal-container");this.createContainer=t=>{this.modal=document.createElement("superviz-modal-container"),this.modal.setOptions(t)};this.createModal=({detail:t})=>{this.createContainer(t),window.document.body.appendChild(this.modal)};this.destroyModal=()=>{var t;this.modal=void 0,(t=this.getContainer())==null||t.remove()}}firstUpdated(){window.document.body.addEventListener("superviz-modal--open",this.createModal),window.document.body.addEventListener("superviz-modal--close",this.destroyModal)}disconnectedCallback(){this.destroyModal(),window.document.body.removeEventListener("superviz-modal--open",this.createModal),window.document.body.removeEventListener("superviz-modal--close",this.destroyModal)}};xt.styles=Fs,xt=w([$s("superviz-modal")],xt);a();import{LitElement as zs,html as Ct}from"lit";import{customElement as Gs}from"lit/decorators.js";var oo=P(zs),Hs=[oo.styles,Se],_t=class extends oo{constructor(){super(...arguments);this.closeModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--close",{bubbles:!0,composed:!0}))};this.confirmModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--confirm",{bubbles:!0,composed:!0}))}}setOptions(t){this.options=t}render(){let t=()=>Ct`
        <div class="modal--header">
          <span class="text text-bold sv-gray-600">${this.options.title}</span>
          <div class="close" @click=${this.closeModal}>
            <superviz-icon name="close" size="md"></superviz-icon>
          </div>
        </div>
      `,e=()=>Ct`
        <div class="modal--body">
          <div class="modal--body-content">${this.options.body}</div>
        </div>
      `,o=()=>{if(this.options.footer)return Ct` <div class="modal--footer">${this.options.footer}</div> `;let s=this.options.confirmLabel||"OK",n=this.options.cancelLabel||"Cancel";return this.options.confirm&&this.options.cancel?Ct`
          <div class="modal--footer">
            <button class="text text-bold btn btn--cancel" @click=${this.closeModal}>
              ${n}
            </button>
            <button class="text text-bold btn btn--confirm" @click=${this.confirmModal}>
              ${s}
            </button>
          </div>
        `:Ct`
        <div class="modal--footer">
          <button class="text text-bold btn btn--confirm" @click=${this.confirmModal}>
            ${s}
          </button>
        </div>
      `};return Ct`
      <div class="modal--overlay"></div>
      <div class="modal--container">
        <div class="modal">${t()} ${e()} ${o()}</div>
      </div>
    `}};_t.styles=Hs,_t=w([Gs("superviz-modal-container")],_t);a();a();import{LitElement as on,html as hi}from"lit";import{customElement as sn}from"lit/decorators.js";import{classMap as nn}from"lit/directives/class-map.js";a();a();import{css as Us}from"lit";var Qe=Us`
  .superviz-comments {
    --offset-left: 10px;
    --offset-right: 10px;
    --offset-top: 10px;
    --offset-bottom: 10px;

    display: flex;
    flex-direction: column;
    width: 320px;
    position: fixed;
    color: rgb(var(--sv-gray-700));
    background: rgb(var(--sv-white));
    top: 0px;
    bottom: 0;
    box-shadow: -2px 0 4px 0 rgba(0, 0, 0, 0.1);
    z-index: 100;
    overflow: hidden;
    transition: right 0.3s ease-out;
  }

  .header {
    width: 100%;
  }

  .content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .toggle {
    display: flex;
    position: fixed;
    width: 100px;
    color: rgb(var(--sv-gray-700));
    background: rgb(var(--sv-white));
    top: 0;
    right: 0;
    bottom: 0;
  }

  .threads-on-left-side {
    left: var(--offset-left);
    top: var(--offset-top);
    bottom: var(--offset-bottom);
    border-radius: 8px;
  }

  .threads-on-right-side {
    right: var(--offset-right);
    top: var(--offset-top);
    bottom: var(--offset-bottom);
    border-radius: 8px;
  }

  #superviz-comments.threads-on-right-side.hide-at-right {
    right: -330px;
  }

  #superviz-comments.threads-on-left-side.hide-at-left {
    left: -330px;
  }

  .hide-at-right,
  .hide-at-left {
    animation: keep-opacity 0.3s ease-out;
    opacity: 0;
    visibility: hidden;
  }

  @keyframes keep-opacity {
    0%,
    99% {
      visibility: visible;
      opacity: 1;
    }

    100% {
      visibility: hidden;
      opacity: 0;
    }
  }
`;a();import{css as Ws}from"lit";var ti=Ws`
  .comments__topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: rgb(var(--sv-gray-200));
    height: 50px;
  }

  .comments__topbar__title {
    margin: 0 16px;
    color: rgb(var(--sv-gray-600));
  }

  .comments__topbar__close-threads {
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: 0.15s;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    box-sizing: border-box;
    margin-right: 8px;
    padding-right: 2px;
  }

  .comments__topbar__close-threads:hover {
    background: rgb(var(--sv-gray-300));
  }
`;a();import{css as Vs}from"lit";var ei=Vs`
  .reply {
    padding-left: 24px !important;
  }

  .comments__comment-item {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    padding: 8px;
    gap: 4px;
  }

  .comments__comment-item__header {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    width: 100%;
    align-items: center;
    color: rgb(var(--sv-gray-500));
  }

  .comments__comment-item__actions {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .comments__comment-item__actions superviz-dropdown,
  .comments__comment-item__icons {
    width: 25px;
    height: 25px;
    border-radius: 50%;
  }

  .comments__comment-item__metadata {
    display: flex;
    width: 100%;
    gap: 8px;
    align-items: center;
  }

  .comments__comment-item__avatar-container {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    overflow: hidden;
    background-color: rgb(var(--sv-gray-300));
    border: 1px solid rgb(var(--sv-gray-500));
    color: #fff;

    display: flex;
    align-items: center;
    justify-content: center;
  }

  .comments__comment-item__avatar-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 50%;
  }

  .comments__comment-item__content {
    width: 100%;
  }

  .line-clamp {
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .comments__comment-item__content__body {
    color: rgb(var(--sv-gray-700));
    position: relative;
    display: grid;
    grid-template-rows: 0px auto;
  }

  .comments__comment-item__content__body.editing-annotation {
    grid-template-rows: auto 0px;
  }

  .hidden {
    display: none;
  }

  .mentioned {
    display: inline-block;
  }

  .annotation-content {
    transition: opacity 0ms;
    opacity: 1;
    overflow: hidden;
  }

  .editing {
    transition: opacity 400ms;
    overflow: hidden;
    opacity: 0;
    pointer-events: none;
  }

  .comments__input--editable {
    transform: translateY(0);
    opacity: 1;
    overflow: hidden;
  }

  .hide-edit-input {
    transition: opacity 500ms, transform 0 linear 300ms;
    opacity: 0;
    pointer-events: none;
    width: 100%;
  }
`;a();import{css as js}from"lit";var ii=js`
  .comments {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 288px;
  }

  .hidden {
    display: none;
  }
`;a();import{css as Js}from"lit";var oi=Js`
  .comments__input {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    background: rgb(var(--sv-white));
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-gray-300));
    position: relative;
    min-height: 40px;
    box-sizing: border-box;
  }

  .comments__input:focus-within {
    border: 1px solid rgb(var(--sv-gray-500));
  }

  .comments__input__textarea {
    border: 0px;
    text-align: left;
    border-radius: 4px;
    outline: none;
    font-size: 14px;
    color: rgb(var(--sv-gray-700));
    font-family: Roboto;
    white-space: pre-wrap;
    word-wrap: break-word;
    resize: none;
    line-height: 1.15rem;
    max-height: 5rem;
    appearance: none;
    height: 40px;
    width: 100%;
    box-sizing: border-box;

    padding-top: 7px;
    border-top: 8px solid transparent;
    border-bottom: 8px solid transparent;
    border-right: 11px solid transparent;
    border-left: 11px solid transparent;
  }

  .fixed-width {
    width: 288px;
  }

  .comments__input__textarea:invalid {
    border-top: 15px solid transparent;
  }

  .comments__input__textarea::placeholder {
    color: rgb(var(--sv-gray-400));
    font-size: 14px;
    line-height: 14px;
  }

  .comments__input__options {
    display: flex;
    justify-content: space-between;
    box-sizing: border-box;
    overflow: hidden;
    height: 0;
    transition: 0.25s;
    border-radius: 0 0 4px 4px;
  }

  .active-textarea {
    height: 40px;
    padding: 4px 8px;
  }

  .sv-hr {
    border: none;
    width: 100%;
    opacity: 0;
    transition: 0.25s opacity linear, 0.25s visibility;
    visibility: hidden;
    height: 0;
    position: absolute;
  }

  .comments__input__divisor {
    border-top: 1px solid rgb(var(--sv-gray-300));
    opacity: 1;
    position: relative;
    visibility: visible;
  }

  .comment-actions {
    position: absolute;
    left: 8px;
    bottom: 3px;
    opacity: 0;
    transition: 0.25s opacity linear, 0.25s visibility;
    visibility: hidden;
  }

  .active-textarea > .comment-actions {
    opacity: 1;
    visibility: visible;
  }

  .mention:hover {
    background-color: rgb(var(--sv-gray-200));
  }

  .comments__input__button {
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 100%;
    width: 32px;
    height: 32px;
    border: 0px;
  }

  .comments__input__send-button {
    background: rgb(var(--sv-primary));
    color: rgba(var(--sv-white), 1);
  }

  .align-send-btn > superviz-icon {
    cursor: pointer;
  }

  .comments__input__button:disabled {
    background: rgb(var(--sv-gray-200));
    color: rgb(var(--sv-gray-600));
  }

  .comment-input-options {
    display: flex;
    gap: 4px;
    position: absolute;
    right: 8px;
    bottom: 4px;
  }

  .comments__input__textarea:focus,
  .comments__input__textarea.active-textarea {
    border-radius: 4px 4px 0 0;
  }

  .comments__input__textarea:focus::placeholder {
    color: transparent;
  }
`;a();import{css as Ks}from"lit";var si=Ks`
  .comments__thread:hover:not(.comments__thread--selected) {
    background-color: rgba(var(--sv-gray-200), 0.3);
  }

  .avatars-comments {
    display: flex;
    position: absolute;
    bottom: 8px;
    padding: 0 8px;
    opacity: 1;
    transition: opacity 0.3s linear;
  }

  .avatars-comments.invisible {
    opacity: 0;
  }

  .avatar-container {
    position: relative;
    display: flex;
    align-items: center;
    width: 100%;
  }

  .avatar {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    overflow: hidden;
    background-color: rgb(var(--sv-gray-300));
    border: 1px solid rgb(var(--sv-gray-500));
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .avatar img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 50%;
  }

  .avatar:not(:first-child) {
    margin-left: -6px;
  }

  .comments__thread--selected div:last-child {
    margin-inline: 8px;
  }

  .comments-container {
    display: flex;
    overflow: hidden;
    flex-direction: column;
  }

  .comments-container-wrapper {
    display: grid;
    grid-template-rows: 0fr;
    opacity: 0;
    overflow: hidden;
    transition: grid-template-rows 0.3s linear, opacity 0.3s linear;
  }

  .comments-container-wrapper.show {
    grid-template-rows: 1fr;
    opacity: 1;
  }

  .comments--expand {
    display: flex;
  }

  .comment-avatar--expand {
    display: block;
  }

  .hidden {
    overflow: hidden;
  }

  .comments__thread {
    grid-row: 1 / span 2;
    padding: 8px;
    position: relative;
    cursor: pointer;
    transition: padding-bottom 0.3s linear, opacity 0.3s linear;
  }

  .extra-space-bottom {
    padding-bottom: 35px;
  }

  .comments__thread--selected {
    background-color: rgba(var(--sv-gray-200), 0.5);
    padding-bottom: 16px;
  }

  .hide-input {
    display: none;
  }

  .wrapper {
    margin-inline: 0;
    display: grid;
    grid-template-rows: 0fr;
    opacity: 0;
    width: 100%;
    overflow: hidden;
    transition: grid-template-rows 0.3s linear, opacity 0.3s linear;
  }

  .show-wrapper {
    grid-template-rows: 1fr;
    opacity: 1;
  }

  .comments__complete-annotation {
    position: relative;
    width: 100%;
  }

  .comments__hide-complete-annotation {
    min-height: 0;
    opacity: 0;
    animation: hide-annotation 10s linear;
  }

  @keyframes hide-annotation {
    0%,
    95% {
      min-height: 43px;
      opacity: 1;
    }

    100% {
      opacity: 0;
      min-height: 0;
    }
  }

  .comments__resolved-annotation-message {
    position: absolute;
    width: 100%;
    top: 0;
  }
`;a();import{css as qs}from"lit";var ni=qs`
  .comments__annotation-resolved {
    background: rgba(var(--sv-gray-200), 0.5);
    height: 26px;
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid rgb(var(--sv-gray-200));
  }
`;a();import{css as Ys}from"lit";var ri=Ys`
  .preload {
    animation-duration: 0s !important;
  }

  .comments__annotation-pin,
  .comments__annotation-pin__avatar {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    pointer-events: auto;
    z-index: 10;
    transform-origin: bottom left;
  }

  .comments__annotation-pin:hover {
    transform: scale(1.2);
    animation: growing-spring 0.3s linear;
  }

  .comments__annotation-pin:not(:hover) {
    animation: shrinking-spring 0.3s linear;
  }

  .comments__annotation-pin--add {
    transform: scale(1) !important;
    animation: none !important;
  }

  .comments__annotation-pin {
    position: absolute;

    width: 32px;
    height: 32px;

    background-color: rgb(var(--sv-white));
    border-radius: 50%;
    border-bottom-left-radius: 2px;

    border: 2px solid rgb(var(--sv-white));
    box-shadow: 0px 2px 6px 0px rgba(0, 0, 0, 0.35);
    transition: border-color 0.2s ease-in-out opacity 0.2s ease-in-out;
    padding: 2px;
    box-sizing: border-box;
    cursor: pointer;
  }

  .comments__annotation-pin:hover,
  .comments__annotation-pin:focus,
  .comments__annotation-pin--active {
    border-color: rgb(var(--sv-primary));
  }

  .comments__cursor-pointer,
  .comments__cursor-pointer .comments__annotation-pin__avatar {
    pointer-events: none;
  }

  .comments__annotation-pin__avatar {
    width: 100%;
    height: 100%;

    background-color: rgb(var(--sv-gray-400));
    border-radius: 50%;

    color: rgb(var(--sv-white));
  }

  .comments__annotation-pin__avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: contain;
  }

  .comments__annotation-pin__avatar--add {
    color: rgb(var(--sv-gray-700));
    background-color: rgb(var(--sv-white));
  }

  .floating-input {
    position: absolute;
    top: -2px;
    opacity: 0;
  }

  .left .floating-input {
    right: auto;
    left: 0;
    transform: translateX(calc(-100% - 7px));
    opacity: 1;
  }

  .right .floating-input {
    left: auto;
    right: 0;
    transform: translateX(calc(100% + 7px));
    opacity: 1;
  }

  .comments__annotation-pin-wrapper {
    transform-origin: center;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    position: absolute;
  }

  .comments__annotation-pin-wrapper--new {
    animation: bounce 0.5s linear !important;
  }

  .comments__annotation-pin-wrapper--new .comments__annotation-pin__avatar {
    transform-origin: center;
    animation: avatar-bounce 0.5s linear !important;
  }

  @keyframes avatar-bounce {
    0%,
    40% {
      transform: scale(1);
    }

    48% {
      transform: scale(0.8);
    }

    55%,
    92% {
      transform: scale(1);
    }

    96% {
      transform: scale(0.9);
    }

    100% {
      transform: scale(1);
    }
  }
  @keyframes bounce {
    0% {
      transform: scale(1);
    }

    20% {
      transform: scale(1.3);
    }

    40%,
    55% {
      transform: scale(1);
    }

    75% {
      transform: scale(1.15);
    }

    92%,
    100% {
      transform: scale(1);
    }
  }

  @keyframes growing-spring {
    0% {
      transform: scale(1);
    }

    25% {
      transform: scale(1.3);
    }

    50% {
      transform: scale(1.2);
    }

    75% {
      transform: scale(1.25);
    }

    100% {
      transform: scale(1.2);
    }
  }

  @keyframes shrinking-spring {
    0% {
      transform: scale(1.2);
    }

    33% {
      transform: scale(1);
    }

    66% {
      transform: scale(1.1);
    }

    100% {
      transform: scale(1);
    }
  }
`;a();import{css as Zs}from"lit";var ai=Zs`
  .comments__filter-container {
    display: flex;
    width: 100%;
    justify-content: flex-start;
    align-items: center;
  }

  .comments__filter {
    white-space: nowrap;
    padding: 12px;
    cursor: pointer;
    color: rgb(var(--sv-gray-500));
  }

  .content {
    display: flex;
    justify-content: space-between;
    flex-direction: row;
    align-items: center;
    gap: 6px;
  }

  .comments__filter__toggle-button {
    display: flex;
    flex-direction: row;
    gap: 4px;
  }

  .comments__filter__icon {
    margin-top: -2px;
  }
`;a();import{css as Xs}from"lit";var li=Xs`
  .comments__floating-button {
    position: fixed;
    border-radius: 50%;
    width: 38px;
    height: 38px;
    display: flex;
    align-items: center;
    gap: 4px;
    border: none;
    background-color: rgba(var(--sv-white));
    box-shadow: 2px 2px 15px 0px rgba(0, 0, 0, 0.2);
    color: rgb(var(--sv-gray-600));
    cursor: pointer;
    overflow: hidden;
    padding-left: 10px;
    z-index: 99;
    transition: width 300ms linear, border-radius 300ms linear;
  }

  .comments__floating-button:hover,
  .comments__floating-button.is-active {
    background-color: rgb(var(--sv-gray-400));
    color: rgba(var(--sv-white));
  }

  .comments-floating-button-hovered {
    transition: width 300ms linear 300ms, border-radius 300ms linear 300ms;
  }

  .comments__floating-button__text {
    text-align: left;
    overflow: hidden;
    position: relative;
    margin: 0;
    line-height: 1;
    right: 0px;
  }

  .not-hovered {
    animation-duration: 0s !important;
    transition-duration: 0s !important;
  }

  .hide-button {
    display: none !important;
  }

  .is-inactive:hover {
    width: 110px;
    border-radius: 30px;
  }

  .is-active:hover {
    width: 92px;
    border-radius: 30px;
    animation: decrease-width 600ms linear;
  }

  .textInactive.cancel {
    position: absolute;
    bottom: -30px;
    animation: drop-cancel-text 600ms linear;
    right: auto;
  }

  .textInactive.comment {
    position: absolute;
    top: 0;
    animation: drop-comment-text 600ms linear;
  }

  .textActive.comment {
    position: absolute;
    top: -30px;
    animation: rise-comment-text 600ms linear;
    right: auto;
  }

  .textActive.cancel {
    position: absolute;
    bottom: 0;
    animation: rise-cancel-text 600ms linear;
  }

  .comments__floating-button .comments__floating-button-text-box {
    width: 0;
  }

  .comments__floating-button.is-inactive:hover .comments__floating-button-text-box {
    width: 61.45px;
  }

  .comments__floating-button.is-active:hover .comments__floating-button-text-box {
    width: 43.0833px;
  }

  .comments__floating-button-text-box {
    position: relative;
    height: 14px;
    overflow-x: clip;
    transition: width 300ms linear;
  }

  .comments__floating-button__icon {
    position: relative;
  }

  .cross {
    position: absolute;
    top: 9px;
    left: 5.3px;
    transform: translateY(-50%);
    transform-origin: center;
    transition: transform 300ms linear 300ms;
  }

  rect {
    fill: rgba(var(--sv-gray-600));
  }

  .comments__floating-button:hover rect,
  .is-active rect {
    fill: rgba(var(--sv-white));
  }

  .cross-bar-1 {
    transform-origin: center;
    transform: rotate(0deg);
  }

  .cross-bar-2 {
    transform-origin: center;
    transform: rotate(90deg);
  }

  .is-active .cross {
    transform: translateY(-50%) rotate(45deg);
  }

  @keyframes rise-cancel-text {
    0%,
    50% {
      opacity: 0;
      bottom: -35px;
    }

    75% {
      opacity: 0;
    }

    100% {
      opacity: 1;
      bottom: 0px;
    }
  }

  @keyframes rise-comment-text {
    0% {
      opacity: 1;
      top: 0px;
    }

    35% {
      opacity: 0;
    }

    50%,
    100% {
      opacity: 0;
      top: -35px;
    }
  }

  @keyframes drop-cancel-text {
    0% {
      opacity: 1;
      bottom: 0px;
    }

    35% {
      opacity: 0;
    }

    50%,
    100% {
      opacity: 0;
      bottom: -30px;
    }
  }

  @keyframes drop-comment-text {
    0%,
    50% {
      opacity: 0;
      top: -30px;
    }

    75% {
      opacity: 0;
    }

    100% {
      opacity: 1;
      top: 0px;
    }
  }
`;a();import{css as Qs}from"lit";var pi=Qs`
.footer {
  bottom: 5px;
  position: absolute;
  right: 5px;
  font-family: Roboto,sans-serif;
  font-size: 10px;
  line-height: 15px;
  letter-spacing: normal;
}

.link {
  text-decoration: none;
  color: rgb(var(--sv-gray-500));
}

.powered-by {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  width: 140px;
  &--vertical {
    justify-content: flex-end;
  }
  &--horizontal {
    justify-content: center;
  }
}
`;a();import{css as tn}from"lit";var ci=tn`
  #mention-list {
    position: absolute;
    z-index: 1;
    max-height: 200px;
    overflow-y: auto;
    overflow-x: hidden;
    background-color: white;
    display: none;
    width: 216px;
    text-align: -webkit-center;
    border-radius: 2px;
    box-shadow: 2px 2px 8px 0px rgba(0, 0, 0, 0.30);
    padding-top: 4px;
    padding-bottom: 4px;
    /* Stiling scroll WebKit (Firefox) */
    scrollbar-width: 6px; /* Firefox */
    scrollbar-color: #888; /* Firefox */
    /* Style scroll WebKit (Chrome, Safari, Edge) */
    &::-webkit-scrollbar {
      width: 6px;
    }
    &::-webkit-scrollbar-thumb {
      background-color: #888;
    }
  }

  .mention-item {
    cursor: pointer;
    align-items: center;
    display: flex;
    height: 48px;
    width: 208px;
    margin-left: 4px;
    margin-right: 4px;
  }

  .mention-item:hover {
    background: rgb(var(--sv-gray-200));
  }

  .avatar {
    width: 32px;
    height: 32px;
    object-fit: contain;
    border-radius: 32%;
    margin-right: 14px;
    margin-left: 12px;
  }

  .default-avatar {
    width: 32px;
    height: 32px;
    margin-right: 14px;
    margin-left: 12px;
    border-radius: 50%;
    overflow: hidden;
    background-color: rgb(var(--sv-gray-300));
    border: 1px solid rgb(var(--sv-gray-500));
    color: #fff;

    display: flex;
    align-items: center;
    justify-content: center;
  }

  .avatar-type {
    font-family: Roboto;
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 20px;
    color: rgb(var(--sv-gray-600));
  }
`;a();var di;function mi(p){let i=p.querySelector("#superviz-comments");if(i&&!di){let t={childList:!0,attributes:!0,characterData:!0,subtree:!0};di=new MutationObserver(e=>{e.forEach(o=>{!o.removedNodes.length||o.removedNodes.forEach(s=>{s.id==="poweredby-footer"&&en(p)})})}),di.observe(i,t)}}function en(p){let i=document.createElement("div");i.id="poweredby-footer",i.className="footer";let t=document.createElement("div");t.className="powered-by powered-by--horizontal";let e=document.createElement("a");e.href="https://superviz.com/",e.target="_blank",e.className="link";let o=document.createElement("div");o.textContent="Powered by";let s=document.createElement("img");s.width=48,s.height=8.86,s.src="https://production.cdn.superviz.com/static/superviz-gray-logo.svg",t.appendChild(e),e.appendChild(o),o.appendChild(s),i.appendChild(t);let n=p.getElementById("superviz-comments");n&&n.appendChild(i),mi(p)}var so=P(on),rn=[so.styles,Qe,pi],Q=class extends so{constructor(){super();this.annotations=[],this.annotationFilter="all",this.waterMarkState=!1,this.participantsList=[],this.side="left"}firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{_.call(this,["comments"])})}updated(t){super.updated(t),this.updateComplete.then(()=>{this.waterMarkState&&mi(this.shadowRoot),t.has("offset")&&this.applyOffset()})}participantsListed(t){this.participantsList=t}updateAnnotations(t){this.annotations=t}close(){this.emitEvent("close-threads",{})}waterMarkStatus(t){this.waterMarkState=t}setFilter({detail:t}){let{filter:e}=t;this.annotationFilter=e}getOffset(t){return t==null||t<0?"10px":`${t}px`}applyOffset(){let t=this.shadowRoot.querySelector(".superviz-comments");if(!t)return;let{left:e,right:o,top:s,bottom:n}=this.offset;t.style.setProperty("--offset-top",this.getOffset(s)),t.style.setProperty("--offset-bottom",this.getOffset(n)),t.style.setProperty("--offset-right",this.getOffset(o)),t.style.setProperty("--offset-left",this.getOffset(e))}get poweredBy(){return this.waterMarkState?hi` <div id="poweredby-footer" class="footer">
      <div class="powered-by powered-by--horizontal">
        <a href="https://superviz.com/" target="_blank" class="link">
          <div class="">
            Powered by
            <img
              width="48px"
              height="8.86px"
              src="https://production.cdn.superviz.com/static/superviz-gray-logo.svg"
            />
          </div>
        </a>
      </div>
    </div>`:hi``}render(){let t={"superviz-comments":!0,"threads-on-left-side":this.side==="left","threads-on-right-side":this.side==="right","hide-at-right":this.side==="right"&&!this.open,"hide-at-left":this.side==="left"&&!this.open};return hi`
      <div id="superviz-comments" class=${nn(t)}>
        <div class="header">
          <superviz-comments-topbar
            @close-threads=${this.close}
            side=${this.side.split(":")[0]}
          ></superviz-comments-topbar>
        </div>
        <superviz-comments-annotation-filter
          filter=${this.annotationFilter}
          @select=${this.setFilter}
        >
        </superviz-comments-annotation-filter>
        <superviz-comments-content
          annotations=${JSON.stringify(this.annotations)}
          annotationFilter=${this.annotationFilter}
          participantsList=${JSON.stringify(this.participantsList)}
          class="content"
        ></superviz-comments-content>
        ${this.poweredBy}
      </div>
    `}};Q.styles=rn,Q.properties={open:{type:Boolean},annotations:{type:Object},annotationFilter:{type:String},waterMarkState:{type:Boolean},side:{type:String},participantsList:{type:Object},offset:{type:Object}},Q=w([sn("superviz-comments")],Q);a();a();import{LitElement as no,html as an}from"lit";import{customElement as ln}from"lit/decorators.js";var pn=P(no),cn=[pn.styles,ti],tt=class extends P(no){firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{_.call(this,["comments"])})}close(){this.dispatchEvent(new CustomEvent("close-threads"))}render(){return an`
      <div class="comments__topbar">
        <span class="text text-bold comments__topbar__title">COMMENTS</span>
        <span @click=${this.close} class="comments__topbar__close-threads">
          <superviz-icon name=${this.side}></superviz-icon>
        </span>
      </div>
    `}};tt.styles=cn,tt.properties={side:{type:String}},tt=w([ln("superviz-comments-topbar")],tt);a();import{LitElement as dn,html as ro}from"lit";import{customElement as mn}from"lit/decorators.js";import{repeat as hn}from"lit/directives/repeat.js";var ao=P(dn),un=[ao.styles,ii],et=class extends ao{constructor(){super();this.unselectAnnotation=()=>{this.selectedAnnotation=null};this.unselectAnnotationEsc=t=>{t&&(t==null?void 0:t.key)!=="Escape"||(this.selectedAnnotation=null)};this.selectAnnotation=({detail:t})=>{let{uuid:e}=t;if(this.selectedAnnotation===e){this.selectedAnnotation=null;return}this.selectedAnnotation=e};this.checkLastAnnotation=t=>{var s,n;let e=this.annotations.filter(r=>r.resolved),o=this.annotations.filter(r=>!r.resolved);return this.annotationFilter==="all"?t===((s=e[e.length-1])==null?void 0:s.uuid):t===((n=o[o.length-1])==null?void 0:n.uuid)};this.annotations=[],this.participantsList=[]}updated(t){super.updated(t),this.updateComplete.then(()=>{let e=this.shadowRoot.querySelector(`[uuid='${this.selectedAnnotation}']`);if(!e)return;let o=this.lastCommentId===this.selectedAnnotation,s=o?0:-150,n=e.getClientRects()[0];!n||(this.scrollBy(0,n.y+s),o&&setTimeout(()=>{this.scrollBy(0,n.y+s)},200))})}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("select-annotation",this.selectAnnotation),window.document.body.addEventListener("keyup",this.unselectAnnotationEsc),window.document.body.addEventListener("unselect-annotation",this.unselectAnnotation)}disconnectedCallback(){super.disconnectedCallback(),window.document.body.removeEventListener("select-annotation",this.selectAnnotation),window.document.body.removeEventListener("keyup",this.unselectAnnotationEsc),window.document.body.removeEventListener("unselect-annotation",this.unselectAnnotation)}render(){return ro` ${hn(this.annotations.filter(t=>{var e;return(e=t.comments)==null?void 0:e.length}),t=>t.uuid,t=>ro`
        <superviz-comments-annotation-item
          annotation=${JSON.stringify(t)}
          selected="${this.selectedAnnotation}"
          annotationFilter=${this.annotationFilter}
          uuid=${t.uuid}
          isLastComment=${this.checkLastAnnotation(t.uuid)}
          participantsList=${JSON.stringify(this.participantsList)}
        >
        </superviz-comments-annotation-item>
      `)}`}};et.styles=un,et.properties={annotations:{type:Object},selectedAnnotation:{type:String},annotationFilter:{type:String},participantsList:{type:Object}},et=w([mn("superviz-comments-content")],et);a();import{LitElement as vn,html as oe}from"lit";import{customElement as gn}from"lit/decorators.js";import{classMap as Le}from"lit/directives/class-map.js";import{DateTime as bn}from"luxon";var lo=P(vn),fn=[lo.styles,ei],it=class extends lo{constructor(){super();this.updateComment=({detail:t})=>{let{text:e,mentions:o}=t;this.text=e,this.closeEditMode(),this.emitEvent("update-comment",{uuid:this.uuid,mentions:o,text:e})};this.resolveAnnotation=t=>{t.stopPropagation(),this.emitEvent("resolve-annotation",{type:"resolve-annotation",resolved:!this.resolved},{composed:!1,bubbles:!1})};this.confirmDelete=()=>{if(this.deleteCommentModalOpen=!1,this.primaryComment)return this.emitEvent("delete-annotation",{uuid:this.annotationId});this.emitEvent("delete-comment",{annotationId:this.annotationId,uuid:this.uuid})};this.closeEditMode=()=>{this.mode="readonly",this.emitEvent("edit-comment",{editing:!1})};this.resolved=!1}firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{_.call(this,["comments"])})}getAvatar(){var t;return this.avatar?oe` <div class=${this.getClasses("avatar-container")}>
        <img src=${this.avatar} class=${this.getClasses("avatar-image")} />
      </div>`:oe`<div class=${this.getClasses("avatar-container")}>
      <p class="text text-bold ${this.getClasses("avatar-letter")}">
        ${((t=this.username[0])==null?void 0:t.toUpperCase())||"A"}
      </p>
    </div>`}getClasses(t){return`comments__comment-item__${t} ${this.class}__${t}`}render(){let t=this.annotationFilter==="all"?"resolve":"undo",e=h=>bn.fromISO(h).toFormat("yyyy-dd-MM"),o=this.resolvable?"comments__comment-item__resolve":"hidden",s=[{label:"EDIT"},{label:"DELETE"}],n=({detail:h})=>{h==="EDIT"&&(this.mode="editable",this.emitEvent("edit-comment",{editing:!0})),h==="DELETE"&&(this.deleteCommentModalOpen=!0)},r=()=>{this.text.length<120||(this.expandElipsis=!0)},l=()=>{let h={"comments__comment-item--editable":!0,"hide-edit-input":this.mode!=="editable"};return oe`
        <superviz-comments-comment-input
          class="${Le(h)}"
          editable
          @click=${g=>g.stopPropagation()}
          text=${this.text}
          eventType="update-comment"
          participantsList=${JSON.stringify(this.participantsList)}
          mentions=${JSON.stringify(this.mentions)}
          @update-comment=${this.updateComment}
          @close-edit-mode=${this.closeEditMode}
        ></superviz-comments-comment-input>
      `},c=()=>{let h={editing:this.mode==="editable","annotation-content":!0,text:!0,"text-big":!0,"sv-gray-700":!0,[this.getClasses("content")]:!0,"line-clamp":!this.expandElipsis&&this.text.length>120};return oe`
        <span id="comment-text" @click=${r} class="${Le(h)}"
          >${this.text}</span
        >
      `},d=()=>{this.deleteCommentModalOpen=!1},v={[this.class]:!0,"comments__comment-item":!0,reply:!this.primaryComment},y={"comments__comment-item__content__body":!0,"editing-annotation":this.mode==="editable"};return oe`
      <div class=${Le(v)}>
        <div class=${this.getClasses("header")}>
          <div class=${this.getClasses("metadata")}>
            ${this.getAvatar()}
            <span class="text text-big text-bold sv-gray-700 ${this.getClasses("username")}"
              >${this.username}</span
            >
            <span class="text text-small sv-gray-500 ${this.getClasses("date")}"
              >${e(this.createdAt)}</span
            >
          </div>
          <div class=${this.getClasses("actions")}>
            <button
              @click=${this.resolveAnnotation}
              class="${this.getClasses("icons")} ${this.getClasses("resolve-icon")} icon-button icon-button--clickable icon-button--xsmall ${o}"
            >
              <superviz-icon
                name=${t}
                size="sm"
                suffix=${t==="undo"?"md":void 0}
              ></superviz-icon>
            </button>
            <superviz-dropdown
              options=${JSON.stringify(s)}
              label="label"
              returnTo="label"
              position="bottom-left"
              @selected=${n}
              @click=${h=>h.stopPropagation()}
              classesPrefix="comments__dropdown"
              parentComponent="comments"
            >
              <button
                slot="dropdown"
                class="${this.getClasses("icons")} ${this.getClasses("options-icon")} icon-button icon-button--clickable icon-button--small"
              >
                <superviz-icon name="more" size="sm"></superviz-icon>
              </button>
            </superviz-dropdown>
          </div>
        </div>

        <div class="comments__comment-item__content">
          <div class="${Le(y)}">${l()} ${c()}</div>
        </div>
      </div>
      <superviz-comments-delete-comments-modal
        ?open=${this.deleteCommentModalOpen}
        @close=${d}
        @confirm=${this.confirmDelete}
      >
      </superviz-comments-delete-comments-modal>
    `}};it.styles=fn,it.properties={uuid:{type:String},annotationId:{type:String},avatar:{type:String},username:{type:String},text:{type:String},resolved:{type:Boolean},resolvable:{type:Boolean},createdAt:{type:String},mode:{type:String},deleteCommentModalOpen:{type:Boolean},primaryComment:{type:Boolean},expandElipsis:{type:Boolean},annotationFilter:{type:String},participantsList:{type:Object},mentions:{type:Array},class:{type:String}},it=w([gn("superviz-comments-comment-item")],it);a();import{LitElement as wn,html as vi}from"lit";import{customElement as Pn}from"lit/decorators.js";import{classMap as mo}from"lit/directives/class-map.js";a();var Ie=class{constructor(){this.keys=["@"];this.input=null,this.mentions=[]}setInput(i){this.event=i,this.input=i.target,this.key=i.data}getMentions(i,t=[]){return t.length>0&&(this.mentions=t),this.mentions.filter(e=>((s,n)=>n.includes(s.name))(e,i))}setMentions(i){this.mentions=i}addMention(i){this.mentions.some(e=>e.userId===i.userId)||this.mentions.push(i)}clearMentions(){this.mentions=[]}getSelectionPosition(){var o;let i=this.getSelectionStart(),t=this.getLastKeyBeforeCaret(i);return{start:((o=t==null?void 0:t.keyIndex)!=null?o:-1)+1,end:i}}getSelectionStart(){var i;return(i=this.input)==null?void 0:i.selectionStart}setCaretPosition(i){this.input.selectionEnd=i}getValue(){var i;return(i=this.input)==null?void 0:i.value}setValue(i){this.input.value=i}getLastKeyBeforeCaret(i){let[t]=this.keys.map(e=>({key:e,keyIndex:this.getValue().lastIndexOf(e,i-1)})).sort((e,o)=>o.keyIndex-e.keyIndex);return t}searchMention(i,t){return t!==-1?this.getValue().substring(t+1,i):null}isDeletion(){return this.event.inputType==="deleteContentBackward"||this.event.inputType==="deleteContentForward"||this.event.inputType==="deleteWordBackward"}insertMention(i,t,e){if(this.isDeletion())return;let{id:o,name:s}=e,n=`${this.getValue().slice(0,i)+s} ${this.getValue().slice(t,this.getValue().length)}`;this.setValue(n),this.input.focus(),this.addMention({userId:o,name:s}),this.setCaretPosition(i+s.length+1)}};a();var ui={SHOW:"show",HIDE:"hide"},yn={action:ui.HIDE,mentions:[],findDigitParticipant:!1},En=(p,i,t)=>{var s,n;let e=[];if(e=t==null?void 0:t.filter(r=>r==null?void 0:r.email),p.length>0&&(e=e.filter(r=>(r==null?void 0:r.name.toLowerCase().search(p.toLowerCase()))!==-1),p===((n=(s=e[0])==null?void 0:s.name)==null?void 0:n.toLowerCase()))){let r=po(e,i);return{action:ui.HIDE,mentions:r,findDigitParticipant:!0}}if(!((e==null?void 0:e.length)>0))return yn;let o=po(e,i);return{action:ui.SHOW,mentions:o,findDigitParticipant:!1}},po=(p,i)=>p.map(t=>({id:t.id,name:t.name,avatar:t.avatar,email:t.email,position:i})),co={matchParticipant:(p,i,t)=>En(p,i,t)};var ho=P(wn),Tn=[ho.styles,oi],ot=class extends ho{constructor(){super();this.pinCoordinates=null;this.autoCompleteHandler=new Ie;this.addAtSymbolInCaretPosition=()=>{let t=this.shadowRoot.querySelector(".comments__input__textarea"),e=new InputEvent("input",{bubbles:!0,cancelable:!0});Object.defineProperty(e,"data",{value:"@",writable:!0}),t.dispatchEvent(e)};this.getCommentInput=()=>this.shadowRoot.querySelector(".comments__input__textarea");this.userMentionedByTextInput=t=>{this.mentionList=[];let e={detail:f({},t[0])};this.insertMention(e)};this.buttonAtSymbol=()=>{var l;let t=this.autoCompleteHandler.getSelectionStart(),e=this.autoCompleteHandler.getValue();this.autoCompleteHandler.setValue(`${e.slice(0,t)}@${e.slice(t,e.length)}`),t+=1;let o=this.autoCompleteHandler.getLastKeyBeforeCaret(t),s=(l=o==null?void 0:o.keyIndex)!=null?l:-1,n=this.autoCompleteHandler.searchMention(t,s),r={start:s+1,end:t};return{searchText:n,position:r}};this.focusInput=()=>{this.getCommentInput().focus()};this.handleInput=t=>{var h,g;if(((h=this.commentInput)==null?void 0:h.value.length)===0?this.btnActive=!1:this.btnActive=!0,t.data===null)return;this.autoCompleteHandler.setInput(t);let e=this.autoCompleteHandler.getSelectionStart(),o=this.autoCompleteHandler.getLastKeyBeforeCaret(e),s=(g=o==null?void 0:o.keyIndex)!=null?g:-1,n=this.autoCompleteHandler.searchMention(e,s),r=this.autoCompleteHandler.getSelectionPosition(),l=t.data==="@"&&s===-1,c=t.data==="@"&&e-1!==s;if(l||c){let S=this.buttonAtSymbol();n=S.searchText,r=S.position}if(n===null){this.mentionList=[];return}let{action:d,mentions:v,findDigitParticipant:y}=co.matchParticipant(n,r,this.participantsList);if(y){this.userMentionedByTextInput(v);return}d==="show"&&(this.mentionList=v),d==="hide"&&(this.mentionList=[])};this.insertMention=t=>{let{id:e,name:o,avatar:s,email:n,position:r}=t.detail;this.autoCompleteHandler.insertMention(r.start,r.end,{id:e,name:o,avatar:s,email:n}),this.mentionList=[],this.updateHeight()};this.sendEnter=t=>{var n;if(t.key!=="Escape"&&t.stopImmediatePropagation(),t.key==="Enter"&&!t.shiftKey&&t.preventDefault(),t.key!=="Enter"||t.shiftKey||((n=this.mentionList)==null?void 0:n.length)>0)return;let e=this.commentInput,o=e.value.trim();if(!o)return;let s=this.autoCompleteHandler.getMentions(o);this.emitEvent(this.eventType,{text:o,mentions:s,position:this.pinCoordinates},{composed:!1,bubbles:!1}),e.value="",this.sendBtn.disabled=!0,this.updateHeight()};this.closeEditMode=()=>{this.emitEvent("close-edit-mode",{},{composed:!1,bubbles:!1}),this.hideInput=!0};this.onTextareaFocus=()=>{let t=this.optionsContainer,e=this.horizontalRule,o=this.commentInput;t.classList.add("active-textarea"),e.classList.add("comments__input__divisor"),o.classList.add("active-textarea")};this.onTextareaLoseFocus=t=>{var r,l;let e=(l=(r=t.explicitOriginalTarget)==null?void 0:r.parentNode)==null?void 0:l.host;if(this.closeButton.contains(e)||this.closeButton.contains(t.explicitOriginalTarget)||this.closeButton.contains(t.relatedTarget)){this.cancelComment();return}if(!this.shadowRoot.contains(t.target))return;let o=this.optionsContainer,s=this.horizontalRule,n=this.commentInput;n.value.length||(o.classList.remove("active-textarea"),s.classList.remove("comments__input__divisor"),n.classList.remove("active-textarea"))};this.cancelComment=()=>{document.body.dispatchEvent(new KeyboardEvent("keyup",{key:"Escape"}))};this.commentInputEditableOptions=()=>{var t;if(!!this.editable)return vi`
      <button
        id="close"
        @click=${this.closeEditMode}
        class="icon-button icon-button--medium icon-button--clickable comments__input__button comments__input__close-button"
      >
        <superviz-icon name="close" size="sm"></superviz-icon>
      </button>
      <button
        id="confirm"
        class="icon-button icon-button--medium icon-button--clickable comments__input__button comments__input__send-button"
        disabled
        @click=${this.send}
      >
        <superviz-icon
          color=${((t=this.sendBtn)==null?void 0:t.disabled)||!this.sendBtn?"black":"white"}
          name="check"
          size="sm"
        ></superviz-icon>
      </button>
    `};this.commentInputOptions=()=>{var t;if(!this.editable)return vi`
      <button
        class="icon-button icon-button--medium icon-button--clickable comments__input__button comments__input__close-button align-send-btn"
        @click=${this.cancelComment}
      >
        <superviz-icon name="close" size="sm"></superviz-icon>
      </button>
      <button
        class="comments__input__button comments__input__send-button align-send-btn"
        disabled
        @click=${this.send}
      >
        <superviz-icon
          color=${((t=this.sendBtn)==null?void 0:t.disabled)||!this.sendBtn?"black":"white"}
          name="line-arrow-right"
          size="sm"
        ></superviz-icon>
      </button>
    `};this.btnActive=!1,this.text="",this.mentionList=[],this.mentions=[]}get commentInput(){return this.shadowRoot.querySelector(".comments__input__textarea")}get sendBtn(){return this.shadowRoot.querySelector(".comments__input__send-button")}get optionsContainer(){return this.shadowRoot.querySelector(".comments__input__options")}get horizontalRule(){return this.shadowRoot.querySelector(".sv-hr")}get closeButton(){return this.shadowRoot.querySelector(".comments__input__close-button")}connectedCallback(){super.connectedCallback(),["create-annotation","create-comment"].includes(this.eventType)&&this.addEventListener("keyup",this.sendEnter)}disconnectedCallback(){if(super.disconnectedCallback(),!["create-annotation","create-comment"].includes(this.eventType))return;let t=this.getCommentInput();this.removeEventListener("keyup",this.sendEnter),t.removeEventListener("keydown",this.sendEnter),t.removeEventListener("click",this.focusInput),t.addEventListener("input",this.handleInput)}firstUpdated(t){this.updateComplete.then(()=>{this.emitEvent("comment-input-ready",{},{composed:!1,bubbles:!1});let e=this.getCommentInput();if(e&&(e.addEventListener("input",this.handleInput),e.addEventListener("click",this.focusInput),e.addEventListener("keydown",this.sendEnter)),this.text.length>0){let o=this.participantsList.map(({id:s,name:n})=>({userId:s,name:n}));this.mentions=this.autoCompleteHandler.getMentions(this.text,o),this.autoCompleteHandler.setMentions(this.mentions)}this.editable&&this.focusInput(),_.call(this,["comments"])})}updated(t){if(t.has("text")&&this.text.length>0){let e=this.commentInput;e.value=this.text,this.updateHeight()}t.has("btnActive")&&(this.sendBtn.disabled=!this.btnActive)}updateHeight(){let t=this.commentInput;t.style.height="40px";let e=t.scrollHeight+14;e===47&&(e=40),t.style.height=`${e}px`,this.sendBtn.disabled=!(t.value.length>0)}send(t){var n;if(t.preventDefault(),((n=this.mentionList)==null?void 0:n.length)>0)return;let e=this.commentInput,o=e.value,s=this.autoCompleteHandler.getMentions(o);this.emitEvent(this.eventType,{text:o,mentions:s,position:this.pinCoordinates},{composed:!1,bubbles:!1}),e.value="",this.sendBtn.disabled=!0,this.updateHeight()}render(){var o;let t={comments__input__textarea:!0,"fixed-width":this.eventType==="create-annotation"},e={comments__input:!0,"comments__input--editable":this.editable,"hide-input":this.hideInput};return vi`
      <div class="${mo(e)}">
        <textarea
          id="comments__input__textarea"
          class=${mo(t)}
          placeholder=${(o=this.placeholder)!=null?o:"Add comment..."}
          @input=${this.updateHeight}
          @focus=${this.onTextareaFocus}
          @blur=${this.onTextareaLoseFocus}
          spellcheck="false"
        ></textarea>
        <superviz-comments-mention-list
          .participants=${this.mentionList}
          @participant-selected=${this.insertMention}
        ></superviz-comments-mention-list>
        <div class="sv-hr"></div>
        <div class="comments__input__options">
          <button class="icon-button icon-button--medium icon-button--clickable">
            <superviz-icon
              name="mention"
              @click=${this.addAtSymbolInCaretPosition}
              size="sm"
            ></superviz-icon>
          </button>
          <div class="comment-input-options">
            ${this.commentInputOptions()} ${this.commentInputEditableOptions()}
          </div>
        </div>
      </div>
    `}};ot.styles=Tn,ot.properties={eventType:{type:String},text:{type:String},btnActive:{type:Boolean},editable:{type:Boolean},placeholder:{type:String},mentions:{type:Array},mentionList:{type:Object},participantsList:{type:Object},hideInput:{type:Boolean}},ot=w([Pn("superviz-comments-comment-input")],ot);a();import{LitElement as An,html as St}from"lit";import{customElement as xn}from"lit/decorators.js";import{classMap as gi}from"lit/directives/class-map.js";var uo=P(An),Cn=[uo.styles,ri],st=class extends uo{constructor(){super();this.focusInput=()=>{var t,e;this.inputElement||(this.inputElement=(e=(t=this.shadowRoot)==null?void 0:t.querySelector("superviz-comments-comment-input"))==null?void 0:e.shadowRoot.querySelector("textarea")),this.inputElement.focus()};this.setInputSide=()=>{let s=this.commentsSide==="right"?320:0,n=this.annotationSides.right+293,r=this.containerSides.right-s;if(n<r){this.horizontalSide="right";return}s=this.commentsSide==="left"?320:0;let l=this.annotationSides.left-293,c=this.containerSides.left+s;if(l>c){this.horizontalSide="left";return}this.horizontalSide=c-l>n-r?"right":"left"};this.createComment=({detail:t})=>{this.annotationSent=!0,document.body.dispatchEvent(new CustomEvent("create-annotation",{detail:x(f({},t),{position:x(f({},this.originalPosition),{type:"canvas"})})})),this.annotation=null};this.cancelTemporaryAnnotation=()=>{this.annotation=null};this.cancelTemporaryAnnotationEsc=t=>{this.annotation=null};this.avatar=()=>{if(this.type==="add"&&!this.showInput)return St`<div
        class="comments__annotation-pin__avatar comments__annotation-pin__avatar--add"
      >
        <superviz-icon name="add"></superviz-icon>
      </div>`;let t=this.userAvatar;return t?St`<div class="comments__annotation-pin__avatar">
        <img src=${t} />
      </div>`:St`<div class="comments__annotation-pin__avatar">
      <p class="text text-bold text-big">${this.userInitial}</p>
    </div>`};this.input=()=>{if(!(!this.showInput||this.annotationSent))return St`<div class="floating-input">
      <superviz-comments-comment-input
        @create-annotation=${this.createComment}
        eventType="create-annotation"
        @comment-input-ready=${this.focusInput}
        participantsList=${JSON.stringify(this.participantsList)}
      >
      </superviz-comments-comment-input>
    </div>`};this.position={x:0,y:0},setTimeout(()=>{this.firstLoad=!1},800)}updated(t){super.updated(t),!(!t.has("movedPosition")||!this.annotationSides)&&(this.annotationSides=this.pinAnnotation.getBoundingClientRect(),this.setInputSide(),this.inputElement&&this.focusInput())}firstUpdated(t){var e;super.firstUpdated(t),_.call(this,["comments"]),this.showInput&&(this.originalPosition=f({},this.position),this.pinAnnotation=(e=this.shadowRoot)==null?void 0:e.querySelector(".comments__annotation-pin"),this.annotationSides=this.pinAnnotation.getBoundingClientRect(),this.setInputSide())}connectedCallback(){if(super.connectedCallback(),this.type!=="add")return;let{localParticipant:t}=this.useStore("global-store");t.subscribe(e=>{var o;this.localAvatar=(o=e==null?void 0:e.avatar)==null?void 0:o.imageUrl,this.localName=e==null?void 0:e.name}),window.document.body.addEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.addEventListener("keyup",e=>{e.key==="Escape"&&this.cancelTemporaryAnnotationEsc(e)})}disconnectedCallback(){super.disconnectedCallback(),this.type==="add"&&(window.document.body.removeEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.removeEventListener("keyup",t=>{t.key==="Escape"&&this.cancelTemporaryAnnotationEsc(t)}))}get userAvatar(){var t,e,o,s;return((s=(o=(e=(t=this.annotation)==null?void 0:t.comments)==null?void 0:e.at(0))==null?void 0:o.participant)==null?void 0:s.avatar)||this.localAvatar}get userInitial(){var e,o,s,n,r;return(((r=(n=(s=(o=(e=this.annotation)==null?void 0:e.comments)==null?void 0:o.at(0))==null?void 0:s.participant)==null?void 0:n.name)!=null?r:this.localName)||"Anonymous")[0].toUpperCase()}emitClick(){var t;document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:(t=this.annotation)==null?void 0:t.uuid}}))}render(){let t={"comments__annotation-pin":!0,preload:this.firstLoad===void 0,"comments__annotation-pin--active":this.active,"comments__cursor-pointer":this.type==="add"&&!this.showInput,"comments__annotation-pin--add":this.type==="add"&&this.showInput,[this.horizontalSide]:!0},e={"comments__annotation-pin-wrapper":!0,"comments__annotation-pin-wrapper--new":this.newPin},o=this.keepPositionRatio?"%":"px",s=`top: ${this.position.y}${o}; left: ${this.position.x}${o};`;return this.type==="add"?St`
        <div class=${gi(t)} style=${s}>${this.avatar()} ${this.input()}</div>
      `:St`<div class=${gi(e)} style=${s}>
      <div @click=${this.emitClick} class=${gi(t)}>${this.avatar()}</div>
    </div> `}};st.styles=Cn,st.properties={type:{type:String},annotation:{type:Object},position:{type:Object},active:{type:Boolean},showInput:{type:Boolean},containerSides:{type:Object},horizontalSide:{type:String},commentsSide:{type:String},movedPosition:{type:String},pinAnnotation:{type:Object},localAvatar:{type:String},annotationSent:{type:Boolean},localName:{type:String},keepPositionRatio:{type:Boolean},participantsList:{type:Object},firstLoad:{type:Boolean},newPin:{type:Boolean}},st=w([xn("superviz-comments-annotation-pin")],st);a();import{LitElement as _n,html as H}from"lit";import{customElement as Sn}from"lit/decorators.js";import{classMap as B}from"lit/directives/class-map.js";var vo=P(_n),On=[vo.styles,si],nt=class extends vo{constructor(){super(...arguments);this.selectAnnotation=()=>{let{uuid:t}=this.annotation;document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:t}}))};this.resolveAnnotation=({detail:t})=>{let{uuid:e}=this.annotation,{resolved:o,type:s}=t,n=s==="resolve-annotation"&&this.annotationFilter==="all";this.resolved=o,this.emitEvent("resolve-annotation",{uuid:e,resolved:o}),n&&(this.shouldShowUndoResolved=!0)};this.hideUndoResolved=()=>{this.shouldShowUndoResolved=!1};this.generateExpandedCommentsTemplate=(t,e)=>{var o,s,n,r;return e===0?H``:H`
      <superviz-comments-comment-item
        uuid=${t.uuid}
        avatar=${(r=(n=(s=(o=this.annotation)==null?void 0:o.comments)==null?void 0:s.at(e))==null?void 0:n.participant)==null?void 0:r.avatar}
        username=${t.participant.name||"Anonymous"}
        text=${t.text}
        createdAt=${t.createdAt}
        annotationId=${this.annotation.uuid}
        participantsList=${JSON.stringify(this.participantsList)}
        mentions=${JSON.stringify(t.mentions)}
        class="comments__replies"
      ></superviz-comments-comment-item>
    `};this.updateEditMode=({detail:{editing:t}})=>{this.hideInput=t}}firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{this.resolved=this.annotation.resolved,_.call(this,["comments"])})}get filterIsAll(){return this.annotationFilter==="all"}get filterIsResolved(){return this.annotationFilter==="resolved"}get shouldHideAnnotation(){return{hidden:this.resolved&&this.filterIsAll||!this.resolved&&this.filterIsResolved}}get replies(){return[...this.annotation.comments].splice(1).length}get repliesSize(){return this.replies>=5?5:this.replies}get replyText(){return this.replies!==1?"replies":"reply"}get isSelected(){return this.selected===this.annotation.uuid}get annotationClasses(){return{comments__thread:!0,"comments__thread--selected":this.isSelected,"extra-space-bottom":this.replies}}get mainAnnotationClasses(){return{"comments__main-annotation":!0,"comments__main-annotation--selected":this.isSelected}}get hrClasses(){return{"sv-hr":!0,hidden:this.isLastAnnotation}}get avatarCommentsClasses(){return{"avatars-comments":!0,"comment-avatar--expand":!this.expandComments&&this.replies>1,invisible:!(!this.expandComments&&this.replies>=1)}}get containerWrapperClasses(){return{"comments-container-wrapper":!0,show:this.isSelected&&this.expandComments}}get commentsClasses(){return{"comments-container":!0,"comment-item--expand":this.isSelected&&this.expandComments,show:this.isSelected&&this.expandComments}}updated(t){if(t.has("selected")){let e=this.selected===this.annotation.uuid;this.expandComments=e}}createComment({detail:t}){let{text:e,mentions:o}=t;this.emitEvent("create-comment",{uuid:this.annotation.uuid,mentions:o,text:e})}generateAvatarCommentsTemplate(){var e,o,s,n,r,l;let t=[];for(let c=1;c<=this.repliesSize;c++)(o=(e=this.annotation.comments[c])==null?void 0:e.participant)!=null&&o.avatar?t.push(H`
          <div class="avatar">
            <img src=${(n=(s=this.annotation.comments[c])==null?void 0:s.participant)==null?void 0:n.avatar} />
          </div>
        `):t.push(H`
          <div class="avatar">
            <p class="text text-bold">
              ${((l=(r=this.annotation.comments[c])==null?void 0:r.participant.name[0])==null?void 0:l.toUpperCase())||"A"}
            </p>
          </div>
        `);return H`
      ${t}
      <div class="text text-big sv-gray-500">${this.replies} ${this.replyText}</div>
    `}annotationResolvedTemplate(){return this.shouldShowUndoResolved?H`
      <superviz-comments-annotation-resolved
        @undo-resolve=${this.resolveAnnotation}
        @hide=${this.hideUndoResolved}
        class=${B({hidden:this.filterIsResolved,"comments__resolved-annotation-message":!0})}
      >
      </superviz-comments-annotation-resolved>
    `:H``}get inputClasses(){return{"hide-input":this.hideInput}}get wrapperClasses(){return{wrapper:!0,"show-wrapper":!this.resolved&&this.filterIsAll||this.resolved&&this.filterIsResolved}}render(){var e,o,s,n,r,l,c,d,v,y,h;let t={"comments__complete-annotation":!0,"comments__hide-complete-annotation":this.shouldShowUndoResolved};return H`
      <div class="${B(t)}">
        ${this.annotationResolvedTemplate()}

        <div class=${B(this.wrapperClasses)}>
          <div class=${B(this.shouldHideAnnotation)}>
            <div class=${B(this.annotationClasses)} @click=${this.selectAnnotation}>
              <div class=${B(this.mainAnnotationClasses)}>
                <superviz-comments-comment-item
                  uuid=${(e=this.annotation.comments)==null?void 0:e[0].uuid}
                  annotationId=${this.annotation.uuid}
                  username=${((s=(o=this.annotation.comments)==null?void 0:o[0].participant)==null?void 0:s.name)||"Anonymous"}
                  text=${(n=this.annotation.comments)==null?void 0:n[0].text}
                  createdAt=${(r=this.annotation.comments)==null?void 0:r[0].createdAt}
                  participantsList=${JSON.stringify(this.participantsList)}
                  primaryComment
                  avatar=${(v=(d=(c=(l=this.annotation)==null?void 0:l.comments)==null?void 0:c.at(0))==null?void 0:d.participant)==null?void 0:v.avatar}
                  resolvable
                  ?resolved=${this.resolved}
                  annotationFilter=${this.annotationFilter}
                  @resolve-annotation=${this.resolveAnnotation}
                  mentions=${JSON.stringify((y=this.annotation.comments)==null?void 0:y[0].mentions)}
                  class="comments__annotation"
                  @edit-comment=${this.updateEditMode}
                ></superviz-comments-comment-item>
              </div>

              <div class=${B(this.containerWrapperClasses)}>
                <div class=${B(this.commentsClasses)}>
                  ${(h=this.annotation.comments)==null?void 0:h.map(this.generateExpandedCommentsTemplate)}
                  <span class=${B(this.inputClasses)}>
                    <superviz-comments-comment-input
                      @create-comment=${this.createComment}
                      eventType="create-comment"
                      @click=${g=>g.stopPropagation()}
                      placeholder="Reply"
                      participantsList=${JSON.stringify(this.participantsList)}
                    ></superviz-comments-comment-input>
                  </span>
                </div>
              </div>
              <div class=${B(this.avatarCommentsClasses)}>
                <div class="avatar-container">${this.generateAvatarCommentsTemplate()}</div>
              </div>
            </div>
            <div class=${B(this.hrClasses)}></div>
          </div>
        </div>
      </div>
    `}};nt.styles=On,nt.properties={annotation:{type:Object},expandComments:{type:Boolean},selected:{type:String,reflect:!0},resolved:{type:Boolean},shouldShowUndoResolved:{type:Boolean},isLastAnnotation:{type:Boolean},annotationFilter:{type:String},participantsList:{type:Object},hideInput:{type:Boolean}},nt=w([Sn("superviz-comments-annotation-item")],nt);a();import{LitElement as Ln,html as Re}from"lit";import{customElement as In}from"lit/decorators.js";var go=P(Ln),Rn=[go.styles],rt=class extends go{constructor(){super(...arguments);this.emitEventOpenModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--open",{detail:{title:"DELETE COMMENT",body:Re`<span class="text text-big sv-gray-600"
            >Are you sure you want to delete this comment? <br />
            This action cannot be undone</span
          >`,confirmLabel:"DELETE",confirm:!0,cancel:!0},bubbles:!0,composed:!0}))};this.toggle=()=>{this.open=!this.open}}firstUpdated(){window.document.body.addEventListener("superviz-modal--close",()=>{!this.open||this.emitEvent("close",{},{bubbles:!1,composed:!1})}),window.document.body.addEventListener("superviz-modal--confirm",()=>{!this.open||(this.emitEvent("confirm",{},{bubbles:!1,composed:!1}),this.emitEventCloseModal())})}updated(t){t.has("open")&&(this.open&&setTimeout(()=>this.emitEventOpenModal()),this.open||setTimeout(()=>this.emitEventCloseModal()))}emitEventCloseModal(){!this.open||(window.document.body.dispatchEvent(new CustomEvent("superviz-modal--close",{detail:{open:!0},bubbles:!0,composed:!0})),this.emitEvent("close",{},{bubbles:!1,composed:!1}))}render(){let t=()=>{if(!!this.useSlot)return Re`<slot name="modal-handler" @click=${this.toggle}></slot>`},e=()=>{if(!!this.open)return Re` <superviz-modal></superviz-modal> `};return Re` ${t()} ${e()} `}};rt.styles=Rn,rt.properties={open:{type:Boolean},useSlot:{type:Boolean}},rt=w([In("superviz-comments-delete-comments-modal")],rt);a();import{LitElement as Mn,html as bi}from"lit";import{customElement as kn}from"lit/decorators.js";var bo=P(Mn),Nn=[bo.styles,ni],Dn=10*1e3,at=class extends bo{constructor(){super();this.setTimer=()=>{clearTimeout(this.timeout),this.isCanceled=!1,this.timeout=setTimeout(()=>{this.isCanceled||(this.timeToHide=0,this.isCanceled=!1,this.hide())},this.timeToHide)};this.timeToHide=Dn,this.isCanceled=!1}firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{_.call(this,["comments"]),this.setTimer()})}hide(){this.emitEvent("hide",{},{bubbles:!1,composed:!1})}undone(){this.isCanceled=!0,this.hide(),this.emitEvent("undo-resolve",{type:"undo-resolve",resolved:!1},{bubbles:!1,composed:!1}),clearTimeout(this.timeout)}render(){return this.timeToHide===0?bi``:this.isCanceled?bi``:bi`
      <div class="comments__annotation-resolved">
        <span class="text text-big sv-gray-700 comments__annotation-resolved__text"
          >You resolved this comment</span
        >
        <button
          id="undone"
          @click=${this.undone}
          class="icon-button icon-button--clickable icon-button--medium comments__annotation-resolved__unresolve_button"
        >
          <superviz-icon name="undo" size="md"></superviz-icon>
        </button>
      </div>
    `}};at.styles=Nn,at.properties={timeToHide:{type:Number},isCanceled:{type:Boolean}},at=w([kn("superviz-comments-annotation-resolved")],at);a();import{LitElement as Bn,html as $n}from"lit";import{customElement as Fn}from"lit/decorators.js";import{classMap as zn}from"lit/directives/class-map.js";var fo=P(Bn),Gn=[fo.styles,ai],se=[{label:"All comments",code:"all"},{label:"Resolved comments",code:"resolved"}],lt=class extends fo{constructor(){super();this.caret="down"}firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{_.call(this,["comments"])})}render(){let t=this.filter==="all"?se[0].label:se[1].label,e=({detail:r})=>{this.emitEvent("select",{filter:r}),o()},o=()=>{this.caret=this.caret==="down"?"up":"down"},s=this.filter==="all"?se[0].code:se[1].code,n={text:!0,"text-bold":!0,"select-content":!0,"comments__filter__selected-label":!0,"sv-gray-500":this.caret==="down","sv-gray-700":this.caret==="up"};return $n`
      <div class="comments__filter-container">
        <div class="comments__filter">
          <superviz-dropdown
            options=${JSON.stringify(se)}
            active=${s}
            label="label"
            returnTo="code"
            position="bottom-left"
            right-offset="100px"
            @click=${o}
            @selected=${e}
            @close=${o}
            classesPrefix="comments__dropdown"
            parentComponent="comments"
          >
            <div class="comments__filter__toggle-button" slot="dropdown">
              <span class=${zn(n)}>${t}</span>
              <div class="comments__filter__icon">
                <superviz-icon name=${this.caret} size="xs"></superviz-icon>
              </div>
            </div>
          </superviz-dropdown>
        </div>
      </div>
    `}};lt.styles=Gn,lt.properties={filter:{type:String},caret:{type:String}},lt=w([Fn("superviz-comments-annotation-filter")],lt);a();import{LitElement as Hn,html as Un}from"lit";import{customElement as Wn}from"lit/decorators.js";import{classMap as Me}from"lit/directives/class-map.js";var yo=P(Hn),Vn=[yo.styles,li],pt=class extends yo{constructor(){super();this.onTogglePinActive=({detail:{isActive:t}})=>{this.isActive=t};this.isHidden=!0,this.positionStyles="top: 20px; left: 20px;",this.shouldHide=!1,this.commentsPosition="left"}firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{_.call(this,["comments"])}),this.mouseHovering=!1;let e=this.shadowRoot.querySelector(".comments__floating-button");e.addEventListener("mouseenter",()=>{setTimeout(()=>e.classList.add("comments-floating-button-hovered"),300),this.mouseHovering=!0}),e.addEventListener("mouseleave",()=>{e.classList.remove("comments-floating-button-hovered"),this.mouseHovering=!1})}toggle(){this.emitEvent("toggle",{})}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("toggle-annotation-sidebar",()=>{this.isHidden=!this.isHidden}),window.document.body.addEventListener("toggle-pin-active",this.onTogglePinActive)}disconnectedCallback(){super.disconnectedCallback(),window.document.body.removeEventListener("toggle-annotation-sidebar",()=>{this.isHidden=!this.isHidden}),window.document.body.removeEventListener("toggle-pin-active",this.onTogglePinActive)}updated(t){super.updated(t),this.updateComplete.then(()=>{let e=this.shadowRoot.querySelector(".comments__floating-button");!e||e.setAttribute("style",this.positionStyles)})}calculateIfShouldHide(){var O;let t=(O=document.getElementsByTagName("superviz-comments")[0])==null?void 0:O.shadowRoot.querySelector(".superviz-comments"),e=this.shadowRoot.querySelector(".comments__floating-button");if(!t||!e)return;let{left:o,right:s,top:n,bottom:r}=t.getBoundingClientRect(),{left:l,right:c,top:d,bottom:v}=e.getBoundingClientRect(),y=r>d&&v>n,h=n<v&&d<r,g=s>l&&c>o,S=o<c&&l<s;this.shouldHide=(h||y)&&(g||S)}render(){this.calculateIfShouldHide();let t={"comments__floating-button":!0,"hide-button":!this.isHidden&&this.shouldHide,"is-active":this.isActive,"is-inactive":!this.isActive},e={"comments__floating-button-text-box":!0,"comments__floating-button-text-box--hovered":this.mouseHovering},o={text:!0,"text-big":!0,"text-bold":!0,"not-hovered":!this.mouseHovering,"comments__floating-button__text":!0,textActive:this.isActive,textInactive:!this.isActive};return Un` <button @click=${this.toggle} class="${Me(t)}">
      <div class="comments__floating-button__icon">
        <superviz-icon
          size="sm"
          name="comment"
          color=${this.mouseHovering||this.isActive?"white":"black"}
        ></superviz-icon>
        <svg class="cross" width="8px" height="8px" viewBox="0 0 8 8">
          <rect class="cross-bar-1" x="0" y="3" width="8px" height="2px" />
          <rect class="cross-bar-2" x="0" y="3" width="8px" height="2px" />
        </svg>
      </div>
      <div class=${Me(e)}>
        <p class="${Me(o)} comment">Comment</p>
        <p class="${Me(o)} cancel">Cancel</p>
      </div>
    </button>`}};pt.styles=Vn,pt.properties={positionStyles:{type:String},isHidden:{type:Boolean},commentsPosition:{type:String},isActive:{type:Boolean},mouseHovering:{type:Boolean}},pt=w([Wn("superviz-comments-button")],pt);a();import{LitElement as jn,html as ne}from"lit";import{customElement as Jn}from"lit/decorators.js";import{repeat as Kn}from"lit/directives/repeat.js";var Eo=P(jn),qn=[Eo.styles,ci],ct=class extends Eo{constructor(){super();this.showMentionList=()=>{var e;let t=(e=this.shadowRoot)==null?void 0:e.getElementById("mention-list");t==null||t.style.setProperty("display","block"),t==null||t.style.setProperty("margin-top","1px"),t.addEventListener("wheel",this.stopHandleZoom)};this.hideMentionList=()=>{var e;let t=(e=this.shadowRoot)==null?void 0:e.getElementById("mention-list");t.removeEventListener("wheel",this.stopHandleZoom),t==null||t.style.setProperty("display","none")};this.selectParticipant=t=>{this.emitEvent("participant-selected",t,{bubbles:!1,composed:!1}),this.hideMentionList()};this.stopHandleZoom=t=>{var o;let e=(o=this.shadowRoot)==null?void 0:o.getElementById("mention-list");e.scrollTop+=t.deltaY,t.preventDefault()};this.participants=[]}updated(t){if(t.has("participants")&&this.participants.length>0){this.showMentionList();return}this.hideMentionList()}getAvatar(t){var e;return t.avatar?ne`<img class="avatar" src=${t.avatar} />`:ne`<div class="default-avatar">
      <p class="text text-bold">${((e=t.name[0])==null?void 0:e.toUpperCase())||"A"}</p>
    </div>`}render(){let t=e=>ne`
      <div class="mention-item" @click=${()=>this.selectParticipant(e)}>
          ${this.getAvatar(e)}
        <div class="avatar-type">${e.name}</div>
      </div>
    `;return ne`
      <div id="mention-list">
        ${Kn(this.participants,e=>e.id,e=>ne`
          ${t(e)}
        `)}
      </div>
    `}};ct.styles=qn,ct.properties={participants:{type:Object}},ct=w([Jn("superviz-comments-mention-list")],ct);a();a();import{LitElement as Qn,html as U}from"lit";import{customElement as tr}from"lit/decorators.js";import{classMap as wo}from"lit/directives/class-map.js";import{repeat as er}from"lit/directives/repeat.js";a();var re=(c=>(c.GOTO="go to",c.LOCAL_FOLLOW="follow",c.LOCAL_UNFOLLOW="unfollow",c.FOLLOW="everyone follows me",c.UNFOLLOW="stop followers",c.PRIVATE="private mode",c.LEAVE_PRIVATE="leave private mode",c.GATHER="gather all",c.STOP_GATHER="stop gather all",c))(re||{});a();a();import{css as Yn}from"lit";var fi=Yn`
  .who-is-online__participant-list {
    display: flex;
    align-items: center;
    gap: 4px;
    position: relative;
  }

  .who-is-online {
    display: flex;
    flex-direction: column;
    position: fixed;
    z-index: 99;
  }

  .who-is-online__presence-control-message__text {
    margin: 0;
  }

  .who-is-online__participant {
    border-radius: 50%;
    box-sizing: border-box;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    cursor: pointer;
    transition: opacity 0.3s ease-in-out;
    border: 2px solid #878291;
    border-radius: 50%;
    max-width: 40px;
    flex: 1 0 40px;
  }

  .followed {
    border-style: dashed !important;
    animation: rotate 15s linear infinite;
  }

  .followed .who-is-online__participant__avatar {
    animation: nullifyRotate 15s linear infinite;
  }

  .private {
    opacity: 0.3;
  }

  @keyframes rotate {
    100% {
      transform: rotate(1turn);
    }
  }

  @keyframes nullifyRotate {
    100% {
      transform: rotate(-1turn);
    }
  }

  .who-is-online__participant.disable-dropdown {
    cursor: default;
  }

  .who-is-online__participant__avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Open Sans';
    font-size: 14px;
    line-height: 14px;
    line-height: 14px;
    font-weight: bold;
    color: #26242a;
    object-fit: contain;
  }

  .superviz-who-is-online__excess {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: Roboto;
    font-size: 14px;
    line-height: 16px;
    text-align: center;
    font-weight: bold;
    cursor: pointer;
    color: #aea9b8;
  }

  .excess_participants:hover,
  .excess_participants--open {
    background-color: #aea9b8 !important;
  }

  .excess_participants:hover > div,
  .excess_participants--open > div {
    color: #fff !important;
  }

  @media (max-width: 780px) {
    .who-is-online__participant {
      width: 32px;
      height: 32px;
    }

    .who-is-online__participant {
      flex: 1 0 32px;
      max-width: 32px;
    }

    .who-is-online__participant__avatar {
      width: 24px;
      height: 24px;
    }

    .who-is-online__participant-list {
      gap: 8px;
    }

    .superviz-who-is-online__excess {
      width: 24px;
      height: 24px;
      font-size: 12px;
      line-height: 12px;
    }
  }
`;a();import{css as Zn}from"lit";var yi=Zn`
  .dropdown {
    position: relative;
  }

  .who-is-online__extra-participant {
    display: flex;
    user-select: none;
    align-items: center;
    justify-items: start;
    gap: 4px;
    width: 100%;
    padding: 10px;
    border-radius: 2px;
    position: relative;
    cursor: pointer;
  }

  .who-is-online__extra-participant.disable-dropdown {
    cursor: default;
  }

  .who-is-online__extra-participant:hover,
  .who-is-online__extra-participant--selected {
    background-color: rgb(var(--sv-gray-200));
  }

  .who-is-online__participant {
    border-radius: 50%;
    box-sizing: border-box;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border: 2px solid #878291;
    border-radius: 50%;
    max-width: 40px;
    flex: 1 0 40px;
  }

  .who-is-online__participant__avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Open Sans';
    font-size: 14px;
    line-height: 14px;
    font-weight: bold;
    color: #26242a;
    object-fit: contain;
  }

  .dropdown-list {
    position: relative;
    display: flex;
    flex-direction: column;
    z-index: 100;
  }

  .dropdown-list > div {
    padding: 4px;
    width: 216px;
    box-sizing: border-box;
  }

  .who-is-online__extras-dropdown {
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    opacity: 0;
    display: none;
    background: #fff;
    padding: 0;
    z-index: 1;
    transition: 0.2s;
    border-radius: 3px;
    max-height: 240px;
    overflow: auto;
  }

  .who-is-online__extras__arrow-icon {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .menu--bottom {
    top: 4px;
    min-width: 103px;
    position: absolute;
    right: 0;
  }

  .menu--top {
    bottom: 44px;
    min-width: 103px;
    position: absolute;
    right: 0px;
  }

  .menu-open {
    display: block;
    opacity: 1;
  }

  .superviz-who-is-online-dropdown__tooltip {
    background-color: rgb(var(--sv-gray-600));
    padding: 8px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
    position: absolute;
    top: 52px;
    left: 50%;
    transform: translateX(-50%);
    border-radius: 2px;
    opacity: 0;
    cursor: default;
    display: none;
    transition: opacity 0.2s ease-in-out display 0s;
  }

  .superviz-who-is-online-dropdown__tooltip-arrow {
    width: 13px;
    height: 13px;
    position: absolute;
    top: 0px;
    left: 50%;
    transform: rotate(45deg) translateX(-50%);
    background-color: rgb(var(--sv-gray-600));
    border-top-left-radius: 3px;
  }

  .dropdown-content:hover + .superviz-who-is-online-dropdown__tooltip {
    opacity: 1;
    display: block;
  }

  .tooltip-content {
    margin: 0;
    font-family: roboto;
    white-space: nowrap;
    text-align: center;
    color: white;
    font-size: 14px;
  }

  .who-is-online__extras__username {
    font-size: 14px;
    line-height: 20px;
    font-family: 'Open sans';
    color: rgb(var(--sv-gray-600));
  }

  .icon {
    flex: 1;
    justify-content: flex-end;
    display: flex;
  }

  .hide-icon {
    display: none;
  }

  @media (max-width: 780px) {
    .sv-icon,
    .who-is-online__participant {
      width: 32px;
      height: 32px;
    }

    .who-is-online__participant {
      flex: 1 0 32px;
      max-width: 32px;
    }

    .who-is-online__participant__avatar {
      width: 24px;
      height: 24px;
    }

    .dropdown-list > div {
      width: 192px;
    }

    .menu--top {
      bottom: 36px;
    }

    .superviz-who-is-online-dropdown__tooltip {
      top: 44px;
    }
  }
`;a();import{css as Xn}from"lit";var Ei=Xn`
  .who-is-online__controls-messages {
    position: absolute;
    right: 0;
    display: flex;
    flex-direction: column;
    gap: 5px;
    margin-top: 4px;
  }

  .who-is-online__presence-control-message {
    box-sizing: border-box;
    font-size: 12px;
    padding: 8px 10px;
    font-family: 'Roboto';
    border-radius: 6px;
    background-color: #fff;
    color: rgb(var(--sv-gray-700));
    border: 2px solid #e0e0e0;
    white-space: nowrap;
  }

  .who-is-online__pcm__text {
    margin: 0;
  }

  .who-is-online__presence-control-message span {
    margin-left: 3px;
    text-decoration: underline;
    cursor: pointer;
  }

  .left-side {
    left: 0;
  }

  .right-side {
    right: 0;
  }

  .left-side .who-is-online__presence-control-message {
    align-self: flex-start;
  }

  .right-side .who-is-online__presence-control-message {
    align-self: flex-end;
  }

  .bottom-side {
    bottom: auto;
    top: calc(100% + 5px);
  }

  .top-side {
    top: auto;
    bottom: calc(100% + 5px);
  }
`;var Po=P(Qn),ir=[Po.styles,fi],dt=class extends Po{constructor(){super();this.onClickOutDropdown=({detail:t})=>{this.open=t.open};this.dropdownOptionsHandler=({detail:t})=>{var l;let{id:e,label:o,name:s,color:n,slotIndex:r}=t;if(o==="go to"&&this.emitEvent("realtime.go-to-participant",{id:e}),["follow","unfollow"].includes(o)){if(((l=this.following)==null?void 0:l.id)===e){this.stopFollowing();return}this.everyoneFollowsMe&&this.stopEveryoneFollowsMe(),this.following={name:s,id:e,color:n},this.swapParticipantBeingFollowedPosition(),this.emitEvent("realtime.local-follow-participant",{id:e})}if(["private mode","leave private mode"].includes(o)&&(this.isPrivate=o==="private mode",this.everyoneFollowsMe&&this.stopEveryoneFollowsMe(),this.emitEvent("realtime.private-mode",{id:e,isPrivate:this.isPrivate}),this.everyoneFollowsMe=!1),["everyone follows me","stop followers"].includes(o)){if(this.everyoneFollowsMe){this.stopEveryoneFollowsMe();return}this.following&&this.stopFollowing(),this.isPrivate&&this.cancelPrivate(),this.everyoneFollowsMe=!0,this.following=void 0,this.emitEvent("realtime.follow-participant",{id:e,name:s,color:n,slotIndex:r})}o==="gather all"&&this.emitEvent("realtime.gather",{id:e})};this.toggleShowTooltip=()=>{this.showTooltip=!this.showTooltip};this.position="top: 20px; right: 40px;",this.showTooltip=!0,this.open=!1;let{localParticipant:t}=this.useStore("global-store");t.subscribe(e=>{this.localParticipantData={id:e.id,joinedPresence:!1}})}firstUpdated(t){super.firstUpdated(t),_.call(this,"who-is-online")}updateParticipants(t){this.participants=t}toggleOpen(){this.open=!this.open}dropdownPosition(t){if(this.participants.length===1)return"bottom-center";if(t===0)return"bottom-right";let e=this.participants.length>4,o=t+1===this.participants.length;return e||!o?"bottom-center":"bottom-left"}renderExcessParticipants(){var n;let t=this.participants.length-4;if(t<=0)return U``;let e=this.participants.slice(4).map(({name:r,color:l,id:c,slotIndex:d,isLocal:v,avatar:y,joinedPresence:h})=>({name:r,color:l,id:c,slotIndex:d,avatar:y,isLocal:v,joinedPresence:h})),o={"who-is-online__participant":!0,excess_participants:!0,"excess_participants--open":this.open};return U`
      <superviz-who-is-online-dropdown
        label="label"
        returnTo="label"
        position="bottom"
        @selected=${this.dropdownOptionsHandler}
        participants=${JSON.stringify(e)}
        @clickout=${this.onClickOutDropdown}
        ?disableDropdown=${this.disableDropdown}
        following=${JSON.stringify(this.following)}
        ?showSeeMoreTooltip=${this.showTooltip}
        @toggle=${this.toggleOpen}
        @toggle-dropdown-state=${this.toggleShowTooltip}
        ?localParticipantJoinedPresence=${(n=this.localParticipantData)==null?void 0:n.joinedPresence}
        classesPrefix="who-is-online__controls"
        parentComponent="who-is-online"
        tooltipPrefix="who-is-online"
      >
        <div class=${wo(o)} slot="dropdown">
          <div class="superviz-who-is-online__excess who-is-online__extras">+${t}</div>
        </div>
      </superviz-who-is-online-dropdown>
    `}stopEveryoneFollowsMe(){this.everyoneFollowsMe=!1,this.emitEvent("realtime.follow-participant",void 0)}getAvatar(t){var o,s;if((o=t.avatar)!=null&&o.imageUrl)return U` <img
        class="who-is-online__participant__avatar"
        style="background-color: ${t.color}"
        src=${t.avatar.imageUrl}
      />`;let e=Pt.includes(t.slotIndex)?"#FFFFFF":"#26242A";return U`<div
      class="who-is-online__participant__avatar"
      style="background-color: ${t.color}; color: ${e}"
    >
      ${(s=t.name)==null?void 0:s.at(0).toUpperCase()}
    </div>`}getOptions(t,e,o){let{id:s,slotIndex:n,name:r,color:l}=t,c={id:s,name:r,color:l,slotIndex:n},{isPrivate:d}=this;return(o?["GATHER",this.everyoneFollowsMe?"UNFOLLOW":"FOLLOW",d?"LEAVE_PRIVATE":"PRIVATE"]:["GOTO",e?"LOCAL_UNFOLLOW":"LOCAL_FOLLOW"]).map(h=>x(f({},c),{label:re[h]}))}getIcons(t,e){return t?["gather",this.everyoneFollowsMe?"send-off":"send","eye_inative"]:["place",e?"send-off":"send"]}putLocalParticipationFirst(){var s;if(this.participants[0].isLocal)return;let t=(s=this.participants)==null?void 0:s.find(({isLocal:n})=>n);if(!t)return;let e=[...this.participants],o=e.indexOf(t);e.splice(o,1),e.unshift(t),this.participants=e}swapParticipantBeingFollowedPosition(){var n;let t=(n=this.participants)==null?void 0:n.findIndex(({id:r})=>{var l;return r===((l=this.following)==null?void 0:l.id)}),e=1;if(t<4||!t)return;let o=[...this.participants],s=o[t];o[t]=o[e],o[e]=s,this.participants=o}stopFollowing(){this.following=void 0,this.emitEvent("realtime.local-follow-participant",{id:void 0})}cancelPrivate(){this.isPrivate=void 0,this.emitEvent("realtime.private-mode",{id:this.localParticipantData.id})}renderParticipants(){return this.participants?(this.putLocalParticipationFirst(),this.swapParticipantBeingFollowedPosition(),U`<div class="who-is-online__participant-list">
      ${er(this.participants.slice(0,4),t=>t.id,(t,e)=>{var R,M;let{joinedPresence:o,isLocal:s,id:n,name:r,color:l}=t,c=((R=this.following)==null?void 0:R.id)===n,d=this.getOptions(t,c,s),v=this.getIcons(s,c),y=this.dropdownPosition(e),h=!o||this.disableDropdown,g={"who-is-online__participant":!0,"disable-dropdown":h,followed:c||s&&this.everyoneFollowsMe,private:s&&this.isPrivate},O=r+(s?" (you)":""),u={name:r};return((M=this.localParticipantData)==null?void 0:M.joinedPresence)&&o&&!s&&(u.action="Click to Follow"),s&&(u.action="You"),U`
            <superviz-dropdown
              options=${JSON.stringify(d)}
              label="label"
              position="${y}"
              @selected=${this.dropdownOptionsHandler}
              @toggle-dropdown-state=${this.toggleShowTooltip}
              icons="${JSON.stringify(v)}"
              name="${O}"
              ?disabled=${h}
              ?canShowTooltip=${this.showTooltip}
              onHoverData=${JSON.stringify(u)}
              classesPrefix="who-is-online__controls"
              parentComponent="who-is-online"
              tooltipPrefix="who-is-online"
            >
              <div slot="dropdown" class=${wo(g)} style="border-color: ${l}">
                ${this.getAvatar(t)}
              </div>
            </superviz-dropdown>
          `})}
      ${this.renderExcessParticipants()}
    </div>`):U``}updated(t){super.updated(t),this.updateComplete.then(()=>{let e=this.shadowRoot.querySelector(".who-is-online");if(!e)return;let o=this.position.includes("left")?"flex-start":"flex-end",s=`${this.position} align-items: ${o};`;e.setAttribute("style",s)})}render(){return U`<div class="who-is-online who-is-online">
      ${this.renderParticipants()}
      <superviz-who-is-online-messages
        following=${JSON.stringify(this.following)}
        ?everyoneFollowsMe=${this.everyoneFollowsMe}
        ?isPrivate=${this.isPrivate}
        @stop-following=${this.stopFollowing}
        @cancel-private=${this.cancelPrivate}
        @stop-everyone-follows-me=${this.stopEveryoneFollowsMe}
      ></superviz-who-is-online-messages>
    </div> `}};dt.styles=ir,dt.properties={position:{type:String},participants:{type:Object},open:{type:Boolean},disableDropdown:{type:Boolean},following:{type:Object},localParticipantColor:{type:String},isPrivate:{type:Boolean},everyoneFollowsMe:{type:Boolean},showTooltip:{type:Boolean}},dt=w([tr("superviz-who-is-online")],dt);a();a();import{LitElement as sr,html as ke}from"lit";import{customElement as nr}from"lit/decorators.js";import{classMap as rr}from"lit/directives/class-map.js";var To=P(sr),ar=[To.styles,Ei],mt=class extends To{constructor(){super();this.repositionMessages=()=>{let{following:t,everyoneFollowsMe:e,isPrivate:o}=this;if(t||e||o){this.repositionInVerticalDirection(),this.repositionInHorizontalDirection(),this.animationFrame=window.requestAnimationFrame(this.repositionMessages);return}window.cancelAnimationFrame(this.animationFrame)};let{localParticipant:t}=this.useStore("global-store");t.subscribe(e=>{this.participantColor=e.color})}firstUpdated(t){super.firstUpdated(t),_.call(this,"who-is-online")}updated(t){super.updated(t),["following","everyoneFollowsMe","isPrivate"].some(o=>t.has(o))&&this.repositionMessages()}repositionInVerticalDirection(){let t=window.innerHeight/2,{top:e}=this.parentElement.getBoundingClientRect();if(e<t){this.verticalSide="bottom-side";return}this.verticalSide="top-side"}repositionInHorizontalDirection(){let t=window.innerWidth/2,{left:e}=this.parentElement.getBoundingClientRect();if(e<t){this.horizontalSide="left-side";return}this.horizontalSide="right-side"}stopFollowing(){this.emitEvent("stop-following",{})}cancelPrivate(){this.emitEvent("cancel-private",{})}stopEveryoneFollowsMe(){this.emitEvent("stop-everyone-follows-me",{})}followingMessage(){if(!this.following)return"";let{name:t,color:e}=this.following;return ke`<div
      class="who-is-online__following-message who-is-online__presence-control-message who-is-online__pcm"
      style="border-color: ${e}"
    >
      <p class="who-is-online__presence-control-message__text who-is-online__pcm__text">
        Following: ${t}
        <span
          class="who-is-online__presence-control-message__cancel-action-button who-is-online__pcm__cancel-action-button"
          @click=${this.stopFollowing}
          >Stop</span
        >
      </p>
    </div>`}everyoneFollowsMeMessage(){return this.everyoneFollowsMe?ke`<div
      class="who-is-online__follow-me-message who-is-online__presence-control-message who-is-online__pcm"
      style="border-color: ${this.participantColor}"
    >
      <p class="who-is-online__presence-control-message__text who-is-online__pcm__text">
        Everyone is following you
        <span
          class="who-is-online__presence-control-message__cancel-action-button who-is-online__pcm__cancel-action-button"
          @click=${this.stopEveryoneFollowsMe}
          >Stop</span
        >
      </p>
    </div>`:""}privateMessage(){return this.isPrivate?ke`<div
      class="who-is-online__private-mode-message who-is-online__presence-control-message who-is-online__pcm"
      style="border-color: ${this.participantColor}"
    >
      <p class="who-is-online__presence-control-message__text who-is-online__pcm__text">
        You are in Private Mode
        <span
          class="who-is-online__presence-control-message__cancel-action-button who-is-online__pcm__cancel-action-button"
          @click=${this.cancelPrivate}
          >Cancel</span
        >
      </p>
    </div>`:""}render(){let t={"who-is-online__controls-messages":!0,[this.verticalSide]:!0,[this.horizontalSide]:!0};return ke` <div class=${rr(t)}>
      ${this.followingMessage()} ${this.everyoneFollowsMeMessage()} ${this.privateMessage()}
    </div>`}};mt.styles=ar,mt.properties={following:{type:Object},everyoneFollowsMe:{type:Boolean},isPrivate:{type:Boolean},verticalSide:{type:String},horizontalSide:{type:String}},mt=w([nr("superviz-who-is-online-messages")],mt);a();import{LitElement as lr,html as ae}from"lit";import{customElement as pr}from"lit/decorators.js";import{classMap as wi}from"lit/directives/class-map.js";import{repeat as cr}from"lit/directives/repeat.js";var Ao=P(lr),dr=[Ao.styles,yi],ht=class extends Ao{constructor(){super();this.onClickOutDropdown=t=>{if(t.stopPropagation(),!this.open)return;let e=t.composedPath(),o=this.shadowRoot.querySelector(".dropdown-content"),s=this.shadowRoot.querySelector(".dropdown-list"),r=this.shadowRoot.querySelector('slot[name="dropdown"]').assignedElements()[0],l=e.includes(o),c=e.includes(s),d=e.includes(r);l||c||d||this.close()};this.close=()=>{this.open=!1,this.selected="",this.emitEvent("clickout",{bubbles:!1,composed:!1})};this.selectParticipant=t=>()=>{this.selected=t};this.toggleShowTooltip=({detail:{open:t}})=>{this.showParticipantTooltip=!this.showParticipantTooltip,t||(this.selected="")};this.tooltip=()=>this.showSeeMoreTooltip?ae`<superviz-tooltip
      tooltipData=${JSON.stringify({name:"See more"})}
      classesPrefix="who-is-online__tooltip"
      parentComponent="who-is-online"
    ></superviz-tooltip>`:"";this.repositionDropdown=()=>{if(!this.open){window.cancelAnimationFrame(this.animationFrame);return}this.repositionInVerticalDirection(),this.repositionInHorizontalDirection(),this.animationFrame=window.requestAnimationFrame(this.repositionDropdown)};this.repositionInVerticalDirection=()=>{let{bottom:t,top:e,height:o}=this.parentElement.getBoundingClientRect(),s=window.innerHeight/2;if(e+o/2>s){this.dropdownList.style.setProperty("bottom",`${window.innerHeight-e+8}px`),this.dropdownList.style.setProperty("top","");return}this.dropdownList.style.setProperty("top",`${t+8}px`),this.dropdownList.style.setProperty("bottom","")};this.repositionInHorizontalDirection=()=>{let{right:t,left:e}=this.parentElement.getBoundingClientRect();this.dropdownList.style.setProperty("right",`${window.innerWidth-t}px`),this.dropdownList.style.setProperty("left",`${e}px`)};this.selected="",this.showParticipantTooltip=!0}firstUpdated(t){this.shadowRoot.querySelector(".who-is-online__extras-dropdown").scrollTop=0,_.call(this,"who-is-online"),this.dropdownList=this.shadowRoot.querySelector(".dropdown-list"),this.dropdownList.style.position="fixed"}updated(t){if(!!t.has("open")){if(this.emitEvent("toggle-dropdown-state",{open:this.open,font:"toggle"}),this.open){document.addEventListener("click",this.onClickOutDropdown);return}document.removeEventListener("click",this.onClickOutDropdown)}}getAvatar(t){var o,s;if((o=t.avatar)!=null&&o.imageUrl)return ae` <img
        class="who-is-online__participant__avatar"
        style="background-color: ${t.color}"
        src=${t.avatar.imageUrl}
      />`;let e=Pt.includes(t.slotIndex)?"#FFFFFF":"#26242A";return ae`<div
      class="who-is-online__participant__avatar"
      style="background-color: ${t.color}; color: ${e}"
    >
      ${(s=t.name)==null?void 0:s.at(0).toUpperCase()}
    </div>`}renderParticipants(){if(!this.participants)return;let t=["place","send"],e=this.participants.length-1;return cr(this.participants,o=>o.id,(o,s)=>{var M,$;let{id:n,slotIndex:r,joinedPresence:l,isLocal:c,color:d,name:v}=o,y=!l||c||this.disableDropdown,h={"who-is-online__extra-participant":!0,"who-is-online__extra-participant--selected":this.selected===n,"disable-dropdown":y,followed:((M=this.following)==null?void 0:M.id)===n},g={"who-is-online__extras__arrow-icon":!0,"hide-icon":y},S=(($=this.following)==null?void 0:$.id)===n,O=Object.values(re).map((ut,C)=>({label:S&&C?"UNFOLLOW":ut,id:n,name:v,color:d,slotIndex:r})).slice(0,2),u={name:v};this.localParticipantJoinedPresence&&l&&(u.action="Click to Follow");let R=s===e;return ae`
        <superviz-dropdown
        options=${JSON.stringify(O)}
        label="label"
        position="bottom-right"
        @selected=${this.close}
        icons="${JSON.stringify(t)}"
        ?disabled=${y}
        onHoverData=${JSON.stringify(u)}
        ?canShowTooltip=${this.showParticipantTooltip}
        ?shiftTooltipLeft=${!0}
        ?lastParticipant=${R}
        @toggle-dropdown-state=${this.toggleShowTooltip}
        classesPrefix="who-is-online__controls"
        parentComponent="who-is-online"
        tooltipPrefix="who-is-online"
        >
        <div 
          class=${wi(h)} 
          @click=${this.selectParticipant(n)} slot="dropdown">
            <div class="who-is-online__participant" style="border-color: 
            ${d}">
              ${this.getAvatar(o)}
            </div>
            <span class="who-is-online__extras__username">${v}</span>
            <superviz-icon 
              class=${wi(g)} 
              name="right" 
              color="var(--sv-gray-600)"
              size="sm"
            >
          </superviz-icon>
          </div>
        </div>
      </superviz-dropdown>
      `})}toggle(){this.open=!this.open,this.open&&(this.selected="",this.repositionDropdown())}get menuClasses(){return{"who-is-online__extras-dropdown":!0,"menu--bottom":this.position==="bottom-side","menu--top":this.position==="top-side","menu-open":this.open}}render(){return ae`
      <div class="dropdown">
        <div class="dropdown-content" @click=${this.toggle}>
          <slot name="dropdown"></slot>
        </div>
        ${this.tooltip()}
      </div>
      <div class="dropdown-list">
        <div class=${wi(this.menuClasses)}>${this.renderParticipants()}</div>
      </div>
    `}};ht.styles=dr,ht.properties={open:{type:Boolean},align:{type:String},position:{type:String},participants:{type:Array},selected:{type:String},disableDropdown:{type:Boolean},following:{type:Object},showSeeMoreTooltip:{type:Boolean},showParticipantTooltip:{type:Boolean},localParticipantJoinedPresence:{type:Boolean},dropdownList:{type:Object}},ht=w([pr("superviz-who-is-online-dropdown")],ht);a();a();function xo(p){if(typeof document!="undefined"){let i=document.createElement("style");i.id="superviz-style";let t=document.createTextNode(p);i.appendChild(t),document.head.appendChild(i)}}var Co=`@import"https://unpkg.com/@superviz/sv-icons@0.8.12/css/style.css";@import"https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap";:root{--sv-primary: 98, 16, 204}html,body{width:100%;height:100%;overflow:hidden}#sv-video-wrapper iframe{position:fixed;border:none;margin:0;padding:0;overflow:hidden;z-index:1000}#sv-video-wrapper iframe.sv-video-frame--right{top:var(--superviz-offset-top);right:var(--superviz-offset-right)}#sv-video-wrapper iframe.sv-video-frame--left{top:var(--superviz-offset-top);left:var(--superviz-offset-left)}#sv-video-wrapper iframe.sv-video-frame--bottom{bottom:var(--superviz-offset-bottom);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--top{top:var(--superviz-offset-top);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--no-overlay{display:none}.pointer-mouse{display:flex;height:17px;width:17px;background-image:url(https://production.cdn.superviz.com/static/pointers/0.svg)}.mouse-user-name{display:block;position:absolute;border-radius:30px;padding:2px 8px;font-weight:700;font-size:14px;font-family:Roboto,sans-serif;line-height:22px;margin-left:10px;margin-top:-6px;background:yellow;white-space:nowrap}.mouse-follower{position:absolute;display:block;z-index:2;transition:all .15s linear,opacity 100s ease-in}
`;xo(Co);a();a();a();window&&(window.SuperVizRoom={init:je,CommentEvent:he,MeetingEvent:kt,DeviceEvent:Ne,RealtimeEvent:D,MeetingState:de,MeetingConnectionStatus:Bt,MeetingControlsEvent:Dt,ParticipantEvent:me,FrameEvent:Nt,LayoutMode:fe,VideoConference:Yt,MousePointers:Zt,Realtime:Xt,Comments:Gt,CanvasPin:Wt,HTMLPin:Vt,WhoIsOnline:Qt,ParticipantType:bt,LayoutPosition:Jt,CamerasPosition:ye,RealtimeComponentState:Ae,RealtimeComponentEvent:xe,ComponentLifeCycleEvent:gt,WhoIsOnlineEvent:ue});var Fg=je;export{jt as BrowserService,ye as CamerasPosition,Wt as CanvasPin,he as CommentEvent,Gt as Comments,gt as ComponentLifeCycleEvent,Ne as DeviceEvent,Nt as FrameEvent,Vt as HTMLPin,fe as LayoutMode,Jt as LayoutPosition,Bt as MeetingConnectionStatus,Dt as MeetingControlsEvent,kt as MeetingEvent,de as MeetingState,Zt as MousePointers,E as Observer,me as ParticipantEvent,bt as ParticipantType,Ut as PinMode,Xt as Realtime,xe as RealtimeComponentEvent,Ae as RealtimeComponentState,D as RealtimeEvent,Yt as VideoConference,Qt as WhoIsOnline,ue as WhoIsOnlineEvent,Fg as default};
