var AC=Object.create;var go=Object.defineProperty,wC=Object.defineProperties,dp=Object.getOwnPropertyDescriptor,TC=Object.getOwnPropertyDescriptors,CC=Object.getOwnPropertyNames,ha=Object.getOwnPropertySymbols,SC=Object.getPrototypeOf,Uc=Object.prototype.hasOwnProperty,fp=Object.prototype.propertyIsEnumerable;var hp=Math.pow,up=(s,e,t)=>e in s?go(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,lt=(s,e)=>{for(var t in e||(e={}))Uc.call(e,t)&&up(s,t,e[t]);if(ha)for(var t of ha(e))fp.call(e,t)&&up(s,t,e[t]);return s},Mt=(s,e)=>wC(s,TC(e));var Hc=(s,e)=>{var t={};for(var n in s)Uc.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&ha)for(var n of ha(s))e.indexOf(n)<0&&fp.call(s,n)&&(t[n]=s[n]);return t};var Gc=(s,e)=>()=>(s&&(e=s(s=0)),e);var be=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),pp=(s,e)=>{for(var t in e)go(s,t,{get:e[t],enumerable:!0})},OC=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of CC(e))!Uc.call(s,r)&&r!==t&&go(s,r,{get:()=>e[r],enumerable:!(n=dp(e,r))||n.enumerable});return s};var an=(s,e,t)=>(t=s!=null?AC(SC(s)):{},OC(e||!s||!s.__esModule?go(t,"default",{value:s,enumerable:!0}):t,s));var Nt=(s,e,t,n)=>{for(var r=n>1?void 0:n?dp(e,t):e,a=s.length-1,l;a>=0;a--)(l=s[a])&&(r=(n?l(e,t,r):l(r))||r);return n&&r&&go(e,t,r),r};var Lt=(s,e,t)=>new Promise((n,r)=>{var a=u=>{try{c(t.next(u))}catch(m){r(m)}},l=u=>{try{c(t.throw(u))}catch(m){r(m)}},c=u=>u.done?n(u.value):Promise.resolve(u.value).then(a,l);c((t=t.apply(s,e)).next())});var Z,L=Gc(()=>{Z={}});var gp=be((cx,mp)=>{L();var Sr=1e3,Or=Sr*60,_r=Or*60,Ci=_r*24,xC=Ci*7,PC=Ci*365.25;mp.exports=function(s,e){e=e||{};var t=typeof s;if(t==="string"&&s.length>0)return IC(s);if(t==="number"&&isFinite(s))return e.long?RC(s):MC(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};function IC(s){if(s=String(s),!(s.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(s);if(!!e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*PC;case"weeks":case"week":case"w":return t*xC;case"days":case"day":case"d":return t*Ci;case"hours":case"hour":case"hrs":case"hr":case"h":return t*_r;case"minutes":case"minute":case"mins":case"min":case"m":return t*Or;case"seconds":case"second":case"secs":case"sec":case"s":return t*Sr;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function MC(s){var e=Math.abs(s);return e>=Ci?Math.round(s/Ci)+"d":e>=_r?Math.round(s/_r)+"h":e>=Or?Math.round(s/Or)+"m":e>=Sr?Math.round(s/Sr)+"s":s+"ms"}function RC(s){var e=Math.abs(s);return e>=Ci?ba(s,e,Ci,"day"):e>=_r?ba(s,e,_r,"hour"):e>=Or?ba(s,e,Or,"minute"):e>=Sr?ba(s,e,Sr,"second"):s+" ms"}function ba(s,e,t,n){var r=e>=t*1.5;return Math.round(s/t)+" "+n+(r?"s":"")}});var yp=be((ux,vp)=>{L();function LC(s){t.debug=t,t.default=t,t.coerce=u,t.disable=a,t.enable=r,t.enabled=l,t.humanize=gp(),t.destroy=m,Object.keys(s).forEach(g=>{t[g]=s[g]}),t.names=[],t.skips=[],t.formatters={};function e(g){let E=0;for(let h=0;h<g.length;h++)E=(E<<5)-E+g.charCodeAt(h),E|=0;return t.colors[Math.abs(E)%t.colors.length]}t.selectColor=e;function t(g){let E,h=null,y,O;function _(...C){if(!_.enabled)return;let T=_,x=Number(new Date),v=x-(E||x);T.diff=v,T.prev=E,T.curr=x,E=x,C[0]=t.coerce(C[0]),typeof C[0]!="string"&&C.unshift("%O");let A=0;C[0]=C[0].replace(/%([a-zA-Z%])/g,(p,S)=>{if(p==="%%")return"%";A++;let b=t.formatters[S];if(typeof b=="function"){let P=C[A];p=b.call(T,P),C.splice(A,1),A--}return p}),t.formatArgs.call(T,C),(T.log||t.log).apply(T,C)}return _.namespace=g,_.useColors=t.useColors(),_.color=t.selectColor(g),_.extend=n,_.destroy=t.destroy,Object.defineProperty(_,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(y!==t.namespaces&&(y=t.namespaces,O=t.enabled(g)),O),set:C=>{h=C}}),typeof t.init=="function"&&t.init(_),_}function n(g,E){let h=t(this.namespace+(typeof E=="undefined"?":":E)+g);return h.log=this.log,h}function r(g){t.save(g),t.namespaces=g,t.names=[],t.skips=[];let E,h=(typeof g=="string"?g:"").split(/[\s,]+/),y=h.length;for(E=0;E<y;E++)!h[E]||(g=h[E].replace(/\*/g,".*?"),g[0]==="-"?t.skips.push(new RegExp("^"+g.slice(1)+"$")):t.names.push(new RegExp("^"+g+"$")))}function a(){let g=[...t.names.map(c),...t.skips.map(c).map(E=>"-"+E)].join(",");return t.enable(""),g}function l(g){if(g[g.length-1]==="*")return!0;let E,h;for(E=0,h=t.skips.length;E<h;E++)if(t.skips[E].test(g))return!1;for(E=0,h=t.names.length;E<h;E++)if(t.names[E].test(g))return!0;return!1}function c(g){return g.toString().substring(2,g.toString().length-2).replace(/\.\*\?$/,"*")}function u(g){return g instanceof Error?g.stack||g.message:g}function m(){}return t.enable(t.load()),t}vp.exports=LC});var zc=be((Ze,Ea)=>{L();Ze.formatArgs=NC;Ze.save=FC;Ze.load=BC;Ze.useColors=DC;Ze.storage=kC();Ze.destroy=(()=>{let s=!1;return()=>{s||(s=!0)}})();Ze.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function DC(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function NC(s){if(s[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+s[0]+(this.useColors?"%c ":" ")+"+"+Ea.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;s.splice(1,0,e,"color: inherit");let t=0,n=0;s[0].replace(/%[a-zA-Z%]/g,r=>{r!=="%%"&&(t++,r==="%c"&&(n=t))}),s.splice(n,0,e)}Ze.log=console.debug||console.log||(()=>{});function FC(s){try{s?Ze.storage.setItem("debug",s):Ze.storage.removeItem("debug")}catch(e){}}function BC(){let s;try{s=Ze.storage.getItem("debug")}catch(e){}return!s&&typeof process!="undefined"&&"env"in process&&(s=Z.DEBUG),s}function kC(){try{return localStorage}catch(s){}}Ea.exports=yp()(Ze);var{formatters:$C}=Ea.exports;$C.j=function(s){try{return JSON.stringify(s)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Aa=be((fx,Ep)=>{L();function UC(s){var e=typeof s;return s!=null&&(e=="object"||e=="function")}Ep.exports=UC});var wp=be((hx,Ap)=>{L();var HC=typeof global=="object"&&global&&global.Object===Object&&global;Ap.exports=HC});var Vc=be((px,Tp)=>{L();var GC=wp(),WC=typeof self=="object"&&self&&self.Object===Object&&self,zC=GC||WC||Function("return this")();Tp.exports=zC});var Sp=be((mx,Cp)=>{L();var VC=Vc(),jC=function(){return VC.Date.now()};Cp.exports=jC});var _p=be((gx,Op)=>{L();var JC=/\s/;function KC(s){for(var e=s.length;e--&&JC.test(s.charAt(e)););return e}Op.exports=KC});var Pp=be((vx,xp)=>{L();var qC=_p(),ZC=/^\s+/;function YC(s){return s&&s.slice(0,qC(s)+1).replace(ZC,"")}xp.exports=YC});var jc=be((yx,Ip)=>{L();var QC=Vc(),XC=QC.Symbol;Ip.exports=XC});var Dp=be((bx,Lp)=>{L();var Mp=jc(),Rp=Object.prototype,tS=Rp.hasOwnProperty,eS=Rp.toString,Ao=Mp?Mp.toStringTag:void 0;function nS(s){var e=tS.call(s,Ao),t=s[Ao];try{s[Ao]=void 0;var n=!0}catch(a){}var r=eS.call(s);return n&&(e?s[Ao]=t:delete s[Ao]),r}Lp.exports=nS});var Fp=be((Ex,Np)=>{L();var iS=Object.prototype,rS=iS.toString;function oS(s){return rS.call(s)}Np.exports=oS});var Up=be((Ax,$p)=>{L();var Bp=jc(),sS=Dp(),aS=Fp(),lS="[object Null]",cS="[object Undefined]",kp=Bp?Bp.toStringTag:void 0;function uS(s){return s==null?s===void 0?cS:lS:kp&&kp in Object(s)?sS(s):aS(s)}$p.exports=uS});var Gp=be((wx,Hp)=>{L();function dS(s){return s!=null&&typeof s=="object"}Hp.exports=dS});var zp=be((Tx,Wp)=>{L();var fS=Up(),hS=Gp(),pS="[object Symbol]";function mS(s){return typeof s=="symbol"||hS(s)&&fS(s)==pS}Wp.exports=mS});var Kp=be((Cx,Jp)=>{L();var gS=Pp(),Vp=Aa(),vS=zp(),jp=0/0,yS=/^[-+]0x[0-9a-f]+$/i,bS=/^0b[01]+$/i,ES=/^0o[0-7]+$/i,AS=parseInt;function wS(s){if(typeof s=="number")return s;if(vS(s))return jp;if(Vp(s)){var e=typeof s.valueOf=="function"?s.valueOf():s;s=Vp(e)?e+"":e}if(typeof s!="string")return s===0?s:+s;s=gS(s);var t=bS.test(s);return t||ES.test(s)?AS(s.slice(2),t?2:8):yS.test(s)?jp:+s}Jp.exports=wS});var Yp=be((Sx,Zp)=>{L();var TS=Aa(),Jc=Sp(),qp=Kp(),CS="Expected a function",SS=Math.max,OS=Math.min;function _S(s,e,t){var n,r,a,l,c,u,m=0,g=!1,E=!1,h=!0;if(typeof s!="function")throw new TypeError(CS);e=qp(e)||0,TS(t)&&(g=!!t.leading,E="maxWait"in t,a=E?SS(qp(t.maxWait)||0,e):a,h="trailing"in t?!!t.trailing:h);function y(p){var S=n,b=r;return n=r=void 0,m=p,l=s.apply(b,S),l}function O(p){return m=p,c=setTimeout(T,e),g?y(p):l}function _(p){var S=p-u,b=p-m,P=e-S;return E?OS(P,a-b):P}function C(p){var S=p-u,b=p-m;return u===void 0||S>=e||S<0||E&&b>=a}function T(){var p=Jc();if(C(p))return x(p);c=setTimeout(T,_(p))}function x(p){return c=void 0,h&&n?y(p):(n=r=void 0,l)}function v(){c!==void 0&&clearTimeout(c),m=0,n=u=r=c=void 0}function A(){return c===void 0?l:x(Jc())}function f(){var p=Jc(),S=C(p);if(n=arguments,r=this,u=p,S){if(c===void 0)return O(u);if(E)return clearTimeout(c),c=setTimeout(T,e),y(u)}return c===void 0&&(c=setTimeout(T,e)),l}return f.cancel=v,f.flush=A,f}Zp.exports=_S});var Kc=be((Ox,Qp)=>{L();var xS=Yp(),PS=Aa(),IS="Expected a function";function MS(s,e,t){var n=!0,r=!0;if(typeof s!="function")throw new TypeError(IS);return PS(t)&&(n="leading"in t?!!t.leading:n,r="trailing"in t?!!t.trailing:r),xS(s,e,{leading:n,maxWait:e,trailing:r})}Qp.exports=MS});var Oi=be((xr,wo)=>{L();(function(){var s,e="4.17.21",t=200,n="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",r="Expected a function",a="Invalid `variable` option passed into `_.template`",l="__lodash_hash_undefined__",c=500,u="__lodash_placeholder__",m=1,g=2,E=4,h=1,y=2,O=1,_=2,C=4,T=8,x=16,v=32,A=64,f=128,p=256,S=512,b=30,P="...",B=800,z=16,W=1,N=2,M=3,D=1/0,U=9007199254740991,G=17976931348623157e292,J=0/0,tt=4294967295,it=tt-1,X=tt>>>1,R=[["ary",f],["bind",O],["bindKey",_],["curry",T],["curryRight",x],["flip",S],["partial",v],["partialRight",A],["rearg",p]],k="[object Arguments]",H="[object Array]",j="[object AsyncFunction]",et="[object Boolean]",ft="[object Date]",gt="[object DOMException]",Et="[object Error]",Ct="[object Function]",Vt="[object GeneratorFunction]",ht="[object Map]",Qt="[object Number]",Ee="[object Null]",se="[object Object]",me="[object Promise]",dn="[object Proxy]",An="[object RegExp]",ue="[object Set]",wn="[object String]",Jn="[object Symbol]",Xr="[object Undefined]",pi="[object WeakMap]",Tl="[object WeakSet]",q="[object ArrayBuffer]",ot="[object DataView]",ut="[object Float32Array]",yt="[object Float64Array]",Ut="[object Int8Array]",Se="[object Int16Array]",In="[object Int32Array]",Cl="[object Uint8Array]",Sl="[object Uint8ClampedArray]",Ol="[object Uint16Array]",_l="[object Uint32Array]",Gv=/\b__p \+= '';/g,Wv=/\b(__p \+=) '' \+/g,zv=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Dd=/&(?:amp|lt|gt|quot|#39);/g,Nd=/[&<>"']/g,Vv=RegExp(Dd.source),jv=RegExp(Nd.source),Jv=/<%-([\s\S]+?)%>/g,Kv=/<%([\s\S]+?)%>/g,Fd=/<%=([\s\S]+?)%>/g,qv=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Zv=/^\w*$/,Yv=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,xl=/[\\^$.*+?()[\]{}|]/g,Qv=RegExp(xl.source),Pl=/^\s+/,Xv=/\s/,ty=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ey=/\{\n\/\* \[wrapped with (.+)\] \*/,ny=/,? & /,iy=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ry=/[()=,{}\[\]\/\s]/,oy=/\\(\\)?/g,sy=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Bd=/\w*$/,ay=/^[-+]0x[0-9a-f]+$/i,ly=/^0b[01]+$/i,cy=/^\[object .+?Constructor\]$/,uy=/^0o[0-7]+$/i,dy=/^(?:0|[1-9]\d*)$/,fy=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ss=/($^)/,hy=/['\n\r\u2028\u2029\\]/g,Os="\\ud800-\\udfff",py="\\u0300-\\u036f",my="\\ufe20-\\ufe2f",gy="\\u20d0-\\u20ff",kd=py+my+gy,$d="\\u2700-\\u27bf",Ud="a-z\\xdf-\\xf6\\xf8-\\xff",vy="\\xac\\xb1\\xd7\\xf7",yy="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",by="\\u2000-\\u206f",Ey=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Hd="A-Z\\xc0-\\xd6\\xd8-\\xde",Gd="\\ufe0e\\ufe0f",Wd=vy+yy+by+Ey,Il="['\u2019]",Ay="["+Os+"]",zd="["+Wd+"]",_s="["+kd+"]",Vd="\\d+",wy="["+$d+"]",jd="["+Ud+"]",Jd="[^"+Os+Wd+Vd+$d+Ud+Hd+"]",Ml="\\ud83c[\\udffb-\\udfff]",Ty="(?:"+_s+"|"+Ml+")",Kd="[^"+Os+"]",Rl="(?:\\ud83c[\\udde6-\\uddff]){2}",Ll="[\\ud800-\\udbff][\\udc00-\\udfff]",dr="["+Hd+"]",qd="\\u200d",Zd="(?:"+jd+"|"+Jd+")",Cy="(?:"+dr+"|"+Jd+")",Yd="(?:"+Il+"(?:d|ll|m|re|s|t|ve))?",Qd="(?:"+Il+"(?:D|LL|M|RE|S|T|VE))?",Xd=Ty+"?",tf="["+Gd+"]?",Sy="(?:"+qd+"(?:"+[Kd,Rl,Ll].join("|")+")"+tf+Xd+")*",Oy="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",_y="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ef=tf+Xd+Sy,xy="(?:"+[wy,Rl,Ll].join("|")+")"+ef,Py="(?:"+[Kd+_s+"?",_s,Rl,Ll,Ay].join("|")+")",Iy=RegExp(Il,"g"),My=RegExp(_s,"g"),Dl=RegExp(Ml+"(?="+Ml+")|"+Py+ef,"g"),Ry=RegExp([dr+"?"+jd+"+"+Yd+"(?="+[zd,dr,"$"].join("|")+")",Cy+"+"+Qd+"(?="+[zd,dr+Zd,"$"].join("|")+")",dr+"?"+Zd+"+"+Yd,dr+"+"+Qd,_y,Oy,Vd,xy].join("|"),"g"),Ly=RegExp("["+qd+Os+kd+Gd+"]"),Dy=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ny=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Fy=-1,ae={};ae[ut]=ae[yt]=ae[Ut]=ae[Se]=ae[In]=ae[Cl]=ae[Sl]=ae[Ol]=ae[_l]=!0,ae[k]=ae[H]=ae[q]=ae[et]=ae[ot]=ae[ft]=ae[Et]=ae[Ct]=ae[ht]=ae[Qt]=ae[se]=ae[An]=ae[ue]=ae[wn]=ae[pi]=!1;var oe={};oe[k]=oe[H]=oe[q]=oe[ot]=oe[et]=oe[ft]=oe[ut]=oe[yt]=oe[Ut]=oe[Se]=oe[In]=oe[ht]=oe[Qt]=oe[se]=oe[An]=oe[ue]=oe[wn]=oe[Jn]=oe[Cl]=oe[Sl]=oe[Ol]=oe[_l]=!0,oe[Et]=oe[Ct]=oe[pi]=!1;var By={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},ky={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},$y={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Uy={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Hy=parseFloat,Gy=parseInt,nf=typeof global=="object"&&global&&global.Object===Object&&global,Wy=typeof self=="object"&&self&&self.Object===Object&&self,Oe=nf||Wy||Function("return this")(),Nl=typeof xr=="object"&&xr&&!xr.nodeType&&xr,mi=Nl&&typeof wo=="object"&&wo&&!wo.nodeType&&wo,rf=mi&&mi.exports===Nl,Fl=rf&&nf.process,Qe=function(){try{var Y=mi&&mi.require&&mi.require("util").types;return Y||Fl&&Fl.binding&&Fl.binding("util")}catch(rt){}}(),of=Qe&&Qe.isArrayBuffer,sf=Qe&&Qe.isDate,af=Qe&&Qe.isMap,lf=Qe&&Qe.isRegExp,cf=Qe&&Qe.isSet,uf=Qe&&Qe.isTypedArray;function ze(Y,rt,nt){switch(nt.length){case 0:return Y.call(rt);case 1:return Y.call(rt,nt[0]);case 2:return Y.call(rt,nt[0],nt[1]);case 3:return Y.call(rt,nt[0],nt[1],nt[2])}return Y.apply(rt,nt)}function zy(Y,rt,nt,vt){for(var Rt=-1,Zt=Y==null?0:Y.length;++Rt<Zt;){var Ae=Y[Rt];rt(vt,Ae,nt(Ae),Y)}return vt}function Xe(Y,rt){for(var nt=-1,vt=Y==null?0:Y.length;++nt<vt&&rt(Y[nt],nt,Y)!==!1;);return Y}function Vy(Y,rt){for(var nt=Y==null?0:Y.length;nt--&&rt(Y[nt],nt,Y)!==!1;);return Y}function df(Y,rt){for(var nt=-1,vt=Y==null?0:Y.length;++nt<vt;)if(!rt(Y[nt],nt,Y))return!1;return!0}function Kn(Y,rt){for(var nt=-1,vt=Y==null?0:Y.length,Rt=0,Zt=[];++nt<vt;){var Ae=Y[nt];rt(Ae,nt,Y)&&(Zt[Rt++]=Ae)}return Zt}function xs(Y,rt){var nt=Y==null?0:Y.length;return!!nt&&fr(Y,rt,0)>-1}function Bl(Y,rt,nt){for(var vt=-1,Rt=Y==null?0:Y.length;++vt<Rt;)if(nt(rt,Y[vt]))return!0;return!1}function le(Y,rt){for(var nt=-1,vt=Y==null?0:Y.length,Rt=Array(vt);++nt<vt;)Rt[nt]=rt(Y[nt],nt,Y);return Rt}function qn(Y,rt){for(var nt=-1,vt=rt.length,Rt=Y.length;++nt<vt;)Y[Rt+nt]=rt[nt];return Y}function kl(Y,rt,nt,vt){var Rt=-1,Zt=Y==null?0:Y.length;for(vt&&Zt&&(nt=Y[++Rt]);++Rt<Zt;)nt=rt(nt,Y[Rt],Rt,Y);return nt}function jy(Y,rt,nt,vt){var Rt=Y==null?0:Y.length;for(vt&&Rt&&(nt=Y[--Rt]);Rt--;)nt=rt(nt,Y[Rt],Rt,Y);return nt}function $l(Y,rt){for(var nt=-1,vt=Y==null?0:Y.length;++nt<vt;)if(rt(Y[nt],nt,Y))return!0;return!1}var Jy=Ul("length");function Ky(Y){return Y.split("")}function qy(Y){return Y.match(iy)||[]}function ff(Y,rt,nt){var vt;return nt(Y,function(Rt,Zt,Ae){if(rt(Rt,Zt,Ae))return vt=Zt,!1}),vt}function Ps(Y,rt,nt,vt){for(var Rt=Y.length,Zt=nt+(vt?1:-1);vt?Zt--:++Zt<Rt;)if(rt(Y[Zt],Zt,Y))return Zt;return-1}function fr(Y,rt,nt){return rt===rt?a0(Y,rt,nt):Ps(Y,hf,nt)}function Zy(Y,rt,nt,vt){for(var Rt=nt-1,Zt=Y.length;++Rt<Zt;)if(vt(Y[Rt],rt))return Rt;return-1}function hf(Y){return Y!==Y}function pf(Y,rt){var nt=Y==null?0:Y.length;return nt?Gl(Y,rt)/nt:J}function Ul(Y){return function(rt){return rt==null?s:rt[Y]}}function Hl(Y){return function(rt){return Y==null?s:Y[rt]}}function mf(Y,rt,nt,vt,Rt){return Rt(Y,function(Zt,Ae,ie){nt=vt?(vt=!1,Zt):rt(nt,Zt,Ae,ie)}),nt}function Yy(Y,rt){var nt=Y.length;for(Y.sort(rt);nt--;)Y[nt]=Y[nt].value;return Y}function Gl(Y,rt){for(var nt,vt=-1,Rt=Y.length;++vt<Rt;){var Zt=rt(Y[vt]);Zt!==s&&(nt=nt===s?Zt:nt+Zt)}return nt}function Wl(Y,rt){for(var nt=-1,vt=Array(Y);++nt<Y;)vt[nt]=rt(nt);return vt}function Qy(Y,rt){return le(rt,function(nt){return[nt,Y[nt]]})}function gf(Y){return Y&&Y.slice(0,Ef(Y)+1).replace(Pl,"")}function Ve(Y){return function(rt){return Y(rt)}}function zl(Y,rt){return le(rt,function(nt){return Y[nt]})}function to(Y,rt){return Y.has(rt)}function vf(Y,rt){for(var nt=-1,vt=Y.length;++nt<vt&&fr(rt,Y[nt],0)>-1;);return nt}function yf(Y,rt){for(var nt=Y.length;nt--&&fr(rt,Y[nt],0)>-1;);return nt}function Xy(Y,rt){for(var nt=Y.length,vt=0;nt--;)Y[nt]===rt&&++vt;return vt}var t0=Hl(By),e0=Hl(ky);function n0(Y){return"\\"+Uy[Y]}function i0(Y,rt){return Y==null?s:Y[rt]}function hr(Y){return Ly.test(Y)}function r0(Y){return Dy.test(Y)}function o0(Y){for(var rt,nt=[];!(rt=Y.next()).done;)nt.push(rt.value);return nt}function Vl(Y){var rt=-1,nt=Array(Y.size);return Y.forEach(function(vt,Rt){nt[++rt]=[Rt,vt]}),nt}function bf(Y,rt){return function(nt){return Y(rt(nt))}}function Zn(Y,rt){for(var nt=-1,vt=Y.length,Rt=0,Zt=[];++nt<vt;){var Ae=Y[nt];(Ae===rt||Ae===u)&&(Y[nt]=u,Zt[Rt++]=nt)}return Zt}function Is(Y){var rt=-1,nt=Array(Y.size);return Y.forEach(function(vt){nt[++rt]=vt}),nt}function s0(Y){var rt=-1,nt=Array(Y.size);return Y.forEach(function(vt){nt[++rt]=[vt,vt]}),nt}function a0(Y,rt,nt){for(var vt=nt-1,Rt=Y.length;++vt<Rt;)if(Y[vt]===rt)return vt;return-1}function l0(Y,rt,nt){for(var vt=nt+1;vt--;)if(Y[vt]===rt)return vt;return vt}function pr(Y){return hr(Y)?u0(Y):Jy(Y)}function fn(Y){return hr(Y)?d0(Y):Ky(Y)}function Ef(Y){for(var rt=Y.length;rt--&&Xv.test(Y.charAt(rt)););return rt}var c0=Hl($y);function u0(Y){for(var rt=Dl.lastIndex=0;Dl.test(Y);)++rt;return rt}function d0(Y){return Y.match(Dl)||[]}function f0(Y){return Y.match(Ry)||[]}var h0=function Y(rt){rt=rt==null?Oe:Yn.defaults(Oe.Object(),rt,Yn.pick(Oe,Ny));var nt=rt.Array,vt=rt.Date,Rt=rt.Error,Zt=rt.Function,Ae=rt.Math,ie=rt.Object,jl=rt.RegExp,p0=rt.String,tn=rt.TypeError,Ms=nt.prototype,m0=Zt.prototype,mr=ie.prototype,Rs=rt["__core-js_shared__"],Ls=m0.toString,ee=mr.hasOwnProperty,g0=0,Af=function(){var i=/[^.]+$/.exec(Rs&&Rs.keys&&Rs.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}(),Ds=mr.toString,v0=Ls.call(ie),y0=Oe._,b0=jl("^"+Ls.call(ee).replace(xl,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ns=rf?rt.Buffer:s,Qn=rt.Symbol,Fs=rt.Uint8Array,wf=Ns?Ns.allocUnsafe:s,Bs=bf(ie.getPrototypeOf,ie),Tf=ie.create,Cf=mr.propertyIsEnumerable,ks=Ms.splice,Sf=Qn?Qn.isConcatSpreadable:s,eo=Qn?Qn.iterator:s,gi=Qn?Qn.toStringTag:s,$s=function(){try{var i=Ai(ie,"defineProperty");return i({},"",{}),i}catch(o){}}(),E0=rt.clearTimeout!==Oe.clearTimeout&&rt.clearTimeout,A0=vt&&vt.now!==Oe.Date.now&&vt.now,w0=rt.setTimeout!==Oe.setTimeout&&rt.setTimeout,Us=Ae.ceil,Hs=Ae.floor,Jl=ie.getOwnPropertySymbols,T0=Ns?Ns.isBuffer:s,Of=rt.isFinite,C0=Ms.join,S0=bf(ie.keys,ie),we=Ae.max,Le=Ae.min,O0=vt.now,_0=rt.parseInt,_f=Ae.random,x0=Ms.reverse,Kl=Ai(rt,"DataView"),no=Ai(rt,"Map"),ql=Ai(rt,"Promise"),gr=Ai(rt,"Set"),io=Ai(rt,"WeakMap"),ro=Ai(ie,"create"),Gs=io&&new io,vr={},P0=wi(Kl),I0=wi(no),M0=wi(ql),R0=wi(gr),L0=wi(io),Ws=Qn?Qn.prototype:s,oo=Ws?Ws.valueOf:s,xf=Ws?Ws.toString:s;function F(i){if(ge(i)&&!Dt(i)&&!(i instanceof jt)){if(i instanceof en)return i;if(ee.call(i,"__wrapped__"))return Ph(i)}return new en(i)}var yr=function(){function i(){}return function(o){if(!de(o))return{};if(Tf)return Tf(o);i.prototype=o;var d=new i;return i.prototype=s,d}}();function zs(){}function en(i,o){this.__wrapped__=i,this.__actions__=[],this.__chain__=!!o,this.__index__=0,this.__values__=s}F.templateSettings={escape:Jv,evaluate:Kv,interpolate:Fd,variable:"",imports:{_:F}},F.prototype=zs.prototype,F.prototype.constructor=F,en.prototype=yr(zs.prototype),en.prototype.constructor=en;function jt(i){this.__wrapped__=i,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=tt,this.__views__=[]}function D0(){var i=new jt(this.__wrapped__);return i.__actions__=ke(this.__actions__),i.__dir__=this.__dir__,i.__filtered__=this.__filtered__,i.__iteratees__=ke(this.__iteratees__),i.__takeCount__=this.__takeCount__,i.__views__=ke(this.__views__),i}function N0(){if(this.__filtered__){var i=new jt(this);i.__dir__=-1,i.__filtered__=!0}else i=this.clone(),i.__dir__*=-1;return i}function F0(){var i=this.__wrapped__.value(),o=this.__dir__,d=Dt(i),w=o<0,I=d?i.length:0,$=Kb(0,I,this.__views__),V=$.start,K=$.end,Q=K-V,st=w?K:V-1,at=this.__iteratees__,ct=at.length,pt=0,bt=Le(Q,this.__takeCount__);if(!d||!w&&I==Q&&bt==Q)return Qf(i,this.__actions__);var Ot=[];t:for(;Q--&&pt<bt;){st+=o;for(var Ht=-1,_t=i[st];++Ht<ct;){var zt=at[Ht],Jt=zt.iteratee,Ke=zt.type,Be=Jt(_t);if(Ke==N)_t=Be;else if(!Be){if(Ke==W)continue t;break t}}Ot[pt++]=_t}return Ot}jt.prototype=yr(zs.prototype),jt.prototype.constructor=jt;function vi(i){var o=-1,d=i==null?0:i.length;for(this.clear();++o<d;){var w=i[o];this.set(w[0],w[1])}}function B0(){this.__data__=ro?ro(null):{},this.size=0}function k0(i){var o=this.has(i)&&delete this.__data__[i];return this.size-=o?1:0,o}function $0(i){var o=this.__data__;if(ro){var d=o[i];return d===l?s:d}return ee.call(o,i)?o[i]:s}function U0(i){var o=this.__data__;return ro?o[i]!==s:ee.call(o,i)}function H0(i,o){var d=this.__data__;return this.size+=this.has(i)?0:1,d[i]=ro&&o===s?l:o,this}vi.prototype.clear=B0,vi.prototype.delete=k0,vi.prototype.get=$0,vi.prototype.has=U0,vi.prototype.set=H0;function Mn(i){var o=-1,d=i==null?0:i.length;for(this.clear();++o<d;){var w=i[o];this.set(w[0],w[1])}}function G0(){this.__data__=[],this.size=0}function W0(i){var o=this.__data__,d=Vs(o,i);if(d<0)return!1;var w=o.length-1;return d==w?o.pop():ks.call(o,d,1),--this.size,!0}function z0(i){var o=this.__data__,d=Vs(o,i);return d<0?s:o[d][1]}function V0(i){return Vs(this.__data__,i)>-1}function j0(i,o){var d=this.__data__,w=Vs(d,i);return w<0?(++this.size,d.push([i,o])):d[w][1]=o,this}Mn.prototype.clear=G0,Mn.prototype.delete=W0,Mn.prototype.get=z0,Mn.prototype.has=V0,Mn.prototype.set=j0;function Rn(i){var o=-1,d=i==null?0:i.length;for(this.clear();++o<d;){var w=i[o];this.set(w[0],w[1])}}function J0(){this.size=0,this.__data__={hash:new vi,map:new(no||Mn),string:new vi}}function K0(i){var o=ia(this,i).delete(i);return this.size-=o?1:0,o}function q0(i){return ia(this,i).get(i)}function Z0(i){return ia(this,i).has(i)}function Y0(i,o){var d=ia(this,i),w=d.size;return d.set(i,o),this.size+=d.size==w?0:1,this}Rn.prototype.clear=J0,Rn.prototype.delete=K0,Rn.prototype.get=q0,Rn.prototype.has=Z0,Rn.prototype.set=Y0;function yi(i){var o=-1,d=i==null?0:i.length;for(this.__data__=new Rn;++o<d;)this.add(i[o])}function Q0(i){return this.__data__.set(i,l),this}function X0(i){return this.__data__.has(i)}yi.prototype.add=yi.prototype.push=Q0,yi.prototype.has=X0;function hn(i){var o=this.__data__=new Mn(i);this.size=o.size}function tb(){this.__data__=new Mn,this.size=0}function eb(i){var o=this.__data__,d=o.delete(i);return this.size=o.size,d}function nb(i){return this.__data__.get(i)}function ib(i){return this.__data__.has(i)}function rb(i,o){var d=this.__data__;if(d instanceof Mn){var w=d.__data__;if(!no||w.length<t-1)return w.push([i,o]),this.size=++d.size,this;d=this.__data__=new Rn(w)}return d.set(i,o),this.size=d.size,this}hn.prototype.clear=tb,hn.prototype.delete=eb,hn.prototype.get=nb,hn.prototype.has=ib,hn.prototype.set=rb;function Pf(i,o){var d=Dt(i),w=!d&&Ti(i),I=!d&&!w&&ii(i),$=!d&&!w&&!I&&wr(i),V=d||w||I||$,K=V?Wl(i.length,p0):[],Q=K.length;for(var st in i)(o||ee.call(i,st))&&!(V&&(st=="length"||I&&(st=="offset"||st=="parent")||$&&(st=="buffer"||st=="byteLength"||st=="byteOffset")||Fn(st,Q)))&&K.push(st);return K}function If(i){var o=i.length;return o?i[sc(0,o-1)]:s}function ob(i,o){return ra(ke(i),bi(o,0,i.length))}function sb(i){return ra(ke(i))}function Zl(i,o,d){(d!==s&&!pn(i[o],d)||d===s&&!(o in i))&&Ln(i,o,d)}function so(i,o,d){var w=i[o];(!(ee.call(i,o)&&pn(w,d))||d===s&&!(o in i))&&Ln(i,o,d)}function Vs(i,o){for(var d=i.length;d--;)if(pn(i[d][0],o))return d;return-1}function ab(i,o,d,w){return Xn(i,function(I,$,V){o(w,I,d(I),V)}),w}function Mf(i,o){return i&&Cn(o,_e(o),i)}function lb(i,o){return i&&Cn(o,Ue(o),i)}function Ln(i,o,d){o=="__proto__"&&$s?$s(i,o,{configurable:!0,enumerable:!0,value:d,writable:!0}):i[o]=d}function Yl(i,o){for(var d=-1,w=o.length,I=nt(w),$=i==null;++d<w;)I[d]=$?s:Mc(i,o[d]);return I}function bi(i,o,d){return i===i&&(d!==s&&(i=i<=d?i:d),o!==s&&(i=i>=o?i:o)),i}function nn(i,o,d,w,I,$){var V,K=o&m,Q=o&g,st=o&E;if(d&&(V=I?d(i,w,I,$):d(i)),V!==s)return V;if(!de(i))return i;var at=Dt(i);if(at){if(V=Zb(i),!K)return ke(i,V)}else{var ct=De(i),pt=ct==Ct||ct==Vt;if(ii(i))return eh(i,K);if(ct==se||ct==k||pt&&!I){if(V=Q||pt?{}:Eh(i),!K)return Q?$b(i,lb(V,i)):kb(i,Mf(V,i))}else{if(!oe[ct])return I?i:{};V=Yb(i,ct,K)}}$||($=new hn);var bt=$.get(i);if(bt)return bt;$.set(i,V),qh(i)?i.forEach(function(_t){V.add(nn(_t,o,d,_t,i,$))}):Jh(i)&&i.forEach(function(_t,zt){V.set(zt,nn(_t,o,d,zt,i,$))});var Ot=st?Q?vc:gc:Q?Ue:_e,Ht=at?s:Ot(i);return Xe(Ht||i,function(_t,zt){Ht&&(zt=_t,_t=i[zt]),so(V,zt,nn(_t,o,d,zt,i,$))}),V}function cb(i){var o=_e(i);return function(d){return Rf(d,i,o)}}function Rf(i,o,d){var w=d.length;if(i==null)return!w;for(i=ie(i);w--;){var I=d[w],$=o[I],V=i[I];if(V===s&&!(I in i)||!$(V))return!1}return!0}function Lf(i,o,d){if(typeof i!="function")throw new tn(r);return po(function(){i.apply(s,d)},o)}function ao(i,o,d,w){var I=-1,$=xs,V=!0,K=i.length,Q=[],st=o.length;if(!K)return Q;d&&(o=le(o,Ve(d))),w?($=Bl,V=!1):o.length>=t&&($=to,V=!1,o=new yi(o));t:for(;++I<K;){var at=i[I],ct=d==null?at:d(at);if(at=w||at!==0?at:0,V&&ct===ct){for(var pt=st;pt--;)if(o[pt]===ct)continue t;Q.push(at)}else $(o,ct,w)||Q.push(at)}return Q}var Xn=sh(Tn),Df=sh(Xl,!0);function ub(i,o){var d=!0;return Xn(i,function(w,I,$){return d=!!o(w,I,$),d}),d}function js(i,o,d){for(var w=-1,I=i.length;++w<I;){var $=i[w],V=o($);if(V!=null&&(K===s?V===V&&!Je(V):d(V,K)))var K=V,Q=$}return Q}function db(i,o,d,w){var I=i.length;for(d=Bt(d),d<0&&(d=-d>I?0:I+d),w=w===s||w>I?I:Bt(w),w<0&&(w+=I),w=d>w?0:Yh(w);d<w;)i[d++]=o;return i}function Nf(i,o){var d=[];return Xn(i,function(w,I,$){o(w,I,$)&&d.push(w)}),d}function Re(i,o,d,w,I){var $=-1,V=i.length;for(d||(d=Xb),I||(I=[]);++$<V;){var K=i[$];o>0&&d(K)?o>1?Re(K,o-1,d,w,I):qn(I,K):w||(I[I.length]=K)}return I}var Ql=ah(),Ff=ah(!0);function Tn(i,o){return i&&Ql(i,o,_e)}function Xl(i,o){return i&&Ff(i,o,_e)}function Js(i,o){return Kn(o,function(d){return Bn(i[d])})}function Ei(i,o){o=ei(o,i);for(var d=0,w=o.length;i!=null&&d<w;)i=i[Sn(o[d++])];return d&&d==w?i:s}function Bf(i,o,d){var w=o(i);return Dt(i)?w:qn(w,d(i))}function Ne(i){return i==null?i===s?Xr:Ee:gi&&gi in ie(i)?Jb(i):sE(i)}function tc(i,o){return i>o}function fb(i,o){return i!=null&&ee.call(i,o)}function hb(i,o){return i!=null&&o in ie(i)}function pb(i,o,d){return i>=Le(o,d)&&i<we(o,d)}function ec(i,o,d){for(var w=d?Bl:xs,I=i[0].length,$=i.length,V=$,K=nt($),Q=1/0,st=[];V--;){var at=i[V];V&&o&&(at=le(at,Ve(o))),Q=Le(at.length,Q),K[V]=!d&&(o||I>=120&&at.length>=120)?new yi(V&&at):s}at=i[0];var ct=-1,pt=K[0];t:for(;++ct<I&&st.length<Q;){var bt=at[ct],Ot=o?o(bt):bt;if(bt=d||bt!==0?bt:0,!(pt?to(pt,Ot):w(st,Ot,d))){for(V=$;--V;){var Ht=K[V];if(!(Ht?to(Ht,Ot):w(i[V],Ot,d)))continue t}pt&&pt.push(Ot),st.push(bt)}}return st}function mb(i,o,d,w){return Tn(i,function(I,$,V){o(w,d(I),$,V)}),w}function lo(i,o,d){o=ei(o,i),i=Ch(i,o);var w=i==null?i:i[Sn(on(o))];return w==null?s:ze(w,i,d)}function kf(i){return ge(i)&&Ne(i)==k}function gb(i){return ge(i)&&Ne(i)==q}function vb(i){return ge(i)&&Ne(i)==ft}function co(i,o,d,w,I){return i===o?!0:i==null||o==null||!ge(i)&&!ge(o)?i!==i&&o!==o:yb(i,o,d,w,co,I)}function yb(i,o,d,w,I,$){var V=Dt(i),K=Dt(o),Q=V?H:De(i),st=K?H:De(o);Q=Q==k?se:Q,st=st==k?se:st;var at=Q==se,ct=st==se,pt=Q==st;if(pt&&ii(i)){if(!ii(o))return!1;V=!0,at=!1}if(pt&&!at)return $||($=new hn),V||wr(i)?vh(i,o,d,w,I,$):Vb(i,o,Q,d,w,I,$);if(!(d&h)){var bt=at&&ee.call(i,"__wrapped__"),Ot=ct&&ee.call(o,"__wrapped__");if(bt||Ot){var Ht=bt?i.value():i,_t=Ot?o.value():o;return $||($=new hn),I(Ht,_t,d,w,$)}}return pt?($||($=new hn),jb(i,o,d,w,I,$)):!1}function bb(i){return ge(i)&&De(i)==ht}function nc(i,o,d,w){var I=d.length,$=I,V=!w;if(i==null)return!$;for(i=ie(i);I--;){var K=d[I];if(V&&K[2]?K[1]!==i[K[0]]:!(K[0]in i))return!1}for(;++I<$;){K=d[I];var Q=K[0],st=i[Q],at=K[1];if(V&&K[2]){if(st===s&&!(Q in i))return!1}else{var ct=new hn;if(w)var pt=w(st,at,Q,i,o,ct);if(!(pt===s?co(at,st,h|y,w,ct):pt))return!1}}return!0}function $f(i){if(!de(i)||eE(i))return!1;var o=Bn(i)?b0:cy;return o.test(wi(i))}function Eb(i){return ge(i)&&Ne(i)==An}function Ab(i){return ge(i)&&De(i)==ue}function wb(i){return ge(i)&&ua(i.length)&&!!ae[Ne(i)]}function Uf(i){return typeof i=="function"?i:i==null?He:typeof i=="object"?Dt(i)?Wf(i[0],i[1]):Gf(i):lp(i)}function ic(i){if(!ho(i))return S0(i);var o=[];for(var d in ie(i))ee.call(i,d)&&d!="constructor"&&o.push(d);return o}function Tb(i){if(!de(i))return oE(i);var o=ho(i),d=[];for(var w in i)w=="constructor"&&(o||!ee.call(i,w))||d.push(w);return d}function rc(i,o){return i<o}function Hf(i,o){var d=-1,w=$e(i)?nt(i.length):[];return Xn(i,function(I,$,V){w[++d]=o(I,$,V)}),w}function Gf(i){var o=bc(i);return o.length==1&&o[0][2]?wh(o[0][0],o[0][1]):function(d){return d===i||nc(d,i,o)}}function Wf(i,o){return Ac(i)&&Ah(o)?wh(Sn(i),o):function(d){var w=Mc(d,i);return w===s&&w===o?Rc(d,i):co(o,w,h|y)}}function Ks(i,o,d,w,I){i!==o&&Ql(o,function($,V){if(I||(I=new hn),de($))Cb(i,o,V,d,Ks,w,I);else{var K=w?w(Tc(i,V),$,V+"",i,o,I):s;K===s&&(K=$),Zl(i,V,K)}},Ue)}function Cb(i,o,d,w,I,$,V){var K=Tc(i,d),Q=Tc(o,d),st=V.get(Q);if(st){Zl(i,d,st);return}var at=$?$(K,Q,d+"",i,o,V):s,ct=at===s;if(ct){var pt=Dt(Q),bt=!pt&&ii(Q),Ot=!pt&&!bt&&wr(Q);at=Q,pt||bt||Ot?Dt(K)?at=K:ve(K)?at=ke(K):bt?(ct=!1,at=eh(Q,!0)):Ot?(ct=!1,at=nh(Q,!0)):at=[]:mo(Q)||Ti(Q)?(at=K,Ti(K)?at=Qh(K):(!de(K)||Bn(K))&&(at=Eh(Q))):ct=!1}ct&&(V.set(Q,at),I(at,Q,w,$,V),V.delete(Q)),Zl(i,d,at)}function zf(i,o){var d=i.length;if(!!d)return o+=o<0?d:0,Fn(o,d)?i[o]:s}function Vf(i,o,d){o.length?o=le(o,function($){return Dt($)?function(V){return Ei(V,$.length===1?$[0]:$)}:$}):o=[He];var w=-1;o=le(o,Ve(St()));var I=Hf(i,function($,V,K){var Q=le(o,function(st){return st($)});return{criteria:Q,index:++w,value:$}});return Yy(I,function($,V){return Bb($,V,d)})}function Sb(i,o){return jf(i,o,function(d,w){return Rc(i,w)})}function jf(i,o,d){for(var w=-1,I=o.length,$={};++w<I;){var V=o[w],K=Ei(i,V);d(K,V)&&uo($,ei(V,i),K)}return $}function Ob(i){return function(o){return Ei(o,i)}}function oc(i,o,d,w){var I=w?Zy:fr,$=-1,V=o.length,K=i;for(i===o&&(o=ke(o)),d&&(K=le(i,Ve(d)));++$<V;)for(var Q=0,st=o[$],at=d?d(st):st;(Q=I(K,at,Q,w))>-1;)K!==i&&ks.call(K,Q,1),ks.call(i,Q,1);return i}function Jf(i,o){for(var d=i?o.length:0,w=d-1;d--;){var I=o[d];if(d==w||I!==$){var $=I;Fn(I)?ks.call(i,I,1):cc(i,I)}}return i}function sc(i,o){return i+Hs(_f()*(o-i+1))}function _b(i,o,d,w){for(var I=-1,$=we(Us((o-i)/(d||1)),0),V=nt($);$--;)V[w?$:++I]=i,i+=d;return V}function ac(i,o){var d="";if(!i||o<1||o>U)return d;do o%2&&(d+=i),o=Hs(o/2),o&&(i+=i);while(o);return d}function Wt(i,o){return Cc(Th(i,o,He),i+"")}function xb(i){return If(Tr(i))}function Pb(i,o){var d=Tr(i);return ra(d,bi(o,0,d.length))}function uo(i,o,d,w){if(!de(i))return i;o=ei(o,i);for(var I=-1,$=o.length,V=$-1,K=i;K!=null&&++I<$;){var Q=Sn(o[I]),st=d;if(Q==="__proto__"||Q==="constructor"||Q==="prototype")return i;if(I!=V){var at=K[Q];st=w?w(at,Q,K):s,st===s&&(st=de(at)?at:Fn(o[I+1])?[]:{})}so(K,Q,st),K=K[Q]}return i}var Kf=Gs?function(i,o){return Gs.set(i,o),i}:He,Ib=$s?function(i,o){return $s(i,"toString",{configurable:!0,enumerable:!1,value:Dc(o),writable:!0})}:He;function Mb(i){return ra(Tr(i))}function rn(i,o,d){var w=-1,I=i.length;o<0&&(o=-o>I?0:I+o),d=d>I?I:d,d<0&&(d+=I),I=o>d?0:d-o>>>0,o>>>=0;for(var $=nt(I);++w<I;)$[w]=i[w+o];return $}function Rb(i,o){var d;return Xn(i,function(w,I,$){return d=o(w,I,$),!d}),!!d}function qs(i,o,d){var w=0,I=i==null?w:i.length;if(typeof o=="number"&&o===o&&I<=X){for(;w<I;){var $=w+I>>>1,V=i[$];V!==null&&!Je(V)&&(d?V<=o:V<o)?w=$+1:I=$}return I}return lc(i,o,He,d)}function lc(i,o,d,w){var I=0,$=i==null?0:i.length;if($===0)return 0;o=d(o);for(var V=o!==o,K=o===null,Q=Je(o),st=o===s;I<$;){var at=Hs((I+$)/2),ct=d(i[at]),pt=ct!==s,bt=ct===null,Ot=ct===ct,Ht=Je(ct);if(V)var _t=w||Ot;else st?_t=Ot&&(w||pt):K?_t=Ot&&pt&&(w||!bt):Q?_t=Ot&&pt&&!bt&&(w||!Ht):bt||Ht?_t=!1:_t=w?ct<=o:ct<o;_t?I=at+1:$=at}return Le($,it)}function qf(i,o){for(var d=-1,w=i.length,I=0,$=[];++d<w;){var V=i[d],K=o?o(V):V;if(!d||!pn(K,Q)){var Q=K;$[I++]=V===0?0:V}}return $}function Zf(i){return typeof i=="number"?i:Je(i)?J:+i}function je(i){if(typeof i=="string")return i;if(Dt(i))return le(i,je)+"";if(Je(i))return xf?xf.call(i):"";var o=i+"";return o=="0"&&1/i==-D?"-0":o}function ti(i,o,d){var w=-1,I=xs,$=i.length,V=!0,K=[],Q=K;if(d)V=!1,I=Bl;else if($>=t){var st=o?null:Wb(i);if(st)return Is(st);V=!1,I=to,Q=new yi}else Q=o?[]:K;t:for(;++w<$;){var at=i[w],ct=o?o(at):at;if(at=d||at!==0?at:0,V&&ct===ct){for(var pt=Q.length;pt--;)if(Q[pt]===ct)continue t;o&&Q.push(ct),K.push(at)}else I(Q,ct,d)||(Q!==K&&Q.push(ct),K.push(at))}return K}function cc(i,o){return o=ei(o,i),i=Ch(i,o),i==null||delete i[Sn(on(o))]}function Yf(i,o,d,w){return uo(i,o,d(Ei(i,o)),w)}function Zs(i,o,d,w){for(var I=i.length,$=w?I:-1;(w?$--:++$<I)&&o(i[$],$,i););return d?rn(i,w?0:$,w?$+1:I):rn(i,w?$+1:0,w?I:$)}function Qf(i,o){var d=i;return d instanceof jt&&(d=d.value()),kl(o,function(w,I){return I.func.apply(I.thisArg,qn([w],I.args))},d)}function uc(i,o,d){var w=i.length;if(w<2)return w?ti(i[0]):[];for(var I=-1,$=nt(w);++I<w;)for(var V=i[I],K=-1;++K<w;)K!=I&&($[I]=ao($[I]||V,i[K],o,d));return ti(Re($,1),o,d)}function Xf(i,o,d){for(var w=-1,I=i.length,$=o.length,V={};++w<I;){var K=w<$?o[w]:s;d(V,i[w],K)}return V}function dc(i){return ve(i)?i:[]}function fc(i){return typeof i=="function"?i:He}function ei(i,o){return Dt(i)?i:Ac(i,o)?[i]:xh(Xt(i))}var Lb=Wt;function ni(i,o,d){var w=i.length;return d=d===s?w:d,!o&&d>=w?i:rn(i,o,d)}var th=E0||function(i){return Oe.clearTimeout(i)};function eh(i,o){if(o)return i.slice();var d=i.length,w=wf?wf(d):new i.constructor(d);return i.copy(w),w}function hc(i){var o=new i.constructor(i.byteLength);return new Fs(o).set(new Fs(i)),o}function Db(i,o){var d=o?hc(i.buffer):i.buffer;return new i.constructor(d,i.byteOffset,i.byteLength)}function Nb(i){var o=new i.constructor(i.source,Bd.exec(i));return o.lastIndex=i.lastIndex,o}function Fb(i){return oo?ie(oo.call(i)):{}}function nh(i,o){var d=o?hc(i.buffer):i.buffer;return new i.constructor(d,i.byteOffset,i.length)}function ih(i,o){if(i!==o){var d=i!==s,w=i===null,I=i===i,$=Je(i),V=o!==s,K=o===null,Q=o===o,st=Je(o);if(!K&&!st&&!$&&i>o||$&&V&&Q&&!K&&!st||w&&V&&Q||!d&&Q||!I)return 1;if(!w&&!$&&!st&&i<o||st&&d&&I&&!w&&!$||K&&d&&I||!V&&I||!Q)return-1}return 0}function Bb(i,o,d){for(var w=-1,I=i.criteria,$=o.criteria,V=I.length,K=d.length;++w<V;){var Q=ih(I[w],$[w]);if(Q){if(w>=K)return Q;var st=d[w];return Q*(st=="desc"?-1:1)}}return i.index-o.index}function rh(i,o,d,w){for(var I=-1,$=i.length,V=d.length,K=-1,Q=o.length,st=we($-V,0),at=nt(Q+st),ct=!w;++K<Q;)at[K]=o[K];for(;++I<V;)(ct||I<$)&&(at[d[I]]=i[I]);for(;st--;)at[K++]=i[I++];return at}function oh(i,o,d,w){for(var I=-1,$=i.length,V=-1,K=d.length,Q=-1,st=o.length,at=we($-K,0),ct=nt(at+st),pt=!w;++I<at;)ct[I]=i[I];for(var bt=I;++Q<st;)ct[bt+Q]=o[Q];for(;++V<K;)(pt||I<$)&&(ct[bt+d[V]]=i[I++]);return ct}function ke(i,o){var d=-1,w=i.length;for(o||(o=nt(w));++d<w;)o[d]=i[d];return o}function Cn(i,o,d,w){var I=!d;d||(d={});for(var $=-1,V=o.length;++$<V;){var K=o[$],Q=w?w(d[K],i[K],K,d,i):s;Q===s&&(Q=i[K]),I?Ln(d,K,Q):so(d,K,Q)}return d}function kb(i,o){return Cn(i,Ec(i),o)}function $b(i,o){return Cn(i,yh(i),o)}function Ys(i,o){return function(d,w){var I=Dt(d)?zy:ab,$=o?o():{};return I(d,i,St(w,2),$)}}function br(i){return Wt(function(o,d){var w=-1,I=d.length,$=I>1?d[I-1]:s,V=I>2?d[2]:s;for($=i.length>3&&typeof $=="function"?(I--,$):s,V&&Fe(d[0],d[1],V)&&($=I<3?s:$,I=1),o=ie(o);++w<I;){var K=d[w];K&&i(o,K,w,$)}return o})}function sh(i,o){return function(d,w){if(d==null)return d;if(!$e(d))return i(d,w);for(var I=d.length,$=o?I:-1,V=ie(d);(o?$--:++$<I)&&w(V[$],$,V)!==!1;);return d}}function ah(i){return function(o,d,w){for(var I=-1,$=ie(o),V=w(o),K=V.length;K--;){var Q=V[i?K:++I];if(d($[Q],Q,$)===!1)break}return o}}function Ub(i,o,d){var w=o&O,I=fo(i);function $(){var V=this&&this!==Oe&&this instanceof $?I:i;return V.apply(w?d:this,arguments)}return $}function lh(i){return function(o){o=Xt(o);var d=hr(o)?fn(o):s,w=d?d[0]:o.charAt(0),I=d?ni(d,1).join(""):o.slice(1);return w[i]()+I}}function Er(i){return function(o){return kl(sp(op(o).replace(Iy,"")),i,"")}}function fo(i){return function(){var o=arguments;switch(o.length){case 0:return new i;case 1:return new i(o[0]);case 2:return new i(o[0],o[1]);case 3:return new i(o[0],o[1],o[2]);case 4:return new i(o[0],o[1],o[2],o[3]);case 5:return new i(o[0],o[1],o[2],o[3],o[4]);case 6:return new i(o[0],o[1],o[2],o[3],o[4],o[5]);case 7:return new i(o[0],o[1],o[2],o[3],o[4],o[5],o[6])}var d=yr(i.prototype),w=i.apply(d,o);return de(w)?w:d}}function Hb(i,o,d){var w=fo(i);function I(){for(var $=arguments.length,V=nt($),K=$,Q=Ar(I);K--;)V[K]=arguments[K];var st=$<3&&V[0]!==Q&&V[$-1]!==Q?[]:Zn(V,Q);if($-=st.length,$<d)return hh(i,o,Qs,I.placeholder,s,V,st,s,s,d-$);var at=this&&this!==Oe&&this instanceof I?w:i;return ze(at,this,V)}return I}function ch(i){return function(o,d,w){var I=ie(o);if(!$e(o)){var $=St(d,3);o=_e(o),d=function(K){return $(I[K],K,I)}}var V=i(o,d,w);return V>-1?I[$?o[V]:V]:s}}function uh(i){return Nn(function(o){var d=o.length,w=d,I=en.prototype.thru;for(i&&o.reverse();w--;){var $=o[w];if(typeof $!="function")throw new tn(r);if(I&&!V&&na($)=="wrapper")var V=new en([],!0)}for(w=V?w:d;++w<d;){$=o[w];var K=na($),Q=K=="wrapper"?yc($):s;Q&&wc(Q[0])&&Q[1]==(f|T|v|p)&&!Q[4].length&&Q[9]==1?V=V[na(Q[0])].apply(V,Q[3]):V=$.length==1&&wc($)?V[K]():V.thru($)}return function(){var st=arguments,at=st[0];if(V&&st.length==1&&Dt(at))return V.plant(at).value();for(var ct=0,pt=d?o[ct].apply(this,st):at;++ct<d;)pt=o[ct].call(this,pt);return pt}})}function Qs(i,o,d,w,I,$,V,K,Q,st){var at=o&f,ct=o&O,pt=o&_,bt=o&(T|x),Ot=o&S,Ht=pt?s:fo(i);function _t(){for(var zt=arguments.length,Jt=nt(zt),Ke=zt;Ke--;)Jt[Ke]=arguments[Ke];if(bt)var Be=Ar(_t),qe=Xy(Jt,Be);if(w&&(Jt=rh(Jt,w,I,bt)),$&&(Jt=oh(Jt,$,V,bt)),zt-=qe,bt&&zt<st){var ye=Zn(Jt,Be);return hh(i,o,Qs,_t.placeholder,d,Jt,ye,K,Q,st-zt)}var mn=ct?d:this,$n=pt?mn[i]:i;return zt=Jt.length,K?Jt=aE(Jt,K):Ot&&zt>1&&Jt.reverse(),at&&Q<zt&&(Jt.length=Q),this&&this!==Oe&&this instanceof _t&&($n=Ht||fo($n)),$n.apply(mn,Jt)}return _t}function dh(i,o){return function(d,w){return mb(d,i,o(w),{})}}function Xs(i,o){return function(d,w){var I;if(d===s&&w===s)return o;if(d!==s&&(I=d),w!==s){if(I===s)return w;typeof d=="string"||typeof w=="string"?(d=je(d),w=je(w)):(d=Zf(d),w=Zf(w)),I=i(d,w)}return I}}function pc(i){return Nn(function(o){return o=le(o,Ve(St())),Wt(function(d){var w=this;return i(o,function(I){return ze(I,w,d)})})})}function ta(i,o){o=o===s?" ":je(o);var d=o.length;if(d<2)return d?ac(o,i):o;var w=ac(o,Us(i/pr(o)));return hr(o)?ni(fn(w),0,i).join(""):w.slice(0,i)}function Gb(i,o,d,w){var I=o&O,$=fo(i);function V(){for(var K=-1,Q=arguments.length,st=-1,at=w.length,ct=nt(at+Q),pt=this&&this!==Oe&&this instanceof V?$:i;++st<at;)ct[st]=w[st];for(;Q--;)ct[st++]=arguments[++K];return ze(pt,I?d:this,ct)}return V}function fh(i){return function(o,d,w){return w&&typeof w!="number"&&Fe(o,d,w)&&(d=w=s),o=kn(o),d===s?(d=o,o=0):d=kn(d),w=w===s?o<d?1:-1:kn(w),_b(o,d,w,i)}}function ea(i){return function(o,d){return typeof o=="string"&&typeof d=="string"||(o=sn(o),d=sn(d)),i(o,d)}}function hh(i,o,d,w,I,$,V,K,Q,st){var at=o&T,ct=at?V:s,pt=at?s:V,bt=at?$:s,Ot=at?s:$;o|=at?v:A,o&=~(at?A:v),o&C||(o&=~(O|_));var Ht=[i,o,I,bt,ct,Ot,pt,K,Q,st],_t=d.apply(s,Ht);return wc(i)&&Sh(_t,Ht),_t.placeholder=w,Oh(_t,i,o)}function mc(i){var o=Ae[i];return function(d,w){if(d=sn(d),w=w==null?0:Le(Bt(w),292),w&&Of(d)){var I=(Xt(d)+"e").split("e"),$=o(I[0]+"e"+(+I[1]+w));return I=(Xt($)+"e").split("e"),+(I[0]+"e"+(+I[1]-w))}return o(d)}}var Wb=gr&&1/Is(new gr([,-0]))[1]==D?function(i){return new gr(i)}:Bc;function ph(i){return function(o){var d=De(o);return d==ht?Vl(o):d==ue?s0(o):Qy(o,i(o))}}function Dn(i,o,d,w,I,$,V,K){var Q=o&_;if(!Q&&typeof i!="function")throw new tn(r);var st=w?w.length:0;if(st||(o&=~(v|A),w=I=s),V=V===s?V:we(Bt(V),0),K=K===s?K:Bt(K),st-=I?I.length:0,o&A){var at=w,ct=I;w=I=s}var pt=Q?s:yc(i),bt=[i,o,d,w,I,at,ct,$,V,K];if(pt&&rE(bt,pt),i=bt[0],o=bt[1],d=bt[2],w=bt[3],I=bt[4],K=bt[9]=bt[9]===s?Q?0:i.length:we(bt[9]-st,0),!K&&o&(T|x)&&(o&=~(T|x)),!o||o==O)var Ot=Ub(i,o,d);else o==T||o==x?Ot=Hb(i,o,K):(o==v||o==(O|v))&&!I.length?Ot=Gb(i,o,d,w):Ot=Qs.apply(s,bt);var Ht=pt?Kf:Sh;return Oh(Ht(Ot,bt),i,o)}function mh(i,o,d,w){return i===s||pn(i,mr[d])&&!ee.call(w,d)?o:i}function gh(i,o,d,w,I,$){return de(i)&&de(o)&&($.set(o,i),Ks(i,o,s,gh,$),$.delete(o)),i}function zb(i){return mo(i)?s:i}function vh(i,o,d,w,I,$){var V=d&h,K=i.length,Q=o.length;if(K!=Q&&!(V&&Q>K))return!1;var st=$.get(i),at=$.get(o);if(st&&at)return st==o&&at==i;var ct=-1,pt=!0,bt=d&y?new yi:s;for($.set(i,o),$.set(o,i);++ct<K;){var Ot=i[ct],Ht=o[ct];if(w)var _t=V?w(Ht,Ot,ct,o,i,$):w(Ot,Ht,ct,i,o,$);if(_t!==s){if(_t)continue;pt=!1;break}if(bt){if(!$l(o,function(zt,Jt){if(!to(bt,Jt)&&(Ot===zt||I(Ot,zt,d,w,$)))return bt.push(Jt)})){pt=!1;break}}else if(!(Ot===Ht||I(Ot,Ht,d,w,$))){pt=!1;break}}return $.delete(i),$.delete(o),pt}function Vb(i,o,d,w,I,$,V){switch(d){case ot:if(i.byteLength!=o.byteLength||i.byteOffset!=o.byteOffset)return!1;i=i.buffer,o=o.buffer;case q:return!(i.byteLength!=o.byteLength||!$(new Fs(i),new Fs(o)));case et:case ft:case Qt:return pn(+i,+o);case Et:return i.name==o.name&&i.message==o.message;case An:case wn:return i==o+"";case ht:var K=Vl;case ue:var Q=w&h;if(K||(K=Is),i.size!=o.size&&!Q)return!1;var st=V.get(i);if(st)return st==o;w|=y,V.set(i,o);var at=vh(K(i),K(o),w,I,$,V);return V.delete(i),at;case Jn:if(oo)return oo.call(i)==oo.call(o)}return!1}function jb(i,o,d,w,I,$){var V=d&h,K=gc(i),Q=K.length,st=gc(o),at=st.length;if(Q!=at&&!V)return!1;for(var ct=Q;ct--;){var pt=K[ct];if(!(V?pt in o:ee.call(o,pt)))return!1}var bt=$.get(i),Ot=$.get(o);if(bt&&Ot)return bt==o&&Ot==i;var Ht=!0;$.set(i,o),$.set(o,i);for(var _t=V;++ct<Q;){pt=K[ct];var zt=i[pt],Jt=o[pt];if(w)var Ke=V?w(Jt,zt,pt,o,i,$):w(zt,Jt,pt,i,o,$);if(!(Ke===s?zt===Jt||I(zt,Jt,d,w,$):Ke)){Ht=!1;break}_t||(_t=pt=="constructor")}if(Ht&&!_t){var Be=i.constructor,qe=o.constructor;Be!=qe&&"constructor"in i&&"constructor"in o&&!(typeof Be=="function"&&Be instanceof Be&&typeof qe=="function"&&qe instanceof qe)&&(Ht=!1)}return $.delete(i),$.delete(o),Ht}function Nn(i){return Cc(Th(i,s,Rh),i+"")}function gc(i){return Bf(i,_e,Ec)}function vc(i){return Bf(i,Ue,yh)}var yc=Gs?function(i){return Gs.get(i)}:Bc;function na(i){for(var o=i.name+"",d=vr[o],w=ee.call(vr,o)?d.length:0;w--;){var I=d[w],$=I.func;if($==null||$==i)return I.name}return o}function Ar(i){var o=ee.call(F,"placeholder")?F:i;return o.placeholder}function St(){var i=F.iteratee||Nc;return i=i===Nc?Uf:i,arguments.length?i(arguments[0],arguments[1]):i}function ia(i,o){var d=i.__data__;return tE(o)?d[typeof o=="string"?"string":"hash"]:d.map}function bc(i){for(var o=_e(i),d=o.length;d--;){var w=o[d],I=i[w];o[d]=[w,I,Ah(I)]}return o}function Ai(i,o){var d=i0(i,o);return $f(d)?d:s}function Jb(i){var o=ee.call(i,gi),d=i[gi];try{i[gi]=s;var w=!0}catch($){}var I=Ds.call(i);return w&&(o?i[gi]=d:delete i[gi]),I}var Ec=Jl?function(i){return i==null?[]:(i=ie(i),Kn(Jl(i),function(o){return Cf.call(i,o)}))}:kc,yh=Jl?function(i){for(var o=[];i;)qn(o,Ec(i)),i=Bs(i);return o}:kc,De=Ne;(Kl&&De(new Kl(new ArrayBuffer(1)))!=ot||no&&De(new no)!=ht||ql&&De(ql.resolve())!=me||gr&&De(new gr)!=ue||io&&De(new io)!=pi)&&(De=function(i){var o=Ne(i),d=o==se?i.constructor:s,w=d?wi(d):"";if(w)switch(w){case P0:return ot;case I0:return ht;case M0:return me;case R0:return ue;case L0:return pi}return o});function Kb(i,o,d){for(var w=-1,I=d.length;++w<I;){var $=d[w],V=$.size;switch($.type){case"drop":i+=V;break;case"dropRight":o-=V;break;case"take":o=Le(o,i+V);break;case"takeRight":i=we(i,o-V);break}}return{start:i,end:o}}function qb(i){var o=i.match(ey);return o?o[1].split(ny):[]}function bh(i,o,d){o=ei(o,i);for(var w=-1,I=o.length,$=!1;++w<I;){var V=Sn(o[w]);if(!($=i!=null&&d(i,V)))break;i=i[V]}return $||++w!=I?$:(I=i==null?0:i.length,!!I&&ua(I)&&Fn(V,I)&&(Dt(i)||Ti(i)))}function Zb(i){var o=i.length,d=new i.constructor(o);return o&&typeof i[0]=="string"&&ee.call(i,"index")&&(d.index=i.index,d.input=i.input),d}function Eh(i){return typeof i.constructor=="function"&&!ho(i)?yr(Bs(i)):{}}function Yb(i,o,d){var w=i.constructor;switch(o){case q:return hc(i);case et:case ft:return new w(+i);case ot:return Db(i,d);case ut:case yt:case Ut:case Se:case In:case Cl:case Sl:case Ol:case _l:return nh(i,d);case ht:return new w;case Qt:case wn:return new w(i);case An:return Nb(i);case ue:return new w;case Jn:return Fb(i)}}function Qb(i,o){var d=o.length;if(!d)return i;var w=d-1;return o[w]=(d>1?"& ":"")+o[w],o=o.join(d>2?", ":" "),i.replace(ty,`{
/* [wrapped with `+o+`] */
`)}function Xb(i){return Dt(i)||Ti(i)||!!(Sf&&i&&i[Sf])}function Fn(i,o){var d=typeof i;return o=o==null?U:o,!!o&&(d=="number"||d!="symbol"&&dy.test(i))&&i>-1&&i%1==0&&i<o}function Fe(i,o,d){if(!de(d))return!1;var w=typeof o;return(w=="number"?$e(d)&&Fn(o,d.length):w=="string"&&o in d)?pn(d[o],i):!1}function Ac(i,o){if(Dt(i))return!1;var d=typeof i;return d=="number"||d=="symbol"||d=="boolean"||i==null||Je(i)?!0:Zv.test(i)||!qv.test(i)||o!=null&&i in ie(o)}function tE(i){var o=typeof i;return o=="string"||o=="number"||o=="symbol"||o=="boolean"?i!=="__proto__":i===null}function wc(i){var o=na(i),d=F[o];if(typeof d!="function"||!(o in jt.prototype))return!1;if(i===d)return!0;var w=yc(d);return!!w&&i===w[0]}function eE(i){return!!Af&&Af in i}var nE=Rs?Bn:$c;function ho(i){var o=i&&i.constructor,d=typeof o=="function"&&o.prototype||mr;return i===d}function Ah(i){return i===i&&!de(i)}function wh(i,o){return function(d){return d==null?!1:d[i]===o&&(o!==s||i in ie(d))}}function iE(i){var o=la(i,function(w){return d.size===c&&d.clear(),w}),d=o.cache;return o}function rE(i,o){var d=i[1],w=o[1],I=d|w,$=I<(O|_|f),V=w==f&&d==T||w==f&&d==p&&i[7].length<=o[8]||w==(f|p)&&o[7].length<=o[8]&&d==T;if(!($||V))return i;w&O&&(i[2]=o[2],I|=d&O?0:C);var K=o[3];if(K){var Q=i[3];i[3]=Q?rh(Q,K,o[4]):K,i[4]=Q?Zn(i[3],u):o[4]}return K=o[5],K&&(Q=i[5],i[5]=Q?oh(Q,K,o[6]):K,i[6]=Q?Zn(i[5],u):o[6]),K=o[7],K&&(i[7]=K),w&f&&(i[8]=i[8]==null?o[8]:Le(i[8],o[8])),i[9]==null&&(i[9]=o[9]),i[0]=o[0],i[1]=I,i}function oE(i){var o=[];if(i!=null)for(var d in ie(i))o.push(d);return o}function sE(i){return Ds.call(i)}function Th(i,o,d){return o=we(o===s?i.length-1:o,0),function(){for(var w=arguments,I=-1,$=we(w.length-o,0),V=nt($);++I<$;)V[I]=w[o+I];I=-1;for(var K=nt(o+1);++I<o;)K[I]=w[I];return K[o]=d(V),ze(i,this,K)}}function Ch(i,o){return o.length<2?i:Ei(i,rn(o,0,-1))}function aE(i,o){for(var d=i.length,w=Le(o.length,d),I=ke(i);w--;){var $=o[w];i[w]=Fn($,d)?I[$]:s}return i}function Tc(i,o){if(!(o==="constructor"&&typeof i[o]=="function")&&o!="__proto__")return i[o]}var Sh=_h(Kf),po=w0||function(i,o){return Oe.setTimeout(i,o)},Cc=_h(Ib);function Oh(i,o,d){var w=o+"";return Cc(i,Qb(w,lE(qb(w),d)))}function _h(i){var o=0,d=0;return function(){var w=O0(),I=z-(w-d);if(d=w,I>0){if(++o>=B)return arguments[0]}else o=0;return i.apply(s,arguments)}}function ra(i,o){var d=-1,w=i.length,I=w-1;for(o=o===s?w:o;++d<o;){var $=sc(d,I),V=i[$];i[$]=i[d],i[d]=V}return i.length=o,i}var xh=iE(function(i){var o=[];return i.charCodeAt(0)===46&&o.push(""),i.replace(Yv,function(d,w,I,$){o.push(I?$.replace(oy,"$1"):w||d)}),o});function Sn(i){if(typeof i=="string"||Je(i))return i;var o=i+"";return o=="0"&&1/i==-D?"-0":o}function wi(i){if(i!=null){try{return Ls.call(i)}catch(o){}try{return i+""}catch(o){}}return""}function lE(i,o){return Xe(R,function(d){var w="_."+d[0];o&d[1]&&!xs(i,w)&&i.push(w)}),i.sort()}function Ph(i){if(i instanceof jt)return i.clone();var o=new en(i.__wrapped__,i.__chain__);return o.__actions__=ke(i.__actions__),o.__index__=i.__index__,o.__values__=i.__values__,o}function cE(i,o,d){(d?Fe(i,o,d):o===s)?o=1:o=we(Bt(o),0);var w=i==null?0:i.length;if(!w||o<1)return[];for(var I=0,$=0,V=nt(Us(w/o));I<w;)V[$++]=rn(i,I,I+=o);return V}function uE(i){for(var o=-1,d=i==null?0:i.length,w=0,I=[];++o<d;){var $=i[o];$&&(I[w++]=$)}return I}function dE(){var i=arguments.length;if(!i)return[];for(var o=nt(i-1),d=arguments[0],w=i;w--;)o[w-1]=arguments[w];return qn(Dt(d)?ke(d):[d],Re(o,1))}var fE=Wt(function(i,o){return ve(i)?ao(i,Re(o,1,ve,!0)):[]}),hE=Wt(function(i,o){var d=on(o);return ve(d)&&(d=s),ve(i)?ao(i,Re(o,1,ve,!0),St(d,2)):[]}),pE=Wt(function(i,o){var d=on(o);return ve(d)&&(d=s),ve(i)?ao(i,Re(o,1,ve,!0),s,d):[]});function mE(i,o,d){var w=i==null?0:i.length;return w?(o=d||o===s?1:Bt(o),rn(i,o<0?0:o,w)):[]}function gE(i,o,d){var w=i==null?0:i.length;return w?(o=d||o===s?1:Bt(o),o=w-o,rn(i,0,o<0?0:o)):[]}function vE(i,o){return i&&i.length?Zs(i,St(o,3),!0,!0):[]}function yE(i,o){return i&&i.length?Zs(i,St(o,3),!0):[]}function bE(i,o,d,w){var I=i==null?0:i.length;return I?(d&&typeof d!="number"&&Fe(i,o,d)&&(d=0,w=I),db(i,o,d,w)):[]}function Ih(i,o,d){var w=i==null?0:i.length;if(!w)return-1;var I=d==null?0:Bt(d);return I<0&&(I=we(w+I,0)),Ps(i,St(o,3),I)}function Mh(i,o,d){var w=i==null?0:i.length;if(!w)return-1;var I=w-1;return d!==s&&(I=Bt(d),I=d<0?we(w+I,0):Le(I,w-1)),Ps(i,St(o,3),I,!0)}function Rh(i){var o=i==null?0:i.length;return o?Re(i,1):[]}function EE(i){var o=i==null?0:i.length;return o?Re(i,D):[]}function AE(i,o){var d=i==null?0:i.length;return d?(o=o===s?1:Bt(o),Re(i,o)):[]}function wE(i){for(var o=-1,d=i==null?0:i.length,w={};++o<d;){var I=i[o];w[I[0]]=I[1]}return w}function Lh(i){return i&&i.length?i[0]:s}function TE(i,o,d){var w=i==null?0:i.length;if(!w)return-1;var I=d==null?0:Bt(d);return I<0&&(I=we(w+I,0)),fr(i,o,I)}function CE(i){var o=i==null?0:i.length;return o?rn(i,0,-1):[]}var SE=Wt(function(i){var o=le(i,dc);return o.length&&o[0]===i[0]?ec(o):[]}),OE=Wt(function(i){var o=on(i),d=le(i,dc);return o===on(d)?o=s:d.pop(),d.length&&d[0]===i[0]?ec(d,St(o,2)):[]}),_E=Wt(function(i){var o=on(i),d=le(i,dc);return o=typeof o=="function"?o:s,o&&d.pop(),d.length&&d[0]===i[0]?ec(d,s,o):[]});function xE(i,o){return i==null?"":C0.call(i,o)}function on(i){var o=i==null?0:i.length;return o?i[o-1]:s}function PE(i,o,d){var w=i==null?0:i.length;if(!w)return-1;var I=w;return d!==s&&(I=Bt(d),I=I<0?we(w+I,0):Le(I,w-1)),o===o?l0(i,o,I):Ps(i,hf,I,!0)}function IE(i,o){return i&&i.length?zf(i,Bt(o)):s}var ME=Wt(Dh);function Dh(i,o){return i&&i.length&&o&&o.length?oc(i,o):i}function RE(i,o,d){return i&&i.length&&o&&o.length?oc(i,o,St(d,2)):i}function LE(i,o,d){return i&&i.length&&o&&o.length?oc(i,o,s,d):i}var DE=Nn(function(i,o){var d=i==null?0:i.length,w=Yl(i,o);return Jf(i,le(o,function(I){return Fn(I,d)?+I:I}).sort(ih)),w});function NE(i,o){var d=[];if(!(i&&i.length))return d;var w=-1,I=[],$=i.length;for(o=St(o,3);++w<$;){var V=i[w];o(V,w,i)&&(d.push(V),I.push(w))}return Jf(i,I),d}function Sc(i){return i==null?i:x0.call(i)}function FE(i,o,d){var w=i==null?0:i.length;return w?(d&&typeof d!="number"&&Fe(i,o,d)?(o=0,d=w):(o=o==null?0:Bt(o),d=d===s?w:Bt(d)),rn(i,o,d)):[]}function BE(i,o){return qs(i,o)}function kE(i,o,d){return lc(i,o,St(d,2))}function $E(i,o){var d=i==null?0:i.length;if(d){var w=qs(i,o);if(w<d&&pn(i[w],o))return w}return-1}function UE(i,o){return qs(i,o,!0)}function HE(i,o,d){return lc(i,o,St(d,2),!0)}function GE(i,o){var d=i==null?0:i.length;if(d){var w=qs(i,o,!0)-1;if(pn(i[w],o))return w}return-1}function WE(i){return i&&i.length?qf(i):[]}function zE(i,o){return i&&i.length?qf(i,St(o,2)):[]}function VE(i){var o=i==null?0:i.length;return o?rn(i,1,o):[]}function jE(i,o,d){return i&&i.length?(o=d||o===s?1:Bt(o),rn(i,0,o<0?0:o)):[]}function JE(i,o,d){var w=i==null?0:i.length;return w?(o=d||o===s?1:Bt(o),o=w-o,rn(i,o<0?0:o,w)):[]}function KE(i,o){return i&&i.length?Zs(i,St(o,3),!1,!0):[]}function qE(i,o){return i&&i.length?Zs(i,St(o,3)):[]}var ZE=Wt(function(i){return ti(Re(i,1,ve,!0))}),YE=Wt(function(i){var o=on(i);return ve(o)&&(o=s),ti(Re(i,1,ve,!0),St(o,2))}),QE=Wt(function(i){var o=on(i);return o=typeof o=="function"?o:s,ti(Re(i,1,ve,!0),s,o)});function XE(i){return i&&i.length?ti(i):[]}function tA(i,o){return i&&i.length?ti(i,St(o,2)):[]}function eA(i,o){return o=typeof o=="function"?o:s,i&&i.length?ti(i,s,o):[]}function Oc(i){if(!(i&&i.length))return[];var o=0;return i=Kn(i,function(d){if(ve(d))return o=we(d.length,o),!0}),Wl(o,function(d){return le(i,Ul(d))})}function Nh(i,o){if(!(i&&i.length))return[];var d=Oc(i);return o==null?d:le(d,function(w){return ze(o,s,w)})}var nA=Wt(function(i,o){return ve(i)?ao(i,o):[]}),iA=Wt(function(i){return uc(Kn(i,ve))}),rA=Wt(function(i){var o=on(i);return ve(o)&&(o=s),uc(Kn(i,ve),St(o,2))}),oA=Wt(function(i){var o=on(i);return o=typeof o=="function"?o:s,uc(Kn(i,ve),s,o)}),sA=Wt(Oc);function aA(i,o){return Xf(i||[],o||[],so)}function lA(i,o){return Xf(i||[],o||[],uo)}var cA=Wt(function(i){var o=i.length,d=o>1?i[o-1]:s;return d=typeof d=="function"?(i.pop(),d):s,Nh(i,d)});function Fh(i){var o=F(i);return o.__chain__=!0,o}function uA(i,o){return o(i),i}function oa(i,o){return o(i)}var dA=Nn(function(i){var o=i.length,d=o?i[0]:0,w=this.__wrapped__,I=function($){return Yl($,i)};return o>1||this.__actions__.length||!(w instanceof jt)||!Fn(d)?this.thru(I):(w=w.slice(d,+d+(o?1:0)),w.__actions__.push({func:oa,args:[I],thisArg:s}),new en(w,this.__chain__).thru(function($){return o&&!$.length&&$.push(s),$}))});function fA(){return Fh(this)}function hA(){return new en(this.value(),this.__chain__)}function pA(){this.__values__===s&&(this.__values__=Zh(this.value()));var i=this.__index__>=this.__values__.length,o=i?s:this.__values__[this.__index__++];return{done:i,value:o}}function mA(){return this}function gA(i){for(var o,d=this;d instanceof zs;){var w=Ph(d);w.__index__=0,w.__values__=s,o?I.__wrapped__=w:o=w;var I=w;d=d.__wrapped__}return I.__wrapped__=i,o}function vA(){var i=this.__wrapped__;if(i instanceof jt){var o=i;return this.__actions__.length&&(o=new jt(this)),o=o.reverse(),o.__actions__.push({func:oa,args:[Sc],thisArg:s}),new en(o,this.__chain__)}return this.thru(Sc)}function yA(){return Qf(this.__wrapped__,this.__actions__)}var bA=Ys(function(i,o,d){ee.call(i,d)?++i[d]:Ln(i,d,1)});function EA(i,o,d){var w=Dt(i)?df:ub;return d&&Fe(i,o,d)&&(o=s),w(i,St(o,3))}function AA(i,o){var d=Dt(i)?Kn:Nf;return d(i,St(o,3))}var wA=ch(Ih),TA=ch(Mh);function CA(i,o){return Re(sa(i,o),1)}function SA(i,o){return Re(sa(i,o),D)}function OA(i,o,d){return d=d===s?1:Bt(d),Re(sa(i,o),d)}function Bh(i,o){var d=Dt(i)?Xe:Xn;return d(i,St(o,3))}function kh(i,o){var d=Dt(i)?Vy:Df;return d(i,St(o,3))}var _A=Ys(function(i,o,d){ee.call(i,d)?i[d].push(o):Ln(i,d,[o])});function xA(i,o,d,w){i=$e(i)?i:Tr(i),d=d&&!w?Bt(d):0;var I=i.length;return d<0&&(d=we(I+d,0)),da(i)?d<=I&&i.indexOf(o,d)>-1:!!I&&fr(i,o,d)>-1}var PA=Wt(function(i,o,d){var w=-1,I=typeof o=="function",$=$e(i)?nt(i.length):[];return Xn(i,function(V){$[++w]=I?ze(o,V,d):lo(V,o,d)}),$}),IA=Ys(function(i,o,d){Ln(i,d,o)});function sa(i,o){var d=Dt(i)?le:Hf;return d(i,St(o,3))}function MA(i,o,d,w){return i==null?[]:(Dt(o)||(o=o==null?[]:[o]),d=w?s:d,Dt(d)||(d=d==null?[]:[d]),Vf(i,o,d))}var RA=Ys(function(i,o,d){i[d?0:1].push(o)},function(){return[[],[]]});function LA(i,o,d){var w=Dt(i)?kl:mf,I=arguments.length<3;return w(i,St(o,4),d,I,Xn)}function DA(i,o,d){var w=Dt(i)?jy:mf,I=arguments.length<3;return w(i,St(o,4),d,I,Df)}function NA(i,o){var d=Dt(i)?Kn:Nf;return d(i,ca(St(o,3)))}function FA(i){var o=Dt(i)?If:xb;return o(i)}function BA(i,o,d){(d?Fe(i,o,d):o===s)?o=1:o=Bt(o);var w=Dt(i)?ob:Pb;return w(i,o)}function kA(i){var o=Dt(i)?sb:Mb;return o(i)}function $A(i){if(i==null)return 0;if($e(i))return da(i)?pr(i):i.length;var o=De(i);return o==ht||o==ue?i.size:ic(i).length}function UA(i,o,d){var w=Dt(i)?$l:Rb;return d&&Fe(i,o,d)&&(o=s),w(i,St(o,3))}var HA=Wt(function(i,o){if(i==null)return[];var d=o.length;return d>1&&Fe(i,o[0],o[1])?o=[]:d>2&&Fe(o[0],o[1],o[2])&&(o=[o[0]]),Vf(i,Re(o,1),[])}),aa=A0||function(){return Oe.Date.now()};function GA(i,o){if(typeof o!="function")throw new tn(r);return i=Bt(i),function(){if(--i<1)return o.apply(this,arguments)}}function $h(i,o,d){return o=d?s:o,o=i&&o==null?i.length:o,Dn(i,f,s,s,s,s,o)}function Uh(i,o){var d;if(typeof o!="function")throw new tn(r);return i=Bt(i),function(){return--i>0&&(d=o.apply(this,arguments)),i<=1&&(o=s),d}}var _c=Wt(function(i,o,d){var w=O;if(d.length){var I=Zn(d,Ar(_c));w|=v}return Dn(i,w,o,d,I)}),Hh=Wt(function(i,o,d){var w=O|_;if(d.length){var I=Zn(d,Ar(Hh));w|=v}return Dn(o,w,i,d,I)});function Gh(i,o,d){o=d?s:o;var w=Dn(i,T,s,s,s,s,s,o);return w.placeholder=Gh.placeholder,w}function Wh(i,o,d){o=d?s:o;var w=Dn(i,x,s,s,s,s,s,o);return w.placeholder=Wh.placeholder,w}function zh(i,o,d){var w,I,$,V,K,Q,st=0,at=!1,ct=!1,pt=!0;if(typeof i!="function")throw new tn(r);o=sn(o)||0,de(d)&&(at=!!d.leading,ct="maxWait"in d,$=ct?we(sn(d.maxWait)||0,o):$,pt="trailing"in d?!!d.trailing:pt);function bt(ye){var mn=w,$n=I;return w=I=s,st=ye,V=i.apply($n,mn),V}function Ot(ye){return st=ye,K=po(zt,o),at?bt(ye):V}function Ht(ye){var mn=ye-Q,$n=ye-st,cp=o-mn;return ct?Le(cp,$-$n):cp}function _t(ye){var mn=ye-Q,$n=ye-st;return Q===s||mn>=o||mn<0||ct&&$n>=$}function zt(){var ye=aa();if(_t(ye))return Jt(ye);K=po(zt,Ht(ye))}function Jt(ye){return K=s,pt&&w?bt(ye):(w=I=s,V)}function Ke(){K!==s&&th(K),st=0,w=Q=I=K=s}function Be(){return K===s?V:Jt(aa())}function qe(){var ye=aa(),mn=_t(ye);if(w=arguments,I=this,Q=ye,mn){if(K===s)return Ot(Q);if(ct)return th(K),K=po(zt,o),bt(Q)}return K===s&&(K=po(zt,o)),V}return qe.cancel=Ke,qe.flush=Be,qe}var WA=Wt(function(i,o){return Lf(i,1,o)}),zA=Wt(function(i,o,d){return Lf(i,sn(o)||0,d)});function VA(i){return Dn(i,S)}function la(i,o){if(typeof i!="function"||o!=null&&typeof o!="function")throw new tn(r);var d=function(){var w=arguments,I=o?o.apply(this,w):w[0],$=d.cache;if($.has(I))return $.get(I);var V=i.apply(this,w);return d.cache=$.set(I,V)||$,V};return d.cache=new(la.Cache||Rn),d}la.Cache=Rn;function ca(i){if(typeof i!="function")throw new tn(r);return function(){var o=arguments;switch(o.length){case 0:return!i.call(this);case 1:return!i.call(this,o[0]);case 2:return!i.call(this,o[0],o[1]);case 3:return!i.call(this,o[0],o[1],o[2])}return!i.apply(this,o)}}function jA(i){return Uh(2,i)}var JA=Lb(function(i,o){o=o.length==1&&Dt(o[0])?le(o[0],Ve(St())):le(Re(o,1),Ve(St()));var d=o.length;return Wt(function(w){for(var I=-1,$=Le(w.length,d);++I<$;)w[I]=o[I].call(this,w[I]);return ze(i,this,w)})}),xc=Wt(function(i,o){var d=Zn(o,Ar(xc));return Dn(i,v,s,o,d)}),Vh=Wt(function(i,o){var d=Zn(o,Ar(Vh));return Dn(i,A,s,o,d)}),KA=Nn(function(i,o){return Dn(i,p,s,s,s,o)});function qA(i,o){if(typeof i!="function")throw new tn(r);return o=o===s?o:Bt(o),Wt(i,o)}function ZA(i,o){if(typeof i!="function")throw new tn(r);return o=o==null?0:we(Bt(o),0),Wt(function(d){var w=d[o],I=ni(d,0,o);return w&&qn(I,w),ze(i,this,I)})}function YA(i,o,d){var w=!0,I=!0;if(typeof i!="function")throw new tn(r);return de(d)&&(w="leading"in d?!!d.leading:w,I="trailing"in d?!!d.trailing:I),zh(i,o,{leading:w,maxWait:o,trailing:I})}function QA(i){return $h(i,1)}function XA(i,o){return xc(fc(o),i)}function tw(){if(!arguments.length)return[];var i=arguments[0];return Dt(i)?i:[i]}function ew(i){return nn(i,E)}function nw(i,o){return o=typeof o=="function"?o:s,nn(i,E,o)}function iw(i){return nn(i,m|E)}function rw(i,o){return o=typeof o=="function"?o:s,nn(i,m|E,o)}function ow(i,o){return o==null||Rf(i,o,_e(o))}function pn(i,o){return i===o||i!==i&&o!==o}var sw=ea(tc),aw=ea(function(i,o){return i>=o}),Ti=kf(function(){return arguments}())?kf:function(i){return ge(i)&&ee.call(i,"callee")&&!Cf.call(i,"callee")},Dt=nt.isArray,lw=of?Ve(of):gb;function $e(i){return i!=null&&ua(i.length)&&!Bn(i)}function ve(i){return ge(i)&&$e(i)}function cw(i){return i===!0||i===!1||ge(i)&&Ne(i)==et}var ii=T0||$c,uw=sf?Ve(sf):vb;function dw(i){return ge(i)&&i.nodeType===1&&!mo(i)}function fw(i){if(i==null)return!0;if($e(i)&&(Dt(i)||typeof i=="string"||typeof i.splice=="function"||ii(i)||wr(i)||Ti(i)))return!i.length;var o=De(i);if(o==ht||o==ue)return!i.size;if(ho(i))return!ic(i).length;for(var d in i)if(ee.call(i,d))return!1;return!0}function hw(i,o){return co(i,o)}function pw(i,o,d){d=typeof d=="function"?d:s;var w=d?d(i,o):s;return w===s?co(i,o,s,d):!!w}function Pc(i){if(!ge(i))return!1;var o=Ne(i);return o==Et||o==gt||typeof i.message=="string"&&typeof i.name=="string"&&!mo(i)}function mw(i){return typeof i=="number"&&Of(i)}function Bn(i){if(!de(i))return!1;var o=Ne(i);return o==Ct||o==Vt||o==j||o==dn}function jh(i){return typeof i=="number"&&i==Bt(i)}function ua(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=U}function de(i){var o=typeof i;return i!=null&&(o=="object"||o=="function")}function ge(i){return i!=null&&typeof i=="object"}var Jh=af?Ve(af):bb;function gw(i,o){return i===o||nc(i,o,bc(o))}function vw(i,o,d){return d=typeof d=="function"?d:s,nc(i,o,bc(o),d)}function yw(i){return Kh(i)&&i!=+i}function bw(i){if(nE(i))throw new Rt(n);return $f(i)}function Ew(i){return i===null}function Aw(i){return i==null}function Kh(i){return typeof i=="number"||ge(i)&&Ne(i)==Qt}function mo(i){if(!ge(i)||Ne(i)!=se)return!1;var o=Bs(i);if(o===null)return!0;var d=ee.call(o,"constructor")&&o.constructor;return typeof d=="function"&&d instanceof d&&Ls.call(d)==v0}var Ic=lf?Ve(lf):Eb;function ww(i){return jh(i)&&i>=-U&&i<=U}var qh=cf?Ve(cf):Ab;function da(i){return typeof i=="string"||!Dt(i)&&ge(i)&&Ne(i)==wn}function Je(i){return typeof i=="symbol"||ge(i)&&Ne(i)==Jn}var wr=uf?Ve(uf):wb;function Tw(i){return i===s}function Cw(i){return ge(i)&&De(i)==pi}function Sw(i){return ge(i)&&Ne(i)==Tl}var Ow=ea(rc),_w=ea(function(i,o){return i<=o});function Zh(i){if(!i)return[];if($e(i))return da(i)?fn(i):ke(i);if(eo&&i[eo])return o0(i[eo]());var o=De(i),d=o==ht?Vl:o==ue?Is:Tr;return d(i)}function kn(i){if(!i)return i===0?i:0;if(i=sn(i),i===D||i===-D){var o=i<0?-1:1;return o*G}return i===i?i:0}function Bt(i){var o=kn(i),d=o%1;return o===o?d?o-d:o:0}function Yh(i){return i?bi(Bt(i),0,tt):0}function sn(i){if(typeof i=="number")return i;if(Je(i))return J;if(de(i)){var o=typeof i.valueOf=="function"?i.valueOf():i;i=de(o)?o+"":o}if(typeof i!="string")return i===0?i:+i;i=gf(i);var d=ly.test(i);return d||uy.test(i)?Gy(i.slice(2),d?2:8):ay.test(i)?J:+i}function Qh(i){return Cn(i,Ue(i))}function xw(i){return i?bi(Bt(i),-U,U):i===0?i:0}function Xt(i){return i==null?"":je(i)}var Pw=br(function(i,o){if(ho(o)||$e(o)){Cn(o,_e(o),i);return}for(var d in o)ee.call(o,d)&&so(i,d,o[d])}),Xh=br(function(i,o){Cn(o,Ue(o),i)}),fa=br(function(i,o,d,w){Cn(o,Ue(o),i,w)}),Iw=br(function(i,o,d,w){Cn(o,_e(o),i,w)}),Mw=Nn(Yl);function Rw(i,o){var d=yr(i);return o==null?d:Mf(d,o)}var Lw=Wt(function(i,o){i=ie(i);var d=-1,w=o.length,I=w>2?o[2]:s;for(I&&Fe(o[0],o[1],I)&&(w=1);++d<w;)for(var $=o[d],V=Ue($),K=-1,Q=V.length;++K<Q;){var st=V[K],at=i[st];(at===s||pn(at,mr[st])&&!ee.call(i,st))&&(i[st]=$[st])}return i}),Dw=Wt(function(i){return i.push(s,gh),ze(tp,s,i)});function Nw(i,o){return ff(i,St(o,3),Tn)}function Fw(i,o){return ff(i,St(o,3),Xl)}function Bw(i,o){return i==null?i:Ql(i,St(o,3),Ue)}function kw(i,o){return i==null?i:Ff(i,St(o,3),Ue)}function $w(i,o){return i&&Tn(i,St(o,3))}function Uw(i,o){return i&&Xl(i,St(o,3))}function Hw(i){return i==null?[]:Js(i,_e(i))}function Gw(i){return i==null?[]:Js(i,Ue(i))}function Mc(i,o,d){var w=i==null?s:Ei(i,o);return w===s?d:w}function Ww(i,o){return i!=null&&bh(i,o,fb)}function Rc(i,o){return i!=null&&bh(i,o,hb)}var zw=dh(function(i,o,d){o!=null&&typeof o.toString!="function"&&(o=Ds.call(o)),i[o]=d},Dc(He)),Vw=dh(function(i,o,d){o!=null&&typeof o.toString!="function"&&(o=Ds.call(o)),ee.call(i,o)?i[o].push(d):i[o]=[d]},St),jw=Wt(lo);function _e(i){return $e(i)?Pf(i):ic(i)}function Ue(i){return $e(i)?Pf(i,!0):Tb(i)}function Jw(i,o){var d={};return o=St(o,3),Tn(i,function(w,I,$){Ln(d,o(w,I,$),w)}),d}function Kw(i,o){var d={};return o=St(o,3),Tn(i,function(w,I,$){Ln(d,I,o(w,I,$))}),d}var qw=br(function(i,o,d){Ks(i,o,d)}),tp=br(function(i,o,d,w){Ks(i,o,d,w)}),Zw=Nn(function(i,o){var d={};if(i==null)return d;var w=!1;o=le(o,function($){return $=ei($,i),w||(w=$.length>1),$}),Cn(i,vc(i),d),w&&(d=nn(d,m|g|E,zb));for(var I=o.length;I--;)cc(d,o[I]);return d});function Yw(i,o){return ep(i,ca(St(o)))}var Qw=Nn(function(i,o){return i==null?{}:Sb(i,o)});function ep(i,o){if(i==null)return{};var d=le(vc(i),function(w){return[w]});return o=St(o),jf(i,d,function(w,I){return o(w,I[0])})}function Xw(i,o,d){o=ei(o,i);var w=-1,I=o.length;for(I||(I=1,i=s);++w<I;){var $=i==null?s:i[Sn(o[w])];$===s&&(w=I,$=d),i=Bn($)?$.call(i):$}return i}function tT(i,o,d){return i==null?i:uo(i,o,d)}function eT(i,o,d,w){return w=typeof w=="function"?w:s,i==null?i:uo(i,o,d,w)}var np=ph(_e),ip=ph(Ue);function nT(i,o,d){var w=Dt(i),I=w||ii(i)||wr(i);if(o=St(o,4),d==null){var $=i&&i.constructor;I?d=w?new $:[]:de(i)?d=Bn($)?yr(Bs(i)):{}:d={}}return(I?Xe:Tn)(i,function(V,K,Q){return o(d,V,K,Q)}),d}function iT(i,o){return i==null?!0:cc(i,o)}function rT(i,o,d){return i==null?i:Yf(i,o,fc(d))}function oT(i,o,d,w){return w=typeof w=="function"?w:s,i==null?i:Yf(i,o,fc(d),w)}function Tr(i){return i==null?[]:zl(i,_e(i))}function sT(i){return i==null?[]:zl(i,Ue(i))}function aT(i,o,d){return d===s&&(d=o,o=s),d!==s&&(d=sn(d),d=d===d?d:0),o!==s&&(o=sn(o),o=o===o?o:0),bi(sn(i),o,d)}function lT(i,o,d){return o=kn(o),d===s?(d=o,o=0):d=kn(d),i=sn(i),pb(i,o,d)}function cT(i,o,d){if(d&&typeof d!="boolean"&&Fe(i,o,d)&&(o=d=s),d===s&&(typeof o=="boolean"?(d=o,o=s):typeof i=="boolean"&&(d=i,i=s)),i===s&&o===s?(i=0,o=1):(i=kn(i),o===s?(o=i,i=0):o=kn(o)),i>o){var w=i;i=o,o=w}if(d||i%1||o%1){var I=_f();return Le(i+I*(o-i+Hy("1e-"+((I+"").length-1))),o)}return sc(i,o)}var uT=Er(function(i,o,d){return o=o.toLowerCase(),i+(d?rp(o):o)});function rp(i){return Lc(Xt(i).toLowerCase())}function op(i){return i=Xt(i),i&&i.replace(fy,t0).replace(My,"")}function dT(i,o,d){i=Xt(i),o=je(o);var w=i.length;d=d===s?w:bi(Bt(d),0,w);var I=d;return d-=o.length,d>=0&&i.slice(d,I)==o}function fT(i){return i=Xt(i),i&&jv.test(i)?i.replace(Nd,e0):i}function hT(i){return i=Xt(i),i&&Qv.test(i)?i.replace(xl,"\\$&"):i}var pT=Er(function(i,o,d){return i+(d?"-":"")+o.toLowerCase()}),mT=Er(function(i,o,d){return i+(d?" ":"")+o.toLowerCase()}),gT=lh("toLowerCase");function vT(i,o,d){i=Xt(i),o=Bt(o);var w=o?pr(i):0;if(!o||w>=o)return i;var I=(o-w)/2;return ta(Hs(I),d)+i+ta(Us(I),d)}function yT(i,o,d){i=Xt(i),o=Bt(o);var w=o?pr(i):0;return o&&w<o?i+ta(o-w,d):i}function bT(i,o,d){i=Xt(i),o=Bt(o);var w=o?pr(i):0;return o&&w<o?ta(o-w,d)+i:i}function ET(i,o,d){return d||o==null?o=0:o&&(o=+o),_0(Xt(i).replace(Pl,""),o||0)}function AT(i,o,d){return(d?Fe(i,o,d):o===s)?o=1:o=Bt(o),ac(Xt(i),o)}function wT(){var i=arguments,o=Xt(i[0]);return i.length<3?o:o.replace(i[1],i[2])}var TT=Er(function(i,o,d){return i+(d?"_":"")+o.toLowerCase()});function CT(i,o,d){return d&&typeof d!="number"&&Fe(i,o,d)&&(o=d=s),d=d===s?tt:d>>>0,d?(i=Xt(i),i&&(typeof o=="string"||o!=null&&!Ic(o))&&(o=je(o),!o&&hr(i))?ni(fn(i),0,d):i.split(o,d)):[]}var ST=Er(function(i,o,d){return i+(d?" ":"")+Lc(o)});function OT(i,o,d){return i=Xt(i),d=d==null?0:bi(Bt(d),0,i.length),o=je(o),i.slice(d,d+o.length)==o}function _T(i,o,d){var w=F.templateSettings;d&&Fe(i,o,d)&&(o=s),i=Xt(i),o=fa({},o,w,mh);var I=fa({},o.imports,w.imports,mh),$=_e(I),V=zl(I,$),K,Q,st=0,at=o.interpolate||Ss,ct="__p += '",pt=jl((o.escape||Ss).source+"|"+at.source+"|"+(at===Fd?sy:Ss).source+"|"+(o.evaluate||Ss).source+"|$","g"),bt="//# sourceURL="+(ee.call(o,"sourceURL")?(o.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Fy+"]")+`
`;i.replace(pt,function(_t,zt,Jt,Ke,Be,qe){return Jt||(Jt=Ke),ct+=i.slice(st,qe).replace(hy,n0),zt&&(K=!0,ct+=`' +
__e(`+zt+`) +
'`),Be&&(Q=!0,ct+=`';
`+Be+`;
__p += '`),Jt&&(ct+=`' +
((__t = (`+Jt+`)) == null ? '' : __t) +
'`),st=qe+_t.length,_t}),ct+=`';
`;var Ot=ee.call(o,"variable")&&o.variable;if(!Ot)ct=`with (obj) {
`+ct+`
}
`;else if(ry.test(Ot))throw new Rt(a);ct=(Q?ct.replace(Gv,""):ct).replace(Wv,"$1").replace(zv,"$1;"),ct="function("+(Ot||"obj")+`) {
`+(Ot?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(K?", __e = _.escape":"")+(Q?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ct+`return __p
}`;var Ht=ap(function(){return Zt($,bt+"return "+ct).apply(s,V)});if(Ht.source=ct,Pc(Ht))throw Ht;return Ht}function xT(i){return Xt(i).toLowerCase()}function PT(i){return Xt(i).toUpperCase()}function IT(i,o,d){if(i=Xt(i),i&&(d||o===s))return gf(i);if(!i||!(o=je(o)))return i;var w=fn(i),I=fn(o),$=vf(w,I),V=yf(w,I)+1;return ni(w,$,V).join("")}function MT(i,o,d){if(i=Xt(i),i&&(d||o===s))return i.slice(0,Ef(i)+1);if(!i||!(o=je(o)))return i;var w=fn(i),I=yf(w,fn(o))+1;return ni(w,0,I).join("")}function RT(i,o,d){if(i=Xt(i),i&&(d||o===s))return i.replace(Pl,"");if(!i||!(o=je(o)))return i;var w=fn(i),I=vf(w,fn(o));return ni(w,I).join("")}function LT(i,o){var d=b,w=P;if(de(o)){var I="separator"in o?o.separator:I;d="length"in o?Bt(o.length):d,w="omission"in o?je(o.omission):w}i=Xt(i);var $=i.length;if(hr(i)){var V=fn(i);$=V.length}if(d>=$)return i;var K=d-pr(w);if(K<1)return w;var Q=V?ni(V,0,K).join(""):i.slice(0,K);if(I===s)return Q+w;if(V&&(K+=Q.length-K),Ic(I)){if(i.slice(K).search(I)){var st,at=Q;for(I.global||(I=jl(I.source,Xt(Bd.exec(I))+"g")),I.lastIndex=0;st=I.exec(at);)var ct=st.index;Q=Q.slice(0,ct===s?K:ct)}}else if(i.indexOf(je(I),K)!=K){var pt=Q.lastIndexOf(I);pt>-1&&(Q=Q.slice(0,pt))}return Q+w}function DT(i){return i=Xt(i),i&&Vv.test(i)?i.replace(Dd,c0):i}var NT=Er(function(i,o,d){return i+(d?" ":"")+o.toUpperCase()}),Lc=lh("toUpperCase");function sp(i,o,d){return i=Xt(i),o=d?s:o,o===s?r0(i)?f0(i):qy(i):i.match(o)||[]}var ap=Wt(function(i,o){try{return ze(i,s,o)}catch(d){return Pc(d)?d:new Rt(d)}}),FT=Nn(function(i,o){return Xe(o,function(d){d=Sn(d),Ln(i,d,_c(i[d],i))}),i});function BT(i){var o=i==null?0:i.length,d=St();return i=o?le(i,function(w){if(typeof w[1]!="function")throw new tn(r);return[d(w[0]),w[1]]}):[],Wt(function(w){for(var I=-1;++I<o;){var $=i[I];if(ze($[0],this,w))return ze($[1],this,w)}})}function kT(i){return cb(nn(i,m))}function Dc(i){return function(){return i}}function $T(i,o){return i==null||i!==i?o:i}var UT=uh(),HT=uh(!0);function He(i){return i}function Nc(i){return Uf(typeof i=="function"?i:nn(i,m))}function GT(i){return Gf(nn(i,m))}function WT(i,o){return Wf(i,nn(o,m))}var zT=Wt(function(i,o){return function(d){return lo(d,i,o)}}),VT=Wt(function(i,o){return function(d){return lo(i,d,o)}});function Fc(i,o,d){var w=_e(o),I=Js(o,w);d==null&&!(de(o)&&(I.length||!w.length))&&(d=o,o=i,i=this,I=Js(o,_e(o)));var $=!(de(d)&&"chain"in d)||!!d.chain,V=Bn(i);return Xe(I,function(K){var Q=o[K];i[K]=Q,V&&(i.prototype[K]=function(){var st=this.__chain__;if($||st){var at=i(this.__wrapped__),ct=at.__actions__=ke(this.__actions__);return ct.push({func:Q,args:arguments,thisArg:i}),at.__chain__=st,at}return Q.apply(i,qn([this.value()],arguments))})}),i}function jT(){return Oe._===this&&(Oe._=y0),this}function Bc(){}function JT(i){return i=Bt(i),Wt(function(o){return zf(o,i)})}var KT=pc(le),qT=pc(df),ZT=pc($l);function lp(i){return Ac(i)?Ul(Sn(i)):Ob(i)}function YT(i){return function(o){return i==null?s:Ei(i,o)}}var QT=fh(),XT=fh(!0);function kc(){return[]}function $c(){return!1}function tC(){return{}}function eC(){return""}function nC(){return!0}function iC(i,o){if(i=Bt(i),i<1||i>U)return[];var d=tt,w=Le(i,tt);o=St(o),i-=tt;for(var I=Wl(w,o);++d<i;)o(d);return I}function rC(i){return Dt(i)?le(i,Sn):Je(i)?[i]:ke(xh(Xt(i)))}function oC(i){var o=++g0;return Xt(i)+o}var sC=Xs(function(i,o){return i+o},0),aC=mc("ceil"),lC=Xs(function(i,o){return i/o},1),cC=mc("floor");function uC(i){return i&&i.length?js(i,He,tc):s}function dC(i,o){return i&&i.length?js(i,St(o,2),tc):s}function fC(i){return pf(i,He)}function hC(i,o){return pf(i,St(o,2))}function pC(i){return i&&i.length?js(i,He,rc):s}function mC(i,o){return i&&i.length?js(i,St(o,2),rc):s}var gC=Xs(function(i,o){return i*o},1),vC=mc("round"),yC=Xs(function(i,o){return i-o},0);function bC(i){return i&&i.length?Gl(i,He):0}function EC(i,o){return i&&i.length?Gl(i,St(o,2)):0}return F.after=GA,F.ary=$h,F.assign=Pw,F.assignIn=Xh,F.assignInWith=fa,F.assignWith=Iw,F.at=Mw,F.before=Uh,F.bind=_c,F.bindAll=FT,F.bindKey=Hh,F.castArray=tw,F.chain=Fh,F.chunk=cE,F.compact=uE,F.concat=dE,F.cond=BT,F.conforms=kT,F.constant=Dc,F.countBy=bA,F.create=Rw,F.curry=Gh,F.curryRight=Wh,F.debounce=zh,F.defaults=Lw,F.defaultsDeep=Dw,F.defer=WA,F.delay=zA,F.difference=fE,F.differenceBy=hE,F.differenceWith=pE,F.drop=mE,F.dropRight=gE,F.dropRightWhile=vE,F.dropWhile=yE,F.fill=bE,F.filter=AA,F.flatMap=CA,F.flatMapDeep=SA,F.flatMapDepth=OA,F.flatten=Rh,F.flattenDeep=EE,F.flattenDepth=AE,F.flip=VA,F.flow=UT,F.flowRight=HT,F.fromPairs=wE,F.functions=Hw,F.functionsIn=Gw,F.groupBy=_A,F.initial=CE,F.intersection=SE,F.intersectionBy=OE,F.intersectionWith=_E,F.invert=zw,F.invertBy=Vw,F.invokeMap=PA,F.iteratee=Nc,F.keyBy=IA,F.keys=_e,F.keysIn=Ue,F.map=sa,F.mapKeys=Jw,F.mapValues=Kw,F.matches=GT,F.matchesProperty=WT,F.memoize=la,F.merge=qw,F.mergeWith=tp,F.method=zT,F.methodOf=VT,F.mixin=Fc,F.negate=ca,F.nthArg=JT,F.omit=Zw,F.omitBy=Yw,F.once=jA,F.orderBy=MA,F.over=KT,F.overArgs=JA,F.overEvery=qT,F.overSome=ZT,F.partial=xc,F.partialRight=Vh,F.partition=RA,F.pick=Qw,F.pickBy=ep,F.property=lp,F.propertyOf=YT,F.pull=ME,F.pullAll=Dh,F.pullAllBy=RE,F.pullAllWith=LE,F.pullAt=DE,F.range=QT,F.rangeRight=XT,F.rearg=KA,F.reject=NA,F.remove=NE,F.rest=qA,F.reverse=Sc,F.sampleSize=BA,F.set=tT,F.setWith=eT,F.shuffle=kA,F.slice=FE,F.sortBy=HA,F.sortedUniq=WE,F.sortedUniqBy=zE,F.split=CT,F.spread=ZA,F.tail=VE,F.take=jE,F.takeRight=JE,F.takeRightWhile=KE,F.takeWhile=qE,F.tap=uA,F.throttle=YA,F.thru=oa,F.toArray=Zh,F.toPairs=np,F.toPairsIn=ip,F.toPath=rC,F.toPlainObject=Qh,F.transform=nT,F.unary=QA,F.union=ZE,F.unionBy=YE,F.unionWith=QE,F.uniq=XE,F.uniqBy=tA,F.uniqWith=eA,F.unset=iT,F.unzip=Oc,F.unzipWith=Nh,F.update=rT,F.updateWith=oT,F.values=Tr,F.valuesIn=sT,F.without=nA,F.words=sp,F.wrap=XA,F.xor=iA,F.xorBy=rA,F.xorWith=oA,F.zip=sA,F.zipObject=aA,F.zipObjectDeep=lA,F.zipWith=cA,F.entries=np,F.entriesIn=ip,F.extend=Xh,F.extendWith=fa,Fc(F,F),F.add=sC,F.attempt=ap,F.camelCase=uT,F.capitalize=rp,F.ceil=aC,F.clamp=aT,F.clone=ew,F.cloneDeep=iw,F.cloneDeepWith=rw,F.cloneWith=nw,F.conformsTo=ow,F.deburr=op,F.defaultTo=$T,F.divide=lC,F.endsWith=dT,F.eq=pn,F.escape=fT,F.escapeRegExp=hT,F.every=EA,F.find=wA,F.findIndex=Ih,F.findKey=Nw,F.findLast=TA,F.findLastIndex=Mh,F.findLastKey=Fw,F.floor=cC,F.forEach=Bh,F.forEachRight=kh,F.forIn=Bw,F.forInRight=kw,F.forOwn=$w,F.forOwnRight=Uw,F.get=Mc,F.gt=sw,F.gte=aw,F.has=Ww,F.hasIn=Rc,F.head=Lh,F.identity=He,F.includes=xA,F.indexOf=TE,F.inRange=lT,F.invoke=jw,F.isArguments=Ti,F.isArray=Dt,F.isArrayBuffer=lw,F.isArrayLike=$e,F.isArrayLikeObject=ve,F.isBoolean=cw,F.isBuffer=ii,F.isDate=uw,F.isElement=dw,F.isEmpty=fw,F.isEqual=hw,F.isEqualWith=pw,F.isError=Pc,F.isFinite=mw,F.isFunction=Bn,F.isInteger=jh,F.isLength=ua,F.isMap=Jh,F.isMatch=gw,F.isMatchWith=vw,F.isNaN=yw,F.isNative=bw,F.isNil=Aw,F.isNull=Ew,F.isNumber=Kh,F.isObject=de,F.isObjectLike=ge,F.isPlainObject=mo,F.isRegExp=Ic,F.isSafeInteger=ww,F.isSet=qh,F.isString=da,F.isSymbol=Je,F.isTypedArray=wr,F.isUndefined=Tw,F.isWeakMap=Cw,F.isWeakSet=Sw,F.join=xE,F.kebabCase=pT,F.last=on,F.lastIndexOf=PE,F.lowerCase=mT,F.lowerFirst=gT,F.lt=Ow,F.lte=_w,F.max=uC,F.maxBy=dC,F.mean=fC,F.meanBy=hC,F.min=pC,F.minBy=mC,F.stubArray=kc,F.stubFalse=$c,F.stubObject=tC,F.stubString=eC,F.stubTrue=nC,F.multiply=gC,F.nth=IE,F.noConflict=jT,F.noop=Bc,F.now=aa,F.pad=vT,F.padEnd=yT,F.padStart=bT,F.parseInt=ET,F.random=cT,F.reduce=LA,F.reduceRight=DA,F.repeat=AT,F.replace=wT,F.result=Xw,F.round=vC,F.runInContext=Y,F.sample=FA,F.size=$A,F.snakeCase=TT,F.some=UA,F.sortedIndex=BE,F.sortedIndexBy=kE,F.sortedIndexOf=$E,F.sortedLastIndex=UE,F.sortedLastIndexBy=HE,F.sortedLastIndexOf=GE,F.startCase=ST,F.startsWith=OT,F.subtract=yC,F.sum=bC,F.sumBy=EC,F.template=_T,F.times=iC,F.toFinite=kn,F.toInteger=Bt,F.toLength=Yh,F.toLower=xT,F.toNumber=sn,F.toSafeInteger=xw,F.toString=Xt,F.toUpper=PT,F.trim=IT,F.trimEnd=MT,F.trimStart=RT,F.truncate=LT,F.unescape=DT,F.uniqueId=oC,F.upperCase=NT,F.upperFirst=Lc,F.each=Bh,F.eachRight=kh,F.first=Lh,Fc(F,function(){var i={};return Tn(F,function(o,d){ee.call(F.prototype,d)||(i[d]=o)}),i}(),{chain:!1}),F.VERSION=e,Xe(["bind","bindKey","curry","curryRight","partial","partialRight"],function(i){F[i].placeholder=F}),Xe(["drop","take"],function(i,o){jt.prototype[i]=function(d){d=d===s?1:we(Bt(d),0);var w=this.__filtered__&&!o?new jt(this):this.clone();return w.__filtered__?w.__takeCount__=Le(d,w.__takeCount__):w.__views__.push({size:Le(d,tt),type:i+(w.__dir__<0?"Right":"")}),w},jt.prototype[i+"Right"]=function(d){return this.reverse()[i](d).reverse()}}),Xe(["filter","map","takeWhile"],function(i,o){var d=o+1,w=d==W||d==M;jt.prototype[i]=function(I){var $=this.clone();return $.__iteratees__.push({iteratee:St(I,3),type:d}),$.__filtered__=$.__filtered__||w,$}}),Xe(["head","last"],function(i,o){var d="take"+(o?"Right":"");jt.prototype[i]=function(){return this[d](1).value()[0]}}),Xe(["initial","tail"],function(i,o){var d="drop"+(o?"":"Right");jt.prototype[i]=function(){return this.__filtered__?new jt(this):this[d](1)}}),jt.prototype.compact=function(){return this.filter(He)},jt.prototype.find=function(i){return this.filter(i).head()},jt.prototype.findLast=function(i){return this.reverse().find(i)},jt.prototype.invokeMap=Wt(function(i,o){return typeof i=="function"?new jt(this):this.map(function(d){return lo(d,i,o)})}),jt.prototype.reject=function(i){return this.filter(ca(St(i)))},jt.prototype.slice=function(i,o){i=Bt(i);var d=this;return d.__filtered__&&(i>0||o<0)?new jt(d):(i<0?d=d.takeRight(-i):i&&(d=d.drop(i)),o!==s&&(o=Bt(o),d=o<0?d.dropRight(-o):d.take(o-i)),d)},jt.prototype.takeRightWhile=function(i){return this.reverse().takeWhile(i).reverse()},jt.prototype.toArray=function(){return this.take(tt)},Tn(jt.prototype,function(i,o){var d=/^(?:filter|find|map|reject)|While$/.test(o),w=/^(?:head|last)$/.test(o),I=F[w?"take"+(o=="last"?"Right":""):o],$=w||/^find/.test(o);!I||(F.prototype[o]=function(){var V=this.__wrapped__,K=w?[1]:arguments,Q=V instanceof jt,st=K[0],at=Q||Dt(V),ct=function(zt){var Jt=I.apply(F,qn([zt],K));return w&&pt?Jt[0]:Jt};at&&d&&typeof st=="function"&&st.length!=1&&(Q=at=!1);var pt=this.__chain__,bt=!!this.__actions__.length,Ot=$&&!pt,Ht=Q&&!bt;if(!$&&at){V=Ht?V:new jt(this);var _t=i.apply(V,K);return _t.__actions__.push({func:oa,args:[ct],thisArg:s}),new en(_t,pt)}return Ot&&Ht?i.apply(this,K):(_t=this.thru(ct),Ot?w?_t.value()[0]:_t.value():_t)})}),Xe(["pop","push","shift","sort","splice","unshift"],function(i){var o=Ms[i],d=/^(?:push|sort|unshift)$/.test(i)?"tap":"thru",w=/^(?:pop|shift)$/.test(i);F.prototype[i]=function(){var I=arguments;if(w&&!this.__chain__){var $=this.value();return o.apply(Dt($)?$:[],I)}return this[d](function(V){return o.apply(Dt(V)?V:[],I)})}}),Tn(jt.prototype,function(i,o){var d=F[o];if(d){var w=d.name+"";ee.call(vr,w)||(vr[w]=[]),vr[w].push({name:o,func:d})}}),vr[Qs(s,_).name]=[{name:"wrapper",func:s}],jt.prototype.clone=D0,jt.prototype.reverse=N0,jt.prototype.value=F0,F.prototype.at=dA,F.prototype.chain=fA,F.prototype.commit=hA,F.prototype.next=pA,F.prototype.plant=gA,F.prototype.reverse=vA,F.prototype.toJSON=F.prototype.valueOf=F.prototype.value=yA,F.prototype.first=F.prototype.head,eo&&(F.prototype[eo]=mA),F},Yn=h0();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Oe._=Yn,define(function(){return Yn})):mi?((mi.exports=Yn)._=Yn,Nl._=Yn):Oe._=Yn}).call(xr)});var nm=be((Po,Qc)=>{L();(function(s,e){typeof Po=="object"&&typeof Qc=="object"?Qc.exports=e():typeof define=="function"&&define.amd?define([],e):typeof Po=="object"?Po.bowser=e():s.bowser=e()})(Po,function(){return function(s){var e={};function t(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return s[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=s,t.c=e,t.d=function(n,r,a){t.o(n,r)||Object.defineProperty(n,r,{enumerable:!0,get:a})},t.r=function(n){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,r){if(1&r&&(n=t(n)),8&r||4&r&&typeof n=="object"&&n&&n.__esModule)return n;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:n}),2&r&&typeof n!="string")for(var l in n)t.d(a,l,function(c){return n[c]}.bind(null,l));return a},t.n=function(n){var r=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(r,"a",r),r},t.o=function(n,r){return Object.prototype.hasOwnProperty.call(n,r)},t.p="",t(t.s=90)}({17:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var n=t(18),r=function(){function a(){}return a.getFirstMatch=function(l,c){var u=c.match(l);return u&&u.length>0&&u[1]||""},a.getSecondMatch=function(l,c){var u=c.match(l);return u&&u.length>1&&u[2]||""},a.matchAndReturnConst=function(l,c,u){if(l.test(c))return u},a.getWindowsVersionName=function(l){switch(l){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},a.getMacOSVersionName=function(l){var c=l.split(".").splice(0,2).map(function(u){return parseInt(u,10)||0});if(c.push(0),c[0]===10)switch(c[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},a.getAndroidVersionName=function(l){var c=l.split(".").splice(0,2).map(function(u){return parseInt(u,10)||0});if(c.push(0),!(c[0]===1&&c[1]<5))return c[0]===1&&c[1]<6?"Cupcake":c[0]===1&&c[1]>=6?"Donut":c[0]===2&&c[1]<2?"Eclair":c[0]===2&&c[1]===2?"Froyo":c[0]===2&&c[1]>2?"Gingerbread":c[0]===3?"Honeycomb":c[0]===4&&c[1]<1?"Ice Cream Sandwich":c[0]===4&&c[1]<4?"Jelly Bean":c[0]===4&&c[1]>=4?"KitKat":c[0]===5?"Lollipop":c[0]===6?"Marshmallow":c[0]===7?"Nougat":c[0]===8?"Oreo":c[0]===9?"Pie":void 0},a.getVersionPrecision=function(l){return l.split(".").length},a.compareVersions=function(l,c,u){u===void 0&&(u=!1);var m=a.getVersionPrecision(l),g=a.getVersionPrecision(c),E=Math.max(m,g),h=0,y=a.map([l,c],function(O){var _=E-a.getVersionPrecision(O),C=O+new Array(_+1).join(".0");return a.map(C.split("."),function(T){return new Array(20-T.length).join("0")+T}).reverse()});for(u&&(h=E-Math.min(m,g)),E-=1;E>=h;){if(y[0][E]>y[1][E])return 1;if(y[0][E]===y[1][E]){if(E===h)return 0;E-=1}else if(y[0][E]<y[1][E])return-1}},a.map=function(l,c){var u,m=[];if(Array.prototype.map)return Array.prototype.map.call(l,c);for(u=0;u<l.length;u+=1)m.push(c(l[u]));return m},a.find=function(l,c){var u,m;if(Array.prototype.find)return Array.prototype.find.call(l,c);for(u=0,m=l.length;u<m;u+=1){var g=l[u];if(c(g,u))return g}},a.assign=function(l){for(var c,u,m=l,g=arguments.length,E=new Array(g>1?g-1:0),h=1;h<g;h++)E[h-1]=arguments[h];if(Object.assign)return Object.assign.apply(Object,[l].concat(E));var y=function(){var O=E[c];typeof O=="object"&&O!==null&&Object.keys(O).forEach(function(_){m[_]=O[_]})};for(c=0,u=E.length;c<u;c+=1)y();return l},a.getBrowserAlias=function(l){return n.BROWSER_ALIASES_MAP[l]},a.getBrowserTypeByAlias=function(l){return n.BROWSER_MAP[l]||""},a}();e.default=r,s.exports=e.default},18:function(s,e,t){"use strict";e.__esModule=!0,e.ENGINE_MAP=e.OS_MAP=e.PLATFORMS_MAP=e.BROWSER_MAP=e.BROWSER_ALIASES_MAP=void 0,e.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},e.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},e.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},e.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},e.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var n,r=(n=t(91))&&n.__esModule?n:{default:n},a=t(18);function l(u,m){for(var g=0;g<m.length;g++){var E=m[g];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(u,E.key,E)}}var c=function(){function u(){}var m,g,E;return u.getParser=function(h,y){if(y===void 0&&(y=!1),typeof h!="string")throw new Error("UserAgent should be a string");return new r.default(h,y)},u.parse=function(h){return new r.default(h).getResult()},m=u,E=[{key:"BROWSER_MAP",get:function(){return a.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return a.ENGINE_MAP}},{key:"OS_MAP",get:function(){return a.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return a.PLATFORMS_MAP}}],(g=null)&&l(m.prototype,g),E&&l(m,E),u}();e.default=c,s.exports=e.default},91:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var n=u(t(92)),r=u(t(93)),a=u(t(94)),l=u(t(95)),c=u(t(17));function u(g){return g&&g.__esModule?g:{default:g}}var m=function(){function g(h,y){if(y===void 0&&(y=!1),h==null||h==="")throw new Error("UserAgent parameter can't be empty");this._ua=h,this.parsedResult={},y!==!0&&this.parse()}var E=g.prototype;return E.getUA=function(){return this._ua},E.test=function(h){return h.test(this._ua)},E.parseBrowser=function(){var h=this;this.parsedResult.browser={};var y=c.default.find(n.default,function(O){if(typeof O.test=="function")return O.test(h);if(O.test instanceof Array)return O.test.some(function(_){return h.test(_)});throw new Error("Browser's test function is not valid")});return y&&(this.parsedResult.browser=y.describe(this.getUA())),this.parsedResult.browser},E.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},E.getBrowserName=function(h){return h?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},E.getBrowserVersion=function(){return this.getBrowser().version},E.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},E.parseOS=function(){var h=this;this.parsedResult.os={};var y=c.default.find(r.default,function(O){if(typeof O.test=="function")return O.test(h);if(O.test instanceof Array)return O.test.some(function(_){return h.test(_)});throw new Error("Browser's test function is not valid")});return y&&(this.parsedResult.os=y.describe(this.getUA())),this.parsedResult.os},E.getOSName=function(h){var y=this.getOS().name;return h?String(y).toLowerCase()||"":y||""},E.getOSVersion=function(){return this.getOS().version},E.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},E.getPlatformType=function(h){h===void 0&&(h=!1);var y=this.getPlatform().type;return h?String(y).toLowerCase()||"":y||""},E.parsePlatform=function(){var h=this;this.parsedResult.platform={};var y=c.default.find(a.default,function(O){if(typeof O.test=="function")return O.test(h);if(O.test instanceof Array)return O.test.some(function(_){return h.test(_)});throw new Error("Browser's test function is not valid")});return y&&(this.parsedResult.platform=y.describe(this.getUA())),this.parsedResult.platform},E.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},E.getEngineName=function(h){return h?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},E.parseEngine=function(){var h=this;this.parsedResult.engine={};var y=c.default.find(l.default,function(O){if(typeof O.test=="function")return O.test(h);if(O.test instanceof Array)return O.test.some(function(_){return h.test(_)});throw new Error("Browser's test function is not valid")});return y&&(this.parsedResult.engine=y.describe(this.getUA())),this.parsedResult.engine},E.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},E.getResult=function(){return c.default.assign({},this.parsedResult)},E.satisfies=function(h){var y=this,O={},_=0,C={},T=0;if(Object.keys(h).forEach(function(P){var B=h[P];typeof B=="string"?(C[P]=B,T+=1):typeof B=="object"&&(O[P]=B,_+=1)}),_>0){var x=Object.keys(O),v=c.default.find(x,function(P){return y.isOS(P)});if(v){var A=this.satisfies(O[v]);if(A!==void 0)return A}var f=c.default.find(x,function(P){return y.isPlatform(P)});if(f){var p=this.satisfies(O[f]);if(p!==void 0)return p}}if(T>0){var S=Object.keys(C),b=c.default.find(S,function(P){return y.isBrowser(P,!0)});if(b!==void 0)return this.compareVersion(C[b])}},E.isBrowser=function(h,y){y===void 0&&(y=!1);var O=this.getBrowserName().toLowerCase(),_=h.toLowerCase(),C=c.default.getBrowserTypeByAlias(_);return y&&C&&(_=C.toLowerCase()),_===O},E.compareVersion=function(h){var y=[0],O=h,_=!1,C=this.getBrowserVersion();if(typeof C=="string")return h[0]===">"||h[0]==="<"?(O=h.substr(1),h[1]==="="?(_=!0,O=h.substr(2)):y=[],h[0]===">"?y.push(1):y.push(-1)):h[0]==="="?O=h.substr(1):h[0]==="~"&&(_=!0,O=h.substr(1)),y.indexOf(c.default.compareVersions(C,O,_))>-1},E.isOS=function(h){return this.getOSName(!0)===String(h).toLowerCase()},E.isPlatform=function(h){return this.getPlatformType(!0)===String(h).toLowerCase()},E.isEngine=function(h){return this.getEngineName(!0)===String(h).toLowerCase()},E.is=function(h,y){return y===void 0&&(y=!1),this.isBrowser(h,y)||this.isOS(h)||this.isPlatform(h)},E.some=function(h){var y=this;return h===void 0&&(h=[]),h.some(function(O){return y.is(O)})},g}();e.default=m,s.exports=e.default},92:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var n,r=(n=t(17))&&n.__esModule?n:{default:n},a=/version\/(\d+(\.?_?\d+)+)/i,l=[{test:[/googlebot/i],describe:function(c){var u={name:"Googlebot"},m=r.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,c)||r.default.getFirstMatch(a,c);return m&&(u.version=m),u}},{test:[/opera/i],describe:function(c){var u={name:"Opera"},m=r.default.getFirstMatch(a,c)||r.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/opr\/|opios/i],describe:function(c){var u={name:"Opera"},m=r.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,c)||r.default.getFirstMatch(a,c);return m&&(u.version=m),u}},{test:[/SamsungBrowser/i],describe:function(c){var u={name:"Samsung Internet for Android"},m=r.default.getFirstMatch(a,c)||r.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/Whale/i],describe:function(c){var u={name:"NAVER Whale Browser"},m=r.default.getFirstMatch(a,c)||r.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/MZBrowser/i],describe:function(c){var u={name:"MZ Browser"},m=r.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,c)||r.default.getFirstMatch(a,c);return m&&(u.version=m),u}},{test:[/focus/i],describe:function(c){var u={name:"Focus"},m=r.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,c)||r.default.getFirstMatch(a,c);return m&&(u.version=m),u}},{test:[/swing/i],describe:function(c){var u={name:"Swing"},m=r.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,c)||r.default.getFirstMatch(a,c);return m&&(u.version=m),u}},{test:[/coast/i],describe:function(c){var u={name:"Opera Coast"},m=r.default.getFirstMatch(a,c)||r.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(c){var u={name:"Opera Touch"},m=r.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,c)||r.default.getFirstMatch(a,c);return m&&(u.version=m),u}},{test:[/yabrowser/i],describe:function(c){var u={name:"Yandex Browser"},m=r.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,c)||r.default.getFirstMatch(a,c);return m&&(u.version=m),u}},{test:[/ucbrowser/i],describe:function(c){var u={name:"UC Browser"},m=r.default.getFirstMatch(a,c)||r.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/Maxthon|mxios/i],describe:function(c){var u={name:"Maxthon"},m=r.default.getFirstMatch(a,c)||r.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/epiphany/i],describe:function(c){var u={name:"Epiphany"},m=r.default.getFirstMatch(a,c)||r.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/puffin/i],describe:function(c){var u={name:"Puffin"},m=r.default.getFirstMatch(a,c)||r.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/sleipnir/i],describe:function(c){var u={name:"Sleipnir"},m=r.default.getFirstMatch(a,c)||r.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/k-meleon/i],describe:function(c){var u={name:"K-Meleon"},m=r.default.getFirstMatch(a,c)||r.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/micromessenger/i],describe:function(c){var u={name:"WeChat"},m=r.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,c)||r.default.getFirstMatch(a,c);return m&&(u.version=m),u}},{test:[/qqbrowser/i],describe:function(c){var u={name:/qqbrowserlite/i.test(c)?"QQ Browser Lite":"QQ Browser"},m=r.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,c)||r.default.getFirstMatch(a,c);return m&&(u.version=m),u}},{test:[/msie|trident/i],describe:function(c){var u={name:"Internet Explorer"},m=r.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/\sedg\//i],describe:function(c){var u={name:"Microsoft Edge"},m=r.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/edg([ea]|ios)/i],describe:function(c){var u={name:"Microsoft Edge"},m=r.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/vivaldi/i],describe:function(c){var u={name:"Vivaldi"},m=r.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/seamonkey/i],describe:function(c){var u={name:"SeaMonkey"},m=r.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/sailfish/i],describe:function(c){var u={name:"Sailfish"},m=r.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,c);return m&&(u.version=m),u}},{test:[/silk/i],describe:function(c){var u={name:"Amazon Silk"},m=r.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/phantom/i],describe:function(c){var u={name:"PhantomJS"},m=r.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/slimerjs/i],describe:function(c){var u={name:"SlimerJS"},m=r.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(c){var u={name:"BlackBerry"},m=r.default.getFirstMatch(a,c)||r.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/(web|hpw)[o0]s/i],describe:function(c){var u={name:"WebOS Browser"},m=r.default.getFirstMatch(a,c)||r.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/bada/i],describe:function(c){var u={name:"Bada"},m=r.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/tizen/i],describe:function(c){var u={name:"Tizen"},m=r.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,c)||r.default.getFirstMatch(a,c);return m&&(u.version=m),u}},{test:[/qupzilla/i],describe:function(c){var u={name:"QupZilla"},m=r.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,c)||r.default.getFirstMatch(a,c);return m&&(u.version=m),u}},{test:[/firefox|iceweasel|fxios/i],describe:function(c){var u={name:"Firefox"},m=r.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/electron/i],describe:function(c){var u={name:"Electron"},m=r.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/MiuiBrowser/i],describe:function(c){var u={name:"Miui"},m=r.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/chromium/i],describe:function(c){var u={name:"Chromium"},m=r.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,c)||r.default.getFirstMatch(a,c);return m&&(u.version=m),u}},{test:[/chrome|crios|crmo/i],describe:function(c){var u={name:"Chrome"},m=r.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/GSA/i],describe:function(c){var u={name:"Google Search"},m=r.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:function(c){var u=!c.test(/like android/i),m=c.test(/android/i);return u&&m},describe:function(c){var u={name:"Android Browser"},m=r.default.getFirstMatch(a,c);return m&&(u.version=m),u}},{test:[/playstation 4/i],describe:function(c){var u={name:"PlayStation 4"},m=r.default.getFirstMatch(a,c);return m&&(u.version=m),u}},{test:[/safari|applewebkit/i],describe:function(c){var u={name:"Safari"},m=r.default.getFirstMatch(a,c);return m&&(u.version=m),u}},{test:[/.*/i],describe:function(c){var u=c.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:r.default.getFirstMatch(u,c),version:r.default.getSecondMatch(u,c)}}}];e.default=l,s.exports=e.default},93:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var n,r=(n=t(17))&&n.__esModule?n:{default:n},a=t(18),l=[{test:[/Roku\/DVP/],describe:function(c){var u=r.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,c);return{name:a.OS_MAP.Roku,version:u}}},{test:[/windows phone/i],describe:function(c){var u=r.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,c);return{name:a.OS_MAP.WindowsPhone,version:u}}},{test:[/windows /i],describe:function(c){var u=r.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,c),m=r.default.getWindowsVersionName(u);return{name:a.OS_MAP.Windows,version:u,versionName:m}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(c){var u={name:a.OS_MAP.iOS},m=r.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,c);return m&&(u.version=m),u}},{test:[/macintosh/i],describe:function(c){var u=r.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,c).replace(/[_\s]/g,"."),m=r.default.getMacOSVersionName(u),g={name:a.OS_MAP.MacOS,version:u};return m&&(g.versionName=m),g}},{test:[/(ipod|iphone|ipad)/i],describe:function(c){var u=r.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,c).replace(/[_\s]/g,".");return{name:a.OS_MAP.iOS,version:u}}},{test:function(c){var u=!c.test(/like android/i),m=c.test(/android/i);return u&&m},describe:function(c){var u=r.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,c),m=r.default.getAndroidVersionName(u),g={name:a.OS_MAP.Android,version:u};return m&&(g.versionName=m),g}},{test:[/(web|hpw)[o0]s/i],describe:function(c){var u=r.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,c),m={name:a.OS_MAP.WebOS};return u&&u.length&&(m.version=u),m}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(c){var u=r.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,c)||r.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,c)||r.default.getFirstMatch(/\bbb(\d+)/i,c);return{name:a.OS_MAP.BlackBerry,version:u}}},{test:[/bada/i],describe:function(c){var u=r.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,c);return{name:a.OS_MAP.Bada,version:u}}},{test:[/tizen/i],describe:function(c){var u=r.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,c);return{name:a.OS_MAP.Tizen,version:u}}},{test:[/linux/i],describe:function(){return{name:a.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:a.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(c){var u=r.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,c);return{name:a.OS_MAP.PlayStation4,version:u}}}];e.default=l,s.exports=e.default},94:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var n,r=(n=t(17))&&n.__esModule?n:{default:n},a=t(18),l=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(c){var u=r.default.getFirstMatch(/(can-l01)/i,c)&&"Nova",m={type:a.PLATFORMS_MAP.mobile,vendor:"Huawei"};return u&&(m.model=u),m}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(c){var u=c.test(/ipod|iphone/i),m=c.test(/like (ipod|iphone)/i);return u&&!m},describe:function(c){var u=r.default.getFirstMatch(/(ipod|iphone)/i,c);return{type:a.PLATFORMS_MAP.mobile,vendor:"Apple",model:u}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(c){return c.getBrowserName(!0)==="blackberry"},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(c){return c.getBrowserName(!0)==="bada"},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(c){return c.getBrowserName()==="windows phone"},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(c){var u=Number(String(c.getOSVersion()).split(".")[0]);return c.getOSName(!0)==="android"&&u>=3},describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(c){return c.getOSName(!0)==="android"},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(c){return c.getOSName(!0)==="macos"},describe:function(){return{type:a.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(c){return c.getOSName(!0)==="windows"},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(c){return c.getOSName(!0)==="linux"},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(c){return c.getOSName(!0)==="playstation 4"},describe:function(){return{type:a.PLATFORMS_MAP.tv}}},{test:function(c){return c.getOSName(!0)==="roku"},describe:function(){return{type:a.PLATFORMS_MAP.tv}}}];e.default=l,s.exports=e.default},95:function(s,e,t){"use strict";e.__esModule=!0,e.default=void 0;var n,r=(n=t(17))&&n.__esModule?n:{default:n},a=t(18),l=[{test:function(c){return c.getBrowserName(!0)==="microsoft edge"},describe:function(c){if(/\sedg\//i.test(c))return{name:a.ENGINE_MAP.Blink};var u=r.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,c);return{name:a.ENGINE_MAP.EdgeHTML,version:u}}},{test:[/trident/i],describe:function(c){var u={name:a.ENGINE_MAP.Trident},m=r.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:function(c){return c.test(/presto/i)},describe:function(c){var u={name:a.ENGINE_MAP.Presto},m=r.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:function(c){var u=c.test(/gecko/i),m=c.test(/like gecko/i);return u&&!m},describe:function(c){var u={name:a.ENGINE_MAP.Gecko},m=r.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:a.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(c){var u={name:a.ENGINE_MAP.WebKit},m=r.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,c);return m&&(u.version=m),u}}];e.default=l,s.exports=e.default}})})});var am={};pp(am,{version:()=>NS});var NS,lm=Gc(()=>{L();NS="5.8.0"});var cm={};pp(cm,{default:()=>FS});var FS,um=Gc(()=>{L();FS={apiUrl:"https://localhost:3000",conferenceLayerUrl:"https://localhost:8080"}});var dm=be((Na,iu)=>{L();(function(e,t){typeof Na=="object"&&typeof iu=="object"?iu.exports=t():typeof define=="function"&&define.amd?define([],t):typeof Na=="object"?Na.Ably=t():e.Ably=t()})(window,function(){return function(s){var e={};function t(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return s[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=s,t.c=e,t.d=function(n,r,a){t.o(n,r)||Object.defineProperty(n,r,{enumerable:!0,get:a})},t.r=function(n){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,r){if(r&1&&(n=t(n)),r&8||r&4&&typeof n=="object"&&n&&n.__esModule)return n;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:n}),r&2&&typeof n!="string")for(var l in n)t.d(a,l,function(c){return n[c]}.bind(null,l));return a},t.n=function(n){var r=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(r,"a",r),r},t.o=function(n,r){return Object.prototype.hasOwnProperty.call(n,r)},t.p="",t(t.s=42)}([function(s,e,t){"use strict";t.r(e),t.d(e,"__extends",function(){return r}),t.d(e,"__assign",function(){return a}),t.d(e,"__rest",function(){return l}),t.d(e,"__decorate",function(){return c}),t.d(e,"__param",function(){return u}),t.d(e,"__metadata",function(){return m}),t.d(e,"__awaiter",function(){return g}),t.d(e,"__generator",function(){return E}),t.d(e,"__createBinding",function(){return h}),t.d(e,"__exportStar",function(){return y}),t.d(e,"__values",function(){return O}),t.d(e,"__read",function(){return _}),t.d(e,"__spread",function(){return C}),t.d(e,"__spreadArrays",function(){return T}),t.d(e,"__spreadArray",function(){return x}),t.d(e,"__await",function(){return v}),t.d(e,"__asyncGenerator",function(){return A}),t.d(e,"__asyncDelegator",function(){return f}),t.d(e,"__asyncValues",function(){return p}),t.d(e,"__makeTemplateObject",function(){return S}),t.d(e,"__importStar",function(){return P}),t.d(e,"__importDefault",function(){return B}),t.d(e,"__classPrivateFieldGet",function(){return z}),t.d(e,"__classPrivateFieldSet",function(){return W});var n=function(N,M){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,U){D.__proto__=U}||function(D,U){for(var G in U)Object.prototype.hasOwnProperty.call(U,G)&&(D[G]=U[G])},n(N,M)};function r(N,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");n(N,M);function D(){this.constructor=N}N.prototype=M===null?Object.create(M):(D.prototype=M.prototype,new D)}var a=function(){return a=Object.assign||function(M){for(var D,U=1,G=arguments.length;U<G;U++){D=arguments[U];for(var J in D)Object.prototype.hasOwnProperty.call(D,J)&&(M[J]=D[J])}return M},a.apply(this,arguments)};function l(N,M){var D={};for(var U in N)Object.prototype.hasOwnProperty.call(N,U)&&M.indexOf(U)<0&&(D[U]=N[U]);if(N!=null&&typeof Object.getOwnPropertySymbols=="function")for(var G=0,U=Object.getOwnPropertySymbols(N);G<U.length;G++)M.indexOf(U[G])<0&&Object.prototype.propertyIsEnumerable.call(N,U[G])&&(D[U[G]]=N[U[G]]);return D}function c(N,M,D,U){var G=arguments.length,J=G<3?M:U===null?U=Object.getOwnPropertyDescriptor(M,D):U,tt;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")J=Reflect.decorate(N,M,D,U);else for(var it=N.length-1;it>=0;it--)(tt=N[it])&&(J=(G<3?tt(J):G>3?tt(M,D,J):tt(M,D))||J);return G>3&&J&&Object.defineProperty(M,D,J),J}function u(N,M){return function(D,U){M(D,U,N)}}function m(N,M){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(N,M)}function g(N,M,D,U){function G(J){return J instanceof D?J:new D(function(tt){tt(J)})}return new(D||(D=Promise))(function(J,tt){function it(k){try{R(U.next(k))}catch(H){tt(H)}}function X(k){try{R(U.throw(k))}catch(H){tt(H)}}function R(k){k.done?J(k.value):G(k.value).then(it,X)}R((U=U.apply(N,M||[])).next())})}function E(N,M){var D={label:0,sent:function(){if(J[0]&1)throw J[1];return J[1]},trys:[],ops:[]},U,G,J,tt;return tt={next:it(0),throw:it(1),return:it(2)},typeof Symbol=="function"&&(tt[Symbol.iterator]=function(){return this}),tt;function it(R){return function(k){return X([R,k])}}function X(R){if(U)throw new TypeError("Generator is already executing.");for(;D;)try{if(U=1,G&&(J=R[0]&2?G.return:R[0]?G.throw||((J=G.return)&&J.call(G),0):G.next)&&!(J=J.call(G,R[1])).done)return J;switch(G=0,J&&(R=[R[0]&2,J.value]),R[0]){case 0:case 1:J=R;break;case 4:return D.label++,{value:R[1],done:!1};case 5:D.label++,G=R[1],R=[0];continue;case 7:R=D.ops.pop(),D.trys.pop();continue;default:if(J=D.trys,!(J=J.length>0&&J[J.length-1])&&(R[0]===6||R[0]===2)){D=0;continue}if(R[0]===3&&(!J||R[1]>J[0]&&R[1]<J[3])){D.label=R[1];break}if(R[0]===6&&D.label<J[1]){D.label=J[1],J=R;break}if(J&&D.label<J[2]){D.label=J[2],D.ops.push(R);break}J[2]&&D.ops.pop(),D.trys.pop();continue}R=M.call(N,D)}catch(k){R=[6,k],G=0}finally{U=J=0}if(R[0]&5)throw R[1];return{value:R[0]?R[1]:void 0,done:!0}}}var h=Object.create?function(N,M,D,U){U===void 0&&(U=D),Object.defineProperty(N,U,{enumerable:!0,get:function(){return M[D]}})}:function(N,M,D,U){U===void 0&&(U=D),N[U]=M[D]};function y(N,M){for(var D in N)D!=="default"&&!Object.prototype.hasOwnProperty.call(M,D)&&h(M,N,D)}function O(N){var M=typeof Symbol=="function"&&Symbol.iterator,D=M&&N[M],U=0;if(D)return D.call(N);if(N&&typeof N.length=="number")return{next:function(){return N&&U>=N.length&&(N=void 0),{value:N&&N[U++],done:!N}}};throw new TypeError(M?"Object is not iterable.":"Symbol.iterator is not defined.")}function _(N,M){var D=typeof Symbol=="function"&&N[Symbol.iterator];if(!D)return N;var U=D.call(N),G,J=[],tt;try{for(;(M===void 0||M-- >0)&&!(G=U.next()).done;)J.push(G.value)}catch(it){tt={error:it}}finally{try{G&&!G.done&&(D=U.return)&&D.call(U)}finally{if(tt)throw tt.error}}return J}function C(){for(var N=[],M=0;M<arguments.length;M++)N=N.concat(_(arguments[M]));return N}function T(){for(var N=0,M=0,D=arguments.length;M<D;M++)N+=arguments[M].length;for(var U=Array(N),G=0,M=0;M<D;M++)for(var J=arguments[M],tt=0,it=J.length;tt<it;tt++,G++)U[G]=J[tt];return U}function x(N,M,D){if(D||arguments.length===2)for(var U=0,G=M.length,J;U<G;U++)(J||!(U in M))&&(J||(J=Array.prototype.slice.call(M,0,U)),J[U]=M[U]);return N.concat(J||Array.prototype.slice.call(M))}function v(N){return this instanceof v?(this.v=N,this):new v(N)}function A(N,M,D){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var U=D.apply(N,M||[]),G,J=[];return G={},tt("next"),tt("throw"),tt("return"),G[Symbol.asyncIterator]=function(){return this},G;function tt(j){U[j]&&(G[j]=function(et){return new Promise(function(ft,gt){J.push([j,et,ft,gt])>1||it(j,et)})})}function it(j,et){try{X(U[j](et))}catch(ft){H(J[0][3],ft)}}function X(j){j.value instanceof v?Promise.resolve(j.value.v).then(R,k):H(J[0][2],j)}function R(j){it("next",j)}function k(j){it("throw",j)}function H(j,et){j(et),J.shift(),J.length&&it(J[0][0],J[0][1])}}function f(N){var M,D;return M={},U("next"),U("throw",function(G){throw G}),U("return"),M[Symbol.iterator]=function(){return this},M;function U(G,J){M[G]=N[G]?function(tt){return(D=!D)?{value:v(N[G](tt)),done:G==="return"}:J?J(tt):tt}:J}}function p(N){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var M=N[Symbol.asyncIterator],D;return M?M.call(N):(N=typeof O=="function"?O(N):N[Symbol.iterator](),D={},U("next"),U("throw"),U("return"),D[Symbol.asyncIterator]=function(){return this},D);function U(J){D[J]=N[J]&&function(tt){return new Promise(function(it,X){tt=N[J](tt),G(it,X,tt.done,tt.value)})}}function G(J,tt,it,X){Promise.resolve(X).then(function(R){J({value:R,done:it})},tt)}}function S(N,M){return Object.defineProperty?Object.defineProperty(N,"raw",{value:M}):N.raw=M,N}var b=Object.create?function(N,M){Object.defineProperty(N,"default",{enumerable:!0,value:M})}:function(N,M){N.default=M};function P(N){if(N&&N.__esModule)return N;var M={};if(N!=null)for(var D in N)D!=="default"&&Object.prototype.hasOwnProperty.call(N,D)&&h(M,N,D);return b(M,N),M}function B(N){return N&&N.__esModule?N:{default:N}}function z(N,M,D,U){if(D==="a"&&!U)throw new TypeError("Private accessor was defined without a getter");if(typeof M=="function"?N!==M||!U:!M.has(N))throw new TypeError("Cannot read private member from an object whose class did not declare it");return D==="m"?U:D==="a"?U.call(N):U?U.value:M.get(N)}function W(N,M,D,U,G){if(U==="m")throw new TypeError("Private method is not writable");if(U==="a"&&!G)throw new TypeError("Private accessor was defined without a setter");if(typeof M=="function"?N!==M||!G:!M.has(N))throw new TypeError("Cannot write private member to an object whose class did not declare it");return U==="a"?G.call(N,D):G?G.value=D:M.set(N,D),D}},function(s,e,t){"use strict";(function(n){Object.defineProperty(e,"__esModule",{value:!0}),e.allToUpperCase=e.allToLowerCase=e.encodeBody=e.decodeBody=e.Format=e.promisify=e.trim=e.arrChooseN=e.randomHexString=e.randomString=e.cheapRandStr=e.dataSizeBytes=e.inspectBody=e.inspectError=e.isErrorInfoOrPartialErrorInfo=e.now=e.parseQueryString=e.toQueryString=e.arrPopRandomElement=e.defaultPostHeaders=e.defaultGetHeaders=e.allSame=e.arrEvery=e.arrFilter=e.arrMap=e.safeArrForEach=e.arrForEach=e.forInOwnNonNullProperties=e.valuesArray=e.keysArray=e.arrWithoutValue=e.arrDeleteValue=e.arrIn=e.arrIndexOf=e.arrSubtract=e.arrIntersectOb=e.arrIntersect=e.intersect=e.containsValue=e.inherits=e.prototypicalClone=e.shallowClone=e.isEmptyArg=e.isOnlyPropIn=e.isEmpty=e.isObject=e.ensureArray=e.isArray=e.copy=e.mixin=void 0,e.toBase64=e.matchDerivedChannel=e.shallowEquals=e.getGlobalObject=e.getRetryTime=e.getJitterCoefficient=e.getBackoffCoefficient=void 0;var r=t(0),a=r.__importDefault(t(3)),l=r.__importStar(t(8)),c=r.__importDefault(t(4)),u=t(11),m=t(31);function g(q){return Math.floor(Math.random()*q.length)}function E(q){for(var ot=[],ut=1;ut<arguments.length;ut++)ot[ut-1]=arguments[ut];for(var yt=0;yt<ot.length;yt++){var Ut=ot[yt];if(!Ut)break;var Se=Object.prototype.hasOwnProperty;for(var In in Ut)(!Se||Se.call(Ut,In))&&(q[In]=Ut[In])}return q}e.mixin=E;function h(q){return E({},q)}e.copy=h,e.isArray=Array.isArray||function(q){return Object.prototype.toString.call(q)=="[object Array]"};function y(q){return T(q)?[]:(0,e.isArray)(q)?q:[q]}e.ensureArray=y;function O(q){return Object.prototype.toString.call(q)=="[object Object]"}e.isObject=O;function _(q){for(var ot in q)return!1;return!0}e.isEmpty=_;function C(q,ot){for(var ut in q)if(ut!==ot)return!1;return!0}e.isOnlyPropIn=C;function T(q){return q==null}e.isEmptyArg=T;function x(q){var ot=new Object;for(var ut in q)ot[ut]=q[ut];return ot}e.shallowClone=x;function v(q,ot){var ut=function(){function Ut(){}return Ut}();ut.prototype=q;var yt=new ut;return ot&&E(yt,ot),yt}e.prototypicalClone=v;var A=function(q,ot){if(a.default.Config.inherits){a.default.Config.inherits(q,ot);return}q.super_=ot,q.prototype=v(ot.prototype,{constructor:q})};e.inherits=A;function f(q,ot){for(var ut in q)if(q[ut]==ot)return!0;return!1}e.containsValue=f;function p(q,ot){return(0,e.isArray)(ot)?S(q,ot):b(q,ot)}e.intersect=p;function S(q,ot){for(var ut=[],yt=0;yt<q.length;yt++){var Ut=q[yt];(0,e.arrIndexOf)(ot,Ut)!=-1&&ut.push(Ut)}return ut}e.arrIntersect=S;function b(q,ot){for(var ut=[],yt=0;yt<q.length;yt++){var Ut=q[yt];Ut in ot&&ut.push(Ut)}return ut}e.arrIntersectOb=b;function P(q,ot){for(var ut=[],yt=0;yt<q.length;yt++){var Ut=q[yt];(0,e.arrIndexOf)(ot,Ut)==-1&&ut.push(Ut)}return ut}e.arrSubtract=P,e.arrIndexOf=Array.prototype.indexOf?function(q,ot,ut){return q.indexOf(ot,ut)}:function(q,ot,ut){ut=ut||0;for(var yt=q.length;ut<yt;ut++)if(q[ut]===ot)return ut;return-1};function B(q,ot){return(0,e.arrIndexOf)(q,ot)!==-1}e.arrIn=B;function z(q,ot){var ut=(0,e.arrIndexOf)(q,ot),yt=ut!=-1;return yt&&q.splice(ut,1),yt}e.arrDeleteValue=z;function W(q,ot){var ut=q.slice();return z(ut,ot),ut}e.arrWithoutValue=W;function N(q,ot){var ut=[];for(var yt in q)ot&&!Object.prototype.hasOwnProperty.call(q,yt)||ut.push(yt);return ut}e.keysArray=N;function M(q,ot){var ut=[];for(var yt in q)ot&&!Object.prototype.hasOwnProperty.call(q,yt)||ut.push(q[yt]);return ut}e.valuesArray=M;function D(q,ot){for(var ut in q)Object.prototype.hasOwnProperty.call(q,ut)&&q[ut]&&ot(ut)}e.forInOwnNonNullProperties=D,e.arrForEach=Array.prototype.forEach?function(q,ot){q.forEach(ot)}:function(q,ot){for(var ut=q.length,yt=0;yt<ut;yt++)ot(q[yt],yt,q)};function U(q,ot){return(0,e.arrForEach)(q.slice(),ot)}e.safeArrForEach=U,e.arrMap=Array.prototype.map?function(q,ot){return q.map(ot)}:function(q,ot){for(var ut=[],yt=q.length,Ut=0;Ut<yt;Ut++)ut.push(ot(q[Ut],Ut,q));return ut},e.arrFilter=Array.prototype.filter?function(q,ot){return q.filter(ot)}:function(q,ot){for(var ut=[],yt=q.length,Ut=0;Ut<yt;Ut++)ot(q[Ut])&&ut.push(q[Ut]);return ut},e.arrEvery=Array.prototype.every?function(q,ot){return q.every(ot)}:function(q,ot){for(var ut=q.length,yt=0;yt<ut;yt++)if(!ot(q[yt],yt,q))return!1;return!0};function G(q,ot){if(q.length===0)return!0;var ut=q[0][ot];return(0,e.arrEvery)(q,function(yt){return yt[ot]===ut})}e.allSame=G;var J={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function tt(q,ot){var ut=J[ot||Qt.json];return{accept:ut,"X-Ably-Version":l.default.protocolVersion.toString(),"Ably-Agent":(0,l.getAgentString)(q)}}e.defaultGetHeaders=tt;function it(q,ot){var ut,yt=ut=J[ot||Qt.json];return{accept:yt,"content-type":ut,"X-Ably-Version":l.default.protocolVersion.toString(),"Ably-Agent":(0,l.getAgentString)(q)}}e.defaultPostHeaders=it;function X(q){return q.splice(g(q),1)[0]}e.arrPopRandomElement=X;function R(q){var ot=[];if(q)for(var ut in q)ot.push(encodeURIComponent(ut)+"="+encodeURIComponent(q[ut]));return ot.length?"?"+ot.join("&"):""}e.toQueryString=R;function k(q){for(var ot,ut=/([^?&=]+)=?([^&]*)/g,yt={};ot=ut.exec(q);)yt[decodeURIComponent(ot[1])]=decodeURIComponent(ot[2]);return yt}e.parseQueryString=k,e.now=Date.now||function(){return new Date().getTime()};function H(q){return typeof q=="object"&&q!==null&&(q.constructor.name=="ErrorInfo"||q.constructor.name=="PartialErrorInfo")}e.isErrorInfoOrPartialErrorInfo=H;function j(q){var ot,ut;return q instanceof Error||((ot=q==null?void 0:q.constructor)===null||ot===void 0?void 0:ot.name)==="ErrorInfo"||((ut=q==null?void 0:q.constructor)===null||ut===void 0?void 0:ut.name)==="PartialErrorInfo"?q.toString():a.default.Config.inspect(q)}e.inspectError=j;function et(q){return a.default.BufferUtils.isBuffer(q)?q.toString():typeof q=="string"?q:a.default.Config.inspect(q)}e.inspectBody=et;function ft(q){if(a.default.BufferUtils.isBuffer(q))return a.default.BufferUtils.byteLength(q);if(typeof q=="string")return a.default.Config.stringByteSize(q);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof q)}e.dataSizeBytes=ft;function gt(){return String(Math.random()).substr(2)}e.cheapRandStr=gt;var Et=function(q){if(a.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var ot=new Uint8Array(q);return a.default.Config.getRandomValues(ot),a.default.BufferUtils.base64Encode(ot)}for(var ut=a.default.BufferUtils.base64CharSet,yt=Math.round(q*4/3),Ut="",Se=0;Se<yt;Se++)Ut+=ut[g(ut)];return Ut};e.randomString=Et;var Ct=function(q){if(a.default.Config.getRandomValues&&typeof Uint8Array!="undefined"){var ot=new Uint8Array(q);return a.default.Config.getRandomValues(ot),a.default.BufferUtils.hexEncode(ot)}for(var ut=a.default.BufferUtils.hexCharSet,yt=q*2,Ut="",Se=0;Se<yt;Se++)Ut+=ut[g(ut)];return Ut};e.randomHexString=Ct;function Vt(q,ot){for(var ut=Math.min(ot,q.length),yt=q.slice(),Ut=[],Se=0;Se<ut;Se++)Ut.push(X(yt));return Ut}e.arrChooseN=Vt,e.trim=String.prototype.trim?function(q){return q.trim()}:function(q){return q.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function ht(q,ot,ut){return new Promise(function(yt,Ut){q[ot].apply(q,r.__spreadArray(r.__spreadArray([],ut,!1),[function(Se,In){Se?Ut(Se):yt(In)}],!1))})}e.promisify=ht;var Qt;(function(q){q.msgpack="msgpack",q.json="json"})(Qt=e.Format||(e.Format={}));function Ee(q,ot){return ot=="msgpack"?a.default.Config.msgpack.decode(q):JSON.parse(String(q))}e.decodeBody=Ee;function se(q,ot){return ot=="msgpack"?a.default.Config.msgpack.encode(q,!0):JSON.stringify(q)}e.encodeBody=se;function me(q){return q.map(function(ot){return ot&&ot.toLowerCase()})}e.allToLowerCase=me;function dn(q){return q.map(function(ot){return ot&&ot.toUpperCase()})}e.allToUpperCase=dn;function An(q){return Math.min((q+2)/3,2)}e.getBackoffCoefficient=An;function ue(){return 1-Math.random()*.2}e.getJitterCoefficient=ue;function wn(q,ot){return q*An(ot)*ue()}e.getRetryTime=wn;function Jn(){return n||(typeof window!="undefined"?window:self)}e.getGlobalObject=Jn;function Xr(q,ot){return Object.keys(q).every(function(ut){return q[ut]===ot[ut]})&&Object.keys(ot).every(function(ut){return ot[ut]===q[ut]})}e.shallowEquals=Xr;function pi(q){var ot=/^(\[([^?]*)(?:(.*))\])?(.+)$/,ut=q.match(ot);if(!ut||!ut.length||ut.length<5)throw new c.default("regex match failed",400,40010);if(ut[2])throw new c.default("cannot use a derived option with a ".concat(ut[2]," channel"),400,40010);return{qualifierParam:ut[3]||"",channelName:ut[4]}}e.matchDerivedChannel=pi;function Tl(q){return a.default.Config.createHmac?Buffer.from(q,"ascii").toString("base64"):(0,u.stringify)((0,m.parse)(q))}e.toBase64=Tl}).call(this,t(13))},function(s,e,t){"use strict";(function(n){Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),a=r.__importDefault(t(3)),l=n||(typeof window!="undefined"?window:self),c;(function(h){h[h.None=0]="None",h[h.Error=1]="Error",h[h.Major=2]="Major",h[h.Minor=3]="Minor",h[h.Micro=4]="Micro"})(c||(c={}));function u(h,y){return"".concat(h).padStart(y?3:2,"0")}function m(h){return a.default.Config.logTimestamps?function(y){var O=new Date;h(u(O.getHours())+":"+u(O.getMinutes())+":"+u(O.getSeconds())+"."+u(O.getMilliseconds(),1)+" "+y)}:h}var g=function(){var h,y,O,_;return typeof Window=="undefined"&&typeof WorkerGlobalScope=="undefined"||typeof((y=(h=l==null?void 0:l.console)===null||h===void 0?void 0:h.log)===null||y===void 0?void 0:y.apply)=="function"?(O=function(){for(var C=[],T=0;T<arguments.length;T++)C[T]=arguments[T]},_=console.warn?function(){for(var C=[],T=0;T<arguments.length;T++)C[T]=arguments[T]}:O):l!=null&&l.console.log?O=_=function(){Function.prototype.apply.call(console.log,console,arguments)}:O=_=function(){},[O,_].map(m)},E=function(){function h(){h.logLevel=h.LOG_DEFAULT}return h.initLogHandlers=function(){var y=g(),O=y[0],_=y[1];this.logHandler=O,this.logErrorHandler=_},h.logLevel=c.Error,h.LOG_NONE=c.None,h.LOG_ERROR=c.Error,h.LOG_MAJOR=c.Major,h.LOG_MINOR=c.Minor,h.LOG_MICRO=c.Micro,h.LOG_DEFAULT=c.Error,h.LOG_DEBUG=c.Micro,h.logAction=function(y,O,_){h.shouldLog(y)&&(y===c.Error?h.logErrorHandler:h.logHandler)("Ably: "+O+": "+_)},h.deprecated=function(y,O){h.deprecatedWithMsg(y,"Please use '"+O+"' instead.")},h.deprecatedWithMsg=function(y,O){h.shouldLog(c.Error)&&h.logErrorHandler("Ably: Deprecation warning - '"+y+"' is deprecated and will be removed from a future version. "+O)},h.shouldLog=function(y){return y<=h.logLevel},h.setLog=function(y,O){y!==void 0&&(h.logLevel=y),O!==void 0&&(h.logHandler=h.logErrorHandler=O)},h}();e.default=E}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function r(){}return r}();e.default=n},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PartialErrorInfo=void 0;var n=t(0),r=n.__importDefault(t(3)),a=n.__importStar(t(1));function l(m){var g="["+m.constructor.name;return m.message&&(g+=": "+m.message),m.statusCode&&(g+="; statusCode="+m.statusCode),m.code&&(g+="; code="+m.code),m.cause&&(g+="; cause="+a.inspectError(m.cause)),m.href&&!(m.message&&m.message.indexOf("help.ably.io")>-1)&&(g+="; see "+m.href+" "),g+="]",g}var c=function(m){n.__extends(g,m);function g(E,h,y,O){var _=m.call(this,E)||this;return typeof Object.setPrototypeOf!="undefined"&&Object.setPrototypeOf(_,g.prototype),_.code=h,_.statusCode=y,_.cause=O,_}return g.prototype.toString=function(){return l(this)},g.fromValues=function(E){var h=E,y=h.message,O=h.code,_=h.statusCode;if(typeof y!="string"||typeof O!="number"||typeof _!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+r.default.Config.inspect(E));var C=Object.assign(new g(y,O,_),E);return C.code&&!C.href&&(C.href="https://help.ably.io/error/"+C.code),C},g}(Error);e.default=c;var u=function(m){n.__extends(g,m);function g(E,h,y,O){var _=m.call(this,E)||this;return typeof Object.setPrototypeOf!="undefined"&&Object.setPrototypeOf(_,g.prototype),_.code=h,_.statusCode=y,_.cause=O,_}return g.prototype.toString=function(){return l(this)},g}(Error);e.PartialErrorInfo=u},function(s,e,t){(function(n,r){s.exports=e=r(t(6))})(this,function(n){return function(){if(typeof ArrayBuffer=="function"){var r=n,a=r.lib,l=a.WordArray,c=l.init,u=l.init=function(m){if(m instanceof ArrayBuffer&&(m=new Uint8Array(m)),(m instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&m instanceof Uint8ClampedArray||m instanceof Int16Array||m instanceof Uint16Array||m instanceof Int32Array||m instanceof Uint32Array||m instanceof Float32Array||m instanceof Float64Array)&&(m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength)),m instanceof Uint8Array){for(var g=m.byteLength,E=[],h=0;h<g;h++)E[h>>>2]|=m[h]<<24-h%4*8;c.call(this,E,g)}else c.apply(this,arguments)};u.prototype=l}}(),n.lib.WordArray})},function(s,e,t){(function(n){(function(r,a){s.exports=e=a()})(this,function(){var r=r||function(a,l){var c;if(typeof window!="undefined"&&window.crypto&&(c=window.crypto),!c&&typeof window!="undefined"&&window.msCrypto&&(c=window.msCrypto),!c&&typeof n!="undefined"&&n.crypto&&(c=n.crypto),!c)try{c=t(44)}catch(f){}var u=function(){if(c){if(typeof c.getRandomValues=="function")try{return c.getRandomValues(new Uint32Array(1))[0]}catch(f){}if(typeof c.randomBytes=="function")try{return c.randomBytes(4).readInt32LE()}catch(f){}}throw new Error("Native crypto module could not be used to get secure random number.")},m=Object.create||function(){function f(){}return function(p){var S;return f.prototype=p,S=new f,f.prototype=null,S}}(),g={},E=g.lib={},h=E.Base=function(){return{extend:function(f){var p=m(this);return f&&p.mixIn(f),(!p.hasOwnProperty("init")||this.init===p.init)&&(p.init=function(){p.$super.init.apply(this,arguments)}),p.init.prototype=p,p.$super=this,p},create:function(){var f=this.extend();return f.init.apply(f,arguments),f},init:function(){},mixIn:function(f){for(var p in f)f.hasOwnProperty(p)&&(this[p]=f[p]);f.hasOwnProperty("toString")&&(this.toString=f.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),y=E.WordArray=h.extend({init:function(f,p){f=this.words=f||[],p!=l?this.sigBytes=p:this.sigBytes=f.length*4},toString:function(f){return(f||_).stringify(this)},concat:function(f){var p=this.words,S=f.words,b=this.sigBytes,P=f.sigBytes;if(this.clamp(),b%4)for(var B=0;B<P;B++){var z=S[B>>>2]>>>24-B%4*8&255;p[b+B>>>2]|=z<<24-(b+B)%4*8}else for(var B=0;B<P;B+=4)p[b+B>>>2]=S[B>>>2];return this.sigBytes+=P,this},clamp:function(){var f=this.words,p=this.sigBytes;f[p>>>2]&=4294967295<<32-p%4*8,f.length=a.ceil(p/4)},clone:function(){var f=h.clone.call(this);return f.words=this.words.slice(0),f},random:function(f){for(var p=[],S=0;S<f;S+=4)p.push(u());return new y.init(p,f)}}),O=g.enc={},_=O.Hex={stringify:function(f){for(var p=f.words,S=f.sigBytes,b=[],P=0;P<S;P++){var B=p[P>>>2]>>>24-P%4*8&255;b.push((B>>>4).toString(16)),b.push((B&15).toString(16))}return b.join("")},parse:function(f){for(var p=f.length,S=[],b=0;b<p;b+=2)S[b>>>3]|=parseInt(f.substr(b,2),16)<<24-b%8*4;return new y.init(S,p/2)}},C=O.Latin1={stringify:function(f){for(var p=f.words,S=f.sigBytes,b=[],P=0;P<S;P++){var B=p[P>>>2]>>>24-P%4*8&255;b.push(String.fromCharCode(B))}return b.join("")},parse:function(f){for(var p=f.length,S=[],b=0;b<p;b++)S[b>>>2]|=(f.charCodeAt(b)&255)<<24-b%4*8;return new y.init(S,p)}},T=O.Utf8={stringify:function(f){try{return decodeURIComponent(escape(C.stringify(f)))}catch(p){throw new Error("Malformed UTF-8 data")}},parse:function(f){return C.parse(unescape(encodeURIComponent(f)))}},x=E.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new y.init,this._nDataBytes=0},_append:function(f){typeof f=="string"&&(f=T.parse(f)),this._data.concat(f),this._nDataBytes+=f.sigBytes},_process:function(f){var p,S=this._data,b=S.words,P=S.sigBytes,B=this.blockSize,z=B*4,W=P/z;f?W=a.ceil(W):W=a.max((W|0)-this._minBufferSize,0);var N=W*B,M=a.min(N*4,P);if(N){for(var D=0;D<N;D+=B)this._doProcessBlock(b,D);p=b.splice(0,N),S.sigBytes-=M}return new y.init(p,M)},clone:function(){var f=h.clone.call(this);return f._data=this._data.clone(),f},_minBufferSize:0}),v=E.Hasher=x.extend({cfg:h.extend(),init:function(f){this.cfg=this.cfg.extend(f),this.reset()},reset:function(){x.reset.call(this),this._doReset()},update:function(f){return this._append(f),this._process(),this},finalize:function(f){f&&this._append(f);var p=this._doFinalize();return p},blockSize:512/32,_createHelper:function(f){return function(p,S){return new f.init(S).finalize(p)}},_createHmacHelper:function(f){return function(p,S){return new A.HMAC.init(f,S).finalize(p)}}}),A=g.algo={};return g}(Math);return r})}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importStar(t(1)),a=n.__importDefault(t(2)),l=n.__importDefault(t(3));function c(g,E,h){try{E.apply(g,h)}catch(y){a.default.logAction(a.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+y+"; stack = "+(y&&y.stack))}}function u(g,E,h){for(var y,O,_,C=0;C<g.length;C++)if(y=g[C],h&&(y=y[h]),r.isArray(y)){for(;(O=r.arrIndexOf(y,E))!==-1;)y.splice(O,1);h&&y.length===0&&delete g[C][h]}else if(r.isObject(y))for(_ in y)Object.prototype.hasOwnProperty.call(y,_)&&r.isArray(y[_])&&u([y],E,_)}var m=function(){function g(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return g.prototype.on=function(){for(var E=this,h=[],y=0;y<arguments.length;y++)h[y]=arguments[y];if(h.length===1){var O=h[0];if(typeof O=="function")this.any.push(O);else throw new Error("EventListener.on(): Invalid arguments: "+l.default.Config.inspect(h))}if(h.length===2){var _=h[0],C=h[1];if(typeof C!="function")throw new Error("EventListener.on(): Invalid arguments: "+l.default.Config.inspect(h));if(r.isEmptyArg(_))this.any.push(C);else if(r.isArray(_))_.forEach(function(x){E.on(x,C)});else{if(typeof _!="string")throw new Error("EventListener.on(): Invalid arguments: "+l.default.Config.inspect(h));var T=this.events[_]||(this.events[_]=[]);T.push(C)}}},g.prototype.off=function(){for(var E,h=this,y=[],O=0;O<arguments.length;O++)y[O]=arguments[O];if(y.length==0||r.isEmptyArg(y[0])&&r.isEmptyArg(y[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var _=y[0],C=y[1],T=null,x=null;if(y.length===1||!C)typeof _=="function"?T=_:x=_;else{if(typeof C!="function")throw new Error("EventEmitter.off(): invalid arguments:"+l.default.Config.inspect(y));E=[_,C],x=E[0],T=E[1]}if(T&&r.isEmptyArg(x)){u([this.any,this.events,this.anyOnce,this.eventsOnce],T);return}if(r.isArray(x)){x.forEach(function(v){h.off(v,T)});return}if(typeof x!="string")throw new Error("EventEmitter.off(): invalid arguments:"+l.default.Config.inspect(y));T?u([this.events,this.eventsOnce],T,x):(delete this.events[x],delete this.eventsOnce[x])},g.prototype.listeners=function(E){if(E){var h=this.events[E]||[];return this.eventsOnce[E]&&Array.prototype.push.apply(h,this.eventsOnce[E]),h.length?h:null}return this.any.length?this.any:null},g.prototype.emit=function(E){for(var h=[],y=1;y<arguments.length;y++)h[y-1]=arguments[y];var O={event:E},_=[];this.anyOnce.length&&(Array.prototype.push.apply(_,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(_,this.any);var C=this.eventsOnce[E];C&&(Array.prototype.push.apply(_,C),delete this.eventsOnce[E]);var T=this.events[E];T&&Array.prototype.push.apply(_,T),r.arrForEach(_,function(x){c(O,x,h)})},g.prototype.once=function(){for(var E=this,h=[],y=0;y<arguments.length;y++)h[y]=arguments[y];var O=h.length;if((O===0||O===1&&typeof h[0]!="function")&&l.default.Config.Promise){var _=h[0];return new l.default.Config.Promise(function(f){E.once(_,f)})}var C=h[0],T=h[1];if(h.length===1&&typeof C=="function")this.anyOnce.push(C);else if(r.isEmptyArg(C)){if(typeof T!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(h));this.anyOnce.push(T)}else if(r.isArray(C)){var x=this,v=function(){var f=Array.prototype.slice.call(arguments);if(r.arrForEach(C,function(p){x.off(p,v)}),typeof T!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(h));T.apply(this,f)};r.arrForEach(C,function(f){x.on(f,v)})}else{if(typeof C!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(h));var A=this.eventsOnce[C]||(this.eventsOnce[C]=[]);if(T){if(typeof T!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+l.default.Config.inspect(h));A.push(T)}}},g.prototype.whenState=function(E,h,y){for(var O=this,_=[],C=3;C<arguments.length;C++)_[C-3]=arguments[C];var T={event:E};if(typeof E!="string"||typeof h!="string")throw"whenState requires a valid event String argument";if(typeof y!="function"&&l.default.Config.Promise)return new l.default.Config.Promise(function(x){g.prototype.whenState.apply(O,[E,h,x].concat(_))});E===h?c(T,y,_):this.once(E,y)},g}();e.default=m},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getDefaults=e.normaliseOptions=e.objectifyOptions=e.getAgentString=e.getHosts=e.getFallbackHosts=e.environmentFallbackHosts=e.getHttpScheme=e.getPort=e.getHost=void 0;var n=t(0),r=n.__importDefault(t(3)),a=n.__importStar(t(1)),l=n.__importDefault(t(2)),c=n.__importDefault(t(4)),u=t(43),m="ably-js/"+u.version,g={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:u.version,protocolVersion:2,agent:m,getHost:E,getPort:h,getHttpScheme:y,environmentFallbackHosts:O,getFallbackHosts:_,getHosts:C,checkHost:T,objectifyOptions:f,normaliseOptions:p};function E(b,P,B){return B?P=P==b.restHost&&b.realtimeHost||P||b.realtimeHost:P=P||b.restHost,P}e.getHost=E;function h(b,P){return P||b.tls?b.tlsPort:b.port}e.getPort=h;function y(b){return b.tls?"https://":"http://"}e.getHttpScheme=y;function O(b){return[b+"-a-fallback.ably-realtime.com",b+"-b-fallback.ably-realtime.com",b+"-c-fallback.ably-realtime.com",b+"-d-fallback.ably-realtime.com",b+"-e-fallback.ably-realtime.com"]}e.environmentFallbackHosts=O;function _(b){var P=b.fallbackHosts,B=typeof b.httpMaxRetryCount!="undefined"?b.httpMaxRetryCount:g.httpMaxRetryCount;return P?a.arrChooseN(P,B):[]}e.getFallbackHosts=_;function C(b){return[b.restHost].concat(_(b))}e.getHosts=C;function T(b){if(typeof b!="string")throw new c.default("host must be a string; was a "+typeof b,4e4,400);if(!b.length)throw new c.default("host must not be zero-length",4e4,400)}function x(b,P,B){return b.realtimeHost?b.realtimeHost:b.restHost?(l.default.logAction(l.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+b.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+b.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),b.restHost):P?g.REALTIME_HOST:B+"-"+g.REALTIME_HOST}function v(b){var P={};for(var B in g.TIMEOUTS)P[B]=b[B]||g.TIMEOUTS[B];return P}function A(b){var P=g.agent;if(b.agents)for(var B in b.agents)P+=" "+B+"/"+b.agents[B];return P}e.getAgentString=A;function f(b){return typeof b=="string"?b.indexOf(":")==-1?{token:b}:{key:b}:b}e.objectifyOptions=f;function p(b){if(b.host&&(l.default.deprecated("host","restHost"),b.restHost=b.host),b.wsHost&&(l.default.deprecated("wsHost","realtimeHost"),b.realtimeHost=b.wsHost),b.queueEvents&&(l.default.deprecated("queueEvents","queueMessages"),b.queueMessages=b.queueEvents),b.fallbackHostsUseDefault){if(b.fallbackHosts){var P="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions",P),new c.default(P,4e4,400)}if(b.port||b.tlsPort){var P="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions",P),new c.default(P,4e4,400)}b.environment?l.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):l.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),b.fallbackHosts=g.FALLBACK_HOSTS}b.recover===!0&&(l.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),b.recover=function(X,R){R(!0)}),typeof b.recover=="function"&&b.closeOnUnload===!0&&(l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),b.recover=void 0),"closeOnUnload"in b||(b.closeOnUnload=!b.recover),b.transports&&a.arrIn(b.transports,"xhr")&&(l.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),a.arrDeleteValue(b.transports,"xhr"),b.transports.push("xhr_streaming")),"queueMessages"in b||(b.queueMessages=!0);var B=b.environment&&String(b.environment).toLowerCase()||g.ENVIRONMENT,z=!B||B==="production";!b.fallbackHosts&&!b.restHost&&!b.realtimeHost&&!b.port&&!b.tlsPort&&(b.fallbackHosts=z?g.FALLBACK_HOSTS:O(B));var W=b.restHost||(z?g.REST_HOST:B+"-"+g.REST_HOST),N=x(b,z,B);a.arrForEach((b.fallbackHosts||[]).concat(W,N),T),b.port=b.port||g.PORT,b.tlsPort=b.tlsPort||g.TLS_PORT,"tls"in b||(b.tls=!0);var M=v(b);if("useBinaryProtocol"in b?b.useBinaryProtocol=r.default.Config.supportsBinary&&b.useBinaryProtocol:b.useBinaryProtocol=r.default.Config.preferBinary,b.clientId){var D=b.headers=b.headers||{};D["X-Ably-ClientId"]=r.default.BufferUtils.base64Encode(r.default.BufferUtils.utf8Encode(b.clientId))}"idempotentRestPublishing"in b||(b.idempotentRestPublishing=!0),b.promises&&!r.default.Config.Promise&&(l.default.logAction(l.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),b.promises=!1);var U=null,G=b.connectivityCheckUrl;if(b.connectivityCheckUrl){var J=b.connectivityCheckUrl.split("?"),tt=J[0],it=J[1];U=it?a.parseQueryString(it):{},tt.indexOf("://")===-1&&(tt="https://"+tt),G=tt}return n.__assign(n.__assign({},b),{useBinaryProtocol:"useBinaryProtocol"in b?r.default.Config.supportsBinary&&b.useBinaryProtocol:r.default.Config.preferBinary,realtimeHost:N,restHost:W,maxMessageSize:b.maxMessageSize||g.maxMessageSize,timeouts:M,connectivityCheckParams:U,connectivityCheckUrl:G})}e.normaliseOptions=p,e.default=g;function S(b){return Object.assign(g,b)}e.getDefaults=S},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importDefault(t(3)),a=n.__importDefault(t(2)),l=n.__importDefault(t(4)),c=n.__importStar(t(1));function u(h){return!h||!h.channelOptions?{channelOptions:h,plugins:{},baseEncodedPreviousPayload:void 0}:h}function m(h){if(h&&h.cipher){if(!r.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var y=r.default.Crypto.getCipher(h.cipher);return{cipher:y.cipherParams,channelCipher:y.cipher}}return h!=null?h:{}}function g(h){var y=0;return h.name&&(y+=h.name.length),h.clientId&&(y+=h.clientId.length),h.extras&&(y+=JSON.stringify(h.extras).length),h.data&&(y+=c.dataSizeBytes(h.data)),y}var E=function(){function h(){}return h.prototype.toJSON=function(){var y=this.encoding,O=this.data;return O&&r.default.BufferUtils.isBuffer(O)&&(arguments.length>0?(y=y?y+"/base64":"base64",O=r.default.BufferUtils.base64Encode(O)):O=r.default.BufferUtils.toBuffer(O)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:y,data:O}},h.prototype.toString=function(){var y="[Message";return this.name&&(y+="; name="+this.name),this.id&&(y+="; id="+this.id),this.timestamp&&(y+="; timestamp="+this.timestamp),this.clientId&&(y+="; clientId="+this.clientId),this.connectionId&&(y+="; connectionId="+this.connectionId),this.encoding&&(y+="; encoding="+this.encoding),this.extras&&(y+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?y+="; data="+this.data:r.default.BufferUtils.isBuffer(this.data)?y+="; data (buffer)="+r.default.BufferUtils.base64Encode(this.data):y+="; data (json)="+JSON.stringify(this.data)),this.extras&&(y+="; extras="+JSON.stringify(this.extras)),y+="]",y},h.encrypt=function(y,O,_){var C=y.data,T=y.encoding,x=O.channelCipher;T=T?T+"/":"",r.default.BufferUtils.isBuffer(C)||(C=r.default.BufferUtils.utf8Encode(String(C)),T=T+"utf-8/"),x.encrypt(C,function(v,A){if(v){_(v);return}y.data=A,y.encoding=T+"cipher+"+x.algorithm,_(null,y)})},h.encode=function(y,O,_){var C=y.data,T=typeof C=="string"||r.default.BufferUtils.isBuffer(C)||C===null||C===void 0;if(!T)if(c.isObject(C)||c.isArray(C))y.data=JSON.stringify(C),y.encoding=y.encoding?y.encoding+"/json":"json";else throw new l.default("Data type is unsupported",40013,400);O!=null&&O.cipher?h.encrypt(y,O,_):_(null,y)},h.encodeArray=function(y,O,_){for(var C=0,T=0;T<y.length;T++)h.encode(y[T],O,function(x){if(x){_(x);return}C++,C==y.length&&_(null,y)})},h.decode=function(y,O){var _=u(O),C=y.data,T=y.encoding;if(T){var x=T.split("/"),v=void 0,A=x.length,f=y.data,p="";try{for(;(v=A)>0;){var S=x[--A].match(/([-\w]+)(\+([\w-]+))?/);if(!S)break;switch(p=S[1],p){case"base64":f=r.default.BufferUtils.base64Decode(String(f)),v==x.length&&(C=f);continue;case"utf-8":f=r.default.BufferUtils.utf8Decode(f);continue;case"json":f=JSON.parse(f);continue;case"cipher":if(_.channelOptions!=null&&_.channelOptions.cipher&&_.channelOptions.channelCipher){var b=S[3],P=_.channelOptions.channelCipher;if(b!=P.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");f=P.decrypt(f);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!_.plugins||!_.plugins.vcdiff)throw new l.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array=="undefined")throw new l.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var B=_.baseEncodedPreviousPayload;typeof B=="string"&&(B=r.default.BufferUtils.utf8Encode(B)),B=r.default.BufferUtils.toBuffer(B),f=r.default.BufferUtils.toBuffer(f),f=r.default.BufferUtils.typedArrayToBuffer(_.plugins.vcdiff.decode(f,B)),C=f}catch(W){throw new l.default("Vcdiff delta decode failed with "+W,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(W){var z=W;throw new l.default("Error processing the "+p+" encoding, decoder returned \u2018"+z.message+"\u2019",z.code||40013,400)}finally{y.encoding=v<=0?null:x.slice(0,v).join("/"),y.data=f}}_.baseEncodedPreviousPayload=C},h.fromResponseBody=function(y,O,_){_&&(y=c.decodeBody(y,_));for(var C=0;C<y.length;C++){var T=y[C]=h.fromValues(y[C]);try{h.decode(T,O)}catch(x){a.default.logAction(a.default.LOG_ERROR,"Message.fromResponseBody()",x.toString())}}return y},h.fromValues=function(y){return Object.assign(new h,y)},h.fromValuesArray=function(y){for(var O=y.length,_=new Array(O),C=0;C<O;C++)_[C]=h.fromValues(y[C]);return _},h.fromEncoded=function(y,O){var _=h.fromValues(y),C=m(O!=null?O:null);try{h.decode(_,C)}catch(T){a.default.logAction(a.default.LOG_ERROR,"Message.fromEncoded()",T.toString())}return _},h.fromEncodedArray=function(y,O){return y.map(function(_){return h.fromEncoded(_,O)})},h.getMessagesSize=function(y){for(var O,_=0,C=0;C<y.length;C++)O=y[C],_+=O.size||(O.size=g(O));return _},h.serialize=c.encodeBody,h}();e.default=E},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importStar(t(1)),a=n.__importDefault(t(4)),l=n.__importDefault(t(9)),c=n.__importDefault(t(15)),u={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18},m=[];Object.keys(u).forEach(function(_){m[u[_]]=_});var g={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},E=Object.keys(g);g.MODE_ALL=g.PRESENCE|g.PUBLISH|g.SUBSCRIBE|g.PRESENCE_SUBSCRIBE;function h(_){var C=[];if(_)for(var T=0;T<_.length;T++)C.push(_[T].toString());return"[ "+C.join(", ")+" ]"}var y="id channel channelSerial connectionId count msgSerial timestamp".split(" "),O=function(){function _(){var C=this;this.hasFlag=function(T){return(C.flags&g[T])>0}}return _.prototype.setFlag=function(C){return this.flags=this.flags|g[C]},_.prototype.getMode=function(){return this.flags&&this.flags&g.MODE_ALL},_.prototype.encodeModesToFlags=function(C){var T=this;C.forEach(function(x){return T.setFlag(x)})},_.prototype.decodeModesFromFlags=function(){var C=this,T=[];return _.channelModes.forEach(function(x){C.hasFlag(x)&&T.push(x)}),T.length>0?T:void 0},_.fromValues=function(C){return Object.assign(new _,C)},_.Action=u,_.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],_.ActionName=m,_.serialize=r.encodeBody,_.deserialize=function(C,T){var x=r.decodeBody(C,T);return _.fromDeserialized(x)},_.fromDeserialized=function(C){var T=C.error;T&&(C.error=a.default.fromValues(T));var x=C.messages;if(x)for(var v=0;v<x.length;v++)x[v]=l.default.fromValues(x[v]);var A=C.presence;if(A)for(var v=0;v<A.length;v++)A[v]=c.default.fromValues(A[v],!0);return Object.assign(new _,C)},_.stringify=function(C){var T="[ProtocolMessage";C.action!==void 0&&(T+="; action="+_.ActionName[C.action]||!1);for(var x,v=0;v<y.length;v++)x=y[v],C[x]!==void 0&&(T+="; "+x+"="+C[x]);if(C.messages&&(T+="; messages="+h(l.default.fromValuesArray(C.messages))),C.presence&&(T+="; presence="+h(c.default.fromValuesArray(C.presence))),C.error&&(T+="; error="+a.default.fromValues(C.error).toString()),C.auth&&C.auth.accessToken&&(T+="; token="+C.auth.accessToken),C.flags&&(T+="; flags="+E.filter(C.hasFlag).join(",")),C.params){var A="";r.forInOwnNonNullProperties(C.params,function(f){A.length>0&&(A+="; "),A+=f+"="+C.params[f]}),A.length>0&&(T+="; params=["+A+"]")}return T+="]",T},_}();e.default=O},function(s,e,t){(function(n,r){s.exports=e=r(t(6))})(this,function(n){return function(){var r=n,a=r.lib,l=a.WordArray,c=r.enc,u=c.Base64={stringify:function(g){var E=g.words,h=g.sigBytes,y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";g.clamp();for(var O=[],_=0;_<h;_+=3)for(var C=E[_>>>2]>>>24-_%4*8&255,T=E[_+1>>>2]>>>24-(_+1)%4*8&255,x=E[_+2>>>2]>>>24-(_+2)%4*8&255,v=C<<16|T<<8|x,A=0;A<4&&_+A*.75<h;A++)O.push(y.charAt(v>>>6*(3-A)&63));var f=y.charAt(64);if(f)for(;O.length%4;)O.push(f);return O.join("")},parse:function(g){var E=g.length,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",y=this._reverseMap;if(!y){y=this._reverseMap=[];for(var O=0;O<h.length;O++)y[h.charCodeAt(O)]=O}var _=h.charAt(64);if(_){var C=g.indexOf(_);C!==-1&&(E=C)}return m(g,E,y)}};function m(g,E,h){for(var y=[],O=0,_=0;_<E;_++)if(_%4){var C=h[g.charCodeAt(_-1)]<<_%4*2,T=h[g.charCodeAt(_)]>>>6-_%4*2,x=C|T;y[O>>>2]|=x<<24-O%4*8,O++}return l.create(y,O)}}(),n.enc.Base64})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importStar(t(1)),a=n.__importDefault(t(10)),l=n.__importDefault(t(26)),c=n.__importDefault(t(2)),u=n.__importDefault(t(8)),m=n.__importDefault(t(20)),g=n.__importDefault(t(17)),E=n.__importDefault(t(4)),h=n.__importDefault(t(21)),y=n.__importDefault(t(3));function O(T){var x=[80015,80017,80030];return T.code?g.default.isTokenErr(T)?!1:r.arrIn(x,T.code)?!0:T.code>=4e4&&T.code<5e4:!1}function _(T){return O(T)?[a.default.fromValues({action:a.default.Action.ERROR,error:T})]:[a.default.fromValues({action:a.default.Action.DISCONNECTED,error:T})]}var C=function(T){n.__extends(x,T);function x(v,A,f){var p=T.call(this,v,A,f,!0)||this;return p.onAuthUpdated=function(S){p.authParams={access_token:S.token}},p.stream="stream"in f?f.stream:!0,p.sendRequest=null,p.recvRequest=null,p.pendingCallback=null,p.pendingItems=null,p}return x.prototype.connect=function(){var v=this;c.default.logAction(c.default.LOG_MINOR,"CometTransport.connect()","starting"),l.default.prototype.connect.call(this);var A=this.params,f=A.options,p=u.default.getHost(f,A.host),S=u.default.getPort(f),b=f.tls?"https://":"http://";this.baseUri=b+p+":"+S+"/comet/";var P=this.baseUri+"connect";c.default.logAction(c.default.LOG_MINOR,"CometTransport.connect()","uri: "+P),this.auth.getAuthParams(function(B,z){if(B){v.disconnect(B);return}if(!v.isDisposed){v.authParams=z;var W=v.params.getConnectParams(z);"stream"in W&&(v.stream=W.stream),c.default.logAction(c.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+r.toQueryString(W));var N=!1,M=v.recvRequest=v.createRequest(P,null,W,null,v.stream?h.default.REQ_RECV_STREAM:h.default.REQ_RECV);M.on("data",function(D){!v.recvRequest||(N||(N=!0,v.emit("preconnect")),v.onData(D))}),M.on("complete",function(D){if(v.recvRequest||(D=D||new E.default("Request cancelled",80003,400)),v.recvRequest=null,!N&&!D&&(N=!0,v.emit("preconnect")),v.onActivity(),D){D.code?v.onData(_(D)):v.disconnect(D);return}y.default.Config.nextTick(function(){v.recv()})}),M.exec()}})},x.prototype.requestClose=function(){c.default.logAction(c.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},x.prototype.requestDisconnect=function(){c.default.logAction(c.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},x.prototype._requestCloseOrDisconnect=function(v){var A=this,f=v?this.closeUri:this.disconnectUri;if(f){var p=this.createRequest(f,null,this.authParams,null,h.default.REQ_SEND);p.on("complete",function(S){S&&(c.default.logAction(c.default.LOG_ERROR,"CometTransport.request"+(v?"Close()":"Disconnect()"),"request returned err = "+r.inspectError(S)),A.finish("disconnected",S))}),p.exec()}},x.prototype.dispose=function(){var v=this;c.default.logAction(c.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(c.default.logAction(c.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",m.default.disconnected()),y.default.Config.nextTick(function(){v.emit("disposed")}))},x.prototype.onConnect=function(v){var A;if(!this.isDisposed){var f=(A=v.connectionDetails)===null||A===void 0?void 0:A.connectionKey;l.default.prototype.onConnect.call(this,v);var p=this.baseUri+f;c.default.logAction(c.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+p),this.sendUri=p+"/send",this.recvUri=p+"/recv",this.closeUri=p+"/close",this.disconnectUri=p+"/disconnect"}},x.prototype.send=function(v){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(v);return}var A=this.pendingItems||[];A.push(v),this.pendingItems=null,this.sendItems(A)},x.prototype.sendAnyPending=function(){var v=this.pendingItems;!v||(this.pendingItems=null,this.sendItems(v))},x.prototype.sendItems=function(v){var A=this,f=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(v),h.default.REQ_SEND);f.on("complete",function(p,S){if(p&&c.default.logAction(c.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+r.inspectError(p)),A.sendRequest=null,p){p.code?A.onData(_(p)):A.disconnect(p);return}S&&A.onData(S),A.pendingItems&&y.default.Config.nextTick(function(){A.sendRequest||A.sendAnyPending()})}),f.exec()},x.prototype.recv=function(){var v=this;if(!this.recvRequest&&!!this.isConnected){var A=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?h.default.REQ_RECV_STREAM:h.default.REQ_RECV_POLL);A.on("data",function(f){v.onData(f)}),A.on("complete",function(f){if(v.recvRequest=null,v.onActivity(),f){f.code?v.onData(_(f)):v.disconnect(f);return}y.default.Config.nextTick(function(){v.recv()})}),A.exec()}},x.prototype.onData=function(v){try{var A=this.decodeResponse(v);if(A&&A.length)for(var f=0;f<A.length;f++)this.onProtocolMessage(a.default.fromDeserialized(A[f]))}catch(p){c.default.logAction(c.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+p.stack)}},x.prototype.encodeRequest=function(v){return JSON.stringify(v)},x.prototype.decodeResponse=function(v){return typeof v=="string"?JSON.parse(v):v},x}(l.default);e.default=C},function(s,e){var t;t=function(){return this}();try{t=t||new Function("return this")()}catch(n){typeof window=="object"&&(t=window)}s.exports=t},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importDefault(t(3)),a=n.__importStar(t(1)),l=n.__importDefault(t(2)),c=n.__importDefault(t(17)),u=n.__importDefault(t(18)),m=t(4);function g(C,T,x,v,A){C.http.supportsAuthHeaders?C.auth.getAuthHeaders(function(f,p){f?v(f):A(a.mixin(p,T),x)}):C.auth.getAuthParams(function(f,p){f?v(f):A(T,a.mixin(p,x))})}function E(C,T){return function(x,v,A,f,p){if(x&&!v){C(x);return}if(!f)try{v=a.decodeBody(v,T)}catch(W){a.isErrorInfoOrPartialErrorInfo(W)?C(W):C(new m.PartialErrorInfo(a.inspectError(W),null));return}if(!v){C(new m.PartialErrorInfo("unenvelope(): Response body is missing",null));return}var S=v,b=S.statusCode,P=S.response,B=S.headers;if(b===void 0){C(x,v,A,!0,p);return}if(b<200||b>=300){var z=P&&P.error||x;z||(z=new Error("Error in unenveloping "+v),z.statusCode=b),C(z,P,B,!0,b);return}C(x,P,B,!0,b)}}function h(C){var T=[];if(C)for(var x in C)T.push(x+"="+C[x]);return T.join("&")}function y(C,T){return C+(T?"?":"")+h(T)}function O(C,T,x,v){return function(A,f,p,S,b){A?l.default.logAction(l.default.LOG_MICRO,"Resource."+T+"()","Received Error; "+y(x,v)+"; Error: "+a.inspectError(A)):l.default.logAction(l.default.LOG_MICRO,"Resource."+T+"()","Received; "+y(x,v)+"; Headers: "+h(p)+"; StatusCode: "+b+"; Body: "+(r.default.BufferUtils.isBuffer(f)?f.toString():f)),C&&C(A,f,p,S,b)}}var _=function(){function C(){}return C.get=function(T,x,v,A,f,p){C.do(u.default.Get,T,x,null,v,A,f,p)},C.delete=function(T,x,v,A,f,p){C.do(u.default.Delete,T,x,null,v,A,f,p)},C.post=function(T,x,v,A,f,p,S){C.do(u.default.Post,T,x,v,A,f,p,S)},C.patch=function(T,x,v,A,f,p,S){C.do(u.default.Patch,T,x,v,A,f,p,S)},C.put=function(T,x,v,A,f,p,S){C.do(u.default.Put,T,x,v,A,f,p,S)},C.do=function(T,x,v,A,f,p,S,b){l.default.shouldLog(l.default.LOG_MICRO)&&(b=O(b,T,v,p)),S&&(b=b&&E(b,S),(p=p||{}).envelope=S);function P(B,z){var W;if(l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"Resource."+T+"()","Sending; "+y(v,z)),l.default.shouldLog(l.default.LOG_MICRO)){var N=A;if(((W=B["content-type"])===null||W===void 0?void 0:W.indexOf("msgpack"))>0)try{N=r.default.Config.msgpack.decode(A)}catch(M){l.default.logAction(l.default.LOG_MICRO,"Resource."+T+"()","Sending MsgPack Decoding Error: "+a.inspectError(M))}l.default.logAction(l.default.LOG_MICRO,"Resource."+T+"()","Sending; "+y(v,z)+"; Body: "+N)}x.http.do(T,x,v,B,A,z,function(M,D,U,G,J){if(M&&c.default.isTokenErr(M)){x.auth.authorize(null,null,function(tt){if(tt){b(tt);return}g(x,U,z,b,P)});return}b(M,D,U,G,J)})}g(x,f,p,b,P)},C}();e.default=_},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importDefault(t(2)),a=n.__importDefault(t(3)),l=n.__importDefault(t(9)),c=n.__importStar(t(1));function u(g){return m.Actions.indexOf(g)}var m=function(){function g(){}return g.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},g.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var E=this.id.split(":");return{connectionId:E[0],msgSerial:parseInt(E[1],10),index:parseInt(E[2],10)}},g.prototype.toJSON=function(){var E=this.data,h=this.encoding;return E&&a.default.BufferUtils.isBuffer(E)&&(arguments.length>0?(h=h?h+"/base64":"base64",E=a.default.BufferUtils.base64Encode(E)):E=a.default.BufferUtils.toBuffer(E)),{id:this.id,clientId:this.clientId,action:u(this.action),data:E,encoding:h,extras:this.extras}},g.prototype.toString=function(){var E="[PresenceMessage";return E+="; action="+this.action,this.id&&(E+="; id="+this.id),this.timestamp&&(E+="; timestamp="+this.timestamp),this.clientId&&(E+="; clientId="+this.clientId),this.connectionId&&(E+="; connectionId="+this.connectionId),this.encoding&&(E+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?E+="; data="+this.data:a.default.BufferUtils.isBuffer(this.data)?E+="; data (buffer)="+a.default.BufferUtils.base64Encode(this.data):E+="; data (json)="+JSON.stringify(this.data)),this.extras&&(E+="; extras="+JSON.stringify(this.extras)),E+="]",E},g.fromResponseBody=function(E,h,y){var O=[];y&&(E=c.decodeBody(E,y));for(var _=0;_<E.length;_++){var C=O[_]=g.fromValues(E[_],!0);try{g.decode(C,h)}catch(T){r.default.logAction(r.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",T.toString())}}return O},g.fromValues=function(E,h){return h&&(E.action=g.Actions[E.action]),Object.assign(new g,E)},g.fromValuesArray=function(E){for(var h=E.length,y=new Array(h),O=0;O<h;O++)y[O]=g.fromValues(E[O]);return y},g.fromEncoded=function(E,h){var y=g.fromValues(E,!0);try{g.decode(y,h!=null?h:{})}catch(O){r.default.logAction(r.default.LOG_ERROR,"PresenceMessage.fromEncoded()",O.toString())}return y},g.fromEncodedArray=function(E,h){return E.map(function(y){return g.fromEncoded(y,h)})},g.fromData=function(E){return E instanceof g?E:g.fromValues({data:E})},g.Actions=["absent","present","enter","leave","update"],g.encode=l.default.encode,g.decode=l.default.decode,g.getMessagesSize=l.default.getMessagesSize,g}();e.default=m},function(s,e,t){"use strict";(function(n){Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),a=r.__importStar(t(1)),l=r.__importDefault(t(7)),c=r.__importStar(t(4)),u=r.__importDefault(t(2)),m=r.__importDefault(t(8)),g=r.__importDefault(t(21)),E=r.__importDefault(t(3));function h(b,P){return a.arrIn(a.allToLowerCase(a.keysArray(P)),"x-ably-errorcode")}function y(b,P){if(h(b,P))return b.error&&c.default.fromValues(b.error)}var O=function(){},_=0,C={},T=typeof n!="undefined"&&n.XDomainRequest;function x(){var b=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return b&&Number(b[1])}function v(){var b;return T&&(b=x())&&b===10}function A(b,P){return b.getResponseHeader&&b.getResponseHeader(P)}function f(b){return b.getResponseHeader&&(b.getResponseHeader("transfer-encoding")||!b.getResponseHeader("content-length"))}function p(b){for(var P=a.trim(b.getAllResponseHeaders()).split(`\r
`),B={},z=0;z<P.length;z++){var W=P[z].split(":").map(a.trim);B[W[0].toLowerCase()]=W[1]}return B}var S=function(b){r.__extends(P,b);function P(B,z,W,N,M,D,U){var G=b.call(this)||this;return W=W||{},W.rnd=a.cheapRandStr(),v()&&!W.envelope&&(W.envelope="json"),G.uri=B+a.toQueryString(W),G.headers=z||{},G.body=N,G.method=U?U.toUpperCase():a.isEmptyArg(N)?"GET":"POST",G.requestMode=M,G.timeouts=D,G.timedOut=!1,G.requestComplete=!1,G.id=String(++_),C[G.id]=G,G}return P.createRequest=function(B,z,W,N,M,D,U){var G=D||m.default.TIMEOUTS;return new P(B,z,a.copy(W),N,M,G,U)},P.prototype.complete=function(B,z,W,N,M){this.requestComplete||(this.requestComplete=!0,!B&&z&&this.emit("data",z),this.emit("complete",B,z,W,N,M),this.dispose())},P.prototype.abort=function(){this.dispose()},P.prototype.exec=function(){var B=this,z=this.headers,W=this.requestMode==g.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,N=this.timer=setTimeout(function(){B.timedOut=!0,D.abort()},W),M=this.method,D=this.xhr=new XMLHttpRequest,U=z.accept,G=this.body,J="text";if(U?U.indexOf("application/x-msgpack")===0&&(J="arraybuffer"):z.accept="application/json",G){var tt=z["content-type"]||(z["content-type"]="application/json");tt.indexOf("application/json")>-1&&typeof G!="string"&&(G=JSON.stringify(G))}D.open(M,this.uri,!0),D.responseType=J,"authorization"in z&&(D.withCredentials=!0);for(var it in z)D.setRequestHeader(it,z[it]);var X=function(ht,Qt,Ee,se){var me,dn=Qt+" (event type: "+ht.type+")";!((me=B==null?void 0:B.xhr)===null||me===void 0)&&me.statusText&&(dn+=", current statusText is "+B.xhr.statusText),u.default.logAction(u.default.LOG_ERROR,"Request.on"+ht.type+"()",dn),B.complete(new c.PartialErrorInfo(dn,Ee,se))};D.onerror=function(ht){X(ht,"XHR error occurred",null,400)},D.onabort=function(ht){B.timedOut?X(ht,"Request aborted due to request timeout expiring",null,408):X(ht,"Request cancelled",null,400)},D.ontimeout=function(ht){X(ht,"Request timed out",null,408)};var R,k,H,j=0,et=!1,ft=function(){if(clearTimeout(N),H=k<400,k==204){B.complete(null,null,null,null,k);return}R=B.requestMode==g.default.REQ_RECV_STREAM&&H&&f(D)},gt=function(){var ht;try{var Qt=A(D,"content-type"),Ee=Qt?Qt.indexOf("application/json")>=0:D.responseType=="text";if(Ee){var se=D.responseType==="arraybuffer"?E.default.BufferUtils.utf8Decode(D.response):String(D.responseText);se.length?ht=JSON.parse(se):ht=se,et=!0}else ht=D.response;ht.response!==void 0?(k=ht.statusCode,H=k<400,z=ht.headers,ht=ht.response):z=p(D)}catch(dn){B.complete(new c.PartialErrorInfo("Malformed response body from server: "+dn.message,null,400));return}if(H||a.isArray(ht)){B.complete(null,ht,z,et,k);return}var me=y(ht,z);me||(me=new c.PartialErrorInfo("Error response received from server: "+k+" body was: "+E.default.Config.inspect(ht),null,k)),B.complete(me,ht,z,et,k)};function Et(){for(var ht=D.responseText,Qt=ht.length-1,Ee,se;j<Qt&&(Ee=ht.indexOf(`
`,j))>-1;)se=ht.slice(j,Ee),j=Ee+1,Ct(se)}var Ct=function(ht){try{ht=JSON.parse(ht)}catch(Qt){B.complete(new c.PartialErrorInfo("Malformed response body from server: "+Qt.message,null,400));return}B.emit("data",ht)},Vt=function(){Et(),B.streamComplete=!0,E.default.Config.nextTick(function(){B.complete()})};D.onreadystatechange=function(){var ht=D.readyState;ht<3||D.status!==0&&(k===void 0&&(k=D.status,k===1223&&(k=204),ft()),ht==3&&R?Et():ht==4&&(R?Vt():gt()))},D.send(G)},P.prototype.dispose=function(){var B=this.xhr;if(B){B.onreadystatechange=B.onerror=B.onabort=B.ontimeout=O,this.xhr=null;var z=this.timer;z&&(clearTimeout(z),this.timer=null),this.requestComplete||B.abort()}delete C[this.id]},P}(l.default);e.default=S}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importDefault(t(2)),a=n.__importStar(t(1)),l=n.__importDefault(t(23)),c=n.__importDefault(t(4)),u=n.__importDefault(t(45)),m=t(11),g=n.__importDefault(t(18)),E=n.__importDefault(t(25)),h=n.__importDefault(t(3)),y=n.__importDefault(t(14)),O=Math.pow(2,17);function _(){}function C(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function T(W){return!!W.connection}function x(W){return a.isErrorInfoOrPartialErrorInfo(W)?(W.code||(W.statusCode===403?W.code=40300:(W.code=40170,W.statusCode=401)),W):new c.default(a.inspectError(W),W.code||40170,W.statusCode||401)}var v=function(W,N){if(h.default.Config.createHmac){var M=h.default.Config.createHmac("SHA256",N);return M.update(W),M.digest("base64")}return(0,m.stringify)((0,u.default)(W,N))};function A(W){if(!W)return"";typeof W=="string"&&(W=JSON.parse(W));var N=Object.create(null),M=a.keysArray(W,!0);if(!M)return"";M.sort();for(var D=0;D<M.length;D++)N[M[D]]=W[M[D]].sort();return JSON.stringify(N)}function f(W){if(W.authCallback)r.default.logAction(r.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(W.authUrl)r.default.logAction(r.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(W.key)r.default.logAction(r.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(W.tokenDetails)r.default.logAction(r.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var N="authOptions must include valid authentication parameters";throw r.default.logAction(r.default.LOG_ERROR,"Auth()",N),new Error(N)}}function p(W){return"useTokenAuth"in W&&!W.useTokenAuth}function S(W){return W.useTokenAuth||!p(W)&&(W.authCallback||W.authUrl||W.token||W.tokenDetails)}function b(W){return!W.key&&!W.authCallback&&!W.authUrl}var P=0;function B(){return P++}var z=function(){function W(N,M){if(this.authOptions={},this.client=N,this.tokenParams=M.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,S(M)){if(M.key&&!v){var D="client-side token request signing not supported";throw r.default.logAction(r.default.LOG_ERROR,"Auth()",D),new Error(D)}b(M)&&r.default.logAction(r.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(M.defaultTokenParams,M),f(this.authOptions)}else{if(!M.key){var D="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw r.default.logAction(r.default.LOG_ERROR,"Auth()",D),new c.default(D,40160,401)}r.default.logAction(r.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(M)}}return W.prototype.authorize=function(N,M,D){var U=this,G;if(typeof N=="function"&&!D?(D=N,G=N=null):typeof M=="function"&&!D?(D=M,G=null):G=M,!D&&this.client.options.promises)return a.promisify(this,"authorize",arguments);if(G&&G.key&&this.authOptions.key!==G.key)throw new c.default("Unable to update auth options with incompatible key",40102,401);G&&"force"in G&&(r.default.logAction(r.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),a.isOnlyPropIn(G,"force")&&(G=null)),this._forceNewToken(N,G,function(J,tt){if(J){U.client.connection&&J.statusCode===E.default.Forbidden&&U.client.connection.connectionManager.actOnErrorFromAuthorize(J),D==null||D(J);return}T(U.client)?U.client.connection.connectionManager.onAuthUpdated(tt,D||_):D==null||D(null,tt)})},W.prototype.authorise=function(N,M,D){r.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(N,M,D)},W.prototype._forceNewToken=function(N,M,D){var U=this;this.tokenDetails=null,this._saveTokenOptions(N,M),f(this.authOptions),this._ensureValidAuthCredentials(!0,function(G,J){delete U.tokenParams.timestamp,delete U.authOptions.queryTime,D(G,J)})},W.prototype.requestToken=function(N,M,D){var U=this;if(typeof N=="function"&&!D?(D=N,M=N=null):typeof M=="function"&&!D&&(D=M,M=null),!D&&this.client.options.promises)return a.promisify(this,"requestToken",arguments);M=M||this.authOptions,N=N||a.copy(this.tokenParams);var G=D||_,J,tt=this.client;if(M.authCallback)r.default.logAction(r.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),J=M.authCallback;else if(M.authUrl)r.default.logAction(r.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),J=function(j,et){var ft=a.mixin({accept:"application/json, text/plain"},M.authHeaders),gt=M.authMethod&&M.authMethod.toLowerCase()==="post",Et,Ct=M.authUrl.indexOf("?");Ct>-1&&(Et=a.parseQueryString(M.authUrl.slice(Ct)),M.authUrl=M.authUrl.slice(0,Ct),gt||(M.authParams=a.mixin(Et,M.authParams)));var Vt=a.mixin({},M.authParams||{},j),ht=function(se,me,dn,An){var ue;if(se?r.default.logAction(r.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+a.inspectError(se)):(ue=dn["content-type"],r.default.logAction(r.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+ue+"; body: "+a.inspectBody(me))),se||An)return et(se,me);if(h.default.BufferUtils.isBuffer(me)&&(me=me.toString()),!ue){et(new c.default("authUrl response is missing a content-type header",40170,401));return}var wn=ue.indexOf("application/json")>-1,Jn=ue.indexOf("text/plain")>-1||ue.indexOf("application/jwt")>-1;if(!wn&&!Jn){et(new c.default("authUrl responded with unacceptable content-type "+ue+", should be either text/plain, application/jwt or application/json",40170,401));return}if(wn){if(me.length>O){et(new c.default("authUrl response exceeded max permitted length",40170,401));return}try{me=JSON.parse(me)}catch(Xr){et(new c.default("Unexpected error processing authURL response; err = "+Xr.message,40170,401));return}}et(null,me,ue)};if(r.default.logAction(r.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+M.authUrl+"; Params: "+JSON.stringify(Vt)+"; method: "+(gt?"POST":"GET")),gt){var Qt=ft||{};Qt["content-type"]="application/x-www-form-urlencoded";var Ee=a.toQueryString(Vt).slice(1);U.client.http.doUri(g.default.Post,tt,M.authUrl,Qt,Ee,Et,ht)}else U.client.http.doUri(g.default.Get,tt,M.authUrl,ft||{},null,Vt,ht)};else if(M.key)r.default.logAction(r.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),J=function(j,et){U.createTokenRequest(j,M,et)};else{var it="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";r.default.logAction(r.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),G(new c.default(it,40171,403));return}"capability"in N&&(N.capability=A(N.capability));var X=function(j,et){var ft=j.keyName,gt="/keys/"+ft+"/requestToken",Et=function(Vt){return tt.baseUri(Vt)+gt},Ct=a.defaultPostHeaders(U.client.options);M.requestHeaders&&a.mixin(Ct,M.requestHeaders),r.default.logAction(r.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+gt+"; Token params: "+JSON.stringify(j)),U.client.http.do(g.default.Post,tt,Et,Ct,JSON.stringify(j),null,et)},R=!1,k=this.client.options.timeouts.realtimeRequestTimeout,H=setTimeout(function(){R=!0;var j="Token request callback timed out after "+k/1e3+" seconds";r.default.logAction(r.default.LOG_ERROR,"Auth.requestToken()",j),G(new c.default(j,40170,401))},k);J(N,function(j,et,ft){if(!R){if(clearTimeout(H),j){r.default.logAction(r.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+a.inspectError(j)),G(x(j));return}if(typeof et=="string"){et.length===0?G(new c.default("Token string is empty",40170,401)):et.length>O?G(new c.default("Token string exceeded max permitted length (was "+et.length+" bytes)",40170,401)):et==="undefined"||et==="null"?G(new c.default("Token string was literal null/undefined",40170,401)):et[0]==="{"&&!(ft&&ft.indexOf("application/jwt")>-1)?G(new c.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):G(null,{token:et});return}if(typeof et!="object"){var gt="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof et;r.default.logAction(r.default.LOG_ERROR,"Auth.requestToken()",gt),G(new c.default(gt,40170,401));return}var Et=JSON.stringify(et).length;if(Et>O&&!M.suppressMaxLengthCheck){G(new c.default("Token request/details object exceeded max permitted stringified size (was "+Et+" bytes)",40170,401));return}if("issued"in et){G(null,et);return}if(!("keyName"in et)){var gt="Expected token request callback to call back with a token string, token request object, or token details object";r.default.logAction(r.default.LOG_ERROR,"Auth.requestToken()",gt),G(new c.default(gt,40170,401));return}X(et,function(Ct,Vt,ht,Qt){if(Ct){r.default.logAction(r.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+a.inspectError(Ct)),G(x(Ct));return}Qt||(Vt=JSON.parse(Vt)),r.default.logAction(r.default.LOG_MINOR,"Auth.getToken()","token received"),G(null,Vt)})}})},W.prototype.createTokenRequest=function(N,M,D){var U=this;if(typeof N=="function"&&!D?(D=N,M=N=null):typeof M=="function"&&!D&&(D=M,M=null),!D&&this.client.options.promises)return a.promisify(this,"createTokenRequest",arguments);M=M||this.authOptions,N=N||a.copy(this.tokenParams);var G=M.key;if(!G){D(new c.default("No key specified",40101,403));return}var J=G.split(":"),tt=J[0],it=J[1];if(!it){D(new c.default("Invalid key specified",40101,403));return}if(N.clientId===""){D(new c.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in N&&(N.capability=A(N.capability));var X=a.mixin({keyName:tt},N),R=N.clientId||"",k=N.ttl||"",H=N.capability||"";(function(j){if(X.timestamp){j();return}U.getTimestamp(M&&M.queryTime,function(et,ft){if(et){D(et);return}X.timestamp=ft,j()})})(function(){var j=X.nonce||(X.nonce=C()),et=X.timestamp,ft=X.keyName+`
`+k+`
`+H+`
`+R+`
`+et+`
`+j+`
`;X.mac=X.mac||v(ft,it),r.default.logAction(r.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),D(null,X)})},W.prototype.getAuthParams=function(N){this.method=="basic"?N(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(M,D){if(M){N(M);return}if(!D)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");N(null,{access_token:D.token})})},W.prototype.getAuthHeaders=function(N){this.method=="basic"?N(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(M,D){if(M){N(M);return}if(!D)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");N(null,{authorization:"Bearer "+a.toBase64(D.token)})})},W.prototype.getTimestamp=function(N,M){!this.isTimeOffsetSet()&&(N||this.authOptions.queryTime)?this.client.time(M):M(null,this.getTimestampUsingOffset())},W.prototype.getTimestampUsingOffset=function(){return a.now()+(this.client.serverTimeOffset||0)},W.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},W.prototype._saveBasicOptions=function(N){this.method="basic",this.key=N.key,this.basicKey=a.toBase64(N.key),this.authOptions=N||{},"clientId"in N&&this._userSetClientId(N.clientId)},W.prototype._saveTokenOptions=function(N,M){this.method="token",N&&(this.tokenParams=N),M&&(M.token&&(M.tokenDetails=typeof M.token=="string"?{token:M.token}:M.token),M.tokenDetails&&(this.tokenDetails=M.tokenDetails),"clientId"in M&&this._userSetClientId(M.clientId),this.authOptions=M)},W.prototype._ensureValidAuthCredentials=function(N,M){var D=this,U=this.tokenDetails;if(U){if(this._tokenClientIdMismatch(U.clientId)){M(new c.default("Mismatch between clientId in token ("+U.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!U.expires||U.expires>=this.getTimestampUsingOffset()){r.default.logAction(r.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+U.expires),M(null,U);return}r.default.logAction(r.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=l.default.create())).push(M),!(this.currentTokenRequestId!==null&&!N)){var G=this.currentTokenRequestId=B();this.requestToken(this.tokenParams,this.authOptions,function(J,tt){if(D.currentTokenRequestId>G){r.default.logAction(r.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}D.currentTokenRequestId=null;var it=D.waitingForTokenRequest||_;if(D.waitingForTokenRequest=null,J){it(J);return}it(null,D.tokenDetails=tt)})}},W.prototype._userSetClientId=function(N){if(typeof N=="string"||N===null){if(N==="*")throw new c.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var M=this._uncheckedSetClientId(N);if(M)throw M}else throw new c.default("clientId must be either a string or null",40012,400)},W.prototype._uncheckedSetClientId=function(N){if(this._tokenClientIdMismatch(N)){var M="Unexpected clientId mismatch: client has "+this.clientId+", requested "+N,D=new c.default(M,40102,401);return r.default.logAction(r.default.LOG_ERROR,"Auth._uncheckedSetClientId()",M),D}else return this.clientId=this.tokenParams.clientId=N,null},W.prototype._tokenClientIdMismatch=function(N){return!!(this.clientId&&this.clientId!=="*"&&N&&N!=="*"&&this.clientId!==N)},W.isTokenErr=function(N){return N.code&&N.code>=40140&&N.code<40150},W.prototype.revokeTokens=function(N,M,D){if(S(this.client.options))throw new c.default("Cannot revoke tokens when using token auth",40162,401);var U=this.client.options.keyName,G;if(typeof M=="function"?(D=M,G={}):G=M!=null?M:{},D===void 0){if(this.client.options.promises)return a.promisify(this,"revokeTokens",[N,G]);D=_}var J=D,tt=n.__assign({targets:N.map(function(k){return"".concat(k.type,":").concat(k.value)})},G),it=this.client.options.useBinaryProtocol?a.Format.msgpack:a.Format.json,X=a.defaultPostHeaders(this.client.options,it);this.client.options.headers&&a.mixin(X,this.client.options.headers);var R=a.encodeBody(tt,it);y.default.post(this.client,"/keys/".concat(U,"/revokeTokens"),R,X,{newBatchResponse:"true"},null,function(k,H,j,et){if(k){J(k);return}var ft=et?H:a.decodeBody(H,it);J(null,ft)})},W}();e.default=z},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n;(function(r){r.Get="get",r.Delete="delete",r.Post="post",r.Put="put",r.Patch="patch"})(n||(n={})),e.default=n},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HttpPaginatedResponse=e.PaginatedResult=void 0;var n=t(0),r=n.__importStar(t(1)),a=n.__importDefault(t(2)),l=n.__importDefault(t(14));function c(y){var O=y.match(/^\.\/(\w+)\?(.*)$/);return O&&O[2]&&r.parseQueryString(O[2])}function u(y){typeof y=="string"&&(y=y.split(","));for(var O={},_=0;_<y.length;_++){var C=y[_].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(C){var T=c(C[1]);T&&(O[C[2]]=T)}}return O}function m(y,O,_){return!(_&&(O||typeof y.code=="number"))}var g=function(){function y(O,_,C,T,x,v){this.rest=O,this.path=_,this.headers=C,this.envelope=T!=null?T:null,this.bodyHandler=x,this.useHttpPaginatedResponse=v||!1}return y.prototype.get=function(O,_){var C=this;l.default.get(this.rest,this.path,this.headers,O,this.envelope,function(T,x,v,A,f){C.handlePage(T,x,v,A,f,_)})},y.prototype.delete=function(O,_){var C=this;l.default.delete(this.rest,this.path,this.headers,O,this.envelope,function(T,x,v,A,f){C.handlePage(T,x,v,A,f,_)})},y.prototype.post=function(O,_,C){var T=this;l.default.post(this.rest,this.path,_,this.headers,O,this.envelope,function(x,v,A,f,p){C&&T.handlePage(x,v,A,f,p,C)})},y.prototype.put=function(O,_,C){var T=this;l.default.put(this.rest,this.path,_,this.headers,O,this.envelope,function(x,v,A,f,p){C&&T.handlePage(x,v,A,f,p,C)})},y.prototype.patch=function(O,_,C){var T=this;l.default.patch(this.rest,this.path,_,this.headers,O,this.envelope,function(x,v,A,f,p){C&&T.handlePage(x,v,A,f,p,C)})},y.prototype.handlePage=function(O,_,C,T,x,v){if(O&&m(O,_,this.useHttpPaginatedResponse)){a.default.logAction(a.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+r.inspectError(O)),v==null||v(O);return}var A,f,p;try{A=this.bodyHandler(_,C||{},T)}catch(S){v==null||v(O||S);return}C&&(f=C.Link||C.link)&&(p=u(f)),this.useHttpPaginatedResponse?v(null,new h(this,A,C||{},x,p,O)):v(null,new E(this,A,p))},y}(),E=function(){function y(O,_,C){var T=this;this.resource=O,this.items=_;var x=this;C&&("first"in C&&(this.first=function(v){if(!v&&x.resource.rest.options.promises)return r.promisify(x,"first",[]);x.get(C.first,v)}),"current"in C&&(this.current=function(v){if(!v&&x.resource.rest.options.promises)return r.promisify(x,"current",[]);x.get(C.current,v)}),this.next=function(v){if(!v&&x.resource.rest.options.promises)return r.promisify(x,"next",[]);"next"in C?x.get(C.next,v):v(null)},this.hasNext=function(){return"next"in C},this.isLast=function(){var v;return!(!((v=T.hasNext)===null||v===void 0)&&v.call(T))})}return y.prototype.get=function(O,_){var C=this.resource;l.default.get(C.rest,C.path,C.headers,O,C.envelope,function(T,x,v,A,f){C.handlePage(T,x,v,A,f,_)})},y}();e.PaginatedResult=E;var h=function(y){n.__extends(O,y);function O(_,C,T,x,v,A){var f=y.call(this,_,C,v)||this;return f.statusCode=x,f.success=x<300&&x>=200,f.headers=T,f.errorCode=A&&A.code,f.errorMessage=A&&A.message,f}return O.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},O}(E);e.HttpPaginatedResponse=h,e.default=g},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isRetriable=void 0;var n=t(0),r=n.__importDefault(t(4)),a={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},l={disconnected:function(){return r.default.fromValues({statusCode:400,code:a.DISCONNECTED,message:"Connection to server temporarily unavailable"})},suspended:function(){return r.default.fromValues({statusCode:400,code:a.SUSPENDED,message:"Connection to server unavailable"})},failed:function(){return r.default.fromValues({statusCode:400,code:a.FAILED,message:"Connection failed or disconnected by server"})},closing:function(){return r.default.fromValues({statusCode:400,code:a.CLOSING,message:"Connection closing"})},closed:function(){return r.default.fromValues({statusCode:400,code:a.CLOSED,message:"Connection closed"})},unknownConnectionErr:function(){return r.default.fromValues({statusCode:500,code:a.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"})},unknownChannelErr:function(){return r.default.fromValues({statusCode:500,code:a.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})}};function c(u){return!u.statusCode||!u.code||u.statusCode>=500?!0:Object.values(a).includes(u.code)}e.isRetriable=c,e.default=l},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n;(function(r){r[r.REQ_SEND=0]="REQ_SEND",r[r.REQ_RECV=1]="REQ_RECV",r[r.REQ_RECV_POLL=2]="REQ_RECV_POLL",r[r.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(n||(n={})),e.default=n},function(s,e,t){(function(n,r){s.exports=e=r(t(6),t(5),t(58),t(11),t(40),t(32),t(24),t(27),t(28),t(59),t(60))})(this,function(n){return n})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importDefault(t(2)),a=function(){function l(c){this.members=c||[]}return l.prototype.call=function(){for(var c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];for(var m=0,g=this.members;m<g.length;m++){var E=g[m];if(E)try{E.apply(void 0,c)}catch(h){r.default.logAction(r.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+h+"; stack = "+h.stack)}}},l.prototype.push=function(){for(var c,u=[],m=0;m<arguments.length;m++)u[m]=arguments[m];(c=this.members).push.apply(c,u)},l.create=function(c){var u=new l(c);return Object.assign(function(){for(var m=[],g=0;g<arguments.length;g++)m[g]=arguments[g];return u.call.apply(u,m)},{push:function(m){return u.push(m)}})},l}();e.default=a},function(s,e,t){(function(n,r){s.exports=e=r(t(6))})(this,function(n){(function(){var r=n,a=r.lib,l=a.Base,c=r.enc,u=c.Utf8,m=r.algo,g=m.HMAC=l.extend({init:function(E,h){E=this._hasher=new E.init,typeof h=="string"&&(h=u.parse(h));var y=E.blockSize,O=y*4;h.sigBytes>O&&(h=E.finalize(h)),h.clamp();for(var _=this._oKey=h.clone(),C=this._iKey=h.clone(),T=_.words,x=C.words,v=0;v<y;v++)T[v]^=1549556828,x[v]^=909522486;_.sigBytes=C.sigBytes=O,this.reset()},reset:function(){var E=this._hasher;E.reset(),E.update(this._iKey)},update:function(E){return this._hasher.update(E),this},finalize:function(E){var h=this._hasher,y=h.finalize(E);h.reset();var O=h.finalize(this._oKey.clone().concat(y));return O}})})()})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isSuccessCode=void 0;var n;(function(a){a[a.Success=200]="Success",a[a.NoContent=204]="NoContent",a[a.BadRequest=400]="BadRequest",a[a.Unauthorized=401]="Unauthorized",a[a.Forbidden=403]="Forbidden",a[a.RequestTimeout=408]="RequestTimeout",a[a.InternalServerError=500]="InternalServerError"})(n||(n={}));function r(a){return a>=n.Success&&a<n.BadRequest}e.isSuccessCode=r,e.default=n},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importDefault(t(10)),a=n.__importStar(t(1)),l=n.__importDefault(t(7)),c=n.__importDefault(t(2)),u=n.__importDefault(t(20)),m=n.__importDefault(t(4)),g=n.__importDefault(t(3)),E=r.default.Action,h=r.default.fromValues({action:E.CLOSE}),y=r.default.fromValues({action:E.DISCONNECT}),O=function(_){n.__extends(C,_);function C(T,x,v,A){var f=_.call(this)||this;return A&&(v.format=void 0,v.heartbeats=!0),f.connectionManager=T,T.registerProposedTransport(f),f.auth=x,f.params=v,f.timeouts=v.options.timeouts,f.format=v.format,f.isConnected=!1,f.isFinished=!1,f.isDisposed=!1,f.maxIdleInterval=null,f.idleTimer=null,f.lastActivity=null,f}return C.prototype.connect=function(){},C.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",u.default.closed())},C.prototype.disconnect=function(T){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",T||u.default.disconnected())},C.prototype.fail=function(T){this.isConnected&&this.requestDisconnect(),this.finish("failed",T||u.default.failed())},C.prototype.finish=function(T,x){var v;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((v=this.idleTimer)!==null&&v!==void 0?v:void 0),this.idleTimer=null,this.emit(T,x),this.dispose())},C.prototype.onProtocolMessage=function(T){switch(c.default.shouldLog(c.default.LOG_MICRO)&&c.default.logAction(c.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+r.default.stringify(T)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),T.action){case E.HEARTBEAT:c.default.logAction(c.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",T.id);break;case E.CONNECTED:this.onConnect(T),this.emit("connected",T.error,T.connectionId,T.connectionDetails,T);break;case E.CLOSED:this.onClose(T);break;case E.DISCONNECTED:this.onDisconnect(T);break;case E.ACK:this.emit("ack",T.msgSerial,T.count);break;case E.NACK:this.emit("nack",T.msgSerial,T.count,T.error);break;case E.SYNC:this.connectionManager.onChannelMessage(T,this);break;case E.ACTIVATE:break;case E.AUTH:this.auth.authorize(function(x){x&&c.default.logAction(c.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+a.inspectError(x))});break;case E.ERROR:if(c.default.logAction(c.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+g.default.Config.inspect(T.error)+(T.channel?", channel: "+T.channel:"")),T.channel===void 0){this.onFatalError(T);break}this.connectionManager.onChannelMessage(T,this);break;default:this.connectionManager.onChannelMessage(T,this)}},C.prototype.onConnect=function(T){if(this.isConnected=!0,!T.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var x=T.connectionDetails.maxIdleInterval;x&&(this.maxIdleInterval=x+this.timeouts.realtimeRequestTimeout,this.onActivity())},C.prototype.onDisconnect=function(T){var x=T&&T.error;c.default.logAction(c.default.LOG_MINOR,"Transport.onDisconnect()","err = "+a.inspectError(x)),this.finish("disconnected",x)},C.prototype.onFatalError=function(T){var x=T&&T.error;c.default.logAction(c.default.LOG_MINOR,"Transport.onFatalError()","err = "+a.inspectError(x)),this.finish("failed",x)},C.prototype.onClose=function(T){var x=T&&T.error;c.default.logAction(c.default.LOG_MINOR,"Transport.onClose()","err = "+a.inspectError(x)),this.finish("closed",x)},C.prototype.requestClose=function(){c.default.logAction(c.default.LOG_MINOR,"Transport.requestClose()",""),this.send(h)},C.prototype.requestDisconnect=function(){c.default.logAction(c.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(y)},C.prototype.ping=function(T){var x={action:r.default.Action.HEARTBEAT};T&&(x.id=T),this.send(r.default.fromValues(x))},C.prototype.dispose=function(){c.default.logAction(c.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},C.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=a.now(),this.setIdleTimer(this.maxIdleInterval+100))},C.prototype.setIdleTimer=function(T){var x=this;this.idleTimer||(this.idleTimer=setTimeout(function(){x.onIdleTimerExpire()},T))},C.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var T=a.now()-this.lastActivity,x=this.maxIdleInterval-T;if(x<=0){var v="No activity seen from realtime in "+T+"ms; assuming connection has dropped";c.default.logAction(c.default.LOG_ERROR,"Transport.onIdleTimerExpire()",v),this.disconnect(new m.default(v,80003,408))}else this.setIdleTimer(x+100)},C.tryConnect=function(T,x,v,A,f){var p=new T(x,v,A),S,b=function(B){clearTimeout(S),f({event:this.event,error:B})},P=x.options.timeouts.realtimeRequestTimeout;S=setTimeout(function(){p.off(["preconnect","disconnected","failed"]),p.dispose(),b.call({event:"disconnected"},new m.default("Timeout waiting for transport to indicate itself viable",5e4,500))},P),p.on(["failed","disconnected"],b),p.on("preconnect",function(){c.default.logAction(c.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+p),clearTimeout(S),p.off(["failed","disconnected"],b),f(null,p)}),p.connect()},C}(l.default);e.default=O},function(s,e,t){(function(n,r){s.exports=e=r(t(6),t(40),t(24))})(this,function(n){return function(){var r=n,a=r.lib,l=a.Base,c=a.WordArray,u=r.algo,m=u.MD5,g=u.EvpKDF=l.extend({cfg:l.extend({keySize:128/32,hasher:m,iterations:1}),init:function(E){this.cfg=this.cfg.extend(E)},compute:function(E,h){for(var y,O=this.cfg,_=O.hasher.create(),C=c.create(),T=C.words,x=O.keySize,v=O.iterations;T.length<x;){y&&_.update(y),y=_.update(E).finalize(h),_.reset();for(var A=1;A<v;A++)y=_.finalize(y),_.reset();C.concat(y)}return C.sigBytes=x*4,C}});r.EvpKDF=function(E,h,y){return g.create(y).compute(E,h)}}(),n.EvpKDF})},function(s,e,t){(function(n,r){s.exports=e=r(t(6),t(27))})(this,function(n){n.lib.Cipher||function(r){var a=n,l=a.lib,c=l.Base,u=l.WordArray,m=l.BufferedBlockAlgorithm,g=a.enc,E=g.Utf8,h=g.Base64,y=a.algo,O=y.EvpKDF,_=l.Cipher=m.extend({cfg:c.extend(),createEncryptor:function(M,D){return this.create(this._ENC_XFORM_MODE,M,D)},createDecryptor:function(M,D){return this.create(this._DEC_XFORM_MODE,M,D)},init:function(M,D,U){this.cfg=this.cfg.extend(U),this._xformMode=M,this._key=D,this.reset()},reset:function(){m.reset.call(this),this._doReset()},process:function(M){return this._append(M),this._process()},finalize:function(M){M&&this._append(M);var D=this._doFinalize();return D},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function M(D){return typeof D=="string"?N:B}return function(D){return{encrypt:function(U,G,J){return M(G).encrypt(D,U,G,J)},decrypt:function(U,G,J){return M(G).decrypt(D,U,G,J)}}}}()}),C=l.StreamCipher=_.extend({_doFinalize:function(){var M=this._process(!0);return M},blockSize:1}),T=a.mode={},x=l.BlockCipherMode=c.extend({createEncryptor:function(M,D){return this.Encryptor.create(M,D)},createDecryptor:function(M,D){return this.Decryptor.create(M,D)},init:function(M,D){this._cipher=M,this._iv=D}}),v=T.CBC=function(){var M=x.extend();M.Encryptor=M.extend({processBlock:function(U,G){var J=this._cipher,tt=J.blockSize;D.call(this,U,G,tt),J.encryptBlock(U,G),this._prevBlock=U.slice(G,G+tt)}}),M.Decryptor=M.extend({processBlock:function(U,G){var J=this._cipher,tt=J.blockSize,it=U.slice(G,G+tt);J.decryptBlock(U,G),D.call(this,U,G,tt),this._prevBlock=it}});function D(U,G,J){var tt,it=this._iv;it?(tt=it,this._iv=r):tt=this._prevBlock;for(var X=0;X<J;X++)U[G+X]^=tt[X]}return M}(),A=a.pad={},f=A.Pkcs7={pad:function(M,D){for(var U=D*4,G=U-M.sigBytes%U,J=G<<24|G<<16|G<<8|G,tt=[],it=0;it<G;it+=4)tt.push(J);var X=u.create(tt,G);M.concat(X)},unpad:function(M){var D=M.words[M.sigBytes-1>>>2]&255;M.sigBytes-=D}},p=l.BlockCipher=_.extend({cfg:_.cfg.extend({mode:v,padding:f}),reset:function(){var M;_.reset.call(this);var D=this.cfg,U=D.iv,G=D.mode;this._xformMode==this._ENC_XFORM_MODE?M=G.createEncryptor:(M=G.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==M?this._mode.init(this,U&&U.words):(this._mode=M.call(G,this,U&&U.words),this._mode.__creator=M)},_doProcessBlock:function(M,D){this._mode.processBlock(M,D)},_doFinalize:function(){var M,D=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(D.pad(this._data,this.blockSize),M=this._process(!0)):(M=this._process(!0),D.unpad(M)),M},blockSize:128/32}),S=l.CipherParams=c.extend({init:function(M){this.mixIn(M)},toString:function(M){return(M||this.formatter).stringify(this)}}),b=a.format={},P=b.OpenSSL={stringify:function(M){var D,U=M.ciphertext,G=M.salt;return G?D=u.create([1398893684,1701076831]).concat(G).concat(U):D=U,D.toString(h)},parse:function(M){var D,U=h.parse(M),G=U.words;return G[0]==1398893684&&G[1]==1701076831&&(D=u.create(G.slice(2,4)),G.splice(0,4),U.sigBytes-=16),S.create({ciphertext:U,salt:D})}},B=l.SerializableCipher=c.extend({cfg:c.extend({format:P}),encrypt:function(M,D,U,G){G=this.cfg.extend(G);var J=M.createEncryptor(U,G),tt=J.finalize(D),it=J.cfg;return S.create({ciphertext:tt,key:U,iv:it.iv,algorithm:M,mode:it.mode,padding:it.padding,blockSize:M.blockSize,formatter:G.format})},decrypt:function(M,D,U,G){G=this.cfg.extend(G),D=this._parse(D,G.format);var J=M.createDecryptor(U,G).finalize(D.ciphertext);return J},_parse:function(M,D){return typeof M=="string"?D.parse(M,this):M}}),z=a.kdf={},W=z.OpenSSL={execute:function(M,D,U,G){G||(G=u.random(64/8));var J=O.create({keySize:D+U}).compute(M,G),tt=u.create(J.words.slice(D),U*4);return J.sigBytes=D*4,S.create({key:J,iv:tt,salt:G})}},N=l.PasswordBasedCipher=B.extend({cfg:B.cfg.extend({kdf:W}),encrypt:function(M,D,U,G){G=this.cfg.extend(G);var J=G.kdf.execute(U,M.keySize,M.ivSize);G.iv=J.iv;var tt=B.encrypt.call(this,M,D,J.key,G);return tt.mixIn(J),tt},decrypt:function(M,D,U,G){G=this.cfg.extend(G),D=this._parse(D,G.format);var J=G.kdf.execute(U,M.keySize,M.ivSize,D.salt);G.iv=J.iv;var tt=B.decrypt.call(this,M,D,J.key,G);return tt}})}()})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Request=e.createRequest=void 0;var n=t(0),r=n.__importStar(t(1)),a=n.__importDefault(t(12)),l=n.__importDefault(t(3)),c=n.__importDefault(t(7)),u=t(4),m=n.__importDefault(t(8)),g=n.__importDefault(t(2)),E=n.__importDefault(t(21)),h=r.getGlobalObject(),y=function(){},O=h._ablyjs_jsonp={};O._=function(f){return O["_"+f]||y};var _=1,C="jsonp";function T(f,p,S,b,P,B,z){return B=B||m.default.TIMEOUTS,new v(void 0,f,p,r.copy(S),b,P,B,z)}e.createRequest=T;var x=function(f){n.__extends(p,f);function p(S,b,P){var B=f.call(this,S,b,P)||this;return B.shortName=C,P.stream=!1,B}return p.isAvailable=function(){return l.default.Config.jsonpSupported&&l.default.Config.allowComet},p.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},p.prototype.createRequest=function(S,b,P,B,z,W,N){return W=(this===null||this===void 0?void 0:this.timeouts)||W||m.default.TIMEOUTS,T(S,b,P,B,z,W,N)},p}(a.default),v=function(f){n.__extends(p,f);function p(S,b,P,B,z,W,N,M){var D=f.call(this)||this;return S===void 0&&(S=_++),D.id=S,D.uri=b,D.params=B||{},D.params.rnd=r.cheapRandStr(),P&&(P["X-Ably-Version"]&&(D.params.v=P["X-Ably-Version"]),P["X-Ably-Lib"]&&(D.params.lib=P["X-Ably-Lib"])),D.body=z,D.method=M,D.requestMode=W,D.timeouts=N,D.requestComplete=!1,D}return p.prototype.exec=function(){var S=this,b=this.id,P=this.body,B=this.method,z=this.uri,W=this.params;W.callback="_ablyjs_jsonp._("+b+")",W.envelope="jsonp",P&&(W.body=P),B&&B!=="get"&&(W.method=B);var N=this.script=document.createElement("script"),M=z+r.toQueryString(W);N.src=M,N.src.split("/").slice(-1)[0]!==M.split("/").slice(-1)[0]&&g.default.logAction(g.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),N.async=!0,N.type="text/javascript",N.charset="UTF-8",N.onerror=function(G){S.complete(new u.PartialErrorInfo("JSONP script error (event: "+l.default.Config.inspect(G)+")",null,400))},O["_"+b]=function(G){if(G.statusCode){var J=G.response;if(G.statusCode==204)S.complete(null,null,null,G.statusCode);else if(!J)S.complete(new u.PartialErrorInfo("Invalid server response: no envelope detected",null,500));else if(G.statusCode<400||r.isArray(J))S.complete(null,J,G.headers,G.statusCode);else{var tt=J.error||new u.PartialErrorInfo("Error response received from server",null,G.statusCode);S.complete(tt)}}else S.complete(null,G)};var D=this.requestMode==E.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),D);var U=document.getElementsByTagName("head")[0];U.insertBefore(N,U.firstChild)},p.prototype.complete=function(S,b,P,B){if(P=P||{},!this.requestComplete){this.requestComplete=!0;var z=void 0;b&&(z=typeof b=="string"?"text/plain":"application/json",P["content-type"]=z,this.emit("data",b)),this.emit("complete",S,b,P,!0,B),this.dispose()}},p.prototype.abort=function(){this.dispose()},p.prototype.dispose=function(){var S=this.timer;S&&(clearTimeout(S),this.timer=null);var b=this.script;b.parentNode&&b.parentNode.removeChild(b),delete O[this.id],this.emit("disposed")},p}(c.default);e.Request=v;function A(f){return h.JSONPTransport=x,x.isAvailable()&&(f.supportedTransports[C]=x),x}e.default=A},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importStar(t(1)),a=n.__importDefault(t(2)),l=n.__importDefault(t(8)),c=n.__importDefault(t(17)),u=n.__importDefault(t(46)),m=n.__importDefault(t(19)),g=n.__importDefault(t(33)),E=n.__importDefault(t(4)),h=n.__importDefault(t(49)),y=n.__importDefault(t(18)),O=n.__importDefault(t(3)),_=n.__importDefault(t(9)),C=n.__importDefault(t(15)),T=n.__importDefault(t(14)),x=function(){},v=function(){function f(p){if(!p){var S="no options provided";throw a.default.logAction(a.default.LOG_ERROR,"Rest()",S),new Error(S)}var b=l.default.objectifyOptions(p);b.log&&a.default.setLog(b.log.level,b.log.handler),a.default.logAction(a.default.LOG_MICRO,"Rest()","initialized with clientOptions "+O.default.Config.inspect(p));var P=this.options=l.default.normaliseOptions(b);if(P.key){var B=P.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!B){var S="invalid key parameter";throw a.default.logAction(a.default.LOG_ERROR,"Rest()",S),new E.default(S,40400,404)}P.keyName=B[1],P.keySecret=B[2]}if("clientId"in P)if(typeof P.clientId=="string"||P.clientId===null){if(P.clientId==="*")throw new E.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new E.default("clientId must be either a string or null",40012,400);a.default.logAction(a.default.LOG_MINOR,"Rest()","started; version = "+l.default.version),this.baseUri=this.authority=function(z){return l.default.getHttpScheme(P)+z+":"+l.default.getPort(P,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new O.default.Http(P),this.auth=new c.default(this,P),this.channels=new A(this),this.push=new u.default(this)}return f.prototype.stats=function(p,S){if(S===void 0)if(typeof p=="function")S=p,p=null;else{if(this.options.promises)return r.promisify(this,"stats",[p]);S=x}var b=r.defaultGetHeaders(this.options),P=this.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,B=this.http.supportsLinkHeaders?void 0:P;this.options.headers&&r.mixin(b,this.options.headers),new m.default(this,"/stats",b,B,function(z,W,N){for(var M=N?z:JSON.parse(z),D=0;D<M.length;D++)M[D]=h.default.fromValues(M[D]);return M}).get(p,S)},f.prototype.time=function(p,S){var b=this;if(S===void 0){if(typeof p=="function")S=p,p=null;else if(this.options.promises)return r.promisify(this,"time",[p])}var P=S||x,B=r.defaultGetHeaders(this.options);this.options.headers&&r.mixin(B,this.options.headers);var z=function(W){return b.authority(W)+"/time"};this.http.do(y.default.Get,this,z,B,null,p,function(W,N,M,D){if(W){P(W);return}D||(N=JSON.parse(N));var U=N[0];if(!U){P(new E.default("Internal error (unexpected result type from GET /time)",5e4,500));return}b.serverTimeOffset=U-r.now(),P(null,U)})},f.prototype.request=function(p,S,b,P,B,z){var W=this.options.useBinaryProtocol,N=W?O.default.Config.msgpack.encode:JSON.stringify,M=W?O.default.Config.msgpack.decode:JSON.parse,D=W?r.Format.msgpack:r.Format.json,U=this.http.supportsLinkHeaders?void 0:D;b=b||{};var G=p.toLowerCase(),J=G=="get"?r.defaultGetHeaders(this.options,D):r.defaultPostHeaders(this.options,D);if(z===void 0){if(this.options.promises)return r.promisify(this,"request",[p,S,b,P,B]);z=x}typeof P!="string"&&(P=N(P)),this.options.headers&&r.mixin(J,this.options.headers),B&&r.mixin(J,B);var tt=new m.default(this,S,J,U,function(it,X,R){return r.ensureArray(R?it:M(it))},!0);if(!r.arrIn(O.default.Http.methods,G))throw new E.default("Unsupported method "+G,40500,405);r.arrIn(O.default.Http.methodsWithBody,G)?tt[G](b,P,z):tt[G](b,z)},f.prototype.batchPublish=function(p,S){if(S===void 0){if(this.options.promises)return r.promisify(this,"batchPublish",[p]);S=x}var b=S,P,B;r.isArray(p)?(P=p,B=!1):(P=[p],B=!0);var z=this.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,W=r.defaultPostHeaders(this.options,z);this.options.headers&&r.mixin(W,this.options.headers);var N=r.encodeBody(P,z);T.default.post(this,"/messages",N,W,{newBatchResponse:"true"},null,function(M,D,U,G){if(M){b(M);return}var J=G?D:r.decodeBody(D,z);B?b(null,J[0]):b(null,J)})},f.prototype.batchPresence=function(p,S){if(S===void 0){if(this.options.promises)return r.promisify(this,"batchPresence",[p]);S=x}var b=S,P=this.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,B=r.defaultPostHeaders(this.options,P);this.options.headers&&r.mixin(B,this.options.headers);var z=p.join(",");T.default.get(this,"/presence",B,{newBatchResponse:"true",channels:z},null,function(W,N,M,D){if(W){b(W);return}var U=D?N:r.decodeBody(N,P);b(null,U)})},f.prototype.setLog=function(p){a.default.setLog(p.level,p.handler)},f.Promise=function(p){return p=l.default.objectifyOptions(p),p.promises=!0,new f(p)},f.Callbacks=f,f.Platform=O.default,f.Message=_.default,f.PresenceMessage=C.default,f}(),A=function(){function f(p){this.rest=p,this.all=Object.create(null)}return f.prototype.get=function(p,S){p=String(p);var b=this.all[p];return b?S&&b.setOptions(S):this.all[p]=b=new g.default(this.rest,p,S),b},f.prototype.release=function(p){delete this.all[String(p)]},f}();e.default=v},function(s,e,t){(function(n,r){s.exports=e=r(t(6))})(this,function(n){return n.enc.Utf8})},function(s,e,t){(function(n,r){s.exports=e=r(t(6))})(this,function(n){return function(r){var a=n,l=a.lib,c=l.WordArray,u=l.Hasher,m=a.algo,g=[],E=[];(function(){function O(x){for(var v=r.sqrt(x),A=2;A<=v;A++)if(!(x%A))return!1;return!0}function _(x){return(x-(x|0))*4294967296|0}for(var C=2,T=0;T<64;)O(C)&&(T<8&&(g[T]=_(r.pow(C,1/2))),E[T]=_(r.pow(C,1/3)),T++),C++})();var h=[],y=m.SHA256=u.extend({_doReset:function(){this._hash=new c.init(g.slice(0))},_doProcessBlock:function(O,_){for(var C=this._hash.words,T=C[0],x=C[1],v=C[2],A=C[3],f=C[4],p=C[5],S=C[6],b=C[7],P=0;P<64;P++){if(P<16)h[P]=O[_+P]|0;else{var B=h[P-15],z=(B<<25|B>>>7)^(B<<14|B>>>18)^B>>>3,W=h[P-2],N=(W<<15|W>>>17)^(W<<13|W>>>19)^W>>>10;h[P]=z+h[P-7]+N+h[P-16]}var M=f&p^~f&S,D=T&x^T&v^x&v,U=(T<<30|T>>>2)^(T<<19|T>>>13)^(T<<10|T>>>22),G=(f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25),J=b+G+M+E[P]+h[P],tt=U+D;b=S,S=p,p=f,f=A+J|0,A=v,v=x,x=T,T=J+tt|0}C[0]=C[0]+T|0,C[1]=C[1]+x|0,C[2]=C[2]+v|0,C[3]=C[3]+A|0,C[4]=C[4]+f|0,C[5]=C[5]+p|0,C[6]=C[6]+S|0,C[7]=C[7]+b|0},_doFinalize:function(){var O=this._data,_=O.words,C=this._nDataBytes*8,T=O.sigBytes*8;return _[T>>>5]|=128<<24-T%32,_[(T+64>>>9<<4)+14]=r.floor(C/4294967296),_[(T+64>>>9<<4)+15]=C,O.sigBytes=_.length*4,this._process(),this._hash},clone:function(){var O=u.clone.call(this);return O._hash=this._hash.clone(),O}});a.SHA256=u._createHelper(y),a.HmacSHA256=u._createHmacHelper(y)}(Math),n.SHA256})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importStar(t(1)),a=n.__importDefault(t(7)),l=n.__importDefault(t(2)),c=n.__importDefault(t(34)),u=n.__importDefault(t(9)),m=n.__importDefault(t(4)),g=n.__importDefault(t(19)),E=n.__importDefault(t(14)),h=n.__importDefault(t(3));function y(){}var O=9;function _(x){return r.arrEvery(x,function(v){return!v.id})}function C(x){var v=x||{};if(v.cipher){if(!h.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var A=h.default.Crypto.getCipher(v.cipher);v.cipher=A.cipherParams,v.channelCipher=A.cipher}else"cipher"in v&&(v.cipher=void 0,v.channelCipher=null);return v}var T=function(x){n.__extends(v,x);function v(A,f,p){var S=x.call(this)||this;return l.default.logAction(l.default.LOG_MINOR,"Channel()","started; name = "+f),S.rest=A,S.name=f,S.basePath="/channels/"+encodeURIComponent(f),S.presence=new c.default(S),S.channelOptions=C(p),S}return v.prototype.setOptions=function(A){this.channelOptions=C(A)},v.prototype.history=function(A,f){if(l.default.logAction(l.default.LOG_MICRO,"Channel.history()","channel = "+this.name),f===void 0)if(typeof A=="function")f=A,A=null;else{if(this.rest.options.promises)return r.promisify(this,"history",arguments);f=y}this._history(A,f)},v.prototype._history=function(A,f){var p=this.rest,S=p.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,b=this.rest.http.supportsLinkHeaders?void 0:S,P=r.defaultGetHeaders(p.options,S);p.options.headers&&r.mixin(P,p.options.headers);var B=this.channelOptions;new g.default(p,this.basePath+"/messages",P,b,function(z,W,N){return u.default.fromResponseBody(z,B,N?void 0:S)}).get(A,f)},v.prototype.publish=function(){var A=this,f=arguments.length,p=arguments[0],S=arguments[1],b=arguments[f-1],P,B;if(typeof b!="function"){if(this.rest.options.promises)return r.promisify(this,"publish",arguments);b=y}if(typeof p=="string"||p===null)P=[u.default.fromValues({name:p,data:S})],B=arguments[2];else if(r.isObject(p))P=[u.default.fromValues(p)],B=arguments[1];else if(r.isArray(p))P=u.default.fromValuesArray(p),B=arguments[1];else throw new m.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof B!="object"||!B)&&(B={});var z=this.rest,W=z.options,N=W.useBinaryProtocol?r.Format.msgpack:r.Format.json,M=z.options.idempotentRestPublishing,D=r.defaultPostHeaders(z.options,N);if(W.headers&&r.mixin(D,W.headers),M&&_(P)){var U=r.randomString(O);r.arrForEach(P,function(G,J){G.id=U+":"+J.toString()})}u.default.encodeArray(P,this.channelOptions,function(G){if(G){b(G);return}var J=u.default.getMessagesSize(P),tt=W.maxMessageSize;if(J>tt){b(new m.default("Maximum size of messages that can be published at once exceeded ( was "+J+" bytes; limit is "+tt+" bytes)",40009,400));return}A._publish(u.default.serialize(P,N),D,B,b)})},v.prototype._publish=function(A,f,p,S){E.default.post(this.rest,this.basePath+"/messages",A,f,p,null,S)},v.prototype.status=function(A){if(typeof A!="function"&&this.rest.options.promises)return r.promisify(this,"status",[]);var f=this.rest.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,p=r.defaultPostHeaders(this.rest.options,f);E.default.get(this.rest,this.basePath,p,{},f,A||y)},v}(a.default);e.default=T},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importStar(t(1)),a=n.__importDefault(t(7)),l=n.__importDefault(t(2)),c=n.__importDefault(t(19)),u=n.__importDefault(t(15));function m(){}var g=function(E){n.__extends(h,E);function h(y){var O=E.call(this)||this;return O.channel=y,O.basePath=y.basePath+"/presence",O}return h.prototype.get=function(y,O){if(l.default.logAction(l.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),O===void 0)if(typeof y=="function")O=y,y=null;else{if(this.channel.rest.options.promises)return r.promisify(this,"get",arguments);O=m}var _=this.channel.rest,C=_.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,T=this.channel.rest.http.supportsLinkHeaders?void 0:C,x=r.defaultGetHeaders(_.options,C);_.options.headers&&r.mixin(x,_.options.headers);var v=this.channel.channelOptions;new c.default(_,this.basePath,x,T,function(A,f,p){return u.default.fromResponseBody(A,v,p?void 0:C)}).get(y,O)},h.prototype.history=function(y,O){return l.default.logAction(l.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(y,O)},h.prototype._history=function(y,O){if(O===void 0)if(typeof y=="function")O=y,y=null;else{if(this.channel.rest.options.promises)return r.promisify(this,"_history",[y]);O=m}var _=this.channel.rest,C=_.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,T=this.channel.rest.http.supportsLinkHeaders?void 0:C,x=r.defaultGetHeaders(_.options,C);_.options.headers&&r.mixin(x,_.options.headers);var v=this.channel.channelOptions;new c.default(_,this.basePath+"/history",x,T,function(A,f,p){return u.default.fromResponseBody(A,v,p?void 0:C)}).get(y,O)},h}(a.default);e.default=g},function(s,e,t){"use strict";(function(n){Object.defineProperty(e,"__esModule",{value:!0}),e.TransportParams=void 0;var r=t(0),a=r.__importDefault(t(10)),l=r.__importStar(t(1)),c=r.__importStar(t(52)),u=r.__importStar(t(8)),m=r.__importDefault(t(3)),g=r.__importDefault(t(7)),E=r.__importDefault(t(36)),h=r.__importDefault(t(2)),y=r.__importDefault(t(37)),O=r.__importStar(t(20)),_=r.__importStar(t(4)),C=r.__importDefault(t(17)),T=r.__importDefault(t(9)),x=r.__importDefault(t(23)),v=r.__importDefault(t(53)),A=r.__importDefault(t(26)),f=r.__importDefault(t(25)),p=function(){var it;return typeof m.default.WebStorage!="undefined"&&((it=m.default.WebStorage)===null||it===void 0?void 0:it.localSupported)},S=function(){var it;return typeof m.default.WebStorage!="undefined"&&((it=m.default.WebStorage)===null||it===void 0?void 0:it.sessionSupported)},b=a.default.Action,P=function(){},B="ably-transport-preference",z="ably-connection-recovery";function W(){var it,X;return S()&&((X=(it=m.default.WebStorage)===null||it===void 0?void 0:it.getSession)===null||X===void 0?void 0:X.call(it,z))}function N(it){var X,R;return S()&&((R=(X=m.default.WebStorage)===null||X===void 0?void 0:X.setSession)===null||R===void 0?void 0:R.call(X,z,it))}function M(){var it,X;return S()&&((X=(it=m.default.WebStorage)===null||it===void 0?void 0:it.removeSession)===null||X===void 0?void 0:X.call(it,z))}function D(it,X){return l.arrIndexOf(m.default.Defaults.transportPreferenceOrder,it.shortName)>l.arrIndexOf(m.default.Defaults.transportPreferenceOrder,X.shortName)}function U(it,X,R){var k;if(it.channel!==X.channel||(k=it.action)!==b.PRESENCE&&k!==b.MESSAGE||k!==X.action)return!1;var H=k===b.PRESENCE?"presence":"messages",j=it[H].concat(X[H]),et=T.default.getMessagesSize(j);return et>R||!l.allSame(j,"clientId")||!l.arrEvery(j,function(ft){return!ft.id})?!1:(it[H]=j,!0)}function G(it){try{return JSON.parse(it)}catch(X){return null}}var J=function(){function it(X,R,k,H){this.options=X,this.host=R,this.mode=k,this.connectionKey=H,this.format=X.useBinaryProtocol?l.Format.msgpack:l.Format.json}return it.prototype.getConnectParams=function(X){var R=X?l.copy(X):{},k=this.options;switch(this.mode){case"upgrade":R.upgrade=this.connectionKey;break;case"resume":R.resume=this.connectionKey;break;case"recover":{var H=G(k.recover);H&&(R.recover=H.connectionKey);break}default:}return k.clientId!==void 0&&(R.clientId=k.clientId),k.echoMessages===!1&&(R.echo="false"),this.format!==void 0&&(R.format=this.format),this.stream!==void 0&&(R.stream=this.stream),this.heartbeats!==void 0&&(R.heartbeats=this.heartbeats),R.v=u.default.protocolVersion,R.agent=encodeURIComponent((0,u.getAgentString)(this.options)),k.transportParams!==void 0&&l.mixin(R,k.transportParams),R},it.prototype.toString=function(){var X="[mode="+this.mode;return this.host&&(X+=",host="+this.host),this.connectionKey&&(X+=",connectionKey="+this.connectionKey),this.format&&(X+=",format="+this.format),X+="]",X},it}();e.TransportParams=J;var tt=function(it){r.__extends(X,it);function X(R,k){var H=it.call(this)||this;H.disconnectedRetryCount=0,X.initTransports(),H.realtime=R,H.options=k;var j=k.timeouts,et=j.preferenceConnectTimeout+j.realtimeRequestTimeout;if(H.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:et,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:j.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},H.state=H.states.initialized,H.errorReason=null,H.queuedMessages=new E.default,H.msgSerial=0,H.connectionDetails=void 0,H.connectionId=void 0,H.connectionKey=void 0,H.connectionStateTtl=j.connectionStateTtl,H.maxIdleInterval=null,H.transports=l.intersect(k.transports||u.default.defaultTransports,X.supportedTransports),H.baseTransport=l.intersect(u.default.baseTransportOrder,H.transports)[0],H.upgradeTransports=l.intersect(H.transports,u.default.upgradeTransports),H.transportPreference=null,H.httpHosts=u.default.getHosts(k),H.activeProtocol=null,H.proposedTransports=[],H.pendingTransports=[],H.host=null,H.lastAutoReconnectAttempt=null,H.lastActivity=null,H.forceFallbackHost=!1,H.connectCounter=0,h.default.logAction(h.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),h.default.logAction(h.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(k.transports||u.default.defaultTransports)+"]"),h.default.logAction(h.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+H.transports+"]"),h.default.logAction(h.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+H.httpHosts+"]"),!H.transports.length){var ft="no requested transports available";throw h.default.logAction(h.default.LOG_ERROR,"realtime.ConnectionManager()",ft),new Error(ft)}var gt=m.default.Config.addEventListener;return gt&&(S()&&typeof k.recover=="function"&&gt("beforeunload",H.persistConnection.bind(H)),k.closeOnUnload===!0&&gt("beforeunload",function(){h.default.logAction(h.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),H.requestState({state:"closing"})}),gt("online",function(){H.state==H.states.disconnected||H.state==H.states.suspended?(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),H.requestState({state:"connecting"})):H.state==H.states.connecting&&(H.pendingTransports.forEach(function(Et){Et.off()}),H.disconnectAllTransports(),H.startConnect())}),gt("offline",function(){H.state==H.states.connected&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),H.disconnectAllTransports())})),H}return X.initTransports=function(){(0,v.default)(X),l.arrForEach(m.default.Transports,function(R){R(X)})},X.prototype.createTransportParams=function(R,k){return new J(this.options,R,k,this.connectionKey)},X.prototype.getTransportParams=function(R){var k=this,H=function(j){if(k.connectionKey){j("resume");return}if(typeof k.options.recover=="string"){j("recover");return}var et=k.options.recover,ft=W();if(ft&&typeof et=="function"){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),et(ft,function(gt){gt?(k.options.recover=ft.recoveryKey,j("recover")):j("clean")});return}j("clean")};H(function(j){var et=k.createTransportParams(null,j);if(j==="recover"){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+k.options.recover);var ft=G(k.options.recover);ft&&(k.msgSerial=ft.msgSerial)}else h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+et.toString());R(et)})},X.prototype.tryATransport=function(R,k,H){var j=this;h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+k),A.default.tryConnect(X.supportedTransports[k],this,this.realtime.auth,R,function(et,ft){var gt=j.state;if(gt==j.states.closing||gt==j.states.closed||gt==j.states.failed){ft&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+gt.state+" while we were attempting the transport; closing "+ft),ft.close()),H(!0);return}if(et){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+k+" "+et.event+", err: "+et.error.toString()),C.default.isTokenErr(et.error)&&!(j.errorReason&&C.default.isTokenErr(j.errorReason))?(j.errorReason=et.error,j.realtime.auth._forceNewToken(null,null,function(Et){if(Et){j.actOnErrorFromAuthorize(Et);return}j.tryATransport(R,k,H)})):et.event==="failed"?(j.notifyState({state:"failed",error:et.error}),H(!0)):et.event==="disconnected"&&((0,O.isRetriable)(et.error)?H(!1):(j.notifyState({state:j.states.connecting.failState,error:et.error}),H(!0)));return}h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+k+"; setting pending"),j.setTransportPending(ft,R),H(null,ft)})},X.prototype.setTransportPending=function(R,k){var H=this,j=k.mode;h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+R+"; mode = "+j),l.arrDeleteValue(this.proposedTransports,R),this.pendingTransports.push(R);var et=m.default.Defaults.transportPreferenceOrder[m.default.Defaults.transportPreferenceOrder.length-1];R.once("connected",function(gt,Et,Ct){j=="upgrade"&&H.activeProtocol?R.shortName!==et&&l.arrIn(H.getUpgradePossibilities(),et)&&H.activeProtocol?setTimeout(function(){H.scheduleTransportActivation(gt,R,Et,Ct)},H.options.timeouts.parallelUpgradeDelay):H.scheduleTransportActivation(gt,R,Et,Ct):(H.activateTransport(gt,R,Et,Ct),m.default.Config.nextTick(function(){H.connectImpl(k)})),j==="recover"&&H.options.recover&&(H.options.recover=null,H.unpersistConnection())});var ft=this;R.on(["disconnected","closed","failed"],function(gt){ft.deactivateTransport(R,this.event,gt)}),this.emit("transport.pending",R)},X.prototype.scheduleTransportActivation=function(R,k,H,j){var et=this,ft=this.activeProtocol&&this.activeProtocol.getTransport(),gt=function(){k.disconnect(),l.arrDeleteValue(et.pendingTransports,k)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+k.shortName),gt();return}if(ft&&!D(k,ft)){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+k.shortName+" is no better than current active transport "+ft.shortName+" - abandoning upgrade"),gt();return}h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+k);var Et=null;if(!k.isConnected){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+k.shortName+"is no longer connected; abandoning upgrade"),gt();return}if(this.state===this.states.connected)h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),this.state=this.states.synchronizing,Et=this.activeProtocol;else if(this.state!==this.states.connecting){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+k.shortName),gt();return}h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+k);var Ct=function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+k),k.send(a.default.fromValues({action:b.ACTIVATE})),et.activateTransport(R,k,H,j),et.state===et.states.synchronizing?(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+k),et.state=et.states.connected):h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+et.state.state+", so leaving unchanged"),et.state.sendEvents&&et.sendQueuedMessages()};Et?Et.onceIdle(Ct):Ct()},X.prototype.activateTransport=function(R,k,H,j){var et=this;h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+k),R&&h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+R),H&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+H),j&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(j)),this.persistTransportPreference(k);var ft=this.state,gt=this.states.connected.state;if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+ft.state),ft.state==this.states.closing.state||ft.state==this.states.closed.state||ft.state==this.states.failed.state)return h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),k.disconnect(),!1;if(l.arrDeleteValue(this.pendingTransports,k),!k.isConnected)return h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+k+" since it appears to no longer be connected"),!1;var Et=this.activeProtocol;this.activeProtocol=new c.default(k),this.host=k.params.host;var Ct=j.connectionKey;if(Ct&&this.connectionKey!=Ct&&this.setConnection(H,j,!!R),this.onConnectionDetailsUpdate(j,k),m.default.Config.nextTick(function(){k.on("connected",function(ht,Qt,Ee){et.onConnectionDetailsUpdate(Ee,k),et.emit("update",new y.default(gt,gt,null,ht))})}),ft.state===this.states.connected.state?R&&(this.errorReason=this.realtime.connection.errorReason=R,this.emit("update",new y.default(gt,gt,null,R))):(this.notifyState({state:"connected",error:R}),this.errorReason=this.realtime.connection.errorReason=R||null),this.emit("transport.active",k),Et)if(Et.messageQueue.count()>0&&h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+Et.transport.shortName+", new one is "+k.shortName+") finishing with "+Et.messageQueue.count()+" messages still pending"),Et.transport===k){var Vt="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+k.shortName+"; stack = "+new Error().stack;h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()",Vt)}else Et.finish();return l.safeArrForEach(this.pendingTransports,function(ht){if(ht===k){var Qt="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+k.shortName+"; stack = "+new Error().stack;h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()",Qt),l.arrDeleteValue(et.pendingTransports,k)}else ht.disconnect()}),l.safeArrForEach(this.proposedTransports,function(ht){ht===k?(h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+k.shortName+"; stack = "+new Error().stack),l.arrDeleteValue(et.proposedTransports,k)):ht.dispose()}),!0},X.prototype.deactivateTransport=function(R,k,H){var j=this.activeProtocol,et=j&&j.getTransport()===R,ft=l.arrDeleteValue(this.pendingTransports,R),gt=l.arrDeleteValue(this.proposedTransports,R),Et=this.noTransportsScheduledForActivation();if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+R),h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+k+(et?"; was active":ft?"; was pending":gt?"; was proposed":"")+(Et?"":"; another transport is scheduled for activation")),H&&H.message&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+H.message),et&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(j.getPendingMessages()),m.default.Config.nextTick(function(){j.clearPendingMessages()}),this.activeProtocol=this.host=null),this.emit("transport.inactive",R),et&&Et||et&&k==="failed"||k==="closed"||j===null&&ft&&this.pendingTransports.length===0){if(k==="disconnected"&&H&&H.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:k,error:H,retryImmediately:!0});return}var Ct=k==="failed"&&C.default.isTokenErr(H)?"disconnected":k;this.notifyState({state:Ct,error:H});return}et&&k==="disconnected"&&this.state!==this.states.synchronizing&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:H}))},X.prototype.noTransportsScheduledForActivation=function(){return l.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(R){return!R.isConnected})},X.prototype.setConnection=function(R,k,H){var j=this.connectionId,et=j&&j!==R,ft=!j&&H;(et||ft)&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==R&&h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=R,this.realtime.connection.key=this.connectionKey=k.connectionKey},X.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()},X.prototype.createRecoveryKey=function(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null},X.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var R=l.now()-this.lastActivity;R>this.connectionStateTtl+this.maxIdleInterval&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+R+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},X.prototype.persistConnection=function(){if(S()){var R=this.createRecoveryKey();R&&N({recoveryKey:R,disconnectedAt:l.now(),location:n.location,clientId:this.realtime.auth.clientId})}},X.prototype.unpersistConnection=function(){M()},X.prototype.getError=function(){return this.errorReason||this.getStateError()},X.prototype.getStateError=function(){var R,k;return(k=(R=O.default)[this.state.state])===null||k===void 0?void 0:k.call(R)},X.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},X.prototype.enactStateChange=function(R){var k=R.current==="failed"?h.default.LOG_ERROR:h.default.LOG_MAJOR;h.default.logAction(k,"Connection state",R.current+(R.reason?"; reason: "+R.reason:"")),h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+R.current+"; reason = "+(R.reason&&R.reason.message));var H=this.state=this.states[R.current];R.reason&&(this.errorReason=R.reason,this.realtime.connection.errorReason=R.reason),(H.terminal||H.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",R)},X.prototype.startTransitionTimer=function(R){var k=this;h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+R.state),this.transitionTimer&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){k.transitionTimer&&(k.transitionTimer=null,h.default.logAction(h.default.LOG_MINOR,"ConnectionManager "+R.state+" timer expired","requesting new state: "+R.failState),k.notifyState({state:R.failState}))},R.retryDelay)},X.prototype.cancelTransitionTimer=function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},X.prototype.startSuspendTimer=function(){var R=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){R.suspendTimer&&(R.suspendTimer=null,h.default.logAction(h.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),R.states.connecting.failState="suspended",R.notifyState({state:"suspended"}))},this.connectionStateTtl))},X.prototype.checkSuspendTimer=function(R){R!=="disconnected"&&R!=="suspended"&&R!=="connecting"&&this.cancelSuspendTimer()},X.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},X.prototype.startRetryTimer=function(R){var k=this;this.retryTimer=setTimeout(function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),k.retryTimer=null,k.requestState({state:"connecting"})},R)},X.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},X.prototype.notifyState=function(R){var k=this,H,j,et=R.state,ft=et==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||R.retryImmediately||this.state===this.states.connecting&&R.error&&C.default.isTokenErr(R.error)&&!(this.errorReason&&C.default.isTokenErr(this.errorReason)));if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+et+(ft?"; will retry connection immediately":"")),et!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(R.state),(et==="suspended"||et==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var gt=this.states[R.state],Et=gt.retryDelay;gt.state==="disconnected"&&(this.disconnectedRetryCount++,Et=l.getRetryTime(gt.retryDelay,this.disconnectedRetryCount));var Ct=new y.default(this.state.state,gt.state,Et,R.error||((j=(H=O.default)[gt.state])===null||j===void 0?void 0:j.call(H)));if(ft){var Vt=function(){k.state===k.states.disconnected&&(k.lastAutoReconnectAttempt=l.now(),k.requestState({state:"connecting"}))},ht=this.lastAutoReconnectAttempt&&l.now()-this.lastAutoReconnectAttempt+1;ht&&ht<1e3?(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+ht+"ms ago, waiting another "+(1e3-ht)+"ms before trying again"),setTimeout(Vt,1e3-ht)):m.default.Config.nextTick(Vt)}else(et==="disconnected"||et==="suspended")&&this.startRetryTimer(Et);(et==="disconnected"&&!ft||et==="suspended"||gt.terminal)&&m.default.Config.nextTick(function(){k.disconnectAllTransports()}),et=="connected"&&!this.activeProtocol&&h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(Ct),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(et,Ct.reason),this.failQueuedMessages(Ct.reason))}},X.prototype.requestState=function(R){var k=this,H,j,et=R.state;if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+et+"; current state: "+this.state.state),et!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(et),!(et=="connecting"&&this.state.state=="connected")&&!(et=="closing"&&this.state.state=="closed"))){var ft=this.states[et],gt=new y.default(this.state.state,ft.state,null,R.error||((j=(H=O.default)[ft.state])===null||j===void 0?void 0:j.call(H)));this.enactStateChange(gt),et=="connecting"&&m.default.Config.nextTick(function(){k.startConnect()}),et=="closing"&&this.closeImpl()}},X.prototype.startConnect=function(){var R=this;if(this.state!==this.states.connecting){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var k=this.realtime.auth,H=++this.connectCounter,j=function(){R.checkConnectionStateFreshness(),R.getTransportParams(function(ft){if(ft.mode==="recover"&&ft.options.recover){var gt=G(ft.options.recover);gt&&R.realtime.channels.recoverChannels(gt.channelSerials)}H===R.connectCounter&&R.connectImpl(ft,H)})};if(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),k.method==="basic")j();else{var et=function(ft){H===R.connectCounter&&(ft?R.actOnErrorFromAuthorize(ft):j())};this.errorReason&&C.default.isTokenErr(this.errorReason)?k._forceNewToken(null,null,et):k._ensureValidAuthCredentials(!1,et)}},X.prototype.connectImpl=function(R,k){var H=this.state.state;H!==this.states.connecting.state&&H!==this.states.connected.state?h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+H):this.pendingTransports.length?h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):H==this.states.connected.state?this.upgradeIfNeeded(R):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(R,k):this.connectBase(R,k)},X.prototype.connectPreference=function(R,k){var H=this,j=this.getTransportPreference(),et=!1;l.arrIn(this.transports,j)||(this.unpersistTransportPreference(),this.connectImpl(R,k)),h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+j);var ft=setTimeout(function(){et=!0,H.state.state!==H.states.connected.state&&(h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+j+" failed; clearing preference and trying from scratch"),H.disconnectAllTransports(),H.unpersistTransportPreference()),H.connectImpl(R,k)},this.options.timeouts.preferenceConnectTimeout);R.host=this.httpHosts[0],this.tryATransport(R,j,function(gt,Et){clearTimeout(ft),et&&Et?(Et.off(),Et.disconnect(),l.arrDeleteValue(H.pendingTransports,Et)):!Et&&!gt&&(H.unpersistTransportPreference(),H.connectImpl(R,k))})},X.prototype.connectBase=function(R,k){var H=this,j=function(Ct){H.notifyState({state:H.states.connecting.failState,error:Ct})},et=this.httpHosts.slice(),ft=function(Ct,Vt){k===H.connectCounter&&!Vt&&!Ct&&Et()};h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var gt=et.shift();if(!gt){j(new _.default("Unable to connect (no available host)",80003,404));return}R.host=gt;var Et=function(){if(!et.length){j(new _.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!H.realtime.http.checkConnectivity){j(new _.PartialErrorInfo("Internal error: Http.checkConnectivity not set",null,500));return}H.realtime.http.checkConnectivity(function(Ct,Vt){if(k===H.connectCounter){if(Ct){j(Ct);return}if(!Vt){j(new _.default("Unable to connect (network unreachable)",80003,404));return}R.host=l.arrPopRandomElement(et),H.tryATransport(R,H.baseTransport,ft)}})};if(this.forceFallbackHost&&et.length){this.forceFallbackHost=!1,Et();return}this.tryATransport(R,this.baseTransport,ft)},X.prototype.getUpgradePossibilities=function(){var R=this.activeProtocol.getTransport().shortName,k=l.arrIndexOf(this.upgradeTransports,R);return this.upgradeTransports.slice(k+1)},X.prototype.upgradeIfNeeded=function(R){var k=this,H=this.getUpgradePossibilities();h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+m.default.Config.inspect(H)),H.length&&l.arrForEach(H,function(j){var et=k.createTransportParams(R.host,"upgrade");k.tryATransport(et,j,P)})},X.prototype.closeImpl=function(){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),l.safeArrForEach(this.pendingTransports,function(R){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+R),R&&R.close()}),l.safeArrForEach(this.proposedTransports,function(R){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+R),R&&R.dispose()}),this.activeProtocol&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},X.prototype.onAuthUpdated=function(R,k){var H=this,j;switch(this.state.state){case"connected":{if(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var et=this.activeProtocol.getTransport().params;m.default.Config.nextTick(function(){H.state.state==="connected"&&H.upgradeIfNeeded(et)})}var ft=(j=this.activeProtocol)===null||j===void 0?void 0:j.getTransport();ft&&ft.onAuthUpdated&&ft.onAuthUpdated(R);var gt=a.default.fromValues({action:b.AUTH,auth:{accessToken:R.token}});this.send(gt);var Et=function(){H.off(Ct),k(null,R)},Ct=function(ht){ht.current==="failed"&&(H.off(Et),H.off(Ct),k(ht.reason||H.getStateError()))};this.once("connectiondetails",Et),this.on("connectionstate",Ct);break}case"connecting":h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var Vt=function(ht){switch(ht.current){case"connected":H.off(Vt),k(null,R);break;case"failed":case"closed":case"suspended":H.off(Vt),k(ht.reason||H.getStateError());break;default:break}};this.on("connectionstate",Vt),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},X.prototype.disconnectAllTransports=function(R){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(R?" except the active transport":"")),this.connectCounter++,l.safeArrForEach(this.pendingTransports,function(k){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+k),k&&k.disconnect()}),this.pendingTransports=[],l.safeArrForEach(this.proposedTransports,function(k){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+k),k&&k.dispose()}),this.proposedTransports=[],this.activeProtocol&&!R&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},X.prototype.send=function(R,k,H){H=H||P;var j=this.state;if(j.sendEvents){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new c.PendingMessage(R,H));return}var et=k&&j.queueEvents||j.forceQueueEvents;if(!et){var ft="rejecting event, queueEvent was "+k+", state was "+j.state;h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.send()",ft),H(this.errorReason||new _.default(ft,9e4,400));return}h.default.shouldLog(h.default.LOG_MICRO)&&h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+a.default.stringify(R)),this.queue(R,H)},X.prototype.sendImpl=function(R){var k=R.message;R.ackRequired&&!R.sendAttempted&&(k.msgSerial=this.msgSerial++);try{this.activeProtocol.send(R)}catch(H){h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+H.stack)}},X.prototype.queue=function(R,k){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var H=this.queuedMessages.last(),j=this.options.maxMessageSize;H&&!H.sendAttempted&&U(H.message,R,j)?(H.merged||(H.callback=x.default.create([H.callback]),H.merged=!0),H.callback.push(k)):this.queuedMessages.push(new c.PendingMessage(R,k))},X.prototype.sendQueuedMessages=function(){h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var R;R=this.queuedMessages.shift();)this.sendImpl(R)},X.prototype.queuePendingMessages=function(R){R&&R.length&&(h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+R.length+" pending messages"),this.queuedMessages.prepend(R))},X.prototype.failQueuedMessages=function(R){var k=this.queuedMessages.count();k>0&&(h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+k+" queued messages, err = "+l.inspectError(R)),this.queuedMessages.completeAllMessages(R))},X.prototype.onChannelMessage=function(R,k){var H=this.activeProtocol&&k===this.activeProtocol.getTransport(),j=l.arrIn(this.pendingTransports,k)&&this.state==this.states.synchronizing;H||j?this.realtime.channels.onChannelMessage(R):l.arrIndexOf([b.ACK,b.NACK,b.ERROR],R.action)>-1?this.realtime.channels.onChannelMessage(R):h.default.logAction(h.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(R)+"on defunct transport; discarding")},X.prototype.ping=function(R,k){var H=this;if(R){h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+R);var j=function(){R.off("heartbeat",gt),k(new _.default("Timeout waiting for heartbeat response",5e4,500))},et=l.now(),ft=l.cheapRandStr(),gt=function(Qt){if(Qt===ft){R.off("heartbeat",gt),clearTimeout(Et);var Ee=l.now()-et;k(null,Ee)}},Et=setTimeout(j,this.options.timeouts.realtimeRequestTimeout);R.on("heartbeat",gt),R.ping(ft);return}if(this.state.state!=="connected"){k(new _.default("Unable to ping service; not connected",4e4,400));return}var Ct=!1,Vt=function(Qt,Ee){H.off("transport.active",ht),Ct||(Ct=!0,k(Qt,Ee))},ht=function(){Ct||(Ct=!0,m.default.Config.nextTick(function(){H.ping(null,k)}))};this.on("transport.active",ht),this.ping(this.activeProtocol.getTransport(),Vt)},X.prototype.abort=function(R){this.activeProtocol.getTransport().fail(R)},X.prototype.registerProposedTransport=function(R){this.proposedTransports.push(R)},X.prototype.getTransportPreference=function(){var R,k;return this.transportPreference||p()&&((k=(R=m.default.WebStorage)===null||R===void 0?void 0:R.get)===null||k===void 0?void 0:k.call(R,B))},X.prototype.persistTransportPreference=function(R){var k,H;l.arrIn(u.default.upgradeTransports,R.shortName)&&(this.transportPreference=R.shortName,p()&&((H=(k=m.default.WebStorage)===null||k===void 0?void 0:k.set)===null||H===void 0||H.call(k,B,R.shortName)))},X.prototype.unpersistTransportPreference=function(){var R,k;this.transportPreference=null,p()&&((k=(R=m.default.WebStorage)===null||R===void 0?void 0:R.remove)===null||k===void 0||k.call(R,B))},X.prototype.actOnErrorFromAuthorize=function(R){if(R.code===40171)this.notifyState({state:"failed",error:R});else if(R.code===40102)this.notifyState({state:"failed",error:R});else if(R.statusCode===f.default.Forbidden){var k="Client configured authentication provider returned 403; failing the connection";h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",k),this.notifyState({state:"failed",error:new _.default(k,80019,403,R)})}else{var k="Client configured authentication provider request failed";h.default.logAction(h.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",k),this.notifyState({state:this.state.failState,error:new _.default(k,80019,401,R)})}},X.prototype.onConnectionDetailsUpdate=function(R,k){if(!!R){this.connectionDetails=R,R.maxMessageSize&&(this.options.maxMessageSize=R.maxMessageSize);var H=R.clientId;if(H){var j=this.realtime.auth._uncheckedSetClientId(H);if(j){h.default.logAction(h.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",j.message),k.fail(j);return}}var et=R.connectionStateTtl;et&&(this.connectionStateTtl=et),this.maxIdleInterval=R.maxIdleInterval,this.emit("connectiondetails",R)}},X.supportedTransports={},X}(g.default);e.default=tt}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importDefault(t(7)),a=n.__importDefault(t(2)),l=function(c){n.__extends(u,c);function u(){var m=c.call(this)||this;return m.messages=[],m}return u.prototype.count=function(){return this.messages.length},u.prototype.push=function(m){this.messages.push(m)},u.prototype.shift=function(){return this.messages.shift()},u.prototype.last=function(){return this.messages[this.messages.length-1]},u.prototype.copyAll=function(){return this.messages.slice()},u.prototype.append=function(m){this.messages.push.apply(this.messages,m)},u.prototype.prepend=function(m){this.messages.unshift.apply(this.messages,m)},u.prototype.completeMessages=function(m,g,E){a.default.logAction(a.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+m+"; count = "+g),E=E||null;var h=this.messages;if(h.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var y=h[0];if(y){var O=y.message.msgSerial,_=m+g;if(_>O)for(var C=h.splice(0,_-O),T=0,x=C;T<x.length;T++){var v=x[T];v.callback(E)}h.length==0&&this.emit("idle")}},u.prototype.completeAllMessages=function(m){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,m)},u.prototype.resetSendAttempted=function(){for(var m=0,g=this.messages;m<g.length;m++){var E=g[m];E.sendAttempted=!1}},u.prototype.clear=function(){a.default.logAction(a.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},u}(r.default);e.default=l},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function r(a,l,c,u){this.previous=a,this.current=l,c&&(this.retryIn=c),u&&(this.reason=u)}return r}();e.default=n},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importDefault(t(10)),a=n.__importDefault(t(7)),l=n.__importStar(t(1)),c=n.__importDefault(t(33)),u=n.__importDefault(t(2)),m=n.__importDefault(t(54)),g=n.__importDefault(t(9)),E=n.__importDefault(t(39)),h=n.__importStar(t(4)),y=n.__importDefault(t(15)),O=n.__importDefault(t(20)),_=r.default.Action,C=function(){};function T(v){if(v&&"params"in v&&!l.isObject(v.params))return new h.default("options.params must be an object",4e4,400);if(v&&"modes"in v){if(!l.isArray(v.modes))return new h.default("options.modes must be an array",4e4,400);for(var A=0;A<v.modes.length;A++){var f=v.modes[A];if(!f||typeof f!="string"||!l.arrIn(r.default.channelModes,String.prototype.toUpperCase.call(f)))return new h.default("Invalid channel mode: "+f,4e4,400)}}}var x=function(v){n.__extends(A,v);function A(f,p,S){var b=v.call(this,f,p,S)||this;return b.retryCount=0,b.history=function(P,B){if(u.default.logAction(u.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),B===void 0)if(typeof P=="function")B=P,P=null;else{if(this.rest.options.promises)return l.promisify(this,"history",arguments);B=C}if(P&&P.untilAttach){if(this.state!=="attached"){B(new h.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){B(new h.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete P.untilAttach,P.from_serial=this.properties.attachSerial}c.default.prototype._history.call(this,P,B)},b.whenState=function(P,B){return a.default.prototype.whenState.call(b,P,b.state,B)},u.default.logAction(u.default.LOG_MINOR,"RealtimeChannel()","started; name = "+p),b.realtime=f,b.presence=new m.default(b),b.connectionManager=f.connection.connectionManager,b.state="initialized",b.subscriptions=new a.default,b.syncChannelSerial=void 0,b.properties={attachSerial:void 0,channelSerial:void 0},b.setOptions(S),b.errorReason=null,b._requestedFlags=null,b._mode=null,b._attachResume=!1,b._decodingContext={channelOptions:b.channelOptions,plugins:f.options.plugins||{},baseEncodedPreviousPayload:void 0},b._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},b._allChannelChanges=new a.default,b}return A.prototype.invalidStateError=function(){return new h.default("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)},A.processListenerArgs=function(f){return f=Array.prototype.slice.call(f),typeof f[0]=="function"&&f.unshift(null),f[f.length-1]==null&&f.pop(),f},A.prototype.setOptions=function(f,p){if(!p&&this.rest.options.promises)return l.promisify(this,"setOptions",arguments);var S=p||function(P){P&&u.default.logAction(u.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+P.toString())},b=T(f);if(b){S(b);return}c.default.prototype.setOptions.call(this,f),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(f)?(this.attachImpl(),this._allChannelChanges.once(["attached","update","detached","failed"],function(P){switch(this.event){case"update":case"attached":S==null||S(null);return;default:S==null||S(P.reason);return}})):S()},A.prototype._shouldReattachToSetOptions=function(f){return(this.state==="attached"||this.state==="attaching")&&((f==null?void 0:f.params)||(f==null?void 0:f.modes))},A.prototype.publish=function(){for(var f=this,p=[],S=0;S<arguments.length;S++)p[S]=arguments[S];var b=p[0],P=p.length,B=p[P-1];if(typeof B!="function"){if(this.realtime.options.promises)return l.promisify(this,"publish",arguments);B=C,++P}if(!this.connectionManager.activeState()){B(this.connectionManager.getError());return}if(P==2)if(l.isObject(b))b=[g.default.fromValues(b)];else if(l.isArray(b))b=g.default.fromValuesArray(b);else throw new h.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else b=[g.default.fromValues({name:p[0],data:p[1]})];var z=this.realtime.options.maxMessageSize;g.default.encodeArray(b,this.channelOptions,function(W){if(W){B(W);return}var N=g.default.getMessagesSize(b);if(N>z){B(new h.default("Maximum size of messages that can be published at once exceeded ( was "+N+" bytes; limit is "+z+" bytes)",40009,400));return}f.__publish(b,B)})},A.prototype.__publish=function(f,p){u.default.logAction(u.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+f.length);var S=this.state;switch(S){case"failed":case"suspended":p(h.default.fromValues(this.invalidStateError()));break;default:{u.default.logAction(u.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+S);var b=new r.default;b.action=_.MESSAGE,b.channel=this.name,b.messages=f,this.sendMessage(b,p);break}}},A.prototype.onEvent=function(f){u.default.logAction(u.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var p=this.subscriptions,S=0;S<f.length;S++){var b=f[S];p.emit(b.name,b)}},A.prototype.attach=function(f,p){var S;if(typeof f=="function"?(p=f,S=null):S=f,!p){if(this.realtime.options.promises)return l.promisify(this,"attach",arguments);p=function(b){b&&u.default.logAction(u.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+b.toString())}}if(S)u.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=S;else if(this.state==="attached"){p(null,null);return}this._attach(!1,null,p)},A.prototype._attach=function(f,p,S){S||(S=function(P){P&&u.default.logAction(u.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+P.toString())});var b=this.connectionManager;if(!b.activeState()){S(b.getError());return}(this.state!=="attaching"||f)&&this.requestState("attaching",p),this.once(function(P){switch(this.event){case"attached":S==null||S(null,P);break;case"detached":case"suspended":case"failed":S==null||S(P.reason||b.getError()||new h.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":S==null||S(new h.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},A.prototype.attachImpl=function(){u.default.logAction(u.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");var f=r.default.fromValues({action:_.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this._requestedFlags?f.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&f.encodeModesToFlags(l.allToUpperCase(this.channelOptions.modes)),this._attachResume&&f.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(f.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(f,C)},A.prototype.detach=function(f){if(!f){if(this.realtime.options.promises)return l.promisify(this,"detach",arguments);f=C}var p=this.connectionManager;if(!p.activeState()){f(p.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),f();break;case"detached":f();break;case"failed":f(new h.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(S){switch(this.event){case"detached":f();break;case"attached":case"suspended":case"failed":f(S.reason||p.getError()||new h.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":f(new h.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},A.prototype.detachImpl=function(f){u.default.logAction(u.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");var p=r.default.fromValues({action:_.DETACH,channel:this.name});this.sendMessage(p,f||C)},A.prototype.subscribe=function(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];var S=A.processListenerArgs(f),b=S[0],P=S[1],B=S[2];if(!B&&this.realtime.options.promises)return l.promisify(this,"subscribe",[b,P]);if(this.state==="failed"){B==null||B(h.default.fromValues(this.invalidStateError()));return}return b&&typeof b=="object"&&!Array.isArray(b)?this._subscribeFilter(b,P):this.subscriptions.on(b,P),this.attach(B||C)},A.prototype._subscribeFilter=function(f,p){var S=function(b){var P,B,z,W,N,M,D={name:b.name,refTimeserial:(B=(P=b.extras)===null||P===void 0?void 0:P.ref)===null||B===void 0?void 0:B.timeserial,refType:(W=(z=b.extras)===null||z===void 0?void 0:z.ref)===null||W===void 0?void 0:W.type,isRef:!!(!((M=(N=b.extras)===null||N===void 0?void 0:N.ref)===null||M===void 0)&&M.timeserial),clientId:b.clientId};Object.entries(f).find(function(U){var G=U[0],J=U[1];return J!==void 0?D[G]!==J:!1})||p(b)};this._addFilteredSubscription(f,p,S),this.subscriptions.on(S)},A.prototype._addFilteredSubscription=function(f,p,S){var b;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(p)){var P=this.filteredSubscriptions.get(p);P.set(f,((b=P==null?void 0:P.get(f))===null||b===void 0?void 0:b.concat(S))||[S])}else this.filteredSubscriptions.set(p,new Map([[f,[S]]]))},A.prototype._getAndDeleteFilteredSubscriptions=function(f,p){var S=this;if(!this.filteredSubscriptions)return[];if(!p&&f)return Array.from(this.filteredSubscriptions.entries()).map(function(z){var W,N=z[0],M=z[1],D=M.get(f);return M.delete(f),M.size===0&&((W=S.filteredSubscriptions)===null||W===void 0||W.delete(N)),D}).reduce(function(z,W){var N;return W?(N=z).concat.apply(N,W):z},[]);if(!p||!this.filteredSubscriptions.has(p))return[];var b=this.filteredSubscriptions.get(p);if(!f){var P=Array.from(b.values()).reduce(function(z,W){return z.concat.apply(z,W)},[]);return this.filteredSubscriptions.delete(p),P}var B=b.get(f);return b.delete(f),B||[]},A.prototype.unsubscribe=function(){for(var f=this,p,S=[],b=0;b<arguments.length;b++)S[b]=arguments[b];var P=A.processListenerArgs(S),B=P[0],z=P[1];if(typeof B=="object"&&!z||((p=this.filteredSubscriptions)===null||p===void 0?void 0:p.has(z))){this._getAndDeleteFilteredSubscriptions(B,z).forEach(function(W){return f.subscriptions.off(W)});return}this.subscriptions.off(B,z)},A.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new h.PartialErrorInfo("Unable to sync to channel; not attached",4e4);default:}var f=this.connectionManager;if(!f.activeState())throw f.getError();var p=r.default.fromValues({action:_.SYNC,channel:this.name});this.syncChannelSerial&&(p.channelSerial=this.syncChannelSerial),f.send(p)},A.prototype.sendMessage=function(f,p){this.connectionManager.send(f,this.realtime.options.queueMessages,p)},A.prototype.sendPresence=function(f,p){var S=r.default.fromValues({action:_.PRESENCE,channel:this.name,presence:l.isArray(f)?y.default.fromValuesArray(f):[y.default.fromValues(f)]});this.sendMessage(S,p)},A.prototype.onMessage=function(f){(f.action===_.ATTACHED||f.action===_.MESSAGE||f.action===_.PRESENCE)&&this.setChannelSerial(f.channelSerial);var p,S=!1;switch(f.action){case _.ATTACHED:{this.properties.attachSerial=f.channelSerial,this._mode=f.getMode(),this.params=f.params||{};var b=f.decodeModesFromFlags();this.modes=b&&l.allToLowerCase(b)||void 0;var P=f.hasFlag("RESUMED"),B=f.hasFlag("HAS_PRESENCE"),z=f.hasFlag("HAS_BACKLOG");if(this.state==="attached"){P||this.presence.onAttached(B);var W=new E.default(this.state,this.state,P,z,f.error);this._allChannelChanges.emit("update",W),(!P||this.channelOptions.updateOnAttached)&&this.emit("update",W)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",f.error,P,B,z);break}case _.DETACHED:{var N=f.error?h.default.fromValues(f.error):new h.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",N):this.state==="attaching"?this.notifyState("suspended",N):this.requestState("attaching",N);break}case _.SYNC:if(S=!0,p=this.syncChannelSerial=f.channelSerial,!f.presence)break;case _.PRESENCE:{for(var M=f.presence,D=f.id,U=f.connectionId,G=f.timestamp,J=this.channelOptions,tt=void 0,it=0;it<M.length;it++)try{tt=M[it],y.default.decode(tt,J),tt.connectionId||(tt.connectionId=U),tt.timestamp||(tt.timestamp=G),tt.id||(tt.id=D+":"+it)}catch(et){u.default.logAction(u.default.LOG_ERROR,"RealtimeChannel.onMessage()",et.toString())}this.presence.setPresence(M,S,p);break}case _.MESSAGE:{if(this.state!=="attached"){u.default.logAction(u.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+f.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var X=f.messages,R=X[0],k=X[X.length-1],D=f.id,U=f.connectionId,G=f.timestamp;if(R.extras&&R.extras.delta&&R.extras.delta.from!==this._lastPayload.messageId){var H='Delta message decode failure - previous message not available for message "'+f.id+'" on this channel "'+this.name+'".';u.default.logAction(u.default.LOG_ERROR,"RealtimeChannel.onMessage()",H),this._startDecodeFailureRecovery(new h.default(H,40018,400));break}for(var it=0;it<X.length;it++){var H=X[it];try{g.default.decode(H,this._decodingContext)}catch(Vt){switch(u.default.logAction(u.default.LOG_ERROR,"RealtimeChannel.onMessage()",Vt.toString()),Vt.code){case 40018:this._startDecodeFailureRecovery(Vt);return;case 40019:case 40021:this.notifyState("failed",Vt);return}}H.connectionId||(H.connectionId=U),H.timestamp||(H.timestamp=G),H.id||(H.id=D+":"+it)}this._lastPayload.messageId=k.id,this._lastPayload.protocolMessageChannelSerial=f.channelSerial,this.onEvent(X);break}case _.ERROR:{var j=f.error;j&&j.code==80016?this.checkPendingState():this.notifyState("failed",h.default.fromValues(j));break}default:u.default.logAction(u.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+f.action+")"),this.connectionManager.abort(O.default.unknownChannelErr())}},A.prototype._startDecodeFailureRecovery=function(f){var p=this;this._lastPayload.decodeFailureRecoveryInProgress||(u.default.logAction(u.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,f,function(){p._lastPayload.decodeFailureRecoveryInProgress=!1}))},A.prototype.onAttached=function(){u.default.logAction(u.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},A.prototype.notifyState=function(f,p,S,b,P){if(u.default.logAction(u.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+f),this.clearStateTimer(),l.arrIn(["detached","suspended","failed"],f)&&(this.properties.channelSerial=null),f!==this.state){this.presence.actOnChannelState(f,b,p),f==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),p&&(this.errorReason=p);var B=new E.default(this.state,f,S,P,p),z=f==="failed"?u.default.LOG_ERROR:u.default.LOG_MAJOR;u.default.logAction(z,'Channel state for channel "'+this.name+'"',f+(p?"; reason: "+p:"")),f!=="attaching"&&f!=="suspended"&&(this.retryCount=0),f==="attached"&&this.onAttached(),f==="attached"?this._attachResume=!0:(f==="detaching"||f==="failed")&&(this._attachResume=!1),this.state=f,this._allChannelChanges.emit(f,B),this.emit(f,B)}},A.prototype.requestState=function(f,p){u.default.logAction(u.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+f),this.notifyState(f,p),this.checkPendingState()},A.prototype.checkPendingState=function(){var f=this.connectionManager.state;if(!(f.sendEvents||f.forceQueueEvents)){u.default.logAction(u.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(u.default.logAction(u.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;default:break}},A.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var f=new h.default("Channel attach timed out",90007,408);this.notifyState("suspended",f);break}case"detaching":{var f=new h.default("Channel detach timed out",90007,408);this.notifyState("attached",f);break}default:this.checkPendingState();break}},A.prototype.startStateTimerIfNotRunning=function(){var f=this;this.stateTimer||(this.stateTimer=setTimeout(function(){u.default.logAction(u.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),f.stateTimer=null,f.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},A.prototype.clearStateTimer=function(){var f=this.stateTimer;f&&(clearTimeout(f),this.stateTimer=null)},A.prototype.startRetryTimer=function(){var f=this;if(!this.retryTimer){this.retryCount++;var p=l.getRetryTime(this.realtime.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(function(){f.state==="suspended"&&f.connectionManager.state.sendEvents&&(f.retryTimer=null,u.default.logAction(u.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),f.requestState("attaching"))},p)}},A.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},A.prototype.getReleaseErr=function(){var f=this.state;return f==="initialized"||f==="detached"||f==="failed"?null:new h.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+f,90001,400)},A.prototype.setChannelSerial=function(f){u.default.logAction(u.default.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+f+"; previous = "+this.properties.channelSerial),f&&(this.properties.channelSerial=f)},A}(c.default);e.default=x},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function r(a,l,c,u,m){this.previous=a,this.current=l,l==="attached"&&(this.resumed=c,this.hasBacklog=u),m&&(this.reason=m)}return r}();e.default=n},function(s,e,t){(function(n,r){s.exports=e=r(t(6))})(this,function(n){return function(){var r=n,a=r.lib,l=a.WordArray,c=a.Hasher,u=r.algo,m=[],g=u.SHA1=c.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(E,h){for(var y=this._hash.words,O=y[0],_=y[1],C=y[2],T=y[3],x=y[4],v=0;v<80;v++){if(v<16)m[v]=E[h+v]|0;else{var A=m[v-3]^m[v-8]^m[v-14]^m[v-16];m[v]=A<<1|A>>>31}var f=(O<<5|O>>>27)+x+m[v];v<20?f+=(_&C|~_&T)+1518500249:v<40?f+=(_^C^T)+1859775393:v<60?f+=(_&C|_&T|C&T)-1894007588:f+=(_^C^T)-899497514,x=T,T=C,C=_<<30|_>>>2,_=O,O=f}y[0]=y[0]+O|0,y[1]=y[1]+_|0,y[2]=y[2]+C|0,y[3]=y[3]+T|0,y[4]=y[4]+x|0},_doFinalize:function(){var E=this._data,h=E.words,y=this._nDataBytes*8,O=E.sigBytes*8;return h[O>>>5]|=128<<24-O%32,h[(O+64>>>9<<4)+14]=Math.floor(y/4294967296),h[(O+64>>>9<<4)+15]=y,E.sigBytes=h.length*4,this._process(),this._hash},clone:function(){var E=c.clone.call(this);return E._hash=this._hash.clone(),E}});r.SHA1=c._createHelper(g),r.HmacSHA1=c._createHmacHelper(g)}(),n.SHA1})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});function n(v){if(v===void 0)return"undefined";var A,f;if(v instanceof ArrayBuffer?(f="ArrayBuffer",A=new DataView(v)):v instanceof DataView&&(f="DataView",A=v),!A)return JSON.stringify(v);for(var p=[],S=0;S<v.byteLength;S++){if(S>20){p.push("...");break}var b=A.getUint8(S).toString(16);b.length===1&&(b="0"+b),p.push(b)}return"<"+f+" "+p.join(" ")+">"}function r(v,A,f){for(var p=0,S=f.length;p<S;p++){var b=f.charCodeAt(p);if(b<128){v.setUint8(A++,b>>>0&127|0);continue}if(b<2048){v.setUint8(A++,b>>>6&31|192),v.setUint8(A++,b>>>0&63|128);continue}if(b<65536){v.setUint8(A++,b>>>12&15|224),v.setUint8(A++,b>>>6&63|128),v.setUint8(A++,b>>>0&63|128);continue}if(b<1114112){v.setUint8(A++,b>>>18&7|240),v.setUint8(A++,b>>>12&63|128),v.setUint8(A++,b>>>6&63|128),v.setUint8(A++,b>>>0&63|128);continue}throw new Error("bad codepoint "+b)}}function a(v,A,f){for(var p="",S=A,b=A+f;S<b;S++){var P=v.getUint8(S);if((P&128)===0){p+=String.fromCharCode(P);continue}if((P&224)===192){p+=String.fromCharCode((P&15)<<6|v.getUint8(++S)&63);continue}if((P&240)===224){p+=String.fromCharCode((P&15)<<12|(v.getUint8(++S)&63)<<6|(v.getUint8(++S)&63)<<0);continue}if((P&248)===240){p+=String.fromCharCode((P&7)<<18|(v.getUint8(++S)&63)<<12|(v.getUint8(++S)&63)<<6|(v.getUint8(++S)&63)<<0);continue}throw new Error("Invalid byte "+P.toString(16))}return p}function l(v){for(var A=0,f=0,p=v.length;f<p;f++){var S=v.charCodeAt(f);if(S<128){A+=1;continue}if(S<2048){A+=2;continue}if(S<65536){A+=3;continue}if(S<1114112){A+=4;continue}throw new Error("bad codepoint "+S)}return A}function c(v,A){var f=x(v,A);if(f!==0){var p=new ArrayBuffer(f),S=new DataView(p);return T(v,S,0,A),p}}var u=(1<<16)*(1<<16),m=1/u;function g(v,A){return A=A||0,v.getInt32(A)*u+v.getUint32(A+4)}function E(v,A){return A=A||0,v.getUint32(A)*u+v.getUint32(A+4)}function h(v,A,f){f<9223372036854776e3?(v.setInt32(A,Math.floor(f*m)),v.setInt32(A+4,f&-1)):(v.setUint32(A,2147483647),v.setUint32(A+4,2147483647))}function y(v,A,f){f<18446744073709552e3?(v.setUint32(A,Math.floor(f*m)),v.setInt32(A+4,f&-1)):(v.setUint32(A,4294967295),v.setUint32(A+4,4294967295))}var O=function(){function v(A,f){var p=this;this.map=function(S){for(var b={},P=0;P<S;P++){var B=p.parse();b[B]=p.parse()}return b},this.bin=function(S){var b=new ArrayBuffer(S);return new Uint8Array(b).set(new Uint8Array(p.view.buffer,p.offset,S),0),p.offset+=S,b},this.buf=this.bin,this.str=function(S){var b=a(p.view,p.offset,S);return p.offset+=S,b},this.array=function(S){for(var b=new Array(S),P=0;P<S;P++)b[P]=p.parse();return b},this.ext=function(S){return p.offset+=S,{type:p.view.getInt8(p.offset),data:p.buf(S)}},this.parse=function(){var S=p.view.getUint8(p.offset),b,P;if((S&128)===0)return p.offset++,S;if((S&240)===128)return P=S&15,p.offset++,p.map(P);if((S&240)===144)return P=S&15,p.offset++,p.array(P);if((S&224)===160)return P=S&31,p.offset++,p.str(P);if((S&224)===224)return b=p.view.getInt8(p.offset),p.offset++,b;switch(S){case 192:return p.offset++,null;case 193:p.offset++;return;case 194:return p.offset++,!1;case 195:return p.offset++,!0;case 196:return P=p.view.getUint8(p.offset+1),p.offset+=2,p.bin(P);case 197:return P=p.view.getUint16(p.offset+1),p.offset+=3,p.bin(P);case 198:return P=p.view.getUint32(p.offset+1),p.offset+=5,p.bin(P);case 199:return P=p.view.getUint8(p.offset+1),p.offset+=2,p.ext(P);case 200:return P=p.view.getUint16(p.offset+1),p.offset+=3,p.ext(P);case 201:return P=p.view.getUint32(p.offset+1),p.offset+=5,p.ext(P);case 202:return b=p.view.getFloat32(p.offset+1),p.offset+=5,b;case 203:return b=p.view.getFloat64(p.offset+1),p.offset+=9,b;case 204:return b=p.view.getUint8(p.offset+1),p.offset+=2,b;case 205:return b=p.view.getUint16(p.offset+1),p.offset+=3,b;case 206:return b=p.view.getUint32(p.offset+1),p.offset+=5,b;case 207:return b=E(p.view,p.offset+1),p.offset+=9,b;case 208:return b=p.view.getInt8(p.offset+1),p.offset+=2,b;case 209:return b=p.view.getInt16(p.offset+1),p.offset+=3,b;case 210:return b=p.view.getInt32(p.offset+1),p.offset+=5,b;case 211:return b=g(p.view,p.offset+1),p.offset+=9,b;case 212:return P=1,p.offset++,p.ext(P);case 213:return P=2,p.offset++,p.ext(P);case 214:return P=4,p.offset++,p.ext(P);case 215:return P=8,p.offset++,p.ext(P);case 216:return P=16,p.offset++,p.ext(P);case 217:return P=p.view.getUint8(p.offset+1),p.offset+=2,p.str(P);case 218:return P=p.view.getUint16(p.offset+1),p.offset+=3,p.str(P);case 219:return P=p.view.getUint32(p.offset+1),p.offset+=5,p.str(P);case 220:return P=p.view.getUint16(p.offset+1),p.offset+=3,p.array(P);case 221:return P=p.view.getUint32(p.offset+1),p.offset+=5,p.array(P);case 222:return P=p.view.getUint16(p.offset+1),p.offset+=3,p.map(P);case 223:return P=p.view.getUint32(p.offset+1),p.offset+=5,p.map(P)}throw new Error("Unknown type 0x"+S.toString(16))},this.offset=f||0,this.view=A}return v}();function _(v){var A=new DataView(v),f=new O(A),p=f.parse();if(f.offset!==v.byteLength)throw new Error(v.byteLength-f.offset+" trailing bytes");return p}function C(v,A){return Object.keys(v).filter(function(f){var p=v[f],S=typeof p;return(!A||p!=null)&&(S!=="function"||!!p.toJSON)})}function T(v,A,f,p){var S=typeof v;if(typeof v=="string"){var b=l(v);if(b<32)return A.setUint8(f,b|160),r(A,f+1,v),1+b;if(b<256)return A.setUint8(f,217),A.setUint8(f+1,b),r(A,f+2,v),2+b;if(b<65536)return A.setUint8(f,218),A.setUint16(f+1,b),r(A,f+3,v),3+b;if(b<4294967296)return A.setUint8(f,219),A.setUint32(f+1,b),r(A,f+5,v),5+b}if(ArrayBuffer.isView&&ArrayBuffer.isView(v)&&(v=v.buffer),v instanceof ArrayBuffer){var P=v.byteLength;if(P<256)return A.setUint8(f,196),A.setUint8(f+1,P),new Uint8Array(A.buffer).set(new Uint8Array(v),f+2),2+P;if(P<65536)return A.setUint8(f,197),A.setUint16(f+1,P),new Uint8Array(A.buffer).set(new Uint8Array(v),f+3),3+P;if(P<4294967296)return A.setUint8(f,198),A.setUint32(f+1,P),new Uint8Array(A.buffer).set(new Uint8Array(v),f+5),5+P}if(typeof v=="number"){if(Math.floor(v)!==v)return A.setUint8(f,203),A.setFloat64(f+1,v),9;if(v>=0){if(v<128)return A.setUint8(f,v),1;if(v<256)return A.setUint8(f,204),A.setUint8(f+1,v),2;if(v<65536)return A.setUint8(f,205),A.setUint16(f+1,v),3;if(v<4294967296)return A.setUint8(f,206),A.setUint32(f+1,v),5;if(v<18446744073709552e3)return A.setUint8(f,207),y(A,f+1,v),9;throw new Error("Number too big 0x"+v.toString(16))}if(v>=-32)return A.setInt8(f,v),1;if(v>=-128)return A.setUint8(f,208),A.setInt8(f+1,v),2;if(v>=-32768)return A.setUint8(f,209),A.setInt16(f+1,v),3;if(v>=-2147483648)return A.setUint8(f,210),A.setInt32(f+1,v),5;if(v>=-9223372036854776e3)return A.setUint8(f,211),h(A,f+1,v),9;throw new Error("Number too small -0x"+(-v).toString(16).substr(1))}if(S==="undefined")return p?0:(A.setUint8(f,212),A.setUint8(f+1,0),A.setUint8(f+2,0),3);if(v===null)return p?0:(A.setUint8(f,192),1);if(S==="boolean")return A.setUint8(f,v?195:194),1;if(typeof v.toJSON=="function")return T(v.toJSON(),A,f,p);if(S==="object"){var B,z=0,W=void 0,N=Array.isArray(v);if(N?B=v.length:(W=C(v,p),B=W.length),B<16?(A.setUint8(f,B|(N?144:128)),z=1):B<65536?(A.setUint8(f,N?220:222),A.setUint16(f+1,B),z=3):B<4294967296&&(A.setUint8(f,N?221:223),A.setUint32(f+1,B),z=5),N)for(var M=0;M<B;M++)z+=T(v[M],A,f+z,p);else if(W)for(var M=0;M<B;M++){var D=W[M];z+=T(D,A,f+z),z+=T(v[D],A,f+z,p)}return z}if(S==="function")return 0;throw new Error("Unknown type "+S)}function x(v,A){var f=typeof v;if(f==="string"){var p=l(v);if(p<32)return 1+p;if(p<256)return 2+p;if(p<65536)return 3+p;if(p<4294967296)return 5+p}if(ArrayBuffer.isView&&ArrayBuffer.isView(v)&&(v=v.buffer),v instanceof ArrayBuffer){var S=v.byteLength;if(S<256)return 2+S;if(S<65536)return 3+S;if(S<4294967296)return 5+S}if(typeof v=="number"){if(Math.floor(v)!==v)return 9;if(v>=0){if(v<128)return 1;if(v<256)return 2;if(v<65536)return 3;if(v<4294967296)return 5;if(v<18446744073709552e3)return 9;throw new Error("Number too big 0x"+v.toString(16))}if(v>=-32)return 1;if(v>=-128)return 2;if(v>=-32768)return 3;if(v>=-2147483648)return 5;if(v>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+v.toString(16).substr(1))}if(f==="boolean")return 1;if(v===null)return A?0:1;if(v===void 0)return A?0:3;if(typeof v.toJSON=="function")return x(v.toJSON(),A);if(f==="object"){var b,P=0;if(Array.isArray(v)){b=v.length;for(var B=0;B<b;B++)P+=x(v[B],A)}else{var z=C(v,A);b=z.length;for(var B=0;B<b;B++){var W=z[B];P+=x(W)+x(v[W],A)}}if(b<16)return 1+P;if(b<65536)return 3+P;if(b<4294967296)return 5+P;throw new Error("Array or object too long 0x"+b.toString(16))}if(f==="function")return 0;throw new Error("Unknown type "+f)}e.default={encode:c,decode:_,inspect:n,utf8Write:r,utf8Read:a,utf8ByteCount:l}},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importDefault(t(30)),a=n.__importDefault(t(50)),l=n.__importDefault(t(3)),c=n.__importDefault(t(4)),u=n.__importDefault(t(55)),m=n.__importDefault(t(57)),g=n.__importDefault(t(62)),E=n.__importDefault(t(64)),h=n.__importDefault(t(68)),y=n.__importDefault(t(2)),O=t(8),_=n.__importDefault(t(65)),C=n.__importDefault(t(66)),T=n.__importDefault(t(41)),x=(0,m.default)(E.default,u.default);l.default.Crypto=x,l.default.BufferUtils=u.default,l.default.Http=g.default,l.default.Config=E.default,l.default.Transports=h.default,l.default.WebStorage=_.default,r.default.Crypto=x,a.default.Crypto=x,y.default.initLogHandlers(),l.default.Defaults=(0,O.getDefaults)(C.default),l.default.Config.agent&&(l.default.Defaults.agent+=" "+l.default.Config.agent),l.default.Config.noUpgrade&&(l.default.Defaults.upgradeTransports=[]),e.default={ErrorInfo:c.default,Rest:r.default,Realtime:a.default,msgpack:T.default}},function(s){s.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.45","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**","src/**","react/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.5","ws":"^5.1"},"peerDependencies":{"react":">=16.8.0","react-dom":">=16.8.0"},"peerDependenciesMeta":{"react":{"optional":true},"react-dom":{"optional":true}},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@testing-library/react":"^13.3.0","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","@vitejs/plugin-react":"^1.3.2","async":"ably-forks/async#requirejs","aws-sdk":"^2.1413.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"^2.8.5","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-import":"^2.28.0","eslint-plugin-jsdoc":"^40.0.0","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.6.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","jsdom":"^20.0.0","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","react":">=18.1.0","react-dom":">=18.1.0","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^4.0.1","tslib":"^2.3.1","typedoc":"^0.23.8","typescript":"^4.6.4","vite":"^4.4.9","vitest":"^0.18.0","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"build"},"main":"ably"},"scripts":{"start:react":"npx vite serve","grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:node:skip-build":"grunt mocha","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","test:react":"vitest run","concat":"grunt concat","build":"grunt build:all && npm run build:react","build:node":"grunt build:node","build:browser":"grunt build:browser","build:react":"npm run build:react:mjs && npm run build:react:cjs && cp src/platform/react-hooks/res/package.react.json react/package.json","build:react:mjs":"tsc --project src/platform/react-hooks/tsconfig.mjs.json && cp src/platform/react-hooks/res/package.mjs.json react/mjs/package.json","build:react:cjs":"tsc --project src/platform/react-hooks/tsconfig.cjs.json && cp src/platform/react-hooks/res/package.cjs.json react/cjs/package.json","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js docs/chrome-mv3.md","format:check":"prettier --check --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js","docs":"typedoc --entryPoints ably.d.ts --out docs/generated/default --readme docs/landing-pages/default.md && typedoc --entryPoints promises.d.ts --out docs/generated/promises --name \\"ably (Promise-based)\\" --readme docs/landing-pages/promises.md && cp docs/landing-pages/choose-library.html docs/generated/index.html"}}')},function(s,e){},function(s,e,t){(function(n,r){s.exports=e=r(t(6),t(32),t(24))})(this,function(n){return n.HmacSHA256})},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importStar(t(1)),a=n.__importDefault(t(47)),l=n.__importDefault(t(14)),c=n.__importDefault(t(19)),u=n.__importDefault(t(4)),m=n.__importDefault(t(48)),g=function(){},E=function(){function _(C){this.rest=C,this.admin=new h(C)}return _}(),h=function(){function _(C){this.rest=C,this.deviceRegistrations=new y(C),this.channelSubscriptions=new O(C)}return _.prototype.publish=function(C,T,x){var v=this.rest,A=v.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,f=r.defaultPostHeaders(v.options,A),p={},S=r.mixin({recipient:C},T);if(typeof x!="function"){if(this.rest.options.promises)return r.promisify(this,"publish",arguments);x=g}v.options.headers&&r.mixin(f,v.options.headers),v.options.pushFullWait&&r.mixin(p,{fullWait:"true"});var b=r.encodeBody(S,A);l.default.post(v,"/push/publish",b,f,p,null,function(P){return x(P)})},_}(),y=function(){function _(C){this.rest=C}return _.prototype.save=function(C,T){var x=this.rest,v=a.default.fromValues(C),A=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,f=r.defaultPostHeaders(x.options,A),p={};if(typeof T!="function"){if(this.rest.options.promises)return r.promisify(this,"save",arguments);T=g}x.options.headers&&r.mixin(f,x.options.headers),x.options.pushFullWait&&r.mixin(p,{fullWait:"true"});var S=r.encodeBody(v,A);l.default.put(x,"/push/deviceRegistrations/"+encodeURIComponent(C.id),S,f,p,null,function(b,P,B,z){T(b,b?void 0:a.default.fromResponseBody(P,z?void 0:A))})},_.prototype.get=function(C,T){var x=this.rest,v=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,A=r.defaultGetHeaders(x.options,v),f=C.id||C;if(typeof T!="function"){if(this.rest.options.promises)return r.promisify(this,"get",arguments);T=g}if(typeof f!="string"||!f.length){T(new u.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}x.options.headers&&r.mixin(A,x.options.headers),l.default.get(x,"/push/deviceRegistrations/"+encodeURIComponent(f),A,{},null,function(p,S,b,P){T(p,p?void 0:a.default.fromResponseBody(S,P?void 0:v))})},_.prototype.list=function(C,T){var x=this.rest,v=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,A=this.rest.http.supportsLinkHeaders?void 0:v,f=r.defaultGetHeaders(x.options,v);if(typeof T!="function"){if(this.rest.options.promises)return r.promisify(this,"list",arguments);T=g}x.options.headers&&r.mixin(f,x.options.headers),new c.default(x,"/push/deviceRegistrations",f,A,function(p,S,b){return a.default.fromResponseBody(p,b?void 0:v)}).get(C,T)},_.prototype.remove=function(C,T){var x=this.rest,v=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,A=r.defaultGetHeaders(x.options,v),f={},p=C.id||C;if(typeof T!="function"){if(this.rest.options.promises)return r.promisify(this,"remove",arguments);T=g}if(typeof p!="string"||!p.length){T(new u.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}x.options.headers&&r.mixin(A,x.options.headers),x.options.pushFullWait&&r.mixin(f,{fullWait:"true"}),l.default.delete(x,"/push/deviceRegistrations/"+encodeURIComponent(p),A,f,null,function(S){return T(S)})},_.prototype.removeWhere=function(C,T){var x=this.rest,v=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,A=r.defaultGetHeaders(x.options,v);if(typeof T!="function"){if(this.rest.options.promises)return r.promisify(this,"removeWhere",arguments);T=g}x.options.headers&&r.mixin(A,x.options.headers),x.options.pushFullWait&&r.mixin(C,{fullWait:"true"}),l.default.delete(x,"/push/deviceRegistrations",A,C,null,function(f){return T(f)})},_}(),O=function(){function _(C){this.remove=_.prototype.removeWhere,this.rest=C}return _.prototype.save=function(C,T){var x=this.rest,v=m.default.fromValues(C),A=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,f=r.defaultPostHeaders(x.options,A),p={};if(typeof T!="function"){if(this.rest.options.promises)return r.promisify(this,"save",arguments);T=g}x.options.headers&&r.mixin(f,x.options.headers),x.options.pushFullWait&&r.mixin(p,{fullWait:"true"});var S=r.encodeBody(v,A);l.default.post(x,"/push/channelSubscriptions",S,f,p,null,function(b,P,B,z){T(b,!b&&m.default.fromResponseBody(P,z?void 0:A))})},_.prototype.list=function(C,T){var x=this.rest,v=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,A=this.rest.http.supportsLinkHeaders?void 0:v,f=r.defaultGetHeaders(x.options,v);if(typeof T!="function"){if(this.rest.options.promises)return r.promisify(this,"list",arguments);T=g}x.options.headers&&r.mixin(f,x.options.headers),new c.default(x,"/push/channelSubscriptions",f,A,function(p,S,b){return m.default.fromResponseBody(p,b?void 0:v)}).get(C,T)},_.prototype.removeWhere=function(C,T){var x=this.rest,v=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,A=r.defaultGetHeaders(x.options,v);if(typeof T!="function"){if(this.rest.options.promises)return r.promisify(this,"removeWhere",arguments);T=g}x.options.headers&&r.mixin(A,x.options.headers),x.options.pushFullWait&&r.mixin(C,{fullWait:"true"}),l.default.delete(x,"/push/channelSubscriptions",A,C,null,function(f){return T(f)})},_.prototype.listChannels=function(C,T){var x=this.rest,v=x.options.useBinaryProtocol?r.Format.msgpack:r.Format.json,A=this.rest.http.supportsLinkHeaders?void 0:v,f=r.defaultGetHeaders(x.options,v);if(typeof T!="function"){if(this.rest.options.promises)return r.promisify(this,"listChannels",arguments);T=g}x.options.headers&&r.mixin(f,x.options.headers),x.options.pushFullWait&&r.mixin(C,{fullWait:"true"}),new c.default(x,"/push/channels",f,A,function(p,S,b){for(var P=!b&&v?r.decodeBody(p,v):p,B=0;B<P.length;B++)P[B]=String(P[B]);return P}).get(C,T)},_}();e.default=E},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importStar(t(1)),a=n.__importDefault(t(4)),l;(function(m){m.Phone="phone",m.Tablet="tablet",m.Desktop="desktop",m.TV="tv",m.Watch="watch",m.Car="car",m.Embedded="embedded",m.Other="other"})(l||(l={}));var c;(function(m){m.Android="android",m.IOS="ios",m.Browser="browser"})(c||(c={}));var u=function(){function m(){}return m.prototype.toJSON=function(){var g,E,h;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(g=this.push)===null||g===void 0?void 0:g.recipient,state:(E=this.push)===null||E===void 0?void 0:E.state,error:(h=this.push)===null||h===void 0?void 0:h.error}}},m.prototype.toString=function(){var g,E,h,y,O="[DeviceDetails";return this.id&&(O+="; id="+this.id),this.platform&&(O+="; platform="+this.platform),this.formFactor&&(O+="; formFactor="+this.formFactor),this.clientId&&(O+="; clientId="+this.clientId),this.metadata&&(O+="; metadata="+this.metadata),this.deviceIdentityToken&&(O+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((g=this.push)===null||g===void 0)&&g.recipient&&(O+="; push.recipient="+JSON.stringify(this.push.recipient)),!((E=this.push)===null||E===void 0)&&E.state&&(O+="; push.state="+this.push.state),!((h=this.push)===null||h===void 0)&&h.error&&(O+="; push.error="+JSON.stringify(this.push.error)),!((y=this.push)===null||y===void 0)&&y.metadata&&(O+="; push.metadata="+this.push.metadata),O+="]",O},m.fromResponseBody=function(g,E){return E&&(g=r.decodeBody(g,E)),r.isArray(g)?m.fromValuesArray(g):m.fromValues(g)},m.fromValues=function(g){return g.error=g.error&&a.default.fromValues(g.error),Object.assign(new m,g)},m.fromValuesArray=function(g){for(var E=g.length,h=new Array(E),y=0;y<E;y++)h[y]=m.fromValues(g[y]);return h},m.toRequestBody=r.encodeBody,m}();e.default=u},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importStar(t(1)),a=function(){function l(){}return l.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},l.prototype.toString=function(){var c="[PushChannelSubscription";return this.channel&&(c+="; channel="+this.channel),this.deviceId&&(c+="; deviceId="+this.deviceId),this.clientId&&(c+="; clientId="+this.clientId),c+="]",c},l.fromResponseBody=function(c,u){return u&&(c=r.decodeBody(c,u)),r.isArray(c)?l.fromValuesArray(c):l.fromValues(c)},l.fromValues=function(c){return Object.assign(new l,c)},l.fromValuesArray=function(c){for(var u=c.length,m=new Array(u),g=0;g<u;g++)m[g]=l.fromValues(c[g]);return m},l.toRequestBody=r.encodeBody,l}();e.default=a},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importStar(t(1)),a=function(){function x(v){this.count=v&&v.count||0,this.data=v&&v.data||0,this.uncompressedData=v&&v.uncompressedData||0,this.failed=v&&v.failed||0,this.refused=v&&v.refused||0}return x}(),l=function(x){n.__extends(v,x);function v(A){var f=x.call(this,A)||this;return A&&A.category&&(f.category={},r.forInOwnNonNullProperties(A.category,function(p){f.category[p]=new a(A.category[p])})),f}return v}(a),c=function(){function x(v){this.peak=v&&v.peak||0,this.min=v&&v.min||0,this.mean=v&&v.mean||0,this.opened=v&&v.opened||0,this.refused=v&&v.refused||0}return x}(),u=function(){function x(v){this.succeeded=v&&v.succeeded||0,this.failed=v&&v.failed||0,this.refused=v&&v.refused||0}return x}(),m=function(){function x(v){this.plain=new c(v&&v.plain),this.tls=new c(v&&v.tls),this.all=new c(v&&v.all)}return x}(),g=function(){function x(v){this.messages=new l(v&&v.messages),this.presence=new l(v&&v.presence),this.all=new l(v&&v.all)}return x}(),E=function(){function x(v){this.realtime=new g(v&&v.realtime),this.rest=new g(v&&v.rest),this.webhook=new g(v&&v.webhook),this.sharedQueue=new g(v&&v.sharedQueue),this.externalQueue=new g(v&&v.externalQueue),this.httpEvent=new g(v&&v.httpEvent),this.push=new g(v&&v.push),this.all=new g(v&&v.all)}return x}(),h=function(){function x(v){this.all=new g(v&&v.all),this.inbound=new E(v&&v.inbound),this.outbound=new E(v&&v.outbound)}return x}(),y=function(){function x(v){this.all=new g(v&&v.all),this.producerPaid=new h(v&&v.producerPaid),this.consumerPaid=new h(v&&v.consumerPaid)}return x}(),O=function(){function x(v){this.messages=v&&v.messages||0;var A=v&&v.notifications;this.notifications={invalid:A&&A.invalid||0,attempted:A&&A.attempted||0,successful:A&&A.successful||0,failed:A&&A.failed||0},this.directPublishes=v&&v.directPublishes||0}return x}(),_=function(){function x(v){this.succeeded=v&&v.succeeded||0,this.skipped=v&&v.skipped||0,this.failed=v&&v.failed||0}return x}(),C=function(){function x(v){var A=this;this.delta=void 0,v&&v.delta&&(this.delta={},r.forInOwnNonNullProperties(v.delta,function(f){A.delta[f]=new _(v.delta[f])}))}return x}(),T=function(x){n.__extends(v,x);function v(A){var f=x.call(this,A)||this;return f.persisted=new g(A&&A.persisted),f.connections=new m(A&&A.connections),f.channels=new c(A&&A.channels),f.apiRequests=new u(A&&A.apiRequests),f.tokenRequests=new u(A&&A.tokenRequests),f.xchgProducer=new y(A&&A.xchgProducer),f.xchgConsumer=new y(A&&A.xchgConsumer),f.push=new O(A&&A.pushStats),f.processed=new C(A&&A.processed),f.inProgress=A&&A.inProgress||void 0,f.unit=A&&A.unit||void 0,f.intervalId=A&&A.intervalId||void 0,f}return v.fromValues=function(A){return new v(A)},v}(h);e.default=T},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importStar(t(1)),a=n.__importDefault(t(30)),l=n.__importDefault(t(7)),c=n.__importDefault(t(2)),u=n.__importDefault(t(51)),m=n.__importDefault(t(38)),g=n.__importDefault(t(8)),E=n.__importDefault(t(4)),h=n.__importDefault(t(10)),y=n.__importDefault(t(35)),O=n.__importDefault(t(3)),_=n.__importDefault(t(9)),C=function(x){n.__extends(v,x);function v(A){var f=x.call(this,A)||this;return c.default.logAction(c.default.LOG_MINOR,"Realtime()",""),f.connection=new u.default(f,f.options),f.channels=new T(f),A.autoConnect!==!1&&f.connect(),f}return v.prototype.connect=function(){c.default.logAction(c.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},v.prototype.close=function(){c.default.logAction(c.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},v.Promise=function(A){return A=g.default.objectifyOptions(A),A.promises=!0,new v(A)},v.Callbacks=v,v.Utils=r,v.ConnectionManager=y.default,v.Platform=O.default,v.ProtocolMessage=h.default,v.Message=_.default,v}(a.default),T=function(x){n.__extends(v,x);function v(A){var f=x.call(this)||this;return f.realtime=A,f.all=Object.create(null),A.connection.connectionManager.on("transport.active",function(){f.onTransportActive()}),f}return v.prototype.channelSerials=function(){for(var A={},f=0,p=r.keysArray(this.all,!0);f<p.length;f++){var S=p[f],b=this.all[S];b.properties.channelSerial&&(A[S]=b.properties.channelSerial)}return A},v.prototype.recoverChannels=function(A){for(var f=0,p=r.keysArray(A,!0);f<p.length;f++){var S=p[f],b=this.get(S);b.properties.channelSerial=A[S]}},v.prototype.onChannelMessage=function(A){var f=A.channel;if(f===void 0){c.default.logAction(c.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+A.action);return}var p=this.all[f];if(!p){c.default.logAction(c.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+f);return}p.onMessage(A)},v.prototype.onTransportActive=function(){for(var A in this.all){var f=this.all[A];f.state==="attaching"||f.state==="detaching"?f.checkPendingState():f.state==="suspended"?f._attach(!1,null):f.state==="attached"&&f.requestState("attaching")}},v.prototype.propogateConnectionInterruption=function(A,f){var p={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},S=["attaching","attached","detaching","suspended"],b=p[A];for(var P in this.all){var B=this.all[P];r.arrIn(S,B.state)&&B.notifyState(b,f)}},v.prototype.get=function(A,f){A=String(A);var p=this.all[A];if(!p)p=this.all[A]=new m.default(this.realtime,A,f);else if(f){if(p._shouldReattachToSetOptions(f))throw new E.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);p.setOptions(f)}return p},v.prototype.getDerived=function(A,f,p){if(f.filter){var S=r.toBase64(f.filter),b=r.matchDerivedChannel(A);A="[filter=".concat(S).concat(b.qualifierParam,"]").concat(b.channelName)}return this.get(A,p)},v.prototype.release=function(A){A=String(A);var f=this.all[A];if(!!f){var p=f.getReleaseErr();if(p)throw p;delete this.all[A]}},v}(l.default);e.default=C},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importStar(t(1)),a=n.__importDefault(t(7)),l=n.__importDefault(t(35)),c=n.__importDefault(t(2)),u=n.__importDefault(t(37)),m=n.__importDefault(t(3));function g(){}var E=function(h){n.__extends(y,h);function y(O,_){var C=h.call(this)||this;return C.whenState=function(T,x){return a.default.prototype.whenState.call(C,T,C.state,x,new u.default(void 0,T))},C.ably=O,C.connectionManager=new l.default(O,_),C.state=C.connectionManager.state.state,C.key=void 0,C.id=void 0,C.errorReason=null,C.connectionManager.on("connectionstate",function(T){var x=C.state=T.current;m.default.Config.nextTick(function(){C.emit(x,T)})}),C.connectionManager.on("update",function(T){m.default.Config.nextTick(function(){C.emit("update",T)})}),C}return y.prototype.connect=function(){c.default.logAction(c.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},y.prototype.ping=function(O){if(c.default.logAction(c.default.LOG_MINOR,"Connection.ping()",""),!O){if(this.ably.options.promises)return r.promisify(this,"ping",arguments);O=g}this.connectionManager.ping(null,O)},y.prototype.close=function(){c.default.logAction(c.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},Object.defineProperty(y.prototype,"recoveryKey",{get:function(){return this.createRecoveryKey()},enumerable:!1,configurable:!0}),y.prototype.createRecoveryKey=function(){return this.connectionManager.createRecoveryKey()},y}(a.default);e.default=E},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PendingMessage=void 0;var n=t(0),r=n.__importDefault(t(10)),a=n.__importStar(t(1)),l=n.__importDefault(t(7)),c=n.__importDefault(t(2)),u=n.__importDefault(t(36)),m=n.__importDefault(t(4)),g=r.default.Action,E=function(){function y(O,_){this.message=O,this.callback=_,this.merged=!1;var C=O.action;this.sendAttempted=!1,this.ackRequired=C==g.MESSAGE||C==g.PRESENCE}return y}();e.PendingMessage=E;var h=function(y){n.__extends(O,y);function O(_){var C=y.call(this)||this;return C.transport=_,C.messageQueue=new u.default,_.on("ack",function(T,x){C.onAck(T,x)}),_.on("nack",function(T,x,v){C.onNack(T,x,v)}),C}return O.prototype.onAck=function(_,C){c.default.logAction(c.default.LOG_MICRO,"Protocol.onAck()","serial = "+_+"; count = "+C),this.messageQueue.completeMessages(_,C)},O.prototype.onNack=function(_,C,T){c.default.logAction(c.default.LOG_ERROR,"Protocol.onNack()","serial = "+_+"; count = "+C+"; err = "+a.inspectError(T)),T||(T=new m.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(_,C,T)},O.prototype.onceIdle=function(_){var C=this.messageQueue;if(C.count()===0){_();return}C.once("idle",_)},O.prototype.send=function(_){_.ackRequired&&this.messageQueue.push(_),c.default.shouldLog(c.default.LOG_MICRO)&&c.default.logAction(c.default.LOG_MICRO,"Protocol.send()","sending msg; "+r.default.stringify(_.message)),_.sendAttempted=!0,this.transport.send(_.message)},O.prototype.getTransport=function(){return this.transport},O.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},O.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},O.prototype.finish=function(){var _=this.transport;this.onceIdle(function(){_.disconnect()})},O}(l.default);e.default=h},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importDefault(t(3)),a=n.__importStar(t(1)),l=n.__importDefault(t(26)),c=n.__importDefault(t(8)),u=n.__importDefault(t(2)),m=n.__importDefault(t(10)),g=n.__importDefault(t(4)),E="web_socket";function h(_){return!!_.on}var y=function(_){n.__extends(C,_);function C(T,x,v){var A=_.call(this,T,x,v)||this;return A.shortName=E,v.heartbeats=r.default.Config.useProtocolHeartbeats,A.wsHost=c.default.getHost(v.options,v.host,!0),A}return C.isAvailable=function(){return!!r.default.Config.WebSocket},C.prototype.createWebSocket=function(T,x){return this.uri=T+a.toQueryString(x),new r.default.Config.WebSocket(this.uri)},C.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},C.prototype.connect=function(){u.default.logAction(u.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),l.default.prototype.connect.call(this);var T=this,x=this.params,v=x.options,A=v.tls?"wss://":"ws://",f=A+this.wsHost+":"+c.default.getPort(v)+"/";u.default.logAction(u.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+f),this.auth.getAuthParams(function(p,S){if(!T.isDisposed){var b="";for(var P in S)b+=" "+P+": "+S[P]+";";if(u.default.logAction(u.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+b+" err: "+p),p){T.disconnect(p);return}var B=x.getConnectParams(S);try{var z=T.wsConnection=T.createWebSocket(f,B);z.binaryType=r.default.Config.binaryType,z.onopen=function(){T.onWsOpen()},z.onclose=function(W){T.onWsClose(W)},z.onmessage=function(W){T.onWsData(W.data)},z.onerror=function(W){T.onWsError(W)},h(z)&&z.on("ping",function(){T.onActivity()})}catch(W){u.default.logAction(u.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(W.stack||W.message)),T.disconnect(W)}}})},C.prototype.send=function(T){var x=this.wsConnection;if(!x){u.default.logAction(u.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{x.send(m.default.serialize(T,this.params.format))}catch(A){var v="Exception from ws connection when trying to send: "+a.inspectError(A);u.default.logAction(u.default.LOG_ERROR,"WebSocketTransport.send()",v),this.finish("disconnected",new g.default(v,5e4,500))}},C.prototype.onWsData=function(T){u.default.logAction(u.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+T.length+"; type = "+typeof T);try{this.onProtocolMessage(m.default.deserialize(T,this.format))}catch(x){u.default.logAction(u.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+x.stack)}},C.prototype.onWsOpen=function(){u.default.logAction(u.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},C.prototype.onWsClose=function(T){var x,v;if(typeof T=="object"?(v=T.code,x=T.wasClean||v===1e3):(v=T,x=v==1e3),delete this.wsConnection,x){u.default.logAction(u.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var A=new g.default("Websocket closed",80003,400);this.finish("disconnected",A)}else{var f="Unclean disconnection of WebSocket ; code = "+v,A=new g.default(f,80003,400);u.default.logAction(u.default.LOG_MINOR,"WebSocketTransport.onWsClose()",f),this.finish("disconnected",A)}this.emit("disposed")},C.prototype.onWsError=function(T){var x=this;u.default.logAction(u.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+T.message),r.default.Config.nextTick(function(){x.disconnect(Error(T.message))})},C.prototype.dispose=function(){u.default.logAction(u.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var T=this.wsConnection;T&&(T.onmessage=function(){},delete this.wsConnection,r.default.Config.nextTick(function(){if(u.default.logAction(u.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!T)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");T.close()}))},C}(l.default);function O(_){return y.isAvailable()&&(_.supportedTransports[E]=y),y}e.default=O},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importStar(t(1)),a=n.__importDefault(t(34)),l=n.__importDefault(t(7)),c=n.__importDefault(t(2)),u=n.__importDefault(t(15)),m=n.__importStar(t(4)),g=n.__importDefault(t(38)),E=n.__importDefault(t(23)),h=n.__importDefault(t(39)),y=function(){};function O(A){return A.channel.realtime.auth.clientId}function _(A){var f=A.channel.realtime,p=f.auth.clientId;return(!p||p==="*")&&f.connection.state==="connected"}function C(A,f,p){switch(A.state){case"attached":case"suspended":p();break;case"initialized":case"detached":case"detaching":case"attaching":A.attach(function(S){S?f(S):p()});break;default:f(m.default.fromValues(A.invalidStateError()))}}function T(A,f){if(A.isSynthesized()||f.isSynthesized())return A.timestamp>=f.timestamp;var p=A.parseId(),S=f.parseId();return p.msgSerial===S.msgSerial?p.index>S.index:p.msgSerial>S.msgSerial}var x=function(A){n.__extends(f,A);function f(p){var S=A.call(this,p)||this;return S.channel=p,S.syncComplete=!1,S.members=new v(S,function(b){return b.clientId+":"+b.connectionId}),S._myMembers=new v(S,function(b){return b.clientId}),S.subscriptions=new l.default,S.pendingPresence=[],S}return f.prototype.enter=function(p,S){if(_(this))throw new m.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,p,"enter",S)},f.prototype.update=function(p,S){if(_(this))throw new m.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,p,"update",S)},f.prototype.enterClient=function(p,S,b){return this._enterOrUpdateClient(void 0,p,S,"enter",b)},f.prototype.updateClient=function(p,S,b){return this._enterOrUpdateClient(void 0,p,S,"update",b)},f.prototype._enterOrUpdateClient=function(p,S,b,P,B){var z=this;if(!B)if(typeof b=="function")B=b,b=null;else{if(this.channel.realtime.options.promises)return r.promisify(this,"_enterOrUpdateClient",[p,S,b,P]);B=y}var W=this.channel;if(!W.connectionManager.activeState()){B(W.connectionManager.getError());return}c.default.logAction(c.default.LOG_MICRO,"RealtimePresence."+P+"Client()","channel = "+W.name+", id = "+p+", client = "+(S||"(implicit) "+O(this)));var N=u.default.fromData(b);N.action=P,p&&(N.id=p),S&&(N.clientId=S),u.default.encode(N,W.channelOptions,function(M){if(M){B(M);return}switch(W.state){case"attached":W.sendPresence(N,B);break;case"initialized":case"detached":W.attach();case"attaching":z.pendingPresence.push({presence:N,callback:B});break;default:M=new m.PartialErrorInfo("Unable to "+P+" presence channel while in "+W.state+" state",90001),M.code=90001,B(M)}})},f.prototype.leave=function(p,S){if(_(this))throw new m.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,p,S)},f.prototype.leaveClient=function(p,S,b){if(!b)if(typeof S=="function")b=S,S=null;else{if(this.channel.realtime.options.promises)return r.promisify(this,"leaveClient",[p,S]);b=y}var P=this.channel;if(!P.connectionManager.activeState()){b==null||b(P.connectionManager.getError());return}c.default.logAction(c.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+p);var B=u.default.fromValues({action:"leave",data:S});switch(p&&(B.clientId=p),P.state){case"attached":P.sendPresence(B,b);break;case"attaching":this.pendingPresence.push({presence:B,callback:b});break;case"initialized":case"failed":{var z=new m.PartialErrorInfo("Unable to leave presence channel (incompatible state)",90001);b==null||b(z);break}default:b==null||b(P.invalidStateError())}},f.prototype.get=function(p,S){var b=this,P=Array.prototype.slice.call(arguments);P.length==1&&typeof P[0]=="function"&&P.unshift(null),p=P[0],S=P[1];var B=!p||("waitForSync"in p?p.waitForSync:!0);if(!S){if(this.channel.realtime.options.promises)return r.promisify(this,"get",P);S=y}function z(W){S(null,p?W.list(p):W.values())}if(this.channel.state==="suspended"){B?S(m.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):z(this.members);return}C(this.channel,S,function(){var W=b.members;B?W.waitSync(function(){z(W)}):z(W)})},f.prototype.history=function(p,S){if(c.default.logAction(c.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),S===void 0)if(typeof p=="function")S=p,p=null;else{if(this.channel.realtime.options.promises)return r.promisify(this,"history",arguments);S=y}p&&p.untilAttach&&(this.channel.state==="attached"?(delete p.untilAttach,p.from_serial=this.channel.properties.attachSerial):S(new m.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),a.default.prototype._history.call(this,p,S)},f.prototype.setPresence=function(p,S,b){c.default.logAction(c.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+p.length+" participants; syncChannelSerial = "+b);var P,B,z=this.members,W=this._myMembers,N=[],M=this.channel.connectionManager.connectionId;S&&(this.members.startSync(),b&&(B=b.match(/^[\w-]+:(.*)$/))&&(P=B[1]));for(var D=0;D<p.length;D++){var U=u.default.fromValues(p[D]);switch(U.action){case"leave":z.remove(U)&&N.push(U),U.connectionId===M&&!U.isSynthesized()&&W.remove(U);break;case"enter":case"present":case"update":z.put(U)&&N.push(U),U.connectionId===M&&W.put(U);break}}S&&!P&&(z.endSync(),this.channel.syncChannelSerial=null);for(var D=0;D<N.length;D++){var U=N[D];this.subscriptions.emit(U.action,U)}},f.prototype.onAttached=function(p){c.default.logAction(c.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+p),p?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();var S=this.pendingPresence,b=S.length;if(b){this.pendingPresence=[];var P=[],B=E.default.create();c.default.logAction(c.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+b+" queued presence messages");for(var z=0;z<b;z++){var W=S[z];P.push(W.presence),B.push(W.callback)}this.channel.sendPresence(P,B)}},f.prototype.actOnChannelState=function(p,S,b){switch(p){case"attached":this.onAttached(S);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(b);break}},f.prototype.failPendingPresence=function(p){if(this.pendingPresence.length){c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+r.inspectError(p));for(var S=0;S<this.pendingPresence.length;S++)try{this.pendingPresence[S].callback(p)}catch(b){}this.pendingPresence=[]}},f.prototype._clearMyMembers=function(){this._myMembers.clear()},f.prototype._ensureMyMembersPresent=function(){var p=this,S=this._myMembers,b=function(z){if(z){var W="Presence auto-re-enter failed: "+z.toString(),N=new m.default(W,91004,400);c.default.logAction(c.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",W);var M=new h.default(p.channel.state,p.channel.state,!0,!1,N);p.channel.emit("update",M)}};for(var P in S.map){var B=S.map[P];c.default.logAction(c.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+B.clientId+'" into the presence set'),this._enterOrUpdateClient(B.id,B.clientId,B.data,"enter",b)}},f.prototype._synthesizeLeaves=function(p){var S=this.subscriptions;r.arrForEach(p,function(b){var P=u.default.fromValues({action:"leave",connectionId:b.connectionId,clientId:b.clientId,data:b.data,encoding:b.encoding,timestamp:r.now()});S.emit("leave",P)})},f.prototype.on=function(){for(var p=[],S=0;S<arguments.length;S++)p[S]=arguments[S];c.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,p)},f.prototype.off=function(){for(var p=[],S=0;S<arguments.length;S++)p[S]=arguments[S];c.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,p)},f.prototype.subscribe=function(){for(var p=[],S=0;S<arguments.length;S++)p[S]=arguments[S];var b=g.default.processListenerArgs(p),P=b[0],B=b[1],z=b[2],W=this.channel;if(!z){if(this.channel.realtime.options.promises)return r.promisify(this,"subscribe",[P,B]);z=y}if(W.state==="failed"){z(m.default.fromValues(W.invalidStateError()));return}this.subscriptions.on(P,B),W.attach(z)},f.prototype.unsubscribe=function(){for(var p=[],S=0;S<arguments.length;S++)p[S]=arguments[S];var b=g.default.processListenerArgs(p),P=b[0],B=b[1];this.subscriptions.off(P,B)},f}(a.default),v=function(A){n.__extends(f,A);function f(p,S){var b=A.call(this)||this;return b.presence=p,b.map=Object.create(null),b.syncInProgress=!1,b.residualMembers=null,b.memberKey=S,b}return f.prototype.get=function(p){return this.map[p]},f.prototype.getClient=function(p){var S=this.map,b=[];for(var P in S){var B=S[P];B.clientId==p&&B.action!="absent"&&b.push(B)}return b},f.prototype.list=function(p){var S=this.map,b=p&&p.clientId,P=p&&p.connectionId,B=[];for(var z in S){var W=S[z];W.action!=="absent"&&(b&&b!=W.clientId||P&&P!=W.connectionId||B.push(W))}return B},f.prototype.put=function(p){(p.action==="enter"||p.action==="update")&&(p=u.default.fromValues(p),p.action="present");var S=this.map,b=this.memberKey(p);this.residualMembers&&delete this.residualMembers[b];var P=S[b];return P&&!T(p,P)?!1:(S[b]=p,!0)},f.prototype.values=function(){var p=this.map,S=[];for(var b in p){var P=p[b];P.action!="absent"&&S.push(P)}return S},f.prototype.remove=function(p){var S=this.map,b=this.memberKey(p),P=S[b];return P&&!T(p,P)?!1:(this.syncInProgress?(p=u.default.fromValues(p),p.action="absent",S[b]=p):delete S[b],!0)},f.prototype.startSync=function(){var p=this.map,S=this.syncInProgress;c.default.logAction(c.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+S),this.syncInProgress||(this.residualMembers=r.copy(p),this.setInProgress(!0))},f.prototype.endSync=function(){var p=this.map,S=this.syncInProgress;if(c.default.logAction(c.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+S),S){for(var b in p){var P=p[b];P.action==="absent"&&delete p[b]}this.presence._synthesizeLeaves(r.valuesArray(this.residualMembers));for(var b in this.residualMembers)delete p[b];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},f.prototype.waitSync=function(p){var S=this.syncInProgress;if(c.default.logAction(c.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+S),!S){p();return}this.once("sync",p)},f.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},f.prototype.setInProgress=function(p){c.default.logAction(c.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+p),this.syncInProgress=p,this.presence.syncComplete=!p},f}(l.default);e.default=x},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=t(56),a=t(31),l=t(11),c=n.__importDefault(t(5)),u=n.__importDefault(t(3)),m=function(){function g(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return g.prototype.isWordArray=function(E){return E!=null&&E.sigBytes!==void 0},g.prototype.isArrayBuffer=function(E){return E!=null&&E.constructor===ArrayBuffer},g.prototype.isTypedArray=function(E){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(E)},g.prototype.uint8ViewToBase64=function(E){for(var h="",y=this.base64CharSet,O=E.byteLength,_=O%3,C=O-_,T,x,v,A,f,p=0;p<C;p=p+3)f=E[p]<<16|E[p+1]<<8|E[p+2],T=(f&16515072)>>18,x=(f&258048)>>12,v=(f&4032)>>6,A=f&63,h+=y[T]+y[x]+y[v]+y[A];return _==1?(f=E[C],T=(f&252)>>2,x=(f&3)<<4,h+=y[T]+y[x]+"=="):_==2&&(f=E[C]<<8|E[C+1],T=(f&64512)>>10,x=(f&1008)>>4,v=(f&15)<<2,h+=y[T]+y[x]+y[v]+"="),h},g.prototype.base64ToArrayBuffer=function(E){for(var h=atob==null?void 0:atob(E),y=h.length,O=new Uint8Array(y),_=0;_<y;_++){var C=h.charCodeAt(_);O[_]=C}return O.buffer},g.prototype.isBuffer=function(E){return this.isArrayBuffer(E)||this.isWordArray(E)||this.isTypedArray(E)},g.prototype.toBuffer=function(E){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(E))return new Uint8Array(E);if(this.isTypedArray(E))return new Uint8Array(E.buffer);if(this.isWordArray(E)){for(var h=new ArrayBuffer(E.sigBytes),y=new Uint8Array(h),O=0;O<E.sigBytes;O++)y[O]=E.words[O>>>2]>>>24-O%4*8&255;return y}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},g.prototype.toArrayBuffer=function(E){return this.isArrayBuffer(E)?E:this.toBuffer(E).buffer},g.prototype.toWordArray=function(E){return this.isTypedArray(E)&&(E=E.buffer),this.isWordArray(E)?E:c.default.create(E)},g.prototype.base64Encode=function(E){return this.isWordArray(E)?(0,l.stringify)(E):this.uint8ViewToBase64(this.toBuffer(E))},g.prototype.base64Decode=function(E){return ArrayBuffer&&u.default.Config.atob?this.base64ToArrayBuffer(E):(0,l.parse)(E)},g.prototype.hexEncode=function(E){return(0,r.stringify)(this.toWordArray(E))},g.prototype.hexDecode=function(E){var h=(0,r.parse)(E);return ArrayBuffer?this.toArrayBuffer(h):h},g.prototype.utf8Encode=function(E){return u.default.Config.TextEncoder?new u.default.Config.TextEncoder().encode(E).buffer:(0,a.parse)(E)},g.prototype.utf8Decode=function(E){if(!this.isBuffer(E))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(E)?new TextDecoder().decode(E):(E=this.toWordArray(E),(0,a.stringify)(E))},g.prototype.bufferCompare=function(E,h){if(!E)return-1;if(!h)return 1;var y=this.toWordArray(E),O=this.toWordArray(h);y.clamp(),O.clamp();var _=y.sigBytes-O.sigBytes;if(_!=0)return _;for(var C=y.words,T=O.words,x=0;x<C.length;x++)if(_=C[x]-T[x],_!=0)return _;return 0},g.prototype.byteLength=function(E){return this.isArrayBuffer(E)||this.isTypedArray(E)?E.byteLength:this.isWordArray(E)?E.sigBytes:-1},g.prototype.typedArrayToBuffer=function(E){return E.buffer},g}();e.default=new m},function(s,e,t){(function(n,r){s.exports=e=r(t(6))})(this,function(n){return n.enc.Hex})},function(s,e,t){"use strict";t.r(e);var n=t(5),r=t.n(n),a=t(11),l=t.n(a),c=t(22),u=t.n(c),m=t(2),g=t.n(m),E=t(4),h=t.n(E),y=function(O,_){var C="aes",T=256,x="cbc",v=16,A=4,f=4294967296,p=2147483648,S;if(O.getRandomWordArray)S=O.getRandomWordArray;else if(typeof Uint32Array!="undefined"&&O.getRandomValues){var b=new Uint32Array(A);S=function(U,G){var J=U/4,tt=J==A?b:new Uint32Array(J);O.getRandomValues(tt,function(it){typeof G!="undefined"&&G(it,_.toWordArray(tt))})}}else S=function(U,G){g.a.logAction(g.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var J=U/4,tt=new Array(J),it=0;it<J;it++)tt[it]=Math.floor(Math.random()*f)-p;G(null,r.a.create(tt))};function P(U){return U+v&-v}function B(U){if(U.algorithm==="aes"&&U.mode==="cbc"){if(U.keyLength===128||U.keyLength===256)return;throw new Error("Unsupported key length "+U.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function z(U){return U.replace("_","/").replace("-","+")}var W=[r.a.create([269488144,269488144,269488144,269488144],16),r.a.create([16777216],1),r.a.create([33685504],2),r.a.create([50529024],3),r.a.create([67372036],4),r.a.create([84215045,83886080],5),r.a.create([101058054,101056512],6),r.a.create([117901063,117901056],7),r.a.create([134744072,134744072],8),r.a.create([151587081,151587081,150994944],9),r.a.create([168430090,168430090,168427520],10),r.a.create([185273099,185273099,185273088],11),r.a.create([202116108,202116108,202116108],12),r.a.create([218959117,218959117,218959117,218103808],13),r.a.create([235802126,235802126,235802126,235798528],14),r.a.create([252645135,252645135,252645135,252645135],15),r.a.create([269488144,269488144,269488144,269488144],16)];function N(){}function M(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}N.CipherParams=M,N.getDefaultParams=function(U){var G;if(typeof U=="function"||typeof U=="string"){if(g.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof U=="function")N.generateRandomKey(function(tt){U(null,N.getDefaultParams({key:tt}))});else if(typeof arguments[1]=="function")arguments[1](null,N.getDefaultParams({key:U}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!U.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof U.key=="string"?G=Object(a.parse)(z(U.key)):G=_.toWordArray(U.key);var J=new M;if(J.key=G,J.algorithm=U.algorithm||C,J.keyLength=G.words.length*(4*8),J.mode=U.mode||x,U.keyLength&&U.keyLength!==J.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+U.keyLength+" was specified, but the key actually has length "+J.keyLength);return B(J),J},N.generateRandomKey=function(U,G){arguments.length==1&&typeof U=="function"&&(G=U,U=void 0),S((U||T)/8,function(J,tt){G!==void 0&&G(J?h.a.fromValues(J):null,tt)})},N.getCipher=function(U){var G=U instanceof M?U:N.getDefaultParams(U);return{cipherParams:G,cipher:new D(G,A,U.iv)}};function D(U,G,J){this.algorithm=U.algorithm+"-"+String(U.keyLength)+"-"+U.mode,this.cjsAlgorithm=U.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=_.toWordArray(U.key),J&&(this.iv=_.toWordArray(J).clone()),this.blockLengthWords=G}return D.prototype.encrypt=function(U,G){g.a.logAction(g.a.LOG_MICRO,"CBCCipher.encrypt()",""),U=_.toWordArray(U);var J=U.sigBytes,tt=P(J),it=this,X=function(){it.getIv(function(R,k){if(R){G(R);return}var H=it.encryptCipher.process(U.concat(W[tt-J])),j=k.concat(H);G(null,j)})};this.encryptCipher?X():this.iv?(this.encryptCipher=u.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),X()):S(v,function(R,k){if(R){G(R);return}it.encryptCipher=u.a.algo[it.cjsAlgorithm].createEncryptor(it.key,{iv:k}),it.iv=k,X()})},D.prototype.decrypt=function(U){g.a.logAction(g.a.LOG_MICRO,"CBCCipher.decrypt()",""),U=_.toWordArray(U);var G=this.blockLengthWords,J=U.words,tt=r.a.create(J.slice(0,G)),it=r.a.create(J.slice(G)),X=u.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:tt}),R=X.process(it),k=X.finalize();return X.reset(),k&&k.sigBytes&&R.concat(k),R},D.prototype.getIv=function(U){if(this.iv){var G=this.iv;this.iv=null,U(null,G);return}var J=this;S(v,function(tt,it){if(tt){U(tt);return}U(null,J.encryptCipher.process(it))})},N};e.default=y},function(s,e,t){(function(n,r){s.exports=e=r(t(6))})(this,function(n){return function(){var r=n,a=r.lib,l=a.WordArray,c=r.enc,u=c.Utf16=c.Utf16BE={stringify:function(g){for(var E=g.words,h=g.sigBytes,y=[],O=0;O<h;O+=2){var _=E[O>>>2]>>>16-O%4*8&65535;y.push(String.fromCharCode(_))}return y.join("")},parse:function(g){for(var E=g.length,h=[],y=0;y<E;y++)h[y>>>1]|=g.charCodeAt(y)<<16-y%2*16;return l.create(h,E*2)}};c.Utf16LE={stringify:function(g){for(var E=g.words,h=g.sigBytes,y=[],O=0;O<h;O+=2){var _=m(E[O>>>2]>>>16-O%4*8&65535);y.push(String.fromCharCode(_))}return y.join("")},parse:function(g){for(var E=g.length,h=[],y=0;y<E;y++)h[y>>>1]|=m(g.charCodeAt(y)<<16-y%2*16);return l.create(h,E*2)}};function m(g){return g<<8&4278255360|g>>>8&16711935}}(),n.enc.Utf16})},function(s,e,t){(function(n,r){s.exports=e=r(t(6),t(28))})(this,function(n){return function(r){var a=n,l=a.lib,c=l.CipherParams,u=a.enc,m=u.Hex,g=a.format,E=g.Hex={stringify:function(h){return h.ciphertext.toString(m)},parse:function(h){var y=m.parse(h);return c.create({ciphertext:y})}}}(),n.format.Hex})},function(s,e,t){(function(n,r){s.exports=e=r(t(6),t(11),t(61),t(27),t(28))})(this,function(n){return function(){var r=n,a=r.lib,l=a.BlockCipher,c=r.algo,u=[],m=[],g=[],E=[],h=[],y=[],O=[],_=[],C=[],T=[];(function(){for(var A=[],f=0;f<256;f++)f<128?A[f]=f<<1:A[f]=f<<1^283;for(var p=0,S=0,f=0;f<256;f++){var b=S^S<<1^S<<2^S<<3^S<<4;b=b>>>8^b&255^99,u[p]=b,m[b]=p;var P=A[p],B=A[P],z=A[B],W=A[b]*257^b*16843008;g[p]=W<<24|W>>>8,E[p]=W<<16|W>>>16,h[p]=W<<8|W>>>24,y[p]=W;var W=z*16843009^B*65537^P*257^p*16843008;O[b]=W<<24|W>>>8,_[b]=W<<16|W>>>16,C[b]=W<<8|W>>>24,T[b]=W,p?(p=P^A[A[A[z^P]]],S^=A[A[S]]):p=S=1}})();var x=[0,1,2,4,8,16,32,64,128,27,54],v=c.AES=l.extend({_doReset:function(){var A;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var f=this._keyPriorReset=this._key,p=f.words,S=f.sigBytes/4,b=this._nRounds=S+6,P=(b+1)*4,B=this._keySchedule=[],z=0;z<P;z++)z<S?B[z]=p[z]:(A=B[z-1],z%S?S>6&&z%S==4&&(A=u[A>>>24]<<24|u[A>>>16&255]<<16|u[A>>>8&255]<<8|u[A&255]):(A=A<<8|A>>>24,A=u[A>>>24]<<24|u[A>>>16&255]<<16|u[A>>>8&255]<<8|u[A&255],A^=x[z/S|0]<<24),B[z]=B[z-S]^A);for(var W=this._invKeySchedule=[],N=0;N<P;N++){var z=P-N;if(N%4)var A=B[z];else var A=B[z-4];N<4||z<=4?W[N]=A:W[N]=O[u[A>>>24]]^_[u[A>>>16&255]]^C[u[A>>>8&255]]^T[u[A&255]]}}},encryptBlock:function(A,f){this._doCryptBlock(A,f,this._keySchedule,g,E,h,y,u)},decryptBlock:function(A,f){var p=A[f+1];A[f+1]=A[f+3],A[f+3]=p,this._doCryptBlock(A,f,this._invKeySchedule,O,_,C,T,m);var p=A[f+1];A[f+1]=A[f+3],A[f+3]=p},_doCryptBlock:function(A,f,p,S,b,P,B,z){for(var W=this._nRounds,N=A[f]^p[0],M=A[f+1]^p[1],D=A[f+2]^p[2],U=A[f+3]^p[3],G=4,J=1;J<W;J++){var tt=S[N>>>24]^b[M>>>16&255]^P[D>>>8&255]^B[U&255]^p[G++],it=S[M>>>24]^b[D>>>16&255]^P[U>>>8&255]^B[N&255]^p[G++],X=S[D>>>24]^b[U>>>16&255]^P[N>>>8&255]^B[M&255]^p[G++],R=S[U>>>24]^b[N>>>16&255]^P[M>>>8&255]^B[D&255]^p[G++];N=tt,M=it,D=X,U=R}var tt=(z[N>>>24]<<24|z[M>>>16&255]<<16|z[D>>>8&255]<<8|z[U&255])^p[G++],it=(z[M>>>24]<<24|z[D>>>16&255]<<16|z[U>>>8&255]<<8|z[N&255])^p[G++],X=(z[D>>>24]<<24|z[U>>>16&255]<<16|z[N>>>8&255]<<8|z[M&255])^p[G++],R=(z[U>>>24]<<24|z[N>>>16&255]<<16|z[M>>>8&255]<<8|z[D&255])^p[G++];A[f]=tt,A[f+1]=it,A[f+2]=X,A[f+3]=R},keySize:256/32});r.AES=l._createHelper(v)}(),n.AES})},function(s,e,t){(function(n,r){s.exports=e=r(t(6))})(this,function(n){return function(r){var a=n,l=a.lib,c=l.WordArray,u=l.Hasher,m=a.algo,g=[];(function(){for(var C=0;C<64;C++)g[C]=r.abs(r.sin(C+1))*4294967296|0})();var E=m.MD5=u.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(C,T){for(var x=0;x<16;x++){var v=T+x,A=C[v];C[v]=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360}var f=this._hash.words,p=C[T+0],S=C[T+1],b=C[T+2],P=C[T+3],B=C[T+4],z=C[T+5],W=C[T+6],N=C[T+7],M=C[T+8],D=C[T+9],U=C[T+10],G=C[T+11],J=C[T+12],tt=C[T+13],it=C[T+14],X=C[T+15],R=f[0],k=f[1],H=f[2],j=f[3];R=h(R,k,H,j,p,7,g[0]),j=h(j,R,k,H,S,12,g[1]),H=h(H,j,R,k,b,17,g[2]),k=h(k,H,j,R,P,22,g[3]),R=h(R,k,H,j,B,7,g[4]),j=h(j,R,k,H,z,12,g[5]),H=h(H,j,R,k,W,17,g[6]),k=h(k,H,j,R,N,22,g[7]),R=h(R,k,H,j,M,7,g[8]),j=h(j,R,k,H,D,12,g[9]),H=h(H,j,R,k,U,17,g[10]),k=h(k,H,j,R,G,22,g[11]),R=h(R,k,H,j,J,7,g[12]),j=h(j,R,k,H,tt,12,g[13]),H=h(H,j,R,k,it,17,g[14]),k=h(k,H,j,R,X,22,g[15]),R=y(R,k,H,j,S,5,g[16]),j=y(j,R,k,H,W,9,g[17]),H=y(H,j,R,k,G,14,g[18]),k=y(k,H,j,R,p,20,g[19]),R=y(R,k,H,j,z,5,g[20]),j=y(j,R,k,H,U,9,g[21]),H=y(H,j,R,k,X,14,g[22]),k=y(k,H,j,R,B,20,g[23]),R=y(R,k,H,j,D,5,g[24]),j=y(j,R,k,H,it,9,g[25]),H=y(H,j,R,k,P,14,g[26]),k=y(k,H,j,R,M,20,g[27]),R=y(R,k,H,j,tt,5,g[28]),j=y(j,R,k,H,b,9,g[29]),H=y(H,j,R,k,N,14,g[30]),k=y(k,H,j,R,J,20,g[31]),R=O(R,k,H,j,z,4,g[32]),j=O(j,R,k,H,M,11,g[33]),H=O(H,j,R,k,G,16,g[34]),k=O(k,H,j,R,it,23,g[35]),R=O(R,k,H,j,S,4,g[36]),j=O(j,R,k,H,B,11,g[37]),H=O(H,j,R,k,N,16,g[38]),k=O(k,H,j,R,U,23,g[39]),R=O(R,k,H,j,tt,4,g[40]),j=O(j,R,k,H,p,11,g[41]),H=O(H,j,R,k,P,16,g[42]),k=O(k,H,j,R,W,23,g[43]),R=O(R,k,H,j,D,4,g[44]),j=O(j,R,k,H,J,11,g[45]),H=O(H,j,R,k,X,16,g[46]),k=O(k,H,j,R,b,23,g[47]),R=_(R,k,H,j,p,6,g[48]),j=_(j,R,k,H,N,10,g[49]),H=_(H,j,R,k,it,15,g[50]),k=_(k,H,j,R,z,21,g[51]),R=_(R,k,H,j,J,6,g[52]),j=_(j,R,k,H,P,10,g[53]),H=_(H,j,R,k,U,15,g[54]),k=_(k,H,j,R,S,21,g[55]),R=_(R,k,H,j,M,6,g[56]),j=_(j,R,k,H,X,10,g[57]),H=_(H,j,R,k,W,15,g[58]),k=_(k,H,j,R,tt,21,g[59]),R=_(R,k,H,j,B,6,g[60]),j=_(j,R,k,H,G,10,g[61]),H=_(H,j,R,k,b,15,g[62]),k=_(k,H,j,R,D,21,g[63]),f[0]=f[0]+R|0,f[1]=f[1]+k|0,f[2]=f[2]+H|0,f[3]=f[3]+j|0},_doFinalize:function(){var C=this._data,T=C.words,x=this._nDataBytes*8,v=C.sigBytes*8;T[v>>>5]|=128<<24-v%32;var A=r.floor(x/4294967296),f=x;T[(v+64>>>9<<4)+15]=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360,T[(v+64>>>9<<4)+14]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360,C.sigBytes=(T.length+1)*4,this._process();for(var p=this._hash,S=p.words,b=0;b<4;b++){var P=S[b];S[b]=(P<<8|P>>>24)&16711935|(P<<24|P>>>8)&4278255360}return p},clone:function(){var C=u.clone.call(this);return C._hash=this._hash.clone(),C}});function h(C,T,x,v,A,f,p){var S=C+(T&x|~T&v)+A+p;return(S<<f|S>>>32-f)+T}function y(C,T,x,v,A,f,p){var S=C+(T&v|x&~v)+A+p;return(S<<f|S>>>32-f)+T}function O(C,T,x,v,A,f,p){var S=C+(T^x^v)+A+p;return(S<<f|S>>>32-f)+T}function _(C,T,x,v,A,f,p){var S=C+(x^(T|~v))+A+p;return(S<<f|S>>>32-f)+T}a.MD5=u._createHelper(E),a.HmacMD5=u._createHmacHelper(E)}(Math),n.MD5})},function(s,e,t){"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),a=r.__importDefault(t(3)),l=r.__importStar(t(1)),c=r.__importDefault(t(8)),u=t(4),m=r.__importDefault(t(18)),g=r.__importDefault(t(16)),E=r.__importDefault(t(21)),h=r.__importDefault(t(2)),y=t(29),O=r.__importDefault(t(63)),_=t(25);function C(v){var A=v.statusCode;return A===408&&!v.code||A===400&&!v.code||A>=500&&A<=504}function T(v){var A=v.connection,f=A&&A.connectionManager.host;return f?[f].concat(c.default.getFallbackHosts(v.options)):c.default.getHosts(v.options)}var x=(n=function(){function v(A){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=T,this.options=A||{};var f=this.options.connectivityCheckUrl||c.default.connectivityCheckUrl,p=this.options.connectivityCheckParams,S=!this.options.connectivityCheckUrl;a.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(b,P,B,z,W,N,M){var D=g.default.createRequest(B,z,W,N,E.default.REQ_SEND,P&&P.options.timeouts,b);return D.once("complete",M),D.exec(),D},this.options.disableConnectivityCheck?this.checkConnectivity=function(b){b(null,!0)}:this.checkConnectivity=function(b){h.default.logAction(h.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+f),this.doUri(m.default.Get,null,f,null,null,p,function(P,B,z,W,N){var M=!1;S?M=!P&&(B==null?void 0:B.replace(/\n/,""))=="yes":M=!P&&(0,_.isSuccessCode)(N),h.default.logAction(h.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+M),b(null,M)})}):a.default.Config.jsonpSupported?(this.Request=function(b,P,B,z,W,N,M){var D=(0,y.createRequest)(B,z,W,N,E.default.REQ_SEND,P&&P.options.timeouts,b);return D.once("complete",M),a.default.Config.nextTick(function(){D.exec()}),D},this.options.disableConnectivityCheck?this.checkConnectivity=function(b){b(null,!0)}:this.checkConnectivity=function(b){var P=this,B=c.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(b);return}this.checksInProgress=[b],h.default.logAction(h.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+B);var z=new y.Request("isTheInternetUp",B,null,null,null,E.default.REQ_SEND,c.default.TIMEOUTS);z.once("complete",function(W,N){var M=!W&&N;h.default.logAction(h.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+M);for(var D=0;D<P.checksInProgress.length;D++)P.checksInProgress[D](null,M);P.checksInProgress=null}),a.default.Config.nextTick(function(){z.exec()})}):a.default.Config.fetchSupported?(this.supportsAuthHeaders=!0,this.Request=O.default,this.checkConnectivity=function(b){h.default.logAction(h.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+f),this.doUri(m.default.Get,null,f,null,null,null,function(P,B){var z=!P&&(B==null?void 0:B.replace(/\n/,""))=="yes";h.default.logAction(h.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+z),b(null,z)})}):this.Request=function(b,P,B,z,W,N,M){M(new u.PartialErrorInfo("no supported HTTP transports available",null,400),null)}}return v.prototype.do=function(A,f,p,S,b,P,B){var z=this,W=typeof p=="function"?p:function(U){return f.baseUri(U)+p},N=f._currentFallback;if(N)if(N.validUntil>l.now()){if(!this.Request){B==null||B(new u.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(A,f,W(N.host),S,P,b,function(U){for(var G=[],J=1;J<arguments.length;J++)G[J-1]=arguments[J];if(U&&C(U)){f._currentFallback=null,z.do(A,f,p,S,b,P,B);return}B==null||B.apply(void 0,r.__spreadArray([U],G,!1))});return}else f._currentFallback=null;var M=T(f);if(M.length===1){this.doUri(A,f,W(M[0]),S,b,P,B);return}var D=function(U,G){var J=U.shift();z.doUri(A,f,W(J),S,b,P,function(tt){for(var it=[],X=1;X<arguments.length;X++)it[X-1]=arguments[X];if(tt&&C(tt)&&U.length){D(U,!0);return}G&&(f._currentFallback={host:J,validUntil:l.now()+f.options.timeouts.fallbackRetryTimeout}),B==null||B.apply(void 0,r.__spreadArray([tt],it,!1))})};D(M)},v.prototype.doUri=function(A,f,p,S,b,P,B){if(!this.Request){B(new u.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(A,f,p,S,P,b,B)},v}(),n.methods=[m.default.Get,m.default.Delete,m.default.Post,m.default.Put,m.default.Patch],n.methodsWithoutBody=[m.default.Get,m.default.Delete],n.methodsWithBody=[m.default.Post,m.default.Put,m.default.Patch],n);e.default=x},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importStar(t(4)),a=n.__importDefault(t(3)),l=n.__importDefault(t(8)),c=n.__importStar(t(1)),u=t(1);function m(h,y){return!!y.get("x-ably-errorcode")}function g(h,y){if(m(h,y))return h.error&&r.default.fromValues(h.error)}function E(h,y,O,_,C,T,x){var v=new Headers(_||{}),A=h?h.toUpperCase():c.isEmptyArg(T)?"GET":"POST",f=new AbortController,p=setTimeout(function(){f.abort(),x(new r.PartialErrorInfo("Request timed out",null,408))},y?y.options.timeouts.httpRequestTimeout:l.default.TIMEOUTS.httpRequestTimeout),S={method:A,headers:v,body:T};a.default.Config.isWebworker||(S.credentials=v.has("authorization")?"include":"same-origin"),(0,u.getGlobalObject)().fetch(O+"?"+new URLSearchParams(C||{}),S).then(function(b){clearTimeout(p);var P=b.headers.get("Content-Type"),B;P&&P.indexOf("application/x-msgpack")>-1?B=b.arrayBuffer():P&&P.indexOf("application/json")>-1?B=b.json():B=b.text(),B.then(function(z){var W=!!P&&P.indexOf("application/x-msgpack")===-1;if(b.ok)x(null,z,b.headers,W,b.status);else{var N=g(z,b.headers)||new r.PartialErrorInfo("Error response received from server: "+b.status+" body was: "+a.default.Config.inspect(z),null,b.status);x(N,z,b.headers,W,b.status)}})}).catch(function(b){clearTimeout(p),x(b)})}e.default=E},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importDefault(t(41)),a=n.__importStar(t(1)),l=a.getGlobalObject();function c(){var E=l.location;return!l.WebSocket||!E||!E.origin||E.origin.indexOf("http")>-1}var u=l.navigator&&l.navigator.userAgent.toString(),m=l.location&&l.location.href,g={agent:"browser",logTimestamps:!0,userAgent:u,currentUrl:m,noUpgrade:u&&!!u.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:l.WebSocket,fetchSupported:!!l.fetch,xhrSupported:l.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document!="undefined",allowComet:c(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:r.default,supportsBinary:!!l.TextDecoder,preferBinary:!1,ArrayBuffer:l.ArrayBuffer,atob:l.atob,nextTick:typeof l.setImmediate!="undefined"?l.setImmediate.bind(l):function(E){setTimeout(E,0)},addEventListener:l.addEventListener,inspect:JSON.stringify,stringByteSize:function(E){return l.TextDecoder&&new l.TextEncoder().encode(E).length||E.length},TextEncoder:l.TextEncoder,TextDecoder:l.TextDecoder,Promise:l.Promise,getRandomValues:function(E){if(E!==void 0)return function(h,y){E.getRandomValues(h),y&&y(null)}}(l.crypto||msCrypto)};e.default=g},function(s,e,t){"use strict";(function(n){Object.defineProperty(e,"__esModule",{value:!0});var r=t(0),a=r.__importStar(t(1)),l="ablyjs-storage-test",c=function(){function u(){try{n.sessionStorage.setItem(l,l),n.sessionStorage.removeItem(l),this.sessionSupported=!0}catch(m){this.sessionSupported=!1}try{n.localStorage.setItem(l,l),n.localStorage.removeItem(l),this.localSupported=!0}catch(m){this.localSupported=!1}}return u.prototype.get=function(m){return this._get(m,!1)},u.prototype.getSession=function(m){return this._get(m,!0)},u.prototype.remove=function(m){return this._remove(m,!1)},u.prototype.removeSession=function(m){return this._remove(m,!0)},u.prototype.set=function(m,g,E){return this._set(m,g,E,!1)},u.prototype.setSession=function(m,g,E){return this._set(m,g,E,!0)},u.prototype._set=function(m,g,E,h){var y={value:g};return E&&(y.expires=a.now()+E),this.storageInterface(h).setItem(m,JSON.stringify(y))},u.prototype._get=function(m,g){if(g&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!g&&!this.localSupported)throw new Error("Local Storage not supported");var E=this.storageInterface(g).getItem(m);if(!E)return null;var h=JSON.parse(E);return h.expires&&h.expires<a.now()?(this.storageInterface(g).removeItem(m),null):h.value},u.prototype._remove=function(m,g){return this.storageInterface(g).removeItem(m)},u.prototype.storageInterface=function(m){return m?n.sessionStorage:n.localStorage},u}();e.default=new c}).call(this,t(13))},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),r=n.__importDefault(t(67)),a={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[r.default.XhrPolling,r.default.XhrStreaming,r.default.JsonP,r.default.WebSocket],baseTransportOrder:[r.default.XhrPolling,r.default.XhrStreaming,r.default.JsonP,r.default.WebSocket],transportPreferenceOrder:[r.default.JsonP,r.default.XhrPolling,r.default.XhrStreaming,r.default.WebSocket],upgradeTransports:[r.default.XhrStreaming,r.default.WebSocket]};e.default=a},function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n;(function(r){r.WebSocket="web_socket",r.Comet="comet",r.XhrStreaming="xhr_streaming",r.XhrPolling="xhr_polling",r.JsonP="jsonp"})(n||(n={})),e.default=n},function(s,e,t){"use strict";t.r(e);var n=t(29),r=t.n(n),a=t(1),l=t(3),c=t.n(l),u=t(12),m=t.n(u),g=t(16),E=t.n(g),h=function(T){var x="xhr_polling";function v(A,f,p){p.stream=!1,m.a.call(this,A,f,p),this.shortName=x}return a.inherits(v,m.a),v.isAvailable=function(){return c.a.Config.xhrSupported&&c.a.Config.allowComet},v.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},v.prototype.createRequest=function(A,f,p,S,b){return E.a.createRequest(A,f,p,S,b,this.timeouts)},typeof T!="undefined"&&v.isAvailable()&&(T.supportedTransports[x]=v),v},y=h,O=function(T){var x="xhr_streaming";function v(A,f,p){m.a.call(this,A,f,p),this.shortName=x}return a.inherits(v,m.a),v.isAvailable=function(){return c.a.Config.xhrSupported&&c.a.Config.streamingSupported&&c.a.Config.allowComet},v.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},v.prototype.createRequest=function(A,f,p,S,b){return E.a.createRequest(A,f,p,S,b,this.timeouts)},typeof T!="undefined"&&v.isAvailable()&&(T.supportedTransports[x]=v),v},_=O,C=e.default=[r.a,y,_]}]).default})});L();L();var vo=(p=>(p.MEETING_START="meeting.start",p.MEETING_LEAVE="meeting.leave",p.MEETING_PARTICIPANT_AMOUNT_UPDATE="meeting.amount-of-participants-update",p.MEETING_PARTICIPANT_LIST_UPDATE="meeting.participant-list-update",p.MEETING_PARTICIPANT_JOINED="meeting.participant-joined",p.MEETING_PARTICIPANT_LEFT="meeting.participant-left",p.MEETING_JOIN="meeting.join",p.MEETING_PARTICIPANT_PROPERTIES="meeting.participant-properties",p.MEETING_HOST_CHANGE="meeting.host-change",p.MEETING_HOST_AVAILABLE="meeting.host-available",p.MEETING_NO_HOST_AVAILABLE="meeting.no-host-available",p.MEETING_SAME_PARTICIPANT_ERROR="meeting.same-participant-error",p.MEETING_DEVICES_CHANGE="meeting.devices-change",p.MEETING_KICK_PARTICIPANTS="meeting.kick-all-participants",p.MEETING_STATE_UPDATE="meeting.state-update",p.MEETING_CONNECTION_STATUS_CHANGE="meeting.connection-status-change",p.MEETING_WAITING_FOR_HOST="meeting.waiting-for-host",p.MY_PARTICIPANT_UPDATED="my-participant.update",p.MY_PARTICIPANT_LEFT="my-participant.left",p.MY_PARTICIPANT_JOINED="my-participant.joined",p.MEETING_KICK_PARTICIPANT="meeting.kick-participant",p.DESTROY="destroy",p))(vo||{}),yo=(u=>(u.FRAME_LOAD="frame.load",u.FRAME_DIMENSIONS_UPDATE="frame.dimensions-update",u.FRAME_PARENT_SIZE_UPDATE="frame.parent-window-size-update",u.FRAME_LOCALE_UPDATE="frame.locales-update",u.FRAME_AVATAR_LIST_UPDATE="frame.avatar-list-update",u.FRAME_COLOR_LIST_UPDATE="frame.color-list-update",u.FRAME_STYLES_UPDATE="frame.styles-update",u.FRAME_CALLBACKS_UPDATE="frame.callbacks-update",u))(yo||{}),bo=(u=>(u.TOGGLE_MEETING_CHAT="meeting-controls.toggle-chat",u.TOGGLE_MEETING_SETUP="meeting-controls.toggle-setup",u.TOGGLE_MICROPHONE="meeting-controls.toggle-microphone",u.TOGGLE_CAM="meeting-controls.toggle-cam",u.TOGGLE_SCREENSHARE="meeting-controls.toggle-screenshare",u.TOGGLE_TRANSCRIPT="meeting-controls.toggle-transcript",u.HANG_UP="hang-up",u.CALLBACK_CALLED="callback-called",u))(bo||{}),gn=(y=>(y.REALTIME_PARTICIPANT_LIST_UPDATE="realtime.participant-list-update",y.REALTIME_HOST_CHANGE="realtime.host-change",y.REALTIME_GRID_MODE_CHANGE="realtime.grid-mode-change",y.REALTIME_WAIT_FOR_HOST="realtime.wait-for-host",y.REALTIME_AUTHENTICATION_FAILED="realtime.authentication-failed",y.REALTIME_GO_TO_PARTICIPANT="realtime.go-to-participant",y.REALTIME_GATHER="realtime.gather",y.REALTIME_FOLLOW_PARTICIPANT="realtime.follow-participant",y.REALTIME_LOCAL_FOLLOW_PARTICIPANT="realtime.local-follow-participant",y.REALTIME_SET_AVATAR="realtime.set-avatar",y.REALTIME_DRAWING_CHANGE="realtime.drawing-change",y.REALTIME_TRANSCRIPT_CHANGE="realtime.transcript-change",y.REALTIME_PRIVATE_MODE="realtime.private-mode",y))(gn||{});var pa=(g=>(g[g.MEETING_FAILED=-1]="MEETING_FAILED",g[g.MEETING_DISCONNECTED=0]="MEETING_DISCONNECTED",g[g.MEETING_INITIALIZING=1]="MEETING_INITIALIZING",g[g.MEETING_READY_TO_JOIN=2]="MEETING_READY_TO_JOIN",g[g.MEETING_CONNECTING=3]="MEETING_CONNECTING",g[g.MEETING_CONNECTED=4]="MEETING_CONNECTED",g[g.MEETING_RECONNECT=5]="MEETING_RECONNECT",g[g.FRAME_INITIALIZING=6]="FRAME_INITIALIZING",g[g.FRAME_INITIALIZED=7]="FRAME_INITIALIZED",g[g.FRAME_UNINITIALIZED=8]="FRAME_UNINITIALIZED",g))(pa||{}),ma=(c=>(c.JOINED="participant.joined",c.LOCAL_JOINED="participant.local-joined",c.LEFT="participant.left",c.LOCAL_LEFT="participant.local-left",c.LOCAL_UPDATED="participant.updated",c.LIST_UPDATED="participant.list-updated",c.SAME_ACCOUNT_ERROR="participant.same-account-error",c))(ma||{}),Eo=(c=>(c[c.NOT_AVAILABLE=0]="NOT_AVAILABLE",c[c.GOOD=1]="GOOD",c[c.BAD=2]="BAD",c[c.POOR=3]="POOR",c[c.DISCONNECTED=4]="DISCONNECTED",c[c.RECONNECTING=5]="RECONNECTING",c[c.LOST_CONNECTION=6]="LOST_CONNECTION",c))(Eo||{}),Wc=(c=>(c.NO_CAM="devices.no-cam",c.NO_DEVICES="devices.no-devices",c.DEVICES_BLOCKED="devices.blocked",c.DEVICES_CAM_BLOCKED="devices.cam-blocked",c.DEVICES_INITIALIZATION_ERROR="devices.inititalization-error",c.DEVICES_UNKNOWN_ERROR="devices.unknown-error",c.DEVICES_ALLOWED="devices.allowed",c))(Wc||{}),ga=(t=>(t.PIN_ACTIVE="pin-mode.active",t.PIN_INACTIVE="pin-mode.inactive",t))(ga||{}),va=(t=>(t.MOUNT="mount",t.UNMOUNT="unmount",t))(va||{}),ya=(u=>(u.START_FOLLOWING_PARTICIPANT="who-is-online.start-following-participant",u.STOP_FOLLOWING_PARTICIPANT="who-is-online.stop-following-participant",u.ENTER_PRIVATE_MODE="who-is-online.enter-private-mode",u.LEAVE_PRIVATE_MODE="who-is-online.leave-private-mode",u.GATHER_ALL="who-is-online.gather-all",u.GO_TO_PARTICIPANT="who-is-online.go-to-participant",u.START_FOLLOW_ME="who-is-online.start-follow-me",u.STOP_FOLLOW_ME="who-is-online.stop-follow-me",u))(ya||{});L();var Cr=(n=>(n.HOST="host",n.GUEST="guest",n.AUDIENCE="audience",n))(Cr||{});L();L();L();L();var Te=(r,a,l,...c)=>Lt(void 0,[r,a,l,...c],function*(s,e,t,n={}){let u=yield fetch(s,{method:e,headers:lt({"Content-Type":"application/json"},n),body:t?JSON.stringify(t):null});if(!u.ok)throw u;try{return yield u.json()}catch(m){return u.ok}});L();var bp=an(zc()),Kt=class{constructor(e){this.debug=(0,bp.default)(e)}log(e,...t){this.debug(e,...t)}};L();L();var Xp=an(Kc());var At=class{constructor(e={}){this.subscribe=e=>{this.callbacks.push(e)};this.unsubscribe=e=>{this.callbacks=this.callbacks.filter(t=>t!==e)};this.publish=(...e)=>{!this.callbacks||this.callbacks.forEach(t=>{this.callListener(t,e).catch(n=>{var r;(r=this.logger)==null||r.log("superviz-sdk:observer-helper:publish:error",`
            Failed to execute callback on publish value.
            Callback: ${t}
            Event: ${JSON.stringify(e)}
            Error: ${n}
          `)})})};this.reset=()=>{this.callbacks=[]};this.destroy=()=>{delete this.logger,delete this.callbacks};this.callListener=(e,t)=>new Promise((n,r)=>{try{let a=e(...t);n(a)}catch(a){r(a)}});let{logger:t,throttleTime:n}=e;this.logger=t||new Kt("@superviz/sdk/observer-helper"),this.throttle=n,this.callbacks=[],this.throttle&&(this.publish=(0,Xp.default)(this.publish,this.throttle))}};var Si=class{constructor(){this.observers={};this.subscribe=(e,t)=>{this.logger.log(`subscribed to ${e} event`),this.observers[e]||(this.observers[e]=new At({logger:this.logger})),this.observers[e].subscribe(t)};this.unsubscribe=(e,t)=>{if(this.logger.log(`unsubscribed from ${e} event`),!!this.observers[e]){if(!t){this.observers[e].destroy(),delete this.observers[e];return}this.observers[e].unsubscribe(t)}};this.publish=(e,t)=>{e in this.observers&&this.observers[e].publish(t)}}};L();L();L();var tm=an(Oi()),qc=class{setConfig(e){this.configuration=e}get(e,t){return this.configuration?tm.default.get(this.configuration,e,t):t}},wt=new qc;var ce=class{static createUrl(e,t,n={}){let r=new URL(t,e);return Object.keys(n).forEach(a=>r.searchParams.append(a,n[a])),r.toString()}static validateApiKey(e,t){let n="/user/checkapikey",r=this.createUrl(e,n);return Te(r,"POST",{apiKey:t})}static fetchConfig(e,t){let n="/immersive-config",r=this.createUrl(e,n);return Te(r,"POST",{apiKey:t})}static fetchLimits(e,t){return Lt(this,null,function*(){let n="/user/check_limits",r=this.createUrl(e,n);return(yield Te(r,"GET","",{apikey:t})).usage})}static fetchWaterMark(e,t){return Lt(this,null,function*(){let n="/user/watermark",r=this.createUrl(e,n),{message:a}=yield Te(r,"POST",{apiKey:t});return a})}static createAnnotations(e,t,n){return Lt(this,null,function*(){let r="/annotations",a=this.createUrl(e,r);return Te(a,"POST",lt({},n),{apikey:t})})}static updateComment(e,t,n,r){return Lt(this,null,function*(){let a=`/comments/${n}`,l=this.createUrl(e,a);return Te(l,"PUT",{text:r},{apikey:t})})}static createComment(e,t,n){return Lt(this,null,function*(){let r="/comments",a=this.createUrl(e,r);return Te(a,"POST",lt({},n),{apikey:t})})}static fetchAnnotation(e,t,n){return Lt(this,null,function*(){let r="/annotations",a=this.createUrl(e,r,{roomId:n.roomId,url:n.url});return Te(a,"GET",void 0,{apikey:t})})}static resolveAnnotation(e,t,n){return Lt(this,null,function*(){let r=`/annotations/resolve/${n}`,a=this.createUrl(e,r);return Te(a,"POST",{},{apikey:t})})}static deleteComment(e,t,n){return Lt(this,null,function*(){let r=`/comments/${n}`,a=this.createUrl(e,r);return Te(a,"DELETE",{},{apikey:t})})}static deleteAnnotation(e,t,n){return Lt(this,null,function*(){let r=`/annotations/${n}`,a=this.createUrl(e,r);return Te(a,"DELETE",{},{apikey:t})})}static createOrUpdateParticipant(e){return Lt(this,null,function*(){let t=wt.get("apiUrl"),n="/participants",r=this.createUrl(t,n);return Te(r,"POST",lt({},e),{apikey:wt.get("apiKey")})})}static sendActivity(e,t,n,r){return Lt(this,null,function*(){let a="/activity",l=wt.get("apiUrl"),c=wt.get("roomId"),u=wt.get("apiKey"),m=this.createUrl(l,a);return Te(m,"POST",{groupId:t,groupName:n,meetingId:c,product:r,userId:e},{apikey:u})})}static fetchParticipantsByGroup(e){return Lt(this,null,function*(){let t=`/groups/participants/${e}`,n=wt.get("apiUrl"),r=this.createUrl(n,t,{take:1e4});return Te(r,"GET",void 0,{apikey:wt.get("apiKey")})})}static createMentions(e){return Lt(this,null,function*(){let t="/mentions",n=wt.get("apiUrl"),r=this.createUrl(n,t);return Te(r,"POST",e,{apikey:wt.get("apiKey")})})}};L();var Ge=class extends Si{constructor(){super(...arguments);this.isAttached=!1;this.attach=t=>{if(Object.values(t).includes(null)||Object.values(t).includes(void 0)){let u=`${this.name} @ attach - params are required`;throw this.logger.log(u),new Error(u)}let{realtime:n,localParticipant:r,group:a,config:l,eventBus:c}=t;if(!n.isDomainWhitelisted){let u=`Component ${this.name} can't be used because this website's domain is not whitelisted. Please add your domain in https://dashboard.superviz.com/developer`;this.logger.log(u);return}if(wt.setConfig(l),this.realtime=n,this.localParticipant=r,this.group=a,this.eventBus=c,this.isAttached=!0,!this.realtime.isJoinedRoom){this.logger.log(`${this.name} @ attach - not joined yet`),setTimeout(()=>{this.logger.log(`${this.name} @ attach - retrying`),this.attach(t)},1e3);return}this.logger.log(`${this.name} @ attached`),this.start(),this.publish("mount")};this.detach=()=>{if(!this.isAttached){this.logger.log(`${this.name} @ detach - component is not attached`);return}this.logger.log("detached"),this.publish("unmount"),this.destroy(),Object.values(this.observers).forEach(t=>{t.reset(),t.destroy()}),this.observers=void 0,this.realtime=void 0,this.localParticipant=void 0,this.isAttached=!1}}};L();var Zc=(a=>(a.presence3dMatterport="presence",a.presence3dAutodesk="presence",a.presence3dThreejs="presence",a.realtime="presence",a.whoIsOnline="presence",a))(Zc||{});L();var To=(t=>(t.LEFT="left",t.RIGHT="right",t))(To||{}),Yc=(r=>(r.TOP_LEFT="top-left",r.TOP_RIGHT="top-right",r.BOTTOM_LEFT="bottom-left",r.BOTTOM_RIGHT="bottom-right",r))(Yc||{});var Co=class extends Ge{constructor(t,n){var r,a,l;super();this.sidebarOpen=!1;this.layoutOptions={};this.openThreads=()=>{var t;this.sidebarOpen||((t=this.element)==null||t.setAttribute("open",""),this.sidebarOpen=!0,document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0})))};this.closeThreads=()=>{var t;!this.sidebarOpen||((t=this.element)==null||t.removeAttribute("open"),this.sidebarOpen=!1,document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0})))};this.togglePinActive=()=>{if(this.pinActive){this.disable();return}this.enable()};this.onPinFixed=t=>{this.coordinates=t};this.toggleAnnotationSidebar=()=>{this.element.toggleAttribute("open"),this.sidebarOpen=this.element.hasAttribute("open"),document.body.dispatchEvent(new CustomEvent("prepare-to-create-annotation",{detail:void 0,composed:!0,bubbles:!0})),document.body.dispatchEvent(new CustomEvent("toggle-annotation-sidebar",{detail:{open:this.sidebarOpen},composed:!0,bubbles:!0}))};this.onSelectAnnotation=t=>{this.sidebarOpen||this.toggleAnnotationSidebar()};this.positionFloatingButton=()=>{var u,m;this.button=document.createElement("superviz-comments-button");let t=(u=this.layoutOptions)==null?void 0:u.buttonLocation,n=(m=this.layoutOptions)==null?void 0:m.position;if(!t){document.body.appendChild(this.button),this.button.commentsPosition=n;return}let r="",a=Object.values(Yc),l=!1,c=!a.includes(t.toLocaleLowerCase());if(c){let g=window.document.body.querySelector(`#${t}`);g?(g.appendChild(this.button),r="position: relative"):(l=!0,t="top-left")}if(!c||l){document.body.appendChild(this.button);let[g,E]=t.split("-");r=`${g}: 20px; ${E}: 20px;`}this.button.positionStyles=r,this.button.commentsPosition=n};this.positionComments=()=>{var r;this.element=document.createElement("superviz-comments"),this.element.setAttribute("comments",JSON.stringify([])),this.element.side="left",this.element.offset=this.offset,document.body.appendChild(this.element);let t=(r=this.layoutOptions)==null?void 0:r.position;if(!t)return;let n=t.toUpperCase();!To[n]||(this.element.side=To[n])};this.createAnnotation=n=>Lt(this,[n],function*({detail:t}){try{let{text:r,mentions:a}=t,{url:l}=this,c=lt({},this.coordinates),u=yield ce.createAnnotations(wt.get("apiUrl"),wt.get("apiKey"),{roomId:wt.get("roomId"),position:JSON.stringify(c),url:l,userId:this.localParticipant.id}),m=yield this.createComment(u.uuid,r,a);this.addAnnotation(Mt(lt({},u),{comments:[m]})),this.pinAdapter.removeAnnotationPin("temporary-pin"),document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:u.uuid,haltGoToPin:!0,newPin:!0},composed:!0,bubbles:!0}))}catch(r){this.logger.log("error when creating annotation",r)}});this.deleteAnnotation=n=>Lt(this,[n],function*({detail:t}){try{let{uuid:r}=t;yield ce.deleteAnnotation(wt.get("apiUrl"),wt.get("apiKey"),r);let a=this.annotations.filter(l=>l.uuid!==r);this.updateAnnotationList(a),this.pinAdapter.removeAnnotationPin(r),this.element.updateAnnotations(this.annotations)}catch(r){this.logger.log("error when deleting annotation",r)}});this.updateComment=n=>Lt(this,[n],function*({detail:t}){try{let{uuid:r,text:a,mentions:l}=t,c=yield ce.updateComment(wt.get("apiUrl"),wt.get("apiKey"),r,a);yield ce.createMentions({commentsId:c.uuid,participants:l.map(m=>({id:m.userId}))});let u=this.annotations.map(m=>Object.assign({},m,{comments:m.comments.map(g=>g.uuid===r?Object.assign({},g,{text:a,mentions:l}):g)}));this.updateAnnotationList(u)}catch(r){this.logger.log("error when updating comment",r)}});this.resolveAnnotation=n=>Lt(this,[n],function*({detail:t}){try{let{uuid:r}=t,{resolved:a}=yield ce.resolveAnnotation(wt.get("apiUrl"),wt.get("apiKey"),r),l=this.annotations.map(c=>c.uuid===r?Object.assign({},c,{resolved:a}):c);if(this.updateAnnotationList(l),a){this.pinAdapter.removeAnnotationPin(r);return}this.pinAdapter.updateAnnotations(this.annotations)}catch(r){this.logger.log("error when resolve annotation",r)}});this.deleteComment=n=>Lt(this,[n],function*({detail:t}){try{let{uuid:r,annotationId:a}=t;if(!r||!a)return;yield ce.deleteComment(wt.get("apiUrl"),wt.get("apiKey"),r);let l=this.annotations.find(u=>u.uuid===a);l.comments=l.comments.filter(u=>u.uuid!==r);let c=this.annotations.map(u=>u.uuid===a?l:u);this.element.updateAnnotations(c),this.updateAnnotationList(c)}catch(r){this.logger.log("error when deleting comment",r)}});this.onAnnotationListUpdate=t=>{let{data:n,clientId:r}=t;this.localParticipant.id!==r&&(this.annotations=n,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations))};this.name="comments",this.logger=new Kt("@superviz/sdk/comments-component"),this.annotations=[],this.layoutOptions={buttonLocation:(r=n==null?void 0:n.buttonLocation)!=null?r:"top-left",position:(a=n==null?void 0:n.position)!=null?a:"left"},this.hideDefaultButton=(l=n==null?void 0:n.hideDefaultButton)!=null?l:!1,this.setStyles(n==null?void 0:n.styles),this.offset=n==null?void 0:n.offset,setTimeout(()=>{var c,u,m,g,E;t.setCommentsMetadata((u=(c=this.layoutOptions)==null?void 0:c.position)!=null?u:"left",(g=(m=this.localParticipant)==null?void 0:m.avatar)==null?void 0:g.imageUrl,(E=this.localParticipant)==null?void 0:E.name)}),this.pinAdapter=t}enable(){this.pinAdapter.setActive(!0),this.pinActive=!0,this.publish("pin-mode.active"),document.body.dispatchEvent(new CustomEvent("toggle-pin-active",{detail:{isActive:!0}}))}disable(){this.pinAdapter.setActive(!1),this.pinActive=!1,this.publish("pin-mode.inactive"),document.body.dispatchEvent(new CustomEvent("toggle-pin-active",{detail:{isActive:!1}}))}get url(){let t=new URL(this.clientUrl);return t.search="",t.toString()}start(){this.clientUrl=window.location.href,this.positionComments(),this.hideDefaultButton||this.positionFloatingButton(),this.fetchAnnotations(),this.waterMarkState(),this.participantsList(),this.addListeners(),this.pinAdapter.setPinsVisibility(!0)}destroy(){var t;this.logger.log("comments component @ destroy"),this.destroyListeners(),(t=this.button)==null||t.remove(),this.element.remove(),this.element=void 0,this.pinAdapter.destroy()}addListeners(){var t;(t=this.button)==null||t.addEventListener("toggle",this.togglePinActive),this.element.addEventListener("close-threads",this.closeThreads),document.body.addEventListener("create-annotation",this.createAnnotation),this.element.addEventListener("resolve-annotation",this.resolveAnnotation),this.element.addEventListener("delete-annotation",this.deleteAnnotation),this.element.addEventListener("create-comment",({detail:n})=>{this.createComment(n.uuid,n.text,n.mentions,!0)}),this.element.addEventListener("update-comment",this.updateComment),this.element.addEventListener("delete-comment",this.deleteComment),document.body.addEventListener("select-annotation",this.onSelectAnnotation),this.realtime.commentsObserver.subscribe(this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.subscribe(this.onPinFixed)}destroyListeners(){var t;(t=this.button)==null||t.removeEventListener("toggle",this.togglePinActive),this.element.removeEventListener("close-threads",this.closeThreads),this.element.removeEventListener("resolve-annotation",this.resolveAnnotation),this.element.removeEventListener("create-comment",({detail:n})=>{this.createComment(n.uuid,n.text,n.mentions,!0)}),this.element.removeEventListener("update-comment",this.updateComment),this.element.removeEventListener("delete-comment",this.deleteComment),document.body.removeEventListener("select-annotation",this.onSelectAnnotation),document.body.removeEventListener("create-annotation",this.createAnnotation),this.realtime.commentsObserver.unsubscribe(this.onAnnotationListUpdate),this.pinAdapter.onPinFixedObserver.unsubscribe(this.onPinFixed)}setStyles(t=""){if(!t)return;let n=document.createElement("style");n.textContent=t,n.id="superviz-comments-styles",document.head.appendChild(n)}createComment(l,c){return Lt(this,arguments,function*(t,n,r=[],a=!1){try{let u=yield ce.createComment(wt.get("apiUrl"),wt.get("apiKey"),{annotationId:t,userId:this.localParticipant.id,text:n});return yield ce.createMentions({commentsId:u.uuid,participants:r.map(m=>({id:m.userId,readed:0}))}),u.mentions=r,a&&this.addComment(t,u),u}catch(u){this.logger.log("error when creating comment",u)}})}addAnnotation(t){let n=[t,...this.annotations];this.element.updateAnnotations(n),this.pinAdapter.updateAnnotations(n),this.updateAnnotationList(n)}updateAnnotationList(t){this.annotations=t,this.realtime.updateComments(t)}addComment(t,n){let r=this.annotations.find(l=>l.uuid===t);r.comments.push(n);let a=this.annotations.map(l=>l.uuid===t?r:l);this.updateAnnotationList(a),this.element.updateAnnotations(a)}fetchAnnotations(){return Lt(this,null,function*(){try{let t=yield ce.fetchAnnotation(wt.get("apiUrl"),wt.get("apiKey"),{roomId:wt.get("roomId"),url:this.url});this.annotations=t,this.element.updateAnnotations(this.annotations),this.pinAdapter.updateAnnotations(this.annotations)}catch(t){this.logger.log("error when fetching annotations",t)}})}waterMarkState(){return Lt(this,null,function*(){try{let t=yield ce.fetchWaterMark(wt.get("apiUrl"),wt.get("apiKey"));this.element.waterMarkStatus(t)}catch(t){this.logger.log("error when fetching waterMark",t)}})}participantsList(){return Lt(this,null,function*(){try{let n=(yield ce.fetchParticipantsByGroup(this.group.id)).data;this.pinAdapter.participantsList=n,this.element.participantsList=n}catch(t){this.logger.log("error when fetching participantsList",t)}})}};L();L();var Oo=(t=>(t.ADD="add",t.SHOW="show",t))(Oo||{});var _o=class{constructor(e,t){this.isPinsVisible=!0;this.selectedPin=null;this.temporaryPinCoordinates=null;this.commentsSide="left";this.localParticipant={};this.setCommentsMetadata=(e,t,n)=>{this.commentsSide=e,this.localParticipant.avatar=t,this.localParticipant.name=n};this.resetPins=e=>{e&&(e==null?void 0:e.key)!=="Escape"||(this.resetSelectedPin(),this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates=null)};this.animate=()=>{(this.isActive||this.isPinsVisible)&&(this.renderAnnotationsPins(),this.divWrapper=this.renderDivWrapper()),this.temporaryPinCoordinates&&this.renderTemporaryPin(),requestAnimationFrame(this.animate)};this.setMouseDownCoordinates=({x:e,y:t})=>{this.mouseDownCoordinates={x:e,y:t}};this.annotationSelected=({detail:{uuid:e,haltGoToPin:t,newPin:n}})=>{var l,c;if(!e)return;n&&this.pins.get(e).setAttribute("newPin","");let r=JSON.parse((c=(l=this.selectedPin)==null?void 0:l.getAttribute("annotation"))!=null?c:"{}");if(this.resetPins(),(r==null?void 0:r.uuid)===e)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let a=this.pins.get(e);!a||(a.setAttribute("active",""),this.selectedPin=a,!t&&this.goToPin(e))};this.onClick=e=>{if(!this.isActive)return;let t=this.canvas.getBoundingClientRect(),{x:n,y:r}=this.mouseDownCoordinates,a=n-t.x,l=r-t.y,c=e.clientX-t.left,u=e.clientY-t.top;if(Math.hypot(c-a,u-l)>10)return;let h=this.canvas.getContext("2d").getTransform().inverse(),y=new DOMPoint(c,u-31).matrixTransform(h);this.onPinFixedObserver.publish({x:y.x,y:y.y,type:"canvas"}),this.resetSelectedPin(),this.temporaryPinCoordinates={x:y.x,y:y.y},this.renderTemporaryPin();let O=document.getElementById("superviz-temporary-pin");this.movedTemporaryPin=!this.movedTemporaryPin,O.setAttribute("movedPosition",String(this.movedTemporaryPin)),!this.selectedPin&&document.body.dispatchEvent(new CustomEvent("unselect-annotation"))};this.onToggleAnnotationSidebar=({detail:e})=>{let{open:t}=e;t||(this.pins.forEach(n=>{n.removeAttribute("active")}),this.pins.has("temporary-pin")&&this.removeAnnotationPin("temporary-pin"))};this.hideTemporaryPin=e=>{var E;let t=e.target,n=t.contains(this.canvas),{x:r,y:a}=e,{left:l,top:c,right:u,bottom:m}=this.canvas.getBoundingClientRect(),g=r>l&&r<u&&a>c&&a<m;this.canvas.contains(t)||((E=this.pins.get("temporary-pin"))==null?void 0:E.contains(t))||n&&g||(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates=null)};if(this.logger=new Kt("@superviz/sdk/comments-component/canvas-pin-adapter"),this.canvas=document.getElementById(e),this.isActive=!1,this.pins=new Map,this.goToPinCallback=t==null?void 0:t.onGoToPin,!this.canvas){let n=`Canvas with id ${e} not found`;throw this.logger.log(n),new Error(n)}this.canvasSides=this.canvas.getBoundingClientRect(),document.body.style.position="relative",this.onPinFixedObserver=new At({logger:this.logger}),this.divWrapper=this.renderDivWrapper(),this.annotations=[],this.renderAnnotationsPins(),this.animateFrame=requestAnimationFrame(this.animate),document.body.addEventListener("select-annotation",this.annotationSelected),document.body.addEventListener("keyup",this.resetPins)}destroy(){this.removeListeners(),this.removeAnnotationsPins(),this.pins=new Map,this.divWrapper.remove(),this.onPinFixedObserver.destroy(),this.onPinFixedObserver=null,this.canvas.style.cursor="default",this.annotations=[],cancelAnimationFrame(this.animateFrame),document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("keyup",this.resetPins)}setPinsVisibility(e){if(this.isPinsVisible=e,this.isPinsVisible){this.renderAnnotationsPins();return}this.removeAnnotationsPins()}setActive(e){if(this.isActive!==e){if(this.isActive=e,this.isActive){this.originalCanvasCursor=this.canvas.style.cursor,this.canvas.style.cursor='url("https://production.cdn.superviz.com/static/pin-html.png") 0 100, pointer',this.addListeners();return}this.resetPins(),this.removeListeners(),this.canvas.style.cursor=this.originalCanvasCursor}}updateAnnotations(e){this.logger.log("updateAnnotations",e),this.annotations=e,!(!this.isActive&&!this.isPinsVisible)&&(this.removeAnnotationsPins(),this.renderAnnotationsPins())}removeAnnotationPin(e){let t=this.pins.get(e);!t||(t.remove(),this.pins.delete(e),e!=="temporary-pin"&&(this.annotations=this.annotations.filter(n=>n.uuid!==e)))}renderTemporaryPin(){var h,y;let e=document.getElementById("superviz-temporary-pin");e||(e=document.createElement("superviz-comments-annotation-pin"),e.id="superviz-temporary-pin",e.setAttribute("type","add"),e.setAttribute("showInput",""),e.setAttribute("containerSides",JSON.stringify(this.canvasSides)),e.setAttribute("commentsSide",this.commentsSide),e.setAttribute("position",JSON.stringify(this.temporaryPinCoordinates)),e.setAttribute("annotation",JSON.stringify({})),e.setAttribute("localAvatar",(h=this.localParticipant.avatar)!=null?h:""),e.setAttribute("participantsList",JSON.stringify(this.participants)),e.setAttribute("localName",(y=this.localParticipant.name)!=null?y:""),e.setAttributeNode(document.createAttribute("active")),this.divWrapper.appendChild(e));let{x:t,y:n}=this.temporaryPinCoordinates,a=this.canvas.getContext("2d").getTransform(),l=a.e,c=a.f,u=a.a,m=a.d,g=t*u+l,E=n*m+c;e.setAttribute("position",JSON.stringify({x:g,y:E})),this.pins.set("temporary-pin",e)}addListeners(){this.canvas.addEventListener("click",this.onClick),this.canvas.addEventListener("mousedown",this.setMouseDownCoordinates),document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}removeListeners(){this.canvas.removeEventListener("click",this.onClick),this.canvas.removeEventListener("mousedown",this.setMouseDownCoordinates),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}resetSelectedPin(){!this.selectedPin||(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}renderDivWrapper(){let e=this.canvas.getBoundingClientRect(),t=this.divWrapper;return t||(t=document.createElement("div"),t.id="superviz-canvas-wrapper",["","static"].includes(this.canvas.parentElement.style.position)&&(this.canvas.parentElement.style.position="relative")),t.style.position="absolute",t.style.top=`${this.canvas.offsetTop}px`,t.style.left=`${this.canvas.offsetLeft}px`,t.style.width=`${e.width}px`,t.style.height=`${e.height}px`,t.style.pointerEvents="none",t.style.overflow="hidden",document.getElementById("superviz-canvas-wrapper")||this.canvas.parentElement.appendChild(t),t}renderAnnotationsPins(){if((!this.annotations.length||this.canvas.style.display==="none")&&!this.pins.get("temporary-pin")){this.removeAnnotationsPins();return}this.annotations.forEach(e=>{if(e.resolved)return;let t=JSON.parse(e.position);if((t==null?void 0:t.type)!=="canvas")return;let{x:n,y:r}=t,l=this.canvas.getContext("2d").getTransform(),c=l.e,u=l.f,m=l.a,g=l.d,E=n*m+c,h=r*g+u;if(this.pins.has(e.uuid)){let O=this.pins.get(e.uuid);if(this.divWrapper.clientWidth>E&&this.divWrapper.clientHeight>h){O.setAttribute("style","opacity: 1"),this.pins.get(e.uuid).setAttribute("position",JSON.stringify({x:E,y:h}));return}O.setAttribute("style","opacity: 0");return}let y=document.createElement("superviz-comments-annotation-pin");y.setAttribute("type","show"),y.setAttribute("participantsList",JSON.stringify(this.participants)),y.setAttribute("annotation",JSON.stringify(e)),y.setAttribute("position",JSON.stringify({x:E,y:h})),y.id=e.uuid,this.divWrapper.appendChild(y),this.pins.set(e.uuid,y)})}removeAnnotationsPins(){this.pins.forEach(e=>{e.remove()}),this.pins.clear()}set participantsList(e){this.participants=e}goToPin(e){let t=this.annotations.find(y=>y.uuid===e);if(!t)return;let n=JSON.parse(t.position);if((n==null?void 0:n.type)!=="canvas")return;let r=this.canvas.getBoundingClientRect(),{width:a,height:l}=r,{x:c,y:u}=n,m=a/2,g=l/2,E=m-c,h=g-u;this.goToPinCallback&&this.goToPinCallback({x:E,y:h})}};L();var em=an(Oi());var xo=class{constructor(e,t={}){this.localParticipant={};this.isPinsVisible=!0;this.selectedPin=null;this.dataAttribute="data-superviz-id";this.commentsSide="left";this.temporaryPinCoordinates={};this.elementsWithDataId={};this.divWrappers=new Map;this.voidElementsWrappers=new Map;this.VOID_ELEMENTS=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr","svg","rect","ellipse"];this.animate=()=>{this.voidElementsWrappers&&(this.updatePinsPositions(),this.animateFrame=requestAnimationFrame(this.animate))};this.setCommentsMetadata=(e,t,n)=>{this.commentsSide=e,this.localParticipant.avatar=t,this.localParticipant.name=n};this.hideTemporaryPin=e=>{var l;let t=e.target,n=this.divWrappers.get(this.temporaryPinCoordinates.elementId);if(!n)return;let r=n.contains(t),a=(l=this.pins.get("temporary-pin"))==null?void 0:l.contains(t);r||a||(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates={})};this.resetPins=e=>{e&&(e==null?void 0:e.key)!=="Escape"||(this.resetSelectedPin(),this.resetHoveredWrapper(),this.temporaryPinCoordinates.elementId&&(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates={}))};this.annotationSelected=({detail:{uuid:e,newPin:t}})=>{if(!e)return;t&&this.pins.get(e).setAttribute("newPin","");let n=this.annotations.find(l=>{var c;return l.uuid===((c=this.selectedPin)==null?void 0:c.id)});if(this.resetPins(),(n==null?void 0:n.uuid)===e)return;document.body.dispatchEvent(new CustomEvent("close-temporary-annotation"));let r=this.pins.get(e);if(!r)return;r.setAttribute("active",""),this.selectedPin=r;let a=this.annotations.find(l=>l.uuid===e);this.selectedPin.setAttribute("elementId",JSON.parse(a.position).elementId)};this.onClick=e=>{if(!this.isActive||e.target===this.pins.get("temporary-pin"))return;let t=e.target,n=e.currentTarget;if(t!==n&&this.pins.has(t.id))return;let r=n.getAttribute("data-wrapper-id"),a=n.getBoundingClientRect(),{x:l,y:c}=this.mouseDownCoordinates,u=e.clientX-a.left,m=e.clientY-a.top,g=l-a.x,E=c-a.y;if(Math.hypot(u-g,m-E)>10)return;let{width:y,height:O}=n.getBoundingClientRect(),_=32,C=n.getBoundingClientRect().width/n.offsetWidth||1;u=u*100/y,m=(m-_*C)*100/O,this.onPinFixedObserver.publish({x:u,y:m,type:"html",elementId:r}),this.resetSelectedPin(),this.temporaryPinCoordinates=Mt(lt({},this.temporaryPinCoordinates),{x:u,y:m}),this.renderTemporaryPin(r);let T=this.pins.get("temporary-pin");this.movedTemporaryPin=!this.movedTemporaryPin,T.setAttribute("movedPosition",String(this.movedTemporaryPin)),document.body.dispatchEvent(new CustomEvent("unselect-annotation"))};this.onMouseDown=({x:e,y:t})=>{this.mouseDownCoordinates={x:e,y:t}};this.handleMutationObserverChanges=e=>{e.forEach(t=>{var m;let{target:n,oldValue:r}=t,a=n.getAttribute(this.dataAttribute);if(!a&&!r||a===r)return;let l=this.dataAttributeValueFilters.some(g=>r.match(g));if(!a&&r&&!l){this.removeAnnotationPin("temporary-pin"),this.clearElement(r),((m=this.selectedPin)==null?void 0:m.getAttribute("elementId"))===r&&(document.body.dispatchEvent(new CustomEvent("unselect-annotation")),this.selectedPin=null);return}let u=this.dataAttributeValueFilters.some(g=>a.match(g));(r&&this.elementsWithDataId[r]||u)&&this.clearElement(r),!u&&(this.setElementReadyToPin(n,a),this.renderAnnotationsPins())})};this.onToggleAnnotationSidebar=({detail:e})=>{let{open:t}=e;t||(this.resetSelectedPin(),this.pins.has("temporary-pin")&&(this.removeAnnotationPin("temporary-pin"),this.temporaryPinCoordinates.elementId=void 0))};this.onMouseEnter=e=>{var a;let t=e.target;if(this.hoveredWrapper=t,!((a=t.getAttribute("data-wrapper-type"))==null?void 0:a.includes("ellipse"))){this.hoveredWrapper.style.setProperty("outline","1px solid rgb(var(--sv-primary))");return}let r=t.querySelector("ellipse");r.setAttribute("stroke","rgb(var(--sv-primary))"),r.setAttribute("stroke-width","1")};this.onMouseLeave=e=>{var a;let t=e.target;if(this.hoveredWrapper=t,!((a=t.getAttribute("data-wrapper-type"))==null?void 0:a.includes("ellipse"))){this.hoveredWrapper.style.setProperty("outline","");return}let r=t.querySelector("ellipse");r.removeAttribute("stroke"),r.removeAttribute("stroke-width")};if(this.logger=new Kt("@superviz/sdk/comments-component/container-pin-adapter"),this.container=document.getElementById(e),!this.container){let a=`Element with id ${e} not found`;throw this.logger.log(a),new Error(a)}if(typeof t!="object")throw new Error("Second argument of the HTMLPin constructor must be an object");let{dataAttributeName:n,dataAttributeValueFilters:r}=t;if(n==="")throw new Error("dataAttributeName must be a non-empty string");if(n===null)throw new Error("dataAttributeName cannot be null");if(n!==void 0&&typeof n!="string")throw new Error("dataAttributeName must be a non-empty string");this.dataAttribute=n||this.dataAttribute,this.dataAttributeValueFilters=r||[],this.isActive=!1,this.prepareElements(),this.mutationObserver=new MutationObserver(this.handleMutationObserverChanges),this.observeContainer(),this.pins=new Map,this.onPinFixedObserver=new At({logger:this.logger}),this.annotations=[],document.body.addEventListener("select-annotation",this.annotationSelected),document.body.addEventListener("keyup",this.resetPins),this.voidElementsWrappers.size&&(this.animateFrame=requestAnimationFrame(this.animate))}destroy(){var e;this.logger.log("Destroying HTML Pin Adapter for Comments"),this.removeListeners(),this.removeObservers(),this.divWrappers.forEach(t=>t.remove()),this.divWrappers.clear(),this.pins.forEach(t=>t.remove()),this.pins.clear(),this.divWrappers=void 0,this.pins=void 0,this.elementsWithDataId=void 0,this.logger=void 0,this.onPinFixedObserver.destroy(),this.onPinFixedObserver=void 0,this.container=void 0,this.voidElementsWrappers.clear(),this.voidElementsWrappers=void 0,this.annotations=[],(e=this.svgWrappers)==null||e.remove(),this.svgWrappers=void 0,document.body.removeEventListener("select-annotation",this.annotationSelected),document.body.removeEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),cancelAnimationFrame(this.animateFrame)}addElementListeners(e){this.divWrappers.get(e).addEventListener("click",this.onClick,!0),this.divWrappers.get(e).addEventListener("mousedown",this.onMouseDown),this.divWrappers.get(e).addEventListener("mouseenter",this.onMouseEnter),this.divWrappers.get(e).addEventListener("mouseleave",this.onMouseLeave)}removeElementListeners(e){this.divWrappers.get(e).removeEventListener("click",this.onClick,!0),this.divWrappers.get(e).removeEventListener("mousedown",this.onMouseDown),this.divWrappers.get(e).removeEventListener("mouseenter",this.onMouseEnter),this.divWrappers.get(e).removeEventListener("mouseleave",this.onMouseLeave)}set participantsList(e){this.participants=e}removeObservers(){this.mutationObserver.disconnect(),this.mutationObserver=void 0}addListeners(){this.divWrappers.forEach((e,t)=>this.addElementListeners(t)),document.body.addEventListener("toggle-annotation-sidebar",this.onToggleAnnotationSidebar),document.body.addEventListener("click",this.hideTemporaryPin)}removeListeners(){this.divWrappers.forEach((e,t)=>this.removeElementListeners(t)),document.body.removeEventListener("keyup",this.resetPins),document.body.removeEventListener("click",this.hideTemporaryPin)}observeContainer(){this.mutationObserver.observe(this.container,{subtree:!0,attributes:!0,attributeFilter:[this.dataAttribute],attributeOldValue:!0})}prepareElements(){this.container.querySelectorAll(`[${this.dataAttribute}]`).forEach(t=>{let n=t.getAttribute(this.dataAttribute);this.dataAttributeValueFilters.some(a=>n.match(a))||this.setElementReadyToPin(t,n)})}addAllCursors(){this.divWrappers.forEach((e,t)=>{this.addCursor(e,t)})}removeAddCursor(){this.divWrappers.forEach((e,t)=>{let n=e,r=e.getAttribute("data-wrapper-type");if(r){let a=r.split("-")[1];n=this.divWrappers.get(t).querySelector(a)}n.style.setProperty("cursor","default"),n.style.setProperty("pointer-events","none")})}setPinsVisibility(e){this.isPinsVisible=e,this.isPinsVisible&&this.renderAnnotationsPins(),this.removeAnnotationsPins()}removeAnnotationPin(e){let t=this.pins.get(e);!t&&e==="temporary-pin"||(t&&(t.remove(),this.pins.delete(e)),e!=="temporary-pin"&&(this.annotations=this.annotations.filter(n=>n.uuid!==e)))}updateAnnotations(e){this.logger.log("updateAnnotations",e),this.annotations=e,this.isPinsVisible&&(this.removeAnnotationsPins(),this.renderAnnotationsPins())}setActive(e){if(this.isActive!==e){if(this.isActive=e,this.isActive){this.addListeners(),this.addAllCursors(),this.prepareElements();return}this.resetPins(),this.removeListeners(),this.removeAddCursor()}}renderTemporaryPin(e){var a,l,c,u;(a=this.temporaryPinCoordinates).elementId||(a.elementId=e);let t=this.pins.get("temporary-pin");if(e&&e!==this.temporaryPinCoordinates.elementId&&(this.pins.get("temporary-pin").remove(),this.pins.delete("temporary-pin"),this.temporaryPinCoordinates.elementId=e,t=null),!t){let m=(l=this.elementsWithDataId[e])==null?void 0:l.getBoundingClientRect();t=document.createElement("superviz-comments-annotation-pin"),t.id="superviz-temporary-pin",t.setAttribute("type","add"),t.setAttribute("showInput",""),t.setAttribute("containerSides",JSON.stringify(m)),t.setAttribute("commentsSide",this.commentsSide),t.setAttribute("position",JSON.stringify(this.temporaryPinCoordinates)),t.setAttribute("annotation",JSON.stringify({})),t.setAttribute("localAvatar",(c=this.localParticipant.avatar)!=null?c:""),t.setAttribute("localName",(u=this.localParticipant.name)!=null?u:""),t.setAttribute("participantsList",JSON.stringify(this.participants)),t.setAttribute("keepPositionRatio",""),t.setAttributeNode(document.createAttribute("active")),this.addTemporaryPinToElement(e,t)}let{x:n,y:r}=this.temporaryPinCoordinates;t.setAttribute("position",JSON.stringify({x:n,y:r})),this.pins.set("temporary-pin",t)}renderAnnotationsPins(){if(!this.annotations.length){this.removeAnnotationsPins();return}this.annotations.forEach(e=>{if(e.resolved)return;let{x:t,y:n,elementId:r,type:a}=JSON.parse(e.position);if(a!=="html"||this.pins.has(e.uuid)||!this.elementsWithDataId[r])return;let c=this.divWrappers.get(r);if(!c)return;let u=this.createPin(e,t,n);c.appendChild(u),this.pins.set(e.uuid,u)})}updatePinsPositions(){this.voidElementsWrappers.forEach((e,t)=>{let n=JSON.stringify(e.getBoundingClientRect()),r=this.elementsWithDataId[t].getBoundingClientRect();this.elementsWithDataId[t].tagName.toLowerCase()==="ellipse"&&(r=this.elementsWithDataId[t].viewportElement.getBoundingClientRect()),!(0,em.isEqual)(JSON.stringify(r),n)&&(e.style.setProperty("top",`${r.top}px`),e.style.setProperty("left",`${r.left}px`),e.style.setProperty("width",`${r.width}px`),e.style.setProperty("height",`${r.height}px`))})}clearElement(e){if(!this.elementsWithDataId[e])return;let n=this.divWrappers.get(e);if(n){let r=n.children,{length:a}=r;for(let l=0;l<a;++l){let c=r.item(l);this.pins.delete(c.id)}n.remove()}this.voidElementsWrappers.delete(e),this.removeElementListeners(e),this.divWrappers.delete(e),this.elementsWithDataId[e]=void 0,this.voidElementsWrappers.size||(cancelAnimationFrame(this.animateFrame),this.animateFrame=void 0)}resetSelectedPin(){!this.selectedPin||(this.selectedPin.removeAttribute("active"),this.selectedPin=null)}resetHoveredWrapper(){!this.hoveredWrapper||this.onMouseLeave({target:this.hoveredWrapper})}removeAnnotationsPins(){this.pins.forEach(e=>{e.remove()}),this.pins.clear()}setElementReadyToPin(e,t){if(!this.elementsWithDataId[t]){if(this.elementsWithDataId[t]=e,!this.divWrappers.get(t)){let n=this.createWrapper(e,t);this.divWrappers.set(t,n)}!this.isActive||!this.isPinsVisible||(this.addCursor(this.divWrappers.get(t),t),this.addElementListeners(t))}}handleSvgElement(e,t){let n=e.viewportElement;if(n===void 0)return;if(e.tagName.toLowerCase()==="svg"){let T=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return T.setAttribute("height","100%"),T.setAttribute("width","100%"),T.style.setProperty("overflow","visible"),T.appendChild(t),e.appendChild(T),e.style.setProperty("overflow","visible"),t}let l=e.tagName.toLowerCase(),c=l==="ellipse",u=l==="rect";if(!c&&!u)return;let m=document.createElementNS("http://www.w3.org/2000/svg","svg"),g=document.createElementNS("http://www.w3.org/2000/svg",l),E,h,y,O,_,C;if(u){let T=e;E=T.getAttribute("x"),h=T.getAttribute("y"),y=T.getAttribute("width"),O=T.getAttribute("height"),_=T.getAttribute("rx"),C=T.getAttribute("ry"),g.setAttribute("fill","transparent"),g.setAttribute("stroke","transparent"),g.setAttribute("x","0"),g.setAttribute("y","0"),g.setAttribute("rx",_),g.setAttribute("ry",C)}if(c){let T=e.getAttribute("cx"),x=e.getAttribute("cy");_=e.getAttribute("rx"),C=e.getAttribute("ry"),E=Number(T)-Number(_),h=Number(x)-Number(C);let{width:v,height:A}=n.getBoundingClientRect();y=`${v}px`,O=`${A}px`,g.setAttribute("fill","transparent"),g.setAttribute("stroke","transparent"),g.setAttribute("cx",T),g.setAttribute("cy",x),g.setAttribute("rx",_),g.setAttribute("ry",C)}return g.setAttribute("height",O),g.setAttribute("width",y),m.setAttribute("height",O),m.setAttribute("width",y),m.appendChild(g),t.appendChild(m),e.style.setProperty("overflow","visible"),t.setAttribute("data-wrapper-type",`svg-${l}`),t}addTemporaryPinToElement(e,t){if(!this.elementsWithDataId[e])return;let r=this.divWrappers.get(e);!r||r.appendChild(t)}createPin(e,t,n){let r=document.createElement("superviz-comments-annotation-pin");return r.setAttribute("type","show"),r.setAttribute("annotation",JSON.stringify(e)),r.setAttribute("position",JSON.stringify({x:t,y:n})),r.setAttribute("keepPositionRatio",""),r.setAttribute("participantsList",JSON.stringify(this.participants)),r.id=e.uuid,r}addCursor(e,t){let n=e,r=e.getAttribute("data-wrapper-type");if(r){let a=r.split("-")[1];n=this.divWrappers.get(t).querySelector(a)}n.style.setProperty("cursor",'url("https://production.cdn.superviz.com/static/pin-html.png") 0 100, pointer'),n.style.setProperty("pointer-events","auto")}createWrapper(e,t){var u;let n=`superviz-id-${t}`;if(this.divWrappers.get(t))return;let r=e.getBoundingClientRect(),a=document.createElement("div");a.setAttribute("data-wrapper-id",t),a.id=n,a.style.position="absolute",a.style.pointerEvents="none",a.style.transform="translateX(0) translateY(0) scale(1)",a.style.cursor="default",a.style.top="0",a.style.left="0",a.style.width="100%",a.style.height="100%",a.style.pointerEvents="none";let l=window.getComputedStyle(e).getPropertyValue("border-radius");if(a.style.borderRadius=l,!this.VOID_ELEMENTS.includes(this.elementsWithDataId[t].tagName.toLowerCase()))return this.elementsWithDataId[t].appendChild(a),this.setPositionNotStatic(this.elementsWithDataId[t]),a;a=(u=this.handleSvgElement(e,a))!=null?u:a,a.style.position="fixed",a.style.top=`${r.top}px`,a.style.left=`${r.left}px`,a.style.width=`${r.width}px`,a.style.height=`${r.height}px`;let c=this.elementsWithDataId[t].parentElement;return(!c||e.viewportElement)&&(c=document.body),this.setPositionNotStatic(c),c.appendChild(a),this.voidElementsWrappers.set(t,a),this.animateFrame||(this.animateFrame=requestAnimationFrame(this.animate)),a}setPositionNotStatic(e){let{position:t}=window.getComputedStyle(e);t==="static"&&e.style.setProperty("position","relative")}};L();var Xc=an(Oi());L();var On=an(nm()),Io=class{constructor(){this.browser=On.default.getParser(navigator.userAgent)}get clientStats(){return this.browser.getResult()}get isFirefox(){return this.browser.isBrowser(On.default.BROWSER_MAP.firefox)}get isSafari(){return this.browser.isBrowser(On.default.BROWSER_MAP.safari)}get isChrome(){return this.browser.isBrowser(On.default.BROWSER_MAP.chrome)}get isIE(){return this.browser.isBrowser(On.default.BROWSER_MAP.ie)}get isEdge(){return this.browser.isBrowser(On.default.BROWSER_MAP.edge)}get isMobileDevice(){return(this.browser.is(On.default.PLATFORMS_MAP.mobile)||this.browser.is(On.default.PLATFORMS_MAP.tablet))&&!navigator.userAgent.match(/iPad/i)}get isTabletDevice(){return this.browser.is(On.default.PLATFORMS_MAP.tablet)}get isAndroid(){return this.isMobileDevice&&!!navigator.userAgent.match(/Android/i)}get isIpad(){return!!navigator.userAgent.match(/iPad/i)}get isIphone(){return this.isMobileDevice&&!!navigator.userAgent.match(/iPhone/i)}get isAppleMobileDevice(){return this.isIpad||this.isIphone}};L();var wa=class{constructor(){this.updateMeetingConnectionStatus=e=>{this.oldConnectionStatus=this.connectionStatus,this.connectionStatus=e,this.connectionStatusObserver.publish(e),this.logger.log("CONNECTION STATUS CHANGE",e)};this.onUpdateBrowserOnlineStatus=e=>{let{type:t}=e;if(t==="online"){this.updateMeetingConnectionStatus(1);return}this.updateMeetingConnectionStatus(4)};this.logger=new Kt("@superviz/sdk/connection-service"),this.connectionStatus=0,this.connectionStatusObserver=new At({logger:this.logger})}addListeners(){window.addEventListener("online",this.onUpdateBrowserOnlineStatus),window.addEventListener("offline",this.onUpdateBrowserOnlineStatus)}removeListeners(){window.removeEventListener("online",this.onUpdateBrowserOnlineStatus),window.removeEventListener("offline",this.onUpdateBrowserOnlineStatus)}};L();L();var Ta=class{build(e,t,n,r={},a={}){let l=document.querySelector(`#${e}`),c=new URL(t);if(this.wrapperId||this.element)throw new Error("Tried to initialize two frames with the same FrameBricklayer instance");this.element=document.createElement("iframe"),Object.entries(r).forEach(([u,m])=>{c.searchParams.set(u,m)}),Object.entries(a).forEach(([u,m])=>{this.element.setAttribute(u,m)}),this.element.src=c.toString(),this.element.id=n,l.appendChild(this.element),this.wrapperId=e}destroy(){if(!this.wrapperId)throw new Error("Tried to destroy a frame before it was initialized");let e=document.querySelector(`#${this.wrapperId}`);!!e&&!!e.querySelector(`#${this.element.id}`)&&e.removeChild(this.element),this.wrapperId=null,this.element=null}};L();var Ca=class{constructor(e){this.observers={};this.sourceBlockList=["vue-devtools-proxy","vue-devtools-backend"];this.originBlockList=["https://sketchfab.com"];this.publish=(e,t={})=>{this.logger.log("MessageBridge","Posting message to frame",e,t),this.contentWindow.postMessage({type:e,data:t},this.allowedOrigins)};this.listen=(e,t)=>{this.observers[e]||(this.observers[e]=new At({logger:this.logger})),this.observers[e].subscribe(t)};this.onReceiveMessage=e=>{let{type:t,data:n,source:r}=e.data;if(this.sourceBlockList.includes(r)||this.originBlockList.includes(e.origin))return;let a=!!t,l=!this.domains.length||this.domains.includes(e.origin),c=this.observers.hasOwnProperty(t);if(this.logger.log("MessageBridge",`Message received -
        TYPE: ${e.type}
        ORIGIN: ${e.origin}
        DATA: ${JSON.stringify(e.data)} `),!a||!l||!c){this.logger.log("MessageBridge","Message discarded");return}this.observers[t].publish(n)};let{contentWindow:t,domains:n=[],allowedOrigins:r="*",sourceBlockList:a=[],logger:l}=e;if(this.logger=l,this.domains=n,this.allowedOrigins=r,this.sourceBlockList.push(...a),typeof window=="undefined")throw new Error("MessageBridge: window is undefined");this.contentWindow=t,window.addEventListener("message",this.onReceiveMessage)}destroy(){Object.entries(this.observers).forEach(([e,t])=>{t.reset(),delete this.observers[e]}),window.removeEventListener("message",this.onReceiveMessage),delete this.logger,delete this.allowedOrigins,delete this.contentWindow,delete this.domains,delete this.observers,delete this.sourceBlockList}};L();var Mo=(n=>(n.RIGHT="right",n.CENTER="center",n.LEFT="left",n))(Mo||{}),Sa=(t=>(t.GRID="grid",t.LIST="list",t))(Sa||{}),Oa=(r=>(r.RIGHT="right",r.LEFT="left",r.TOP="top",r.BOTTOM="bottom",r))(Oa||{});var im="sv-video-frame",Ro=class{constructor(e){this.logger=new Kt("@superviz/sdk/video-conference-manager");this.frameStateObserver=new At({logger:this.logger});this.frameSizeObserver=new At({logger:this.logger});this.waitingForHostObserver=new At({logger:this.logger});this.realtimeEventsObserver=new At({logger:this.logger});this.sameAccountErrorObserver=new At({logger:this.logger});this.devicesObserver=new At({logger:this.logger});this.meetingStateObserver=new At({logger:this.logger});this.meetingConnectionObserver=new At({logger:this.logger});this.participantJoinedObserver=new At({logger:this.logger});this.participantLeftObserver=new At({logger:this.logger});this.participantListObserver=new At({logger:this.logger});this.frameState=0;this.layoutModalsAndCamerasConfig=(e,t)=>{let n=e,r=t,a=["left","right","bottom","top"].includes(r),l=["left","right","center"].includes(n);return a||(r="right"),l||(n="right"),this.browserService.isMobileDevice?(r="bottom",{layoutPosition:n,camerasPosition:r}):(n==="left"&&r==="right"&&(n="right"),n==="right"&&r==="left"&&(n="left"),{layoutPosition:n,camerasPosition:r})};this.onFrameLoad=()=>{this.messageBridge=new Ca({logger:this.logger,contentWindow:this.bricklayer.element.contentWindow}),this.addMessagesListeners(),this.updateFrameState(2),this.updateFrameLocale(),this.updateMeetingAvatars(),this.onWindowResize(),this.setCustomColors(),this.setCallbacks()};this.setFrameOffset=e=>{let t=e!=null?e:{};["top","bottom","left","right"].forEach(n=>{Object.keys(t).includes(n)||(t[n]=0)}),this.frameOffset=t};this.setCustomColors=()=>{this.customColors&&this.messageBridge.publish("frame.color-list-update",this.customColors),this.styles&&this.messageBridge.publish("frame.styles-update",this.styles)};this.setCallbacks=()=>{if(!this.callbacks)return;let e={onToggleMicrophone:!!this.callbacks.onToggleMicrophone,onToggleCam:!!this.callbacks.onToggleCam,onToggleTranscript:!!this.callbacks.onToggleTranscript,onToggleChat:!!this.callbacks.onToggleChat,onToggleScreenShare:!!this.callbacks.onToggleScreenShare,onClickHangup:!!this.callbacks.onClickHangup,onToggleMeetingSetup:!!this.callbacks.onToggleMeetingSetup};this.messageBridge.listen("callback-called",t=>{var n,r;(r=(n=this.callbacks)[t])==null||r.call(n)}),this.messageBridge.publish("frame.callbacks-update",JSON.stringify(e))};this.setFrameStyle=e=>{let t=document.createElement("style"),{bottom:n,left:r,right:a,top:l}=this.frameOffset;if(t.innerHTML=`
      :root {
        --superviz-offset-top: ${l}px;
        --superviz-offset-right: ${a}px;
        --superviz-offset-left: ${r}px;
        --superviz-offset-bottom: ${n}px;
      }     
    `,document.head.appendChild(t),this.browserService.isMobileDevice){this.bricklayer.element.classList.add("sv-video-frame--bottom");return}this.bricklayer.element.classList.add(`sv-video-frame--${e}`)};this.onFrameDimensionsUpdate=({width:e,height:t})=>{let n=document.getElementById(im),{bottom:r,right:a,left:l,top:c}=this.frameOffset,u=this.isWaterMarkEnabled?40:0,m=`${e}px`,g=`${t+u}px`;(e>=window.innerWidth||this.isHorizontalCameraEnabled)&&(m=`calc(100% - ${a}px - ${l}px)`),t>=window.innerHeight&&(g=`calc(100% - ${c}px - ${r}px)`),n.style.width=m,n.style.height=g,this.frameSizeObserver.publish({width:n.offsetWidth,height:n.offsetHeight})};this.onWindowResize=()=>{let{top:e,bottom:t,right:n,left:r}=this.frameOffset,{innerHeight:a,innerWidth:l}=window,c=a-e-t,u=l-n-r;!this.messageBridge||this.messageBridge.publish("frame.parent-window-size-update",{height:c,width:u})};this.updateFrameLocale=()=>{var a,l;if(!this.frameLocale||!((a=this.frameLocale)!=null&&a.language)&&((l=this.frameLocale)==null?void 0:l.locales))return;let{language:e,locales:t}=this.frameLocale,n=t.map(c=>c==null?void 0:c.language),r=["en",...n];if(e&&!r.includes(e))throw new Error("The default language is not available in the language listing.");this.messageBridge.publish("frame.locales-update",this.frameLocale)};this.updateMeetingAvatars=()=>{this.messageBridge.publish("frame.avatar-list-update",this.meetingAvatars)};this.onParticipantJoined=e=>{this.participantJoinedObserver.publish(e)};this.onParticipantLeft=e=>{this.participantLeftObserver.publish(e)};this.onMeetingHostChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.host-change",data:e})};this.onMeetingKickParticipant=e=>{this.realtimeEventsObserver.publish({event:"meeting.kick-participant",data:e})};this.onFollowParticipantDidChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.follow-participant",data:e})};this.onGoToDidChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.go-to-participant",data:e})};this.onGather=()=>{this.realtimeEventsObserver.publish({event:"realtime.gather",data:!0})};this.onGridModeChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.grid-mode-change",data:e})};this.onDrawingChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.drawing-change",data:e})};this.onTranscriptChange=e=>{this.realtimeEventsObserver.publish({event:"realtime.transcript-change",data:e})};this.onSameAccountError=e=>{this.sameAccountErrorObserver.publish(e)};this.onDevicesChange=e=>{this.devicesObserver.publish(e)};this.meetingStateUpdate=e=>{this.meetingStateObserver.publish(e)};this.onConnectionStatusChange=e=>{this.meetingConnectionObserver.publish(e)};this.onWaitingForHostDidChange=e=>{this.waitingForHostObserver.publish(e)};this.onParticipantListUpdate=e=>{this.participantListObserver.publish(e)};var N,M,D,U;let{language:t,canUseCams:n,canUseChat:r,canUseScreenshare:a,canUseDefaultAvatars:l,canUseFollow:c,canUseGoTo:u,canUseGather:m,canShowAudienceList:g,canUseDefaultToolbar:E,canUseTranscription:h,browserService:y,offset:O,locales:_,avatars:C,customColors:T,styles:x,waterMark:v,layoutPosition:A,camerasPosition:f,skipMeetingSettings:p,devices:S,layoutMode:b,collaborationMode:P,callbacks:B}=e;this.browserService=y;let z=this.layoutModalsAndCamerasConfig(A,f),W=document.createElement("div");this.frameConfig={apiKey:wt.get("apiKey"),apiUrl:wt.get("apiUrl"),ablyKey:wt.get("ablyKey"),debug:wt.get("debug"),roomId:wt.get("roomId"),limits:wt.get("limits"),collaborationMode:P,canUseFollow:c,canUseGoTo:u,canUseCams:n,canUseChat:r,canUseGather:m,canUseScreenshare:a,canUseDefaultAvatars:l,canUseTranscription:h,canShowAudienceList:g,camerasPosition:(N=z.camerasPosition)!=null?N:"right",canUseDefaultToolbar:E,devices:{audioInput:(M=S==null?void 0:S.audioInput)!=null?M:!0,audioOutput:(D=S==null?void 0:S.audioOutput)!=null?D:!0,videoInput:(U=S==null?void 0:S.videoInput)!=null?U:!0},waterMark:v,layoutMode:b,skipMeetingSettings:p,layoutPosition:z.layoutPosition},this.customColors=T,this.callbacks=B,this.styles=x,W.classList.add("sv_video_wrapper"),W.id="sv-video-wrapper",document.body.appendChild(W),this.updateFrameState(1),this.bricklayer=new Ta,this.bricklayer.build(W.id,wt.get("conferenceLayerUrl"),im,void 0,{allow:"camera *;microphone *; display-capture *;"}),this.setFrameOffset(O),this.setFrameStyle(z.camerasPosition),this.bricklayer.element.addEventListener("load",this.onFrameLoad),this.frameLocale={language:t,locales:_},this.meetingAvatars=C,window.addEventListener("resize",this.onWindowResize),window.addEventListener("orientationchange",this.onWindowResize)}get isWaterMarkEnabled(){return this.browserService.isMobileDevice?!1:this.frameConfig.waterMark}get isHorizontalCameraEnabled(){return this.browserService.isMobileDevice?!1:["top","bottom"].includes(this.frameConfig.camerasPosition)}addMessagesListeners(){this.messageBridge.listen("meeting.waiting-for-host",this.onWaitingForHostDidChange),this.messageBridge.listen("meeting.participant-joined",this.onParticipantJoined),this.messageBridge.listen("meeting.participant-list-update",this.onParticipantListUpdate),this.messageBridge.listen("meeting.participant-left",this.onParticipantLeft),this.messageBridge.listen("meeting.host-change",this.onMeetingHostChange),this.messageBridge.listen("meeting.kick-participant",this.onMeetingKickParticipant),this.messageBridge.listen("meeting.same-participant-error",this.onSameAccountError),this.messageBridge.listen("meeting.state-update",this.meetingStateUpdate),this.messageBridge.listen("meeting.connection-status-change",this.onConnectionStatusChange),this.messageBridge.listen("meeting.devices-change",this.onDevicesChange),this.messageBridge.listen("realtime.grid-mode-change",this.onGridModeChange),this.messageBridge.listen("realtime.drawing-change",this.onDrawingChange),this.messageBridge.listen("realtime.transcript-change",this.onTranscriptChange),this.messageBridge.listen("frame.dimensions-update",this.onFrameDimensionsUpdate),this.messageBridge.listen("realtime.follow-participant",this.onFollowParticipantDidChange),this.messageBridge.listen("realtime.go-to-participant",this.onGoToDidChange),this.messageBridge.listen("realtime.gather",this.onGather)}updateFrameState(e){e!==this.frameState&&(this.frameState=e,this.frameStateObserver.publish(this.frameState));let t={[1]:6,[2]:7,[0]:8};this.meetingStateUpdate(t[e])}start(e){this.messageBridge.publish("meeting.start",Mt(lt({},e),{config:this.frameConfig}))}leave(){this.messageBridge.publish("meeting.leave"),this.destroy()}destroy(){var e,t,n,r,a,l,c,u,m,g;(e=this.messageBridge)==null||e.destroy(),(t=this.bricklayer)==null||t.destroy(),(n=this.frameSizeObserver)==null||n.destroy(),(r=this.realtimeEventsObserver)==null||r.destroy(),(a=this.sameAccountErrorObserver)==null||a.destroy(),(l=this.devicesObserver)==null||l.destroy(),(c=this.meetingStateObserver)==null||c.destroy(),(u=this.meetingConnectionObserver)==null||u.destroy(),(m=this.participantJoinedObserver)==null||m.destroy(),(g=this.participantLeftObserver)==null||g.destroy(),this.bricklayer=null,this.frameState=null,window.removeEventListener("resize",this.onWindowResize),window.removeEventListener("orientationchange",this.onWindowResize)}publishMessageToFrame(e,t){!this.messageBridge||this.messageBridge.publish(e,t)}};var LS=1e3*60,Lo=null,Do=class extends Ge{constructor(t){var n,r;super();this.participantToFrameList=[];this.participantsOnMeeting=[];this.kickParticipantsOnHostLeave=!1;this.startVideo=()=>{var t,n,r,a,l,c,u,m,g,E,h,y,O,_,C,T,x,v,A,f,p,S,b,P,B,z,W,N,M,D,U,G,J,tt,it,X,R;this.videoConfig={language:(t=this.params)==null?void 0:t.language,canUseTranscription:((n=this.params)==null?void 0:n.transcriptOff)===!1,canShowAudienceList:(a=(r=this.params)==null?void 0:r.showAudienceList)!=null?a:!0,canUseChat:!((l=this.params)!=null&&l.chatOff),canUseCams:!((c=this.params)!=null&&c.camsOff),canUseScreenshare:!((u=this.params)!=null&&u.screenshareOff),canUseDefaultAvatars:!!((m=this.params)!=null&&m.defaultAvatars)&&!((E=(g=this.localParticipant)==null?void 0:g.avatar)!=null&&E.model3DUrl),canUseGather:!!((h=this.params)!=null&&h.enableGather),canUseFollow:!!((y=this.params)!=null&&y.enableFollow),canUseGoTo:!!((O=this.params)!=null&&O.enableGoTo),canUseDefaultToolbar:(C=(_=this.params)==null?void 0:_.defaultToolbar)!=null?C:!0,camerasPosition:(x=(T=this.params)==null?void 0:T.collaborationMode)==null?void 0:x.position,devices:(v=this.params)==null?void 0:v.devices,skipMeetingSettings:(A=this.params)==null?void 0:A.skipMeetingSettings,browserService:this.browserService,offset:(f=this.params)==null?void 0:f.offset,locales:(S=(p=this.params)==null?void 0:p.locales)!=null?S:[],avatars:(P=(b=this.params)==null?void 0:b.avatars)!=null?P:[],customColors:wt.get("colors"),waterMark:wt.get("waterMark"),styles:(B=this.params)==null?void 0:B.styles,collaborationMode:(N=(W=(z=this.params)==null?void 0:z.collaborationMode)==null?void 0:W.enabled)!=null?N:!0,layoutPosition:((D=(M=this.params)==null?void 0:M.collaborationMode)==null?void 0:D.enabled)===!1?"center":(J=(G=(U=this.params)==null?void 0:U.collaborationMode)==null?void 0:G.modalPosition)!=null?J:"center",layoutMode:(X=(it=(tt=this.params)==null?void 0:tt.collaborationMode)==null?void 0:it.initialView)!=null?X:"list",callbacks:(R=this.params)==null?void 0:R.callbacks},this.logger.log("video conference @ start video",this.videoConfig),this.videoManager=new Ro(this.videoConfig),this.subscribeToVideoEvents()};this.subscribeToVideoEvents=()=>{this.logger.log("video conference @ subscribe to video events"),this.videoManager.meetingConnectionObserver.subscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.subscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.subscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.subscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.subscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.subscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.subscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.subscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.subscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.subscribe(this.onSameAccountError),this.videoManager.devicesObserver.subscribe(this.onDevicesChange)};this.unsubscribeFromVideoEvents=()=>{this.logger.log("video conference @ unsubscribe from video events"),this.videoManager.meetingConnectionObserver.unsubscribe(this.connectionService.updateMeetingConnectionStatus),this.videoManager.participantListObserver.unsubscribe(this.onParticipantListUpdate),this.videoManager.waitingForHostObserver.unsubscribe(this.onWaitingForHost),this.videoManager.frameSizeObserver.unsubscribe(this.onFrameSizeDidChange),this.videoManager.meetingStateObserver.unsubscribe(this.onMeetingStateChange),this.videoManager.frameStateObserver.unsubscribe(this.onFrameStateChange),this.videoManager.realtimeEventsObserver.unsubscribe(this.onRealtimeEventFromFrame),this.videoManager.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.videoManager.participantLeftObserver.unsubscribe(this.onParticipantLeft),this.videoManager.sameAccountErrorObserver.unsubscribe(this.onSameAccountError),this.videoManager.devicesObserver.unsubscribe(this.onDevicesChange)};this.suscribeToRealtimeEvents=()=>{this.logger.log("video conference @ subscribe to realtime events"),this.realtime.kickAllParticipantsObserver.subscribe(this.onKickAllParticipantsDidChange),this.realtime.kickParticipantObserver.subscribe(this.onKickLocalParticipant),this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.subscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.subscribe(this.onRealtimeParticipantsDidChange)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("video conference @ unsubscribe from realtime events"),this.realtime.kickAllParticipantsObserver.unsubscribe(this.onKickAllParticipantsDidChange),this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoinedOnRealtime),this.realtime.participantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.roomInfoUpdatedObserver.unsubscribe(this.onRoomInfoUpdated),this.realtime.participantsObserver.unsubscribe(this.onRealtimeParticipantsDidChange)};this.createParticipantFromAblyPresence=t=>{var n;return{id:t.clientId,color:this.realtime.getSlotColor((n=t.data)==null?void 0:n.slotIndex).color,avatar:t.data.avatar,type:t.data.type,name:t.data.name,isHost:this.realtime.hostClientId===t.clientId}};this.onFrameSizeDidChange=t=>{this.publish("frame.dimensions-update",t)};this.onWaitingForHost=t=>{this.publish("meeting.waiting-for-host",t)};this.onConnectionStatusChange=t=>{this.logger.log("video conference @ on connection status change",t);let n=[2,4,3,6];n.includes(t)&&this.realtime.freezeSync(!0),n.includes(this.connectionService.oldConnectionStatus)&&!n.includes(t)&&this.realtime.freezeSync(!1),this.publish("meeting.connection-status-change",t)};this.onMeetingStateChange=t=>{this.logger.log("video conference @ on meeting state change",t),this.publish("meeting.state-update",t)};this.onSameAccountError=t=>{this.publish("meeting.same-participant-error",t),this.detach()};this.onDevicesChange=t=>{this.publish("meeting.devices-change",t)};this.onFrameStateChange=t=>{this.logger.log("video conference @ on frame state change",t),t===2&&(this.videoManager.start({group:this.group,participant:this.localParticipant,roomId:wt.get("roomId")}),this.publish("meeting.start"))};this.onRealtimeEventFromFrame=({event:t,data:n})=>{this.logger.log("video conference @ on realtime event from frame",t,n);let r={["realtime.host-change"]:a=>this.realtime.setHost(a),["realtime.gather"]:a=>this.realtime.setGather(a),["realtime.grid-mode-change"]:a=>this.realtime.setGridMode(a),["realtime.drawing-change"]:a=>{this.realtime.setDrawing(a)},["realtime.follow-participant"]:a=>{this.realtime.setFollowParticipant(a)},["meeting.kick-participant"]:a=>{this.realtime.setKickParticipant(a)},["realtime.transcript-change"]:a=>{this.realtime.setTranscript(a)},["realtime.go-to-participant"]:a=>{this.eventBus.publish("realtime.go-to-participant",a)}}[t](n);this.publish(t,n)};this.onParticipantJoined=t=>{var n;if(this.logger.log("video conference @ on participant joined",t),this.localParticipant=t,this.publish("meeting.participant-joined",t),this.publish("my-participant.joined",t),this.kickParticipantsOnHostLeave=!((n=this.params)!=null&&n.allowGuests),this.videoConfig.canUseDefaultAvatars){this.realtime.updateMyProperties({avatar:t.avatar,name:t.name,type:t.type});return}this.realtime.updateMyProperties({name:t.name,type:t.type})};this.onParticipantLeft=t=>{this.logger.log("video conference @ on participant left",this.localParticipant),this.publish("my-participant.left",this.localParticipant),this.detach()};this.onParticipantListUpdate=t=>{this.logger.log("video conference @ on participant list update",t);let n=t.map(r=>{var l;let a=this.realtime.getParticipants[r.id];return{id:r.id,color:(l=r.color)!=null?l:this.realtime.getSlotColor(a.data.slotIndex).color,avatar:r.avatar,name:r.name,type:r.type,isHost:r.isHost}});(0,Xc.isEqual)(this.participantsOnMeeting,n)||(this.publish("meeting.participant-list-update",n),this.participantsOnMeeting.length!==n.length&&this.publish("meeting.amount-of-participants-update",n.length),this.participantsOnMeeting=n)};this.onKickAllParticipantsDidChange=t=>{this.logger.log("video conference @ on kick all participants did change",t),this.publish("meeting.kick-all-participants",t),this.detach()};this.onKickLocalParticipant=()=>{this.logger.log("video conference @ on kick local participant"),this.publish("meeting.kick-participant",this.localParticipant),this.detach()};this.onRoomInfoUpdated=t=>{this.logger.log("video conference @ on room info updated",t);let{isGridModeEnable:n,followParticipantId:r,gather:a,drawing:l,transcript:c,hostClientId:u}=t;this.videoManager.publishMessageToFrame("realtime.host-change",u),this.onHostParticipantDidChange(u),this.videoManager.publishMessageToFrame("realtime.grid-mode-change",n),this.videoManager.publishMessageToFrame("realtime.drawing-change",l),this.videoManager.publishMessageToFrame("realtime.follow-participant",r),this.videoManager.publishMessageToFrame("realtime.transcript-change",c),this.realtime.hostClientId===this.localParticipant.id&&a&&this.realtime.setGather(!1)};this.onRealtimeParticipantsDidChange=t=>{this.logger.log("video conference @ on participants did change",t);let n=Object.values(t).map(r=>({timestamp:r.timestamp,connectionId:r.connectionId,participantId:r.clientId,color:this.realtime.getSlotColor(r.data.slotIndex).name,name:r.data.name,isHost:this.realtime.hostClientId===r.clientId,avatar:r.data.avatar,type:r.data.type}));(0,Xc.isEqual)(this.participantToFrameList,n)||this.videoManager.publishMessageToFrame("realtime.participant-list-update",n),this.participantToFrameList=n,this.validateIfInTheRoomHasHost(t)};this.onHostParticipantDidChange=t=>{this.logger.log("video conference @ on host participant did change",t),this.videoManager.publishMessageToFrame("realtime.host-change",t);let n=this.participantsOnMeeting.find(r=>r.id===t);this.realtime.isLocalParticipantHost&&(this.realtime.setSyncProperty("meeting.host-change",n),this.publish("meeting.host-change",n))};this.onHostAvailabilityChange=t=>{if(this.logger.log("launcher service @ onHostAvailabilityChange"),t){this.publish("meeting.host-available");return}this.publish("meeting.no-host-available")};this.onParticipantJoinedOnRealtime=t=>{this.logger.log("video conference @ on participant joined on realtime",t),this.publish("meeting.participant-joined",this.createParticipantFromAblyPresence(t))};this.onParticipantLeftOnRealtime=t=>{this.logger.log("video conference @ on participant left on realtime",t),this.publish("meeting.participant-left",this.createParticipantFromAblyPresence(t))};this.validateIfInTheRoomHasHost=t=>{let n=Object.values(t).filter(l=>l.data.type==="host"),r=n.some(l=>l.clientId===this.realtime.hostClientId);if(!n.length&&this.kickParticipantsOnHostLeave&&this.localParticipant.type!=="host"&&!Lo&&(this.logger.log("video conference @ validate if in the room has host - init kick all participants timeout"),Lo=setTimeout(()=>{this.logger.log("video conference @ validate if in the room has host - kick all participants"),this.onKickLocalParticipant()},LS)),n.length&&Lo&&(this.logger.log("video conference @ validade if in the room has host - clear kick all participants timeout"),clearTimeout(Lo),Lo=null),this.onHostAvailabilityChange(!!n.length),!n.length||r)return;let a=n.reduce((l,c)=>(this.logger.log("video conference @ validade if in the room has host - reducing participants",{previus:l,current:c}),!l||c.clientId===this.realtime.hostClientId||c.timestamp>l.timestamp?c:l),null);a.clientId===this.realtime.hostClientId||a.clientId!==this.localParticipant.id||(this.logger.log("video conference @ validade if in the room has host - set host",a),this.realtime.setHost(a.clientId))};this.params=Mt(lt({},t),{userType:(r=(n=t==null?void 0:t.participantType)!=null?n:t==null?void 0:t.userType)!=null?r:"guest"}),this.name="videoConference",this.logger=new Kt(`@superviz/sdk/${"videoConference"}`),this.browserService=new Io,this.connectionService=new wa,this.connectionService.addListeners(),this.connectionService.connectionStatusObserver.subscribe(this.onConnectionStatusChange)}toggleMeetingSetup(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-setup")}toggleMicrophone(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-microphone")}toggleCam(){this.videoManager.publishMessageToFrame("meeting-controls.toggle-cam")}toggleScreenShare(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-screenshare")}toggleChat(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-chat")}toggleTranscript(){return this.videoManager.publishMessageToFrame("meeting-controls.toggle-transcript")}hangUp(){this.videoManager.publishMessageToFrame("hang-up")}start(){this.logger.log("video conference @ start"),this.params.userType!=="guest"&&(this.localParticipant.type=this.params.userType),this.suscribeToRealtimeEvents(),this.startVideo()}destroy(){this.logger.log("video conference @ destroy");let{data:t}=this.realtime.participant,n=t.activeComponents.filter(r=>r!=="videoConference");this.realtime.updateMyProperties({activeComponents:n,type:"guest"}),this.kickParticipantsOnHostLeave=!1,this.publish("destroy"),this.unsubscribeFromRealtimeEvents(),this.unsubscribeFromVideoEvents(),this.videoManager.leave(),this.connectionService.removeListeners()}};L();L();var _a=class extends Ge{constructor(t,n){var r;super();this.transformation={translate:{x:0,y:0},scale:1};this.subscribeToRealtimeEvents=()=>{this.logger.log("presence-mouse component @ subscribe to realtime events"),this.realtime.presenceMouseParticipantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.presenceMouseObserver.subscribe(this.onParticipantsDidChange)};this.unsubscribeFromRealtimeEvents=()=>{this.logger.log("presence-mouse component @ unsubscribe from realtime events"),this.realtime.presenceMouseParticipantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.presenceMouseObserver.unsubscribe(this.onParticipantsDidChange)};this.setParticipantPrivate=t=>{this.isPrivate=t,this.realtime.updatePresenceMouse(Mt(lt({},this.localParticipant),{visible:!t}))};this.animate=()=>{this.renderDivWrapper(),this.updateParticipantsMouses(),requestAnimationFrame(this.animate)};this.goToMouse=t=>{let n=this.presences.get(t);if(!n)return;let r=this.canvas.getBoundingClientRect(),{width:a,height:l}=r,{x:c,y:u}=n,m=a/2,g=l/2,E=m-c,h=g-u;this.goToMouseCallback&&this.goToMouseCallback({x:E,y:h})};this.onMyParticipantMouseMove=t=>{let n=this.canvas.getContext("2d"),r=this.canvas.getBoundingClientRect(),a=t.x-r.left,l=t.y-r.top,u=(n==null?void 0:n.getTransform()).inverse(),m=new DOMPoint(a,l).matrixTransform(u),g={x:(m.x-this.transformation.translate.x)/this.transformation.scale,y:(m.y-this.transformation.translate.y)/this.transformation.scale};this.realtime.updatePresenceMouse(Mt(lt(lt({},this.localParticipant),g),{visible:!this.isPrivate}))};this.onParticipantsDidChange=t=>{this.logger.log("presence-mouse component @ on participants did change",t),Object.values(t).forEach(n=>{if(n.id!==this.localParticipant.id){if(this.following&&n.id!==this.following&&this.presences.has(n.id)){this.removePresenceMouseParticipant(n.id);return}this.presences.set(n.id,n)}}),this.following&&this.presences.get(this.following)&&this.goToMouse(this.following)};this.onMyParticipantMouseOut=t=>{let{x:n,y:r,width:a,height:l}=this.canvas.getBoundingClientRect();t.x>0&&t.y>0&&t.x<n+a&&t.y<r+l||this.realtime.updatePresenceMouse(lt({visible:!1},this.localParticipant))};this.onParticipantLeftOnRealtime=t=>{this.removePresenceMouseParticipant(t.id)};this.updateParticipantsMouses=()=>{this.presences.forEach(t=>{if(!(t!=null&&t.visible)){this.removePresenceMouseParticipant(t.id);return}this.renderPresenceMouses(t)})};this.renderPresenceMouses=t=>{let r=document.getElementById(`mouse-${t.id}`);r||(r=this.createMouseElement(t));let a=document.getElementById(`mouse-${t.id}`),l=document.getElementById(`mouse-${t.id}`);if(!a||!l)return;let c=a.getElementsByClassName("mouse-user-name")[0],u=l.getElementsByClassName("pointer-mouse")[0];u&&(u.style.backgroundImage=`url(https://production.cdn.superviz.com/static/pointers-v2/${t.slotIndex}.svg)`),c&&(c.style.color=this.textColorValues.includes(t.slotIndex)?"#FFFFFF":"#26242A",c.style.backgroundColor=t.color,c.innerHTML=t.name);let{x:m,y:g}=t,E=this.canvas.getContext("2d"),h=E==null?void 0:E.getTransform(),y=h==null?void 0:h.e,O=h==null?void 0:h.f,_=this.transformation.translate.x+(m+y)*this.transformation.scale,C=this.transformation.translate.y+(g+O)*this.transformation.scale,T=this.divWrapper.clientWidth>_&&this.divWrapper.clientHeight>C&&t.visible;r.style.opacity=T?"1":"0",r.style.left=`${_}px`,r.style.top=`${C}px`};this.followMouse=t=>{this.following=t};if(this.name="presence",this.logger=new Kt(`@superviz/sdk/${"presence"}`),this.canvas=document.getElementById(t),this.presences=new Map,!this.canvas){let a=`Canvas with id ${t} not found`;throw this.logger.log(a),new Error(a)}this.divWrapper=this.renderDivWrapper(),this.animateFrame=requestAnimationFrame(this.animate),this.goToMouseCallback=(r=n==null?void 0:n.callbacks)==null?void 0:r.onGoToPresence}get textColorValues(){return[2,4,5,7,8,16]}start(){this.logger.log("presence-mouse component @ start"),this.canvas.addEventListener("mousemove",this.onMyParticipantMouseMove),this.canvas.addEventListener("mouseout",this.onMyParticipantMouseOut),this.eventBus.subscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.subscribe("realtime.local-follow-participant",this.followMouse),this.eventBus.subscribe("realtime.private-mode",this.setParticipantPrivate),this.subscribeToRealtimeEvents(),this.realtime.enterPresenceMouseChannel(this.localParticipant)}destroy(){this.logger.log("presence-mouse component @ destroy"),this.eventBus.unsubscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.unsubscribe("realtime.local-follow-participant",this.followMouse),this.eventBus.unsubscribe("realtime.private-mode",this.setParticipantPrivate),this.realtime.leavePresenceMouseChannel(),this.unsubscribeFromRealtimeEvents(),cancelAnimationFrame(this.animateFrame),this.canvas.removeEventListener("mousemove",this.onMyParticipantMouseMove),this.canvas.removeEventListener("mouseout",this.onMyParticipantMouseOut),this.divWrapper.remove()}renderDivWrapper(){let t=this.canvas.getBoundingClientRect(),n=document.getElementById("superviz-presence-mouse-wrapper");return n||(n=document.createElement("div"),n.id="superviz-presence-mouse-wrapper",this.canvas.parentElement.style.position="relative",this.canvas.parentElement.appendChild(n)),n.style.position="fixed",n.style.top=`${t.top}px`,n.style.left=`${t.left}px`,n.style.width=`${t.width}px`,n.style.height=`${t.height}px`,n.style.pointerEvents="none",n.style.overflow="hidden",n.style.zIndex="2",n}removePresenceMouseParticipant(t){let n=document.getElementById(`mouse-${t}`);n&&(n.remove(),this.presences.delete(t))}createMouseElement(t){let n=document.createElement("div");n.setAttribute("id",`mouse-${t.id}`),n.setAttribute("class","mouse-follower");let r=document.createElement("div");r.setAttribute("class","pointer-mouse");let a=document.createElement("div");return a.setAttribute("class","mouse-user-name"),a.innerHTML=t.name,n.appendChild(r),n.appendChild(a),n.style.left="0px",n.style.top="0px",this.divWrapper.appendChild(n),n}transform(t){this.transformation=t}};L();var rm=an(Oi());L();var xa=(T=>(T[T.turquoise=0]="turquoise",T[T.orange=1]="orange",T[T.blue=2]="blue",T[T.pink=3]="pink",T[T.purple=4]="purple",T[T.green=5]="green",T[T.red=6]="red",T[T.bluedark=7]="bluedark",T[T.pinklight=8]="pinklight",T[T.purplelight=9]="purplelight",T[T.greenlight=10]="greenlight",T[T.orangelight=11]="orangelight",T[T.bluelight=12]="bluelight",T[T.redlight=13]="redlight",T[T.brown=14]="brown",T[T.yellow=15]="yellow",T[T.gray=16]="gray",T))(xa||{}),Pr=[1,3,4,6,7,14,16],tu=(s=>(s[s["#31E0B0"]=0]="#31E0B0",s[s["#FF5E10"]=1]="#FF5E10",s[s["#00ABF7"]=2]="#00ABF7",s[s["#FF00BB"]=3]="#FF00BB",s[s["#9C29FF"]=4]="#9C29FF",s[s["#6FDD00"]=5]="#6FDD00",s[s["#E30000"]=6]="#E30000",s[s["#304AFF"]=7]="#304AFF",s[s["#FF89C4"]=8]="#FF89C4",s[s["#D597FF"]=9]="#D597FF",s[s["#C6EC5C"]=10]="#C6EC5C",s[s["#FFA115"]=11]="#FFA115",s[s["#75DEFE"]=12]="#75DEFE",s[s["#FAA291"]=13]="#FAA291",s[s["#BB813F"]=14]="#BB813F",s[s["#FFEF33"]=15]="#FFEF33",s[s["#878291"]=16]="#878291",s))(tu||{});L();var Pa=(O=>(O.AREA="area",O.BASE="base",O.BR="br",O.COL="col",O.EMBED="embed",O.HR="hr",O.IMG="img",O.INPUT="input",O.LINK="link",O.META="meta",O.PARAM="param",O.SOURCE="source",O.TRACK="track",O.WBR="wbr",O))(Pa||{}),Ia=(n=>(n.RECT="rect",n.ELLIPSE="ellipse",n.SVG="svg",n))(Ia||{});var Ma=class extends Ge{constructor(t,n){var r;super();this.presences=new Map;this.mouses=new Map;this.transformation={translate:{x:0,y:0},scale:1};this.onMyParticipantMouseMove=t=>{if(this.isPrivate)return;let n=t.currentTarget,{left:r,top:a}=n.getBoundingClientRect(),l=(t.x-r-this.transformation.translate.x)/this.transformation.scale,c=(t.y-a-this.transformation.translate.y)/this.transformation.scale;this.realtime.updatePresenceMouse(Mt(lt({},this.localParticipant),{x:l,y:c,visible:!0}))};this.onMyParticipantMouseLeave=()=>{this.realtime.updatePresenceMouse(lt({visible:!1},this.localParticipant))};this.onParticipantsDidChange=t=>{this.logger.log("presence-mouse component @ on participants did change",t),Object.values(t).forEach(n=>{if(n.id===this.localParticipant.id)return;if(this.userBeingFollowedId&&n.id!==this.userBeingFollowedId&&this.presences.has(n.id)){this.removePresenceMouseParticipant(n.id);return}this.presences.set(n.id,n)}),this.animate(),this.updateParticipantsMouses()};this.goToMouse=t=>{let n=this.mouses.get(t);if(!!n){if(this.goToPresenceCallback){let{x:r,y:a}=this.mouses.get(t).getBoundingClientRect();this.goToPresenceCallback({x:r,y:a});return}n.scrollIntoView({block:"center",inline:"center",behavior:"smooth"})}};this.followMouse=t=>{this.userBeingFollowedId=t};this.onParticipantLeftOnRealtime=t=>{this.removePresenceMouseParticipant(t.id)};this.setParticipantPrivate=t=>{this.isPrivate=t,this.realtime.updatePresenceMouse(Mt(lt({},this.localParticipant),{visible:!t}))};this.getTextColorValue=t=>Pr.includes(t)?"#FFFFFF":"#26242A";this.animate=()=>{Pa[this.containerTagname]&&this.updateVoidElementWrapper(),Ia[this.containerTagname]&&this.updateSVGElementWrapper(),this.animationFrame=requestAnimationFrame(this.animate)};this.updateParticipantsMouses=()=>{this.presences.forEach(n=>{if(n.id!==this.localParticipant.id){if(!(n!=null&&n.visible)){this.removePresenceMouseParticipant(n.id);return}this.renderPresenceMouses(n)}}),this.presences.has(this.userBeingFollowedId)&&this.goToMouse(this.userBeingFollowedId)};this.renderPresenceMouses=t=>{if(t.id===this.localParticipant.id)return;let n=document.getElementById(`mouse-${t.id}`);if(n||(n=this.createMouseElement(t)),!n)return;let r=n.getElementsByClassName("mouse-user-name")[0],a=n.getElementsByClassName("pointer-mouse")[0];a&&(a.style.backgroundImage=`url(https://production.cdn.superviz.com/static/pointers-v2/${t.slotIndex}.svg)`),r&&(r.style.color=this.getTextColorValue(t.slotIndex),r.style.backgroundColor=t.color,r.innerHTML=t.name);let{x:l,y:c}=t,{translate:{x:u,y:m},scale:g}=this.transformation;n.style.transform=`translate(${u+l*g}px, ${m+c*g}px)`};this.renderVoidElementWrapper=()=>{let t=document.createElement("div"),n=this.container,{width:r,height:a,left:l,top:c}=this.container.getBoundingClientRect(),u=n.offsetLeft-l,m=n.offsetTop-c;t.style.position="absolute",t.style.width=`${r}px`,t.style.height=`${a}px`,t.style.top=`${c}px`,t.style.left=`${l}px`,t.style.overflow="visible",t.style.pointerEvents="none",this.container.parentElement.appendChild(t),this.wrapper=t};this.renderSVGElementWrapper=()=>{let t=this.containerTagname.toLowerCase();if(t==="svg"){this.createSVGWrapper();return}if(t==="rect"){this.createRectWrapper();return}t==="ellipse"&&this.createEllipseWrapper()};if(this.container=document.getElementById(t),this.logger=new Kt(`@superviz/sdk/${"presence"}`),!this.container){let a=`Element with id ${t} not found`;throw this.logger.log(a),new Error(a)}this.name="presence",this.containerTagname=this.container.tagName.toUpperCase(),this.goToPresenceCallback=(r=n==null?void 0:n.callbacks)==null?void 0:r.onGoToPresence}start(){this.logger.log("presence-mouse component @ start"),this.realtime.enterPresenceMouseChannel(this.localParticipant),this.renderWrapper(),this.addListeners(),this.subscribeToRealtimeEvents(),this.eventBus.subscribe("realtime.private-mode",this.setParticipantPrivate),this.animationFrame=requestAnimationFrame(this.animate),this.eventBus.subscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.subscribe("realtime.local-follow-participant",this.followMouse)}destroy(){cancelAnimationFrame(this.animationFrame),this.logger.log("presence-mouse component @ destroy"),this.realtime.leavePresenceMouseChannel(),this.removeListeners(),this.wrapper.remove(),this.presences.clear(),this.presences=void 0,this.container=void 0,this.wrapper=void 0,this.unsubscribeFromRealtimeEvents(),this.eventBus.unsubscribe("realtime.private-mode",this.setParticipantPrivate),this.eventBus.unsubscribe("realtime.go-to-participant",this.goToMouse),this.eventBus.unsubscribe("realtime.local-follow-participant",this.followMouse),this.logger=void 0}subscribeToRealtimeEvents(){this.logger.log("presence-mouse component @ subscribe to realtime events"),this.realtime.presenceMouseParticipantLeaveObserver.subscribe(this.onParticipantLeftOnRealtime),this.realtime.presenceMouseObserver.subscribe(this.onParticipantsDidChange)}unsubscribeFromRealtimeEvents(){this.logger.log("presence-mouse component @ unsubscribe from realtime events"),this.realtime.presenceMouseParticipantLeaveObserver.unsubscribe(this.onParticipantLeftOnRealtime),this.realtime.presenceMouseObserver.unsubscribe(this.onParticipantsDidChange)}addListeners(){this.container.addEventListener("pointermove",this.onMyParticipantMouseMove),this.container.addEventListener("mouseleave",this.onMyParticipantMouseLeave)}removeListeners(){this.container.removeEventListener("pointermove",this.onMyParticipantMouseMove),this.container.removeEventListener("mouseleave",this.onMyParticipantMouseLeave)}setPositionNotStatic(){let{position:t}=window.getComputedStyle(this.container);t==="static"&&this.container.style.setProperty("position","relative")}createMouseElement(t){if(!this.wrapper)return;let n=document.createElement("div");n.setAttribute("id",`mouse-${t.id}`),n.setAttribute("class","mouse-follower");let r=document.createElement("div");r.setAttribute("class","pointer-mouse");let a=document.createElement("div");return a.setAttribute("class","mouse-user-name"),a.innerHTML=t.name,n.appendChild(r),n.appendChild(a),n.style.left="0px",n.style.top="0px",this.wrapper.appendChild(n),this.mouses.set(t.id,n),n}updateSVGPosition(){let t=this.container.parentElement.getBoundingClientRect(),n=this.container.getBoundingClientRect(),r=n.left-t.left,a=n.top-t.top,{width:l,height:c}=this.container.getBoundingClientRect();this.wrapper.style.setProperty("width",`${l}px`),this.wrapper.style.setProperty("height",`${c}px`),this.wrapper.style.setProperty("top",`${a}px`),this.wrapper.style.setProperty("left",`${r}px`)}createSVGWrapper(){let t=document.createElement("div"),n=this.container.parentElement.getBoundingClientRect(),r=this.container.getBoundingClientRect(),a=r.left-n.left,l=r.top-n.top,{width:c,height:u}=this.container.getBoundingClientRect();t.style.position="fixed",t.style.width=`${c}px`,t.style.height=`${u}px`,t.style.top=`${l}px`,t.style.left=`${a}px`,t.style.overflow="visible",t.style.pointerEvents="none",t.id="superviz-svg-wrapper",this.container.parentElement.appendChild(t),this.wrapper=t}createRectWrapper(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","rect"),r=document.createElement("div"),a=this.container.getAttribute("width"),l=this.container.getAttribute("height"),c=this.container.getAttribute("rx"),u=this.container.getAttribute("ry");n.setAttribute("fill","transparent"),n.setAttribute("stroke","transparent"),n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("rx",c),n.setAttribute("ry",u),n.setAttribute("height",l),n.setAttribute("width",a),t.setAttribute("height",l),t.setAttribute("width",a),t.appendChild(n),r.appendChild(t);let m=this.container.getBoundingClientRect();r.style.position="fixed",r.style.top=`${m.top}px`,r.style.left=`${m.left}px`,r.style.width=`${m.width}px`,r.style.height=`${m.height}px`,r.style.overflow="visible",r.style.pointerEvents="none",r.id="superviz-rect-wrapper";let g=this.container.viewportElement;for(;g.viewportElement;)g=g.viewportElement;g.parentElement.appendChild(r),this.wrapper=r}createEllipseWrapper(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),r=document.createElement("div"),a=this.container.getAttribute("cx"),l=this.container.getAttribute("cy"),c=this.container.getAttribute("rx"),u=this.container.getAttribute("ry"),m=Number(a)-Number(c),g=Number(l)-Number(u),E=String(2*Number(a)),h=String(2*Number(l));n.setAttribute("fill","transparent"),n.setAttribute("stroke","transparent"),n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("rx",c),n.setAttribute("ry",u),n.setAttribute("cx",`${Number(a)-m}`),n.setAttribute("cy",`${Number(l)-g}`),n.setAttribute("height",h),n.setAttribute("width",E),t.setAttribute("height",h),t.setAttribute("width",E),t.appendChild(n),r.appendChild(t);let y=this.container.getBoundingClientRect();r.style.position="fixed",r.style.top=`${y.top}px`,r.style.left=`${y.left}px`,r.style.width=`${y.width}px`,r.style.height=`${y.height}px`,r.style.overflow="visible",r.style.pointerEvents="none",r.id="superviz-ellipse-wrapper";let O=this.container.viewportElement;for(;O.viewportElement;)O=O.viewportElement;O.parentElement.appendChild(r),this.wrapper=r}transform(t){this.transformation=t}updateVoidElementWrapper(){let t=this.container.getBoundingClientRect(),n=this.wrapper.getBoundingClientRect(),r=this.container;if((0,rm.isEqual)(t,n))return;let a=r.offsetLeft,l=r.offsetTop;this.wrapper.style.setProperty("width",`${t.width}px`),this.wrapper.style.setProperty("height",`${t.height}px`),this.wrapper.style.setProperty("top",`${l}px`),this.wrapper.style.setProperty("left",`${a}px`),this.wrapper.id="superviz-void-wrapper"}updateSVGElementWrapper(){let{left:t,top:n,width:r,height:a}=this.container.getBoundingClientRect(),{left:l,top:c,width:u,height:m}=this.wrapper.getBoundingClientRect();if(!(t===l&&n===c&&r===u&&a===m)){if(this.containerTagname.toLowerCase()==="svg"){this.updateSVGPosition();return}this.wrapper.style.setProperty("width",`${r}px`),this.wrapper.style.setProperty("height",`${a}px`),this.wrapper.style.setProperty("top",`${n}px`),this.wrapper.style.setProperty("left",`${t}px`)}}renderWrapper(){if(!this.wrapper){if(Pa[this.containerTagname]){this.renderVoidElementWrapper();return}if(Ia[this.containerTagname]){this.renderSVGElementWrapper();return}this.renderElementWrapper()}}removePresenceMouseParticipant(t){let n=document.getElementById(`mouse-${t}`);n&&(n.remove(),this.presences.delete(t),this.mouses.delete(t))}renderElementWrapper(){let t=document.createElement("div");t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.top="0",t.style.left="0",t.style.overflow="visible",t.style.pointerEvents="none",this.setPositionNotStatic(),this.container.appendChild(t),this.wrapper=t}};var No=class{constructor(e,t){return document.getElementById(e).tagName.toLowerCase()==="canvas"?new _a(e,t):new Ma(e,t)}};L();L();var Ra=class{constructor(e){this.observers=new Map;this.subscribe=(e,t)=>{this.logger.log("pubsub service @ subscribe",{event:e,callback:t}),this.observers.has(e)||this.observers.set(e,new At),this.observers.get(e).subscribe(t)};this.unsubscribe=(e,t)=>{this.logger.log("pubsub service @ unsubscribe",{event:e,callback:t}),this.observers.has(e)&&(this.observers.get(e).reset(),this.observers.delete(e))};this.publish=(e,t)=>{this.logger.log("pubsub service @ publish",{event:e,data:t}),this.realtime.setSyncProperty(e,t)};this.publishEventToClient=(e,t)=>{this.logger.log("pubsub service @ publishEventToClient",{event:e,data:t}),this.observers.has(e)&&this.observers.get(e).publish(t)};this.destroy=()=>{this.logger.log("pubsub service @ destroy"),this.realtime.syncPropertiesObserver.unsubscribe(this.onSyncPropertiesChange),this.observers.forEach(e=>e.destroy()),this.observers.clear()};this.onSyncPropertiesChange=e=>{this.logger.log("pubsub service @ onSyncPropertiesChange",{properties:e}),Object.entries(e).forEach(([t,n])=>{this.publishEventToClient(t,n)})};this.logger=new Kt("@superviz/sdk/pubsub"),this.realtime=e,this.realtime.syncPropertiesObserver.subscribe(this.onSyncPropertiesChange),this.logger.log("PubSub created")}fetchHistory(e){return this.realtime.fetchSyncClientProperty(e)}};L();var La=(t=>(t.STARTED="STARTED",t.STOPPED="STOPPED",t))(La||{}),Da=(e=>(e.REALTIME_STATE_CHANGED="realtime-component.state-changed",e))(Da||{});var Fo=class extends Ge{constructor(){super();this.callbacksToSubscribeWhenJoined=[];this.state="STOPPED";this.publish=(t,n)=>{if(!this.pubsub){let r=`Realtime component is not started yet. You can't publish event ${t} before start`;this.logger.log(r);return}this.pubsub.publish(t,n)};this.subscribe=(t,n)=>{if(!this.pubsub){this.callbacksToSubscribeWhenJoined.push({event:t,callback:n});return}this.pubsub.subscribe(t,n)};this.unsubscribe=(t,n)=>{this.pubsub.unsubscribe(t,n)};this.name="realtime",this.logger=new Kt("@superviz/sdk/realtime-component")}destroy(){this.logger.log("destroyed"),this.changeState("STOPPED"),this.pubsub.destroy()}start(){this.logger.log("started"),this.pubsub=new Ra(this.realtime),this.callbacksToSubscribeWhenJoined.forEach(({event:t,callback:n})=>{this.pubsub.subscribe(t,n)}),this.changeState("STARTED")}fetchHistory(t){return this.pubsub.fetchHistory(t)}changeState(t){this.logger.log("realtime component @ changeState - state changed",t),this.state=t,this.pubsub.publishEventToClient("realtime-component.state-changed",this.state)}};L();var om=an(Oi());L();var eu=(r=>(r.TOP_LEFT="top-left",r.TOP_RIGHT="top-right",r.BOTTOM_LEFT="bottom-left",r.BOTTOM_RIGHT="bottom-right",r))(eu||{});var Bo=class extends Ge{constructor(t){var n;super();this.participants=[];this.onParticipantListUpdate=t=>{let r=Object.values(t).filter(({data:a})=>{var l;return(l=a.activeComponents)==null?void 0:l.includes("whoIsOnline")}).filter(({data:{isPrivate:a,id:l}})=>!a||a&&l===this.localParticipant.id).map(({data:a})=>{let{slotIndex:l,id:c,name:u,avatar:m,activeComponents:g}=a,{color:E}=this.realtime.getSlotColor(l),h=this.localParticipant.id===c,y=g.some(O=>O.includes("presence"));return this.setLocalData(h,!y,E,y),{name:u,id:c,slotIndex:l,color:E,isLocal:h,joinedPresence:y,avatar:m}});(0,om.isEqual)(r,this.participants)||(this.following&&(r.find(({id:l})=>l===this.following)||this.stopFollowing({clientId:this.following})),this.participants=r,this.element.updateParticipants(this.participants))};this.setLocalData=(t,n,r,a)=>{!t||(this.element.disableDropdown=n,this.element.localParticipantData={color:r,id:this.localParticipant.id,joinedPresence:a})};this.goToMousePointer=({detail:{id:t}})=>{t!==this.localParticipant.id&&(this.eventBus.publish("realtime.go-to-participant",t),this.publish("who-is-online.go-to-participant",t))};this.followMousePointer=({detail:t})=>{if(this.eventBus.publish("realtime.local-follow-participant",t.id),this.following=t.id,this.following){this.publish("who-is-online.start-following-participant",this.following);return}this.publish("who-is-online.stop-following-participant")};this.setPrivate=({detail:{isPrivate:t,id:n}})=>{if(this.eventBus.publish("realtime.private-mode",t),this.realtime.setPrivateWIOParticipant(n,t),t){this.publish("who-is-online.enter-private-mode");return}this.publish("who-is-online.leave-private-mode")};this.setFollow=t=>{var n;if(t.clientId!==this.localParticipant.id){if(this.followMousePointer({detail:{id:(n=t==null?void 0:t.data)==null?void 0:n.id}}),!t.data.id){this.element.following=void 0;return}this.following=t.data.id,this.element.following=t.data}};this.follow=t=>{var n;if(this.realtime.setFollowWIOParticipant(lt({},t.detail)),this.following=(n=t.detail)==null?void 0:n.id,this.following){this.publish("who-is-online.start-follow-me",this.following);return}this.publish("who-is-online.stop-follow-me")};this.stopFollowing=t=>{var n;t.clientId===((n=this.element.following)==null?void 0:n.id)&&(this.element.following=void 0,this.following=void 0,this.eventBus.publish("realtime.local-follow-participant",void 0),this.publish("who-is-online.stop-following-participant"))};this.gather=t=>{this.realtime.setGatherWIOParticipant(lt({},t.detail)),this.publish("who-is-online.gather-all",t.detail.id)};if(this.name="whoIsOnline",this.logger=new Kt("@superviz/sdk/who-is-online-component"),typeof t!="object"){this.position=t!=null?t:"top-right";return}this.position=(n=t.position)!=null?n:"top-right",this.setStyles(t.styles)}start(){this.subscribeToRealtimeEvents(),this.positionWhoIsOnline(),this.addListeners(),this.realtime.enterWIOChannel(this.localParticipant)}destroy(){this.unsubscribeToRealtimeEvents(),this.realtime.leaveWIOChannel(),this.removeListeners(),this.element.remove(),this.element=null,this.participants=null}addListeners(){this.element.addEventListener("realtime.local-follow-participant",this.followMousePointer),this.element.addEventListener("realtime.go-to-participant",this.goToMousePointer),this.element.addEventListener("realtime.private-mode",this.setPrivate),this.element.addEventListener("realtime.follow-participant",this.follow),this.element.addEventListener("realtime.gather",this.gather)}removeListeners(){this.element.removeEventListener("realtime.local-follow-participant",this.followMousePointer),this.element.removeEventListener("realtime.go-to-participant",this.goToMousePointer),this.element.removeEventListener("realtime.private-mode",this.setPrivate),this.element.removeEventListener("realtime.follow-participant",this.follow),this.element.removeEventListener("realtime.gather",this.gather)}subscribeToRealtimeEvents(){this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate),this.realtime.participantLeaveObserver.subscribe(this.stopFollowing),this.realtime.privateModeWIOObserver.subscribe(this.onParticipantListUpdate),this.realtime.followWIOObserver.subscribe(this.setFollow),this.realtime.gatherWIOObserver.subscribe(this.goToMousePointer)}unsubscribeToRealtimeEvents(){this.realtime.participantsObserver.unsubscribe(this.onParticipantListUpdate),this.realtime.participantLeaveObserver.unsubscribe(this.stopFollowing),this.realtime.privateModeWIOObserver.unsubscribe(this.onParticipantListUpdate),this.realtime.followWIOObserver.unsubscribe(this.setFollow),this.realtime.gatherWIOObserver.unsubscribe(this.goToMousePointer)}setStyles(t=""){if(!t)return;let n=document.createElement("style");n.textContent=t,n.id="superviz-who-is-online-styles",document.head.appendChild(n)}positionWhoIsOnline(){if(this.element=document.createElement("superviz-who-is-online"),Object.values(eu).includes(this.position.toLowerCase())){document.body.appendChild(this.element);let[r,a]=this.position.split("-");this.element.position=`${r}: 20px; ${a}: 40px;`;return}let n=document.getElementById(this.position);if(!n){this.element.position="top: 20px; right: 40px;",document.body.appendChild(this.element);return}n.appendChild(this.element),this.element.position="position: relative;"}};L();var lu=an(zc());L();var nu=(T=>(T.svPrimary="sv-primary",T.svPrimary900="sv-primary-900",T.svPrimary200="sv-primary-200",T.svSecondary="sv-secondary",T.svGray="sv-gray",T.svSuccess="sv-success",T.svDanger="sv-danger",T.svBlack="sv-black",T.svWhite="sv-white",T.svGray100="sv-gray-100",T.svGray200="sv-gray-200",T.svGray300="sv-gray-300",T.svGray400="sv-gray-400",T.svGray500="sv-gray-500",T.svGray600="sv-gray-600",T.svGray700="sv-gray-700",T.svGray800="sv-gray-800",T))(nu||{});L();function DS(s,e){return Lt(this,null,function*(){try{return(yield ce.validateApiKey(s,e))===!0}catch(t){if(t.status===404)return!1;throw new Error("Unable to validate API key")}})}var sm=DS;L();L();var Ir=class{static getRemoteConfig(){return Lt(this,arguments,function*(e="prod"){let{version:t}=yield Promise.resolve().then(()=>(lm(),am));if(e==="local"){let{remoteConfig:a}=yield Promise.resolve().then(()=>(um(),cm));return a}let n={version:t,environment:e},r=this.createUrl(n);return Te(r,"GET",null)})}static createUrl({version:e,environment:t}){return`${this.REMOTE_CONFIG_BASE_URL}/${e}?env=${t}`}};Ir.REMOTE_CONFIG_BASE_URL="https://remote-config.superviz.com/sdk";L();var su=an(Oi());L();var ko=class{constructor(){this.observers=new Map;this.subscribe=(e,t)=>{this.logger.log("event bus service @ subscribe",{event:e,callback:t}),this.observers.has(e)||this.observers.set(e,new At),this.observers.get(e).subscribe(t)};this.unsubscribe=(e,t)=>{this.logger.log("event bus service @ unsubscribe",{event:e,callback:t}),this.observers.has(e)&&(this.observers.get(e).reset(),this.observers.delete(e))};this.publish=(e,t)=>{this.logger.log("event bus service @ publish",{event:e,data:t}),this.observers.has(e)&&this.observers.get(e).publish(t)};this.destroy=()=>{this.logger.log("event bus service @ destroy"),this.observers.forEach(e=>{e.reset(),e.destroy()}),this.observers.clear()};this.logger=new Kt("@superviz/sdk/event-bus"),this.logger.log("event bus created")}};L();var $o=class{static checkComponentLimit(e){var r,a;let t=(r=Zc[e])!=null?r:e,n=wt.get("limits");return(a=n==null?void 0:n[t])!=null?a:!1}};L();L();var ou=an(dm()),Ba=an(Kc());L();var ru=(u=>(u[u.DISCONNECTED=0]="DISCONNECTED",u[u.INITIALIZING=1]="INITIALIZING",u[u.READY_TO_JOIN=2]="READY_TO_JOIN",u[u.CONNECTING=3]="CONNECTING",u[u.CONNECTED=4]="CONNECTED",u[u.JOINED=5]="JOINED",u[u.FAILED=-1]="FAILED",u[u.RETRYING=-2]="RETRYING",u))(ru||{});L();var Fa=class{constructor(){this.participantObservers=[],this.participants3DObservers=[],this.logger=new Kt("@superviz/sdk/realtime-service"),this.participantsObserver=new At({logger:this.logger}),this.participantJoinedObserver=new At({logger:this.logger}),this.participantLeaveObserver=new At({logger:this.logger}),this.syncPropertiesObserver=new At({logger:this.logger}),this.reconnectObserver=new At({logger:this.logger}),this.sameAccountObserver=new At({logger:this.logger}),this.roomInfoUpdatedObserver=new At({logger:this.logger}),this.roomListUpdatedObserver=new At({logger:this.logger}),this.realtimeStateObserver=new At({logger:this.logger}),this.kickAllParticipantsObserver=new At({logger:this.logger}),this.kickParticipantObserver=new At({logger:this.logger}),this.authenticationObserver=new At({logger:this.logger}),this.commentsObserver=new At({logger:this.logger}),this.presenceMouseObserver=new At({logger:this.logger}),this.privateModeWIOObserver=new At({logger:this.logger}),this.followWIOObserver=new At({logger:this.logger}),this.gatherWIOObserver=new At({logger:this.logger}),this.presenceMouseParticipantLeaveObserver=new At({logger:this.logger}),this.presenceMouseParticipantJoinedObserver=new At({logger:this.logger}),this.presenceSlotsInfosObserver=new At({logger:this.logger}),this.presence3dObserver=new At({logger:this.logger}),this.presence3dLeaveObserver=new At({logger:this.logger}),this.presence3dJoinedObserver=new At({logger:this.logger})}subscribeToParticipantUpdate(e,t){this.participantObservers[e]||(this.participantObservers[e]=new At({logger:this.logger})),this.participantObservers[e].subscribe(t)}unsubscribeFromParticipantUpdate(e,t){this.participantObservers[e]&&this.participantObservers[e].unsubscribe(t)}subscribeToParticipant3DUpdate(e,t){this.participants3DObservers[e]||(this.participants3DObservers[e]=new At({logger:this.logger})),this.participants3DObservers[e].subscribe(t)}unsubscribeFromParticipant3DUpdate(e,t){this.participants3DObservers[e]&&this.participants3DObservers[e].unsubscribe(t)}getSlotColor(e){let t=e!=null?e:16;return{color:tu[t],name:xa[t]}}};var fm=6e4,BS=1e4,kS=1e3,$S=100,Mr=class extends Fa{constructor(t,n){super();this.participants={};this.participantsWIO={};this.participantsMouse={};this.participantsOn3d={};this.hostParticipantId=null;this.myParticipant=null;this.commentsChannel=null;this.supervizChannel=null;this.clientSyncChannel=null;this.clientRoomStateChannel=null;this.broadcastChannel=null;this.presenceWIOChannel=null;this.presenceMouseChannel=null;this.presence3DChannel=null;this.clientRoomState={};this.clientSyncPropertiesQueue={};this.isReconnecting=!1;this.isJoinedRoom=!1;this.isJoinedPresence3D=!1;this.currentReconnectAttempt=0;this.localRoomProperties=null;this.enableSync=!0;this.isSyncFrozen=!1;this.left=!1;this.domainWhitelisted=!0;this.state=0;this.setHost=t=>{this.updateRoomProperties({hostClientId:t})};this.setKickParticipant=t=>{if(!t)return;let n=this.participants[t];this.updateRoomProperties({kickParticipant:n})};this.freezeSync=t=>{var n,r;if(this.isSyncFrozen=t,t){this.supervizChannel.detach(),this.clientSyncChannel.detach(),(n=this.broadcastChannel)==null||n.detach(),this.supervizChannel.unsubscribe(),this.clientSyncChannel.unsubscribe(),(r=this.broadcastChannel)==null||r.unsubscribe();return}this.join()};this.setParticipantData=t=>{this.myParticipant.data=Object.assign({},this.myParticipant.data,t),this.updateMyProperties(this.myParticipant.data),this.updatePresence3D(this.myParticipant.data)};this.publishClientSyncProperties=()=>{this.state===4&&Object.keys(this.clientSyncPropertiesQueue).forEach(t=>{if(this.clientSyncPropertiesQueue[t]=this.clientSyncPropertiesQueue[t].sort((l,c)=>l.timestamp-c.timestamp),!this.clientSyncPropertiesQueue[t].length)return;let{data:n,lengthToBeSplitted:r}=this.spliceArrayBySize(this.clientSyncPropertiesQueue[t]),a=n;this.clientSyncPropertiesQueue[t].splice(0,r),this.clientSyncChannel.publish(t,a,l=>{!l||this.logger.log("REALTIME","Error in publish client sync properties",l.message)})})};this.saveClientRoomState=(t,n)=>Lt(this,null,function*(){let r=yield this.fetchSyncClientProperty();this.clientRoomState=Object.assign({},r,{[t]:n[n.length-1]}),this.clientRoomStateChannel.publish("update",this.clientRoomState),this.logger.log("REALTIME","setting new room state backup",this.clientRoomState)});this.updateLocalRoomState=t=>Lt(this,null,function*(){this.localRoomProperties=Object.assign({},this.localRoomProperties,t),this.roomInfoUpdatedObserver.publish(this.localRoomProperties),this.updateParticipants(),t.kickParticipant&&t.kickParticipant.clientId===this.myParticipant.clientId&&(this.updateRoomProperties({kickParticipant:null}),this.kickParticipantObserver.publish(this.myParticipant.clientId))});this.updateMyProperties=(t={})=>{let n=t;this.isMessageTooBig(n)||this.left||!this.enableSync||this.isSyncFrozen||(n.avatar===void 0&&delete n.avatar,this.myParticipant.data=lt(lt({},this.myParticipant.data),n),this.isJoinedRoom&&(this.supervizChannel.presence.update(this.myParticipant.data),this.logger.log("REALTIME","updating my properties",this.myParticipant.data)))};this.updateRoomProperties=t=>{if(this.isMessageTooBig(t)||this.isSyncFrozen||this.left)return;let n=lt(lt({},this.localRoomProperties),t);this.supervizChannel.publish("update",n)};this.updateParticipants=()=>{let t={};this.supervizChannel.presence.get((n,r)=>{r.forEach(a=>{t[a.clientId]=lt({},a)}),this.participants=t,this.participantsObserver.publish(this.participants)})};this.initializeRoomProperties=()=>{let t={isGridModeEnable:!1,hostClientId:null,followParticipantId:null,gather:!1,drawing:null};this.updateParticipants(),this.updateRoomProperties(t)};this.findSlotIndex=()=>Lt(this,null,function*(){let t=Math.floor(Math.random()*16);if(yield new Promise(r=>{this.supervizChannel.presence.get((a,l)=>{if(a){r(!0);return}l.forEach(c=>{c.clientId!==this.myParticipant.clientId&&c.data.slotIndex===t&&r(!0)}),r(!1)})})){this.logger.log("slot already taken by someone else, trying again",this.myParticipant.clientId),this.findSlotIndex();return}this.updateMyProperties({slotIndex:t})});this.onParticipantJoin=t=>{this.updateParticipants(),this.participantJoinedObserver.publish(t),this.updateMyProperties(),this.validateSlots()};this.syncBroadcast=(0,Ba.default)(()=>{let t=btoa(this.ablyKey),n=`https://rest.ably.io/channels/${this.roomId.toLowerCase()}/presence`;fetch(n,{headers:{Authorization:`Basic ${t}`}}).then(r=>r.json()).then(r=>{this.broadcastChannel.publish("update",r)})},1e3);this.isMessageTooBig=(t,n=fm)=>{let r=JSON.stringify(t);return new TextEncoder().encode(r).length>n?(this.logger.log("Message too long, the message limit size is 60kb."),!0):!1};this.onCommentsChannelUpdate=t=>{this.logger.log("REALTIME","Comments channel update",t),this.commentsObserver.publish(t)};this.updateComments=t=>{this.commentsChannel.publish("update",t)};this.enterPresenceMouseChannel=t=>{this.presenceMouseChannel||(this.presenceMouseChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-presence-mouse`),this.presenceMouseChannel.attach(),this.presenceMouseChannel.presence.subscribe("enter",this.onPresenceMouseChannelEnter),this.presenceMouseChannel.presence.subscribe("leave",this.onPresenceMouseChannelLeave),this.presenceMouseChannel.presence.subscribe("update",this.publishPresenceMouseUpdate)),this.presenceMouseChannel.presence.enter(t)};this.leavePresenceMouseChannel=()=>{!this.presenceMouseChannel||(this.presenceMouseChannel.presence.leave(),this.presenceMouseChannel=null)};this.updatePresenceMouse=(0,Ba.default)(t=>{let n=Object.assign({},this.participantsMouse[t.id]||{},t);this.presenceMouseChannel.presence.update(n)},$S);this.onPresenceMouseChannelEnter=t=>{let n=this.getParticipantSlot(t.clientId);this.participantsMouse[t.clientId]=Mt(lt({},t.data),{slotIndex:n,color:this.getSlotColor(n).color}),this.presenceMouseParticipantJoinedObserver.publish(this.participantsMouse[t.clientId])};this.onPresenceMouseChannelLeave=t=>{this.presenceMouseParticipantLeaveObserver.publish(this.participantsMouse[t.clientId]),delete this.participantsMouse[t.clientId]};this.publishPresenceMouseUpdate=t=>{let n=this.getParticipantSlot(t.clientId);this.participantsMouse[t.clientId]=Mt(lt({},t.data),{slotIndex:n,color:this.getSlotColor(n).color}),this.presenceMouseObserver.publish(this.participantsMouse)};this.enterWIOChannel=t=>{this.presenceWIOChannel||(this.presenceWIOChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-wio`)),this.presenceWIOChannel.attach(),this.presenceWIOChannel.subscribe("private",this.onSetPrivate),this.presenceWIOChannel.subscribe("follow",this.onSetFollow),this.presenceWIOChannel.subscribe("gather",this.onSetGather)};this.leaveWIOChannel=()=>{!this.presenceWIOChannel||(this.presenceWIOChannel.unsubscribe(),this.presenceWIOChannel.detach(),this.presenceWIOChannel=null)};this.onSetPrivate=({data:{id:t,isPrivate:n}})=>{this.participants[t].data.isPrivate=n,this.privateModeWIOObserver.publish(this.participants)};this.onSetFollow=t=>{this.followWIOObserver.publish(t)};this.onSetGather=({data:t})=>{this.gatherWIOObserver.publish({detail:{id:t.id}})};this.setPrivateWIOParticipant=(t,n)=>{this.presenceWIOChannel.publish("private",{id:t,isPrivate:n})};this.setFollowWIOParticipant=t=>{this.presenceWIOChannel.publish("follow",lt({},t))};this.setGatherWIOParticipant=t=>{this.presenceWIOChannel.publish("gather",lt({},t))};this.leavePresence3DChannel=()=>{!this.presence3DChannel||(this.presence3DChannel.presence.leave(),this.presence3DChannel=null)};this.updatePresence3D=(0,Ba.default)(t=>{var r,a,l;if(!t||!t.id)return;let n=Object.assign({},(a=(r=this.participantsOn3d[t.id])==null?void 0:r.data)!=null?a:{},t);this.participantsOn3d[t.id]=Mt(lt({},this.participants[n.id]),{data:lt(lt({},n),(l=this.participants[n.id])==null?void 0:l.data)}),this.presence3DChannel&&this.presence3DChannel.presence.update(n)},kS);this.onPresence3DChannelEnter=t=>{var r;t.clientId===this.myParticipant.clientId&&(this.isJoinedPresence3D=!0);let n=this.getParticipantSlot(t.clientId);this.presence3dJoinedObserver.publish(Mt(lt({},t),{data:Mt(lt(lt({},t.data),(r=this.participants[t.clientId])==null?void 0:r.data),{slotIndex:n,color:this.getSlotColor(n).color})}))};this.onPresence3DChannelLeave=t=>{delete this.participantsOn3d[t.clientId],this.presence3dLeaveObserver.publish(t)};this.publish3DUpdate=t=>{var a;let n=this.getParticipantSlot(t.clientId),r=Mt(lt({},t),{data:Mt(lt(lt({},t.data),(a=this.participants[t.clientId])==null?void 0:a.data),{slotIndex:n,color:this.getSlotColor(n).color})});this.participantsOn3d[t.clientId]=r,this.participants3DObservers[t.clientId]&&this.participants3DObservers[t.clientId].publish(r),this.presence3dObserver.publish(this.participantsOn3d)};this.ablyKey=n,this.apiUrl=t,this.onAblyPresenceEnter=this.onAblyPresenceEnter.bind(this),this.onAblyPresenceUpdate=this.onAblyPresenceUpdate.bind(this),this.onAblyPresenceLeave=this.onAblyPresenceLeave.bind(this),this.onAblyRoomUpdate=this.onAblyRoomUpdate.bind(this),this.onClientSyncChannelUpdate=this.onClientSyncChannelUpdate.bind(this),this.onAblyChannelStateChange=this.onAblyChannelStateChange.bind(this),this.onAblyConnectionStateChange=this.onAblyConnectionStateChange.bind(this),this.onReceiveBroadcastSync=this.onReceiveBroadcastSync.bind(this),this.getParticipantSlot=this.getParticipantSlot.bind(this),this.auth=this.auth.bind(this),setInterval(()=>{this.publishClientSyncProperties()},1e3)}get roomProperties(){return this.localRoomProperties}get hostClientId(){var t;return(t=this.roomProperties)==null?void 0:t.hostClientId}get isLocalParticipantHost(){return this.hostClientId===this.localParticipantId}get isDomainWhitelisted(){return this.domainWhitelisted}get getParticipants(){return this.participants}get participant(){return this.myParticipant}get localParticipantId(){var t,n;return(n=(t=this.myParticipant.data)==null?void 0:t.participantId)!=null?n:null}get isBroadcast(){return Object.values(this.participants).some(t=>t.data.type==="audience")}start({participant:t,roomId:n,apiKey:r}){this.myParticipant={data:Mt(lt({},t),{participantId:t.id}),timestamp:null,action:null,clientId:t.id,connectionId:null,encoding:null,id:null,extras:null},this.enableSync=t.type!=="audience",this.roomId=`superviz:${n.toLowerCase()}-${r}`,this.apiKey=r,this.client||this.buildClient()}auth(t,n){if(!this.domainWhitelisted)return;let r=new ou.default.Rest({key:this.ablyKey}),{origin:a}=window.location;r.auth.requestToken(t,{authUrl:`${this.apiUrl}/realtime/auth`,key:this.ablyKey,authParams:{domain:a,apiKey:this.apiKey}},(l,c)=>{var u;l&&this.authenticationObserver.publish("realtime.authentication-failed"),(u=l==null?void 0:l.message)!=null&&u.includes("this domain don't have permission")&&(this.domainWhitelisted=!1),n(l,c)})}join(t){let n=t?Object.assign({},t,{participantId:t.id}):this.myParticipant.data;this.logger.log("REALTIME",`Entering room. Room ID: ${this.roomId}`),this.updateMyProperties(n),this.clientSyncChannel=this.client.channels.get(`${this.roomId}:client-sync`),this.clientSyncChannel.subscribe(this.onClientSyncChannelUpdate),this.clientRoomStateChannel=this.client.channels.get(`${this.roomId}:client-state`),this.broadcastChannel=this.client.channels.get(`${this.roomId}:broadcast`),this.enableSync||this.broadcastChannel.subscribe("update",this.onReceiveBroadcastSync),this.supervizChannel=this.client.channels.get(this.roomId),this.supervizChannel.on(this.onAblyChannelStateChange),this.supervizChannel.subscribe("update",this.onAblyRoomUpdate),this.commentsChannel=this.client.channels.get(`${this.roomId}:comments`),this.commentsChannel.subscribe("update",this.onCommentsChannelUpdate),this.supervizChannel.presence.subscribe("enter",this.onAblyPresenceEnter),this.enableSync&&this.supervizChannel.presence.subscribe("update",this.onAblyPresenceUpdate),this.supervizChannel.presence.subscribe("leave",this.onAblyPresenceLeave),this.supervizChannel.presence.enter(this.myParticipant.data)}leave(){this.logger.log("REALTIME","Disconnecting from ably servers"),this.supervizChannel.presence.leave(),this.client.close(),this.isJoinedRoom=!1,this.isReconnecting=!1,this.roomId=null,this.participants={},this.hostParticipantId=null,this.myParticipant=null,this.supervizChannel=null,this.clientSyncChannel=null,this.client=null,this.left=!0}setGridMode(t){let n=this.localRoomProperties;this.updateRoomProperties(Object.assign({},n,{isGridModeEnable:t}))}setDrawing(t){let n=this.localRoomProperties;this.updateRoomProperties(Object.assign({},n,{drawing:t}))}setTranscript(t){let n=this.localRoomProperties;this.updateRoomProperties(Object.assign({},n,{transcript:t}))}setSyncProperty(t,n){let r=(a,l)=>({name:a,data:l,participantId:this.myParticipant.data.participantId,timestamp:Date.now()});this.isMessageTooBig(r(t,n),BS)&&(this.logger.log("REALTIME","Message too big, not sending"),this.throw("Message too long, the message limit size is 10kb.")),this.logger.log("adding to queue",t,n),this.clientSyncPropertiesQueue[t]||(this.clientSyncPropertiesQueue[t]=[]),this.clientSyncPropertiesQueue[t].push(r(t,n))}setFollowParticipant(t){this.updateRoomProperties({followParticipantId:t})}setGather(t){this.updateRoomProperties({gather:t})}getParticipantSlot(t){var n,r;if(t){let a=t.toString();if(this.participants&&this.participants[a])return(r=(n=this.participants[t])==null?void 0:n.data)==null?void 0:r.slotIndex}return 16}onAblyPresenceEnter(t){if(t.clientId===this.myParticipant.data.participantId&&this.isJoinedRoom){this.sameAccountObserver.publish(!0);return}t.clientId===this.myParticipant.data.participantId?this.onJoinRoom(t):this.onParticipantJoin(t)}onAblyPresenceUpdate(t){if(!this.isJoinedRoom)return;let{clientId:n}=t,r=Object.assign({},t,{participantId:t.clientId});this.publishParticipantUpdate(r),this.participants&&this.participants[n]&&this.hostParticipantId===this.localParticipantId&&this.isBroadcast&&this.syncBroadcast()}onAblyPresenceLeave(t){this.onParticipantLeave(t)}onClientSyncChannelUpdate(t){let{name:n,data:r}=t,a={};a[n]=r,this.syncPropertiesObserver.publish(a),t.clientId===this.myParticipant.data.participantId&&this.saveClientRoomState(n,r)}onReceiveBroadcastSync(t){t.data.forEach(r=>{var l;let a=r.clientId;this.participants[a]=r,(l=r.data)!=null&&l.isAudience||(this.participants[a].data=JSON.parse(this.participants[a].data),this.publishParticipantUpdate(this.participants[a]))})}onAblyRoomUpdate(t){this.logger.log("REALTIME","Room update received",t.data),this.updateLocalRoomState(t.data)}buildClient(){this.client&&this.throw("Tried to call buildClient@Ably is already initialized");let t={key:this.ablyKey,disconnectedRetryTimeout:5e3,suspendedRetryTimeout:5e3,clientId:this.myParticipant.data.participantId,authCallback:this.auth};this.client=new ou.default.Realtime(t),this.client.connection.on(this.onAblyConnectionStateChange)}publishParticipantUpdate(t){this.participants[t.clientId]=t,this.participantsObserver.publish(this.participants),this.participantObservers[t.clientId]&&this.participantObservers[t.clientId].publish(t)}forceReconnect(){if(this.logger.log("REALTIME",`RECONNECT: Starting force realtime reconnect | Current attempt: ${this.currentReconnectAttempt}`),this.roomId||this.throw("Tried to reconnect without roomId set"),this.state===2){this.logger.log("REALTIME","Rejoining room since client already connected to ably servers."),this.join();return}this.logger.log("REALTIME","RECONNECT: Restarting ably server since participant lost connection."),this.buildClient(),this.updateMyProperties(this.myParticipant.data)}throw(t){throw this.logger.log(t),new Error(t)}publishStateUpdate(t){this.state!==t&&(this.state=t,this.logger.log("REALTIME",`Realtime state did change. New state: ${ru[this.state]}`),this.realtimeStateObserver.publish(this.state))}fetchRoomProperties(){return new Promise((t,n)=>{this.supervizChannel.history((r,a)=>{var c;r&&n(r);let l=(c=a.items[0])==null?void 0:c.data;t(l||null)})})}fetchSyncClientProperty(t){return Lt(this,null,function*(){try{let n=yield new Promise((r,a)=>{this.clientRoomStateChannel.history((l,c)=>{var m;l&&a(l);let u=(m=c==null?void 0:c.items[0])==null?void 0:m.data;r(u||null)})});if(t&&!n[t])throw new Error(`Event ${t} not found in the history`);return t?n[t]:n}catch(n){this.logger.log("REALTIME","Error in fetch client realtime data",n.message),this.throw(n.message)}})}validateSlots(){return Lt(this,null,function*(){let t=[];yield new Promise(r=>{this.supervizChannel.presence.get((a,l)=>{l.forEach(c=>{c.data.slotIndex!==void 0&&c.data.slotIndex!==null&&t.push({slotIndex:c.data.slotIndex,clientId:c.clientId,timestamp:c.timestamp})}),r(!0)})});let n={};t.forEach(r=>{n[r.slotIndex]||(n[r.slotIndex]=[]),n[r.slotIndex].push(r)}),Object.values(n).forEach(r=>{let a=r.sort((l,c)=>l.timestamp-c.timestamp);a.shift(),a.forEach(l=>{l.clientId===this.myParticipant.clientId&&this.findSlotIndex()})})})}onStateChange(){var g,E,h;let t=(g=this.supervizChannelState)==null?void 0:g.current,n=(E=this.connectionState)==null?void 0:E.current,r=n==="connected",a=["initialized","connecting"].includes(n),l=["closed","closing"].includes(n)||["detaching","detached"].includes(t),c={[0]:l,[1]:a,[2]:!t&&r,[3]:t==="attaching",[4]:t==="attached"&&r,[-1]:t==="failed"||n==="failed",[-2]:n==="suspended"||t==="suspended"},u=Object.entries(c).find(([y,O])=>O&&y)[0],m=Number(u);if(!!this.domainWhitelisted){if(m===2&&(this.currentReconnectAttempt=0),r&&this.isReconnecting&&this.onJoinRoom(this.participant),(m===-2||m===-1)&&this.forceReconnect(),(h=this.connectionState)!=null&&h.retryIn){this.currentReconnectAttempt++,this.isReconnecting=!0,this.publishStateUpdate(-2),this.reconnectObserver.publish(this.currentReconnectAttempt);return}this.publishStateUpdate(m)}}onAblyConnectionStateChange(t){this.connectionState=t,this.onStateChange()}onAblyChannelStateChange(t){this.supervizChannelState=t,this.onStateChange()}onJoinRoom(t){return Lt(this,null,function*(){this.isJoinedRoom=!0,this.localRoomProperties=yield this.fetchRoomProperties(),this.myParticipant=t,this.enableSync&&this.findSlotIndex(),this.localRoomProperties?(this.updateParticipants(),this.localRoomProperties=yield this.fetchRoomProperties(),this.updateLocalRoomState(this.localRoomProperties)):this.initializeRoomProperties(),this.isReconnecting=!1,this.publishStateUpdate(4),this.participantJoinedObserver.publish(t),this.logger.log("REALTIME","Joined realtime room")})}onParticipantLeave(t){if(this.state===2)return;t.data.participantId===this.localRoomProperties.followParticipantId&&this.setFollowParticipant(),this.participantLeaveObserver.publish(t),this.updateParticipants()}spliceArrayBySize(t,n=fm){let r=u=>{let m=JSON.stringify(u);return new TextEncoder().encode(m).length},a=0,l=[],c=[];for(let u=0;u<t.length;u++){let m=r(t[u]);a+m<=n?(c.push(t[u]),a+=m):(l.push(c),c=[t[u]],a=m)}return c.length>0&&l.push(c),{data:l[0],lengthToBeSplitted:l[0].length}}enterPresence3DChannel(t){if(!this.isJoinedRoom){this.logger.log("REALTIME","Cannot enter presence 3D channel because the participant is not in the room"),setTimeout(()=>{this.enterPresence3DChannel(t)},1e3);return}this.presence3DChannel||(this.presence3DChannel=this.client.channels.get(`${this.roomId.toLowerCase()}-presence-3d`),this.presence3DChannel.attach(),this.presence3DChannel.presence.subscribe("enter",this.onPresence3DChannelEnter),this.presence3DChannel.presence.subscribe("leave",this.onPresence3DChannelLeave),this.presence3DChannel.presence.subscribe("update",this.publish3DUpdate)),this.presence3DChannel.presence.enter(t)}};L();var au=class extends Si{constructor({participant:t,group:n}){super();this.isDestroyed=!1;this.activeComponents=[];this.componentsToAttachAfterJoin=[];this.activeComponentsInstances=[];this.eventBus=new ko;this.participants=[];this.addComponent=t=>{if(!!this.canAddComponent(t)){if(!this.realtime.isJoinedRoom){this.logger.log("launcher service @ addComponent - not joined yet"),this.componentsToAttachAfterJoin.push(t);return}t.attach({localParticipant:this.participant,realtime:this.realtime,group:this.group,config:wt.configuration,eventBus:this.eventBus}),this.activeComponents.push(t.name),this.activeComponentsInstances.push(t),this.realtime.updateMyProperties({activeComponents:this.activeComponents}),ce.sendActivity(this.participant.id,this.group.id,this.group.name,t.name)}};this.attachComponentsAfterJoin=()=>{this.logger.log("launcher service @ attachComponentsAfterJoin"),this.componentsToAttachAfterJoin.forEach(t=>{this.logger.log("launcher service @ attachComponentsAfterJoin - attaching component",t.name),this.addComponent(t)}),this.componentsToAttachAfterJoin=[]};this.removeComponent=t=>{if(!this.activeComponents.includes(t.name)){let n=`Component ${t.name} is not initialized yet.`;this.logger.log(n);return}t.detach(),this.activeComponentsInstances=this.activeComponentsInstances.filter(n=>n.name!==t.name),this.activeComponents.splice(this.activeComponents.indexOf(t.name),1),this.realtime.updateMyProperties({activeComponents:this.activeComponents})};this.destroy=()=>{this.logger.log("launcher service @ destroy"),this.activeComponentsInstances.forEach(t=>{this.logger.log("launcher service @ destroy - removing component",t.name),this.removeComponent(t)}),this.activeComponents=[],this.activeComponentsInstances=[],this.participant=void 0,this.eventBus.destroy(),this.eventBus=void 0,this.realtime.authenticationObserver.unsubscribe(this.onAuthentication),this.realtime.sameAccountObserver.unsubscribe(this.onSameAccount),this.realtime.participantJoinedObserver.unsubscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.unsubscribe(this.onParticipantLeave),this.realtime.participantsObserver.unsubscribe(this.onParticipantListUpdate),this.realtime.leave(),this.realtime=void 0,this.isDestroyed=!0,window.SUPERVIZ=void 0};this.canAddComponent=t=>{let n=$o.checkComponentLimit(t.name),r=this.activeComponents.includes(t.name),a=[{isValid:!this.isDestroyed,message:"Component can not be added because the superviz room is destroyed. Initialize a new room to add and use components."},{isValid:!r,message:`Component ${t.name} is already active. Please remove it first`},{isValid:n,message:`You reached the limit usage of ${t.name}`}];for(let l=0;l<a.length;l++){let{isValid:c,message:u}=a[l];if(!c)return this.logger.log(u),!1}return!0};this.startRealtime=()=>{this.logger.log("launcher service @ startRealtime"),this.realtime.start({participant:this.participant,apiKey:wt.get("apiKey"),roomId:wt.get("roomId")}),this.realtime.join(),this.subscribeToRealtimeEvents()};this.subscribeToRealtimeEvents=()=>{this.realtime.authenticationObserver.subscribe(this.onAuthentication),this.realtime.sameAccountObserver.subscribe(this.onSameAccount),this.realtime.participantJoinedObserver.subscribe(this.onParticipantJoined),this.realtime.participantLeaveObserver.subscribe(this.onParticipantLeave),this.realtime.participantsObserver.subscribe(this.onParticipantListUpdate)};this.onAuthentication=t=>{t==="realtime.authentication-failed"&&this.destroy()};this.onParticipantListUpdate=t=>{var a;this.logger.log("launcher service @ onParticipantListUpdate",t);let n=Object.values(t).map(l=>{var c,u,m,g,E,h;return{id:l.data.id,name:(c=l.data)==null?void 0:c.name,type:(u=l.data)==null?void 0:u.type,avatar:(m=l.data)==null?void 0:m.avatar,avatarConfig:(g=l.data)==null?void 0:g.avatarConfig,isHost:this.realtime.hostClientId===l.clientId,color:this.realtime.getSlotColor((E=l.data)==null?void 0:E.slotIndex).color,activeComponents:(h=l.data)==null?void 0:h.activeComponents}}),r=n.find(l=>{var c;return(l==null?void 0:l.id)===((c=this.participant)==null?void 0:c.id)});(0,su.isEqual)(this.participants,n)||(this.participants=n,this.publish("participant.list-updated",n),this.logger.log("Publishing ParticipantEvent.LIST_UPDATED",n)),r&&!(0,su.isEqual)(this.participant,r)&&(this.activeComponents=(a=r.activeComponents)!=null?a:[],this.activeComponentsInstances=this.activeComponentsInstances.filter(l=>r.activeComponents?this.activeComponents.includes(l.name):!0),this.participant=r,this.publish("participant.updated",r),this.logger.log("Publishing ParticipantEvent.UPDATED",r)),this.logger.log("launcher service @ onParticipantListUpdate - participants updated",n)};this.onParticipantJoined=t=>{this.logger.log("launcher service @ onParticipantJoined");let n=this.participants.find(r=>r.id===t.data.id);!n||(n.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantJoined - local participant joined"),this.publish("participant.local-joined",n),this.attachComponentsAfterJoin()),this.logger.log("launcher service @ onParticipantJoined - participant joined",n),this.publish("participant.joined",n))};this.onParticipantLeave=t=>{this.logger.log("launcher service @ onParticipantLeave");let n=this.participants.find(r=>r.id===t.data.id);!n||(n.id===this.participant.id&&(this.logger.log("launcher service @ onParticipantLeave - local participant left"),this.publish("participant.local-left",n)),this.logger.log("launcher service @ onParticipantLeave - participant left",n),this.publish("participant.left",n))};this.onSameAccount=()=>{this.publish("participant.same-account-error"),this.destroy()};this.participant=Mt(lt({},t),{type:"guest"}),this.group=n,this.logger=new Kt("@superviz/sdk/launcher"),this.realtime=new Mr(wt.get("apiUrl"),wt.get("ablyKey")),this.eventBus=new ko,this.logger.log("launcher created"),this.startRealtime()}},hm=s=>{if(window.SUPERVIZ)return{destroy:window.SUPERVIZ.destroy,subscribe:window.SUPERVIZ.subscribe,unsubscribe:window.SUPERVIZ.unsubscribe,addComponent:window.SUPERVIZ.addComponent,removeComponent:window.SUPERVIZ.removeComponent};let e=new au(s);return window.SUPERVIZ=e,{destroy:e.destroy,subscribe:e.subscribe,unsubscribe:e.unsubscribe,addComponent:e.addComponent,removeComponent:e.removeComponent}};var US=({group:s,participant:e,roomId:t,customColors:n})=>{if(n&&HS(n),!s||!s.name||!s.id)throw new Error("Group fields is required");if(!e||!e.id||!e.name)throw new Error("Participant name and id is required");if(!t)throw new Error("Room id is required")},HS=s=>{Object.entries(s).forEach(([e,t])=>{if(!Object.values(nu).includes(e))throw new Error(`Color ${e} is not a valid color variable name. Please check the documentation for more information.`);if(!/^(\d{1,3}\s){2}\d{1,3}$/.test(t))throw new Error(`Color ${e} is not a valid color variable value. Please check the documentation for more information.`)})},GS=s=>{!s||Object.entries(s).forEach(([e,t])=>{let n=t.replace(/\s/g,", ");document.documentElement.style.setProperty(`--${e}`,n)})},WS=(s,e)=>Lt(void 0,null,function*(){var y;if(!(s&&s.trim()))throw new Error("API key is required");if(!e)throw new Error("Options is required");US(e),e.debug?lu.debug.enable("*"):lu.debug.disable();let{apiUrl:n,conferenceLayerUrl:r}=yield Ir.getRemoteConfig(e.environment);if(!(yield sm(n,s)))throw new Error("Failed to validate API key");let[l,c,u]=yield Promise.all([ce.fetchConfig(n,s),ce.fetchLimits(n,s),ce.fetchWaterMark(n,s)]).catch(()=>{throw new Error("Failed to load configuration from server")});if(!l||!l.ablyKey)throw new Error("Failed to load configuration from server");let{ablyKey:m}=l,{participant:g,roomId:E,customColors:h}=e;return wt.setConfig({apiUrl:n,ablyKey:m,apiKey:s,conferenceLayerUrl:r,environment:l,roomId:E,debug:e.debug,limits:c,waterMark:u,colors:e.customColors}),GS(e.customColors),ce.createOrUpdateParticipant({name:g.name,participantId:g.id,avatar:(y=g.avatar)==null?void 0:y.imageUrl}),hm(e)}),cu=WS;L();L();L();L();L();var ka=globalThis,Ua=ka.ShadowRoot&&(ka.ShadyCSS===void 0||ka.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,mm=Symbol(),pm=new WeakMap,$a=class{constructor(e,t,n){if(this._$cssResult$=!0,n!==mm)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o,t=this.t;if(Ua&&e===void 0){let n=t!==void 0&&t.length===1;n&&(e=pm.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&pm.set(t,e))}return e}toString(){return this.cssText}},gm=s=>new $a(typeof s=="string"?s:s+"",void 0,mm);var uu=(s,e)=>{if(Ua)s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(let t of e){let n=document.createElement("style"),r=ka.litNonce;r!==void 0&&n.setAttribute("nonce",r),n.textContent=t.cssText,s.appendChild(n)}},Ha=Ua?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(let n of e.cssRules)t+=n.cssText;return gm(t)})(s):s;var{is:zS,defineProperty:VS,getOwnPropertyDescriptor:jS,getOwnPropertyNames:JS,getOwnPropertySymbols:KS,getPrototypeOf:qS}=Object,ri=globalThis,vm=ri.trustedTypes,ZS=vm?vm.emptyScript:"",du=ri.reactiveElementPolyfillSupport,Uo=(s,e)=>s,Ga={toAttribute(s,e){switch(e){case Boolean:s=s?ZS:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch(n){t=null}}return t}},fu=(s,e)=>!zS(s,e),ym={attribute:!0,type:String,converter:Ga,reflect:!1,hasChanged:fu},bm,Em;(bm=Symbol.metadata)!=null||(Symbol.metadata=Symbol("metadata")),(Em=ri.litPropertyMetadata)!=null||(ri.litPropertyMetadata=new WeakMap);var _i=class extends HTMLElement{static addInitializer(e){var t;this._$Ei(),((t=this.l)!=null?t:this.l=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=ym){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){let n=Symbol(),r=this.getPropertyDescriptor(e,n,t);r!==void 0&&VS(this.prototype,e,r)}}static getPropertyDescriptor(e,t,n){var l;let{get:r,set:a}=(l=jS(this.prototype,e))!=null?l:{get(){return this[t]},set(c){this[t]=c}};return{get(){return r==null?void 0:r.call(this)},set(c){let u=r==null?void 0:r.call(this);a.call(this,c),this.requestUpdate(e,u,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){var t;return(t=this.elementProperties.get(e))!=null?t:ym}static _$Ei(){if(this.hasOwnProperty(Uo("elementProperties")))return;let e=qS(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(Uo("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Uo("properties"))){let t=this.properties,n=[...JS(t),...KS(t)];for(let r of n)this.createProperty(r,t[r])}let e=this[Symbol.metadata];if(e!==null){let t=litPropertyMetadata.get(e);if(t!==void 0)for(let[n,r]of t)this.elementProperties.set(n,r)}this._$Eh=new Map;for(let[t,n]of this.elementProperties){let r=this._$Eu(t,n);r!==void 0&&this._$Eh.set(r,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){let t=[];if(Array.isArray(e)){let n=new Set(e.flat(1/0).reverse());for(let r of n)t.unshift(Ha(r))}else e!==void 0&&t.push(Ha(e));return t}static _$Eu(e,t){let n=t.attribute;return n===!1?void 0:typeof n=="string"?n:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$Eg=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(t=>t(this))}addController(e){var t,n;((t=this._$ES)!=null?t:this._$ES=[]).push(e),this.renderRoot!==void 0&&this.isConnected&&((n=e.hostConnected)==null||n.call(e))}removeController(e){var t;(t=this._$ES)==null||t.splice(this._$ES.indexOf(e)>>>0,1)}_$E_(){let e=new Map,t=this.constructor.elementProperties;for(let n of t.keys())this.hasOwnProperty(n)&&(e.set(n,this[n]),delete this[n]);e.size>0&&(this._$Ep=e)}createRenderRoot(){var t;let e=(t=this.shadowRoot)!=null?t:this.attachShadow(this.constructor.shadowRootOptions);return uu(e,this.constructor.elementStyles),e}connectedCallback(){var e,t;(e=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$ES)==null||t.forEach(n=>{var r;return(r=n.hostConnected)==null?void 0:r.call(n)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$ES)==null||e.forEach(t=>{var n;return(n=t.hostDisconnected)==null?void 0:n.call(t)})}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$EO(e,t){var a;let n=this.constructor.elementProperties.get(e),r=this.constructor._$Eu(e,n);if(r!==void 0&&n.reflect===!0){let l=(((a=n.converter)==null?void 0:a.toAttribute)!==void 0?n.converter:Ga).toAttribute(t,n.type);this._$Em=e,l==null?this.removeAttribute(r):this.setAttribute(r,l),this._$Em=null}}_$AK(e,t){var a;let n=this.constructor,r=n._$Eh.get(e);if(r!==void 0&&this._$Em!==r){let l=n.getPropertyOptions(r),c=typeof l.converter=="function"?{fromAttribute:l.converter}:((a=l.converter)==null?void 0:a.fromAttribute)!==void 0?l.converter:Ga;this._$Em=r,this[r]=c.fromAttribute(t,l.type),this._$Em=null}}requestUpdate(e,t,n,r=!1,a){var l;if(e!==void 0){if(n!=null||(n=this.constructor.getPropertyOptions(e)),!((l=n.hasChanged)!=null?l:fu)(r?a:this[e],t))return;this.C(e,t,n)}this.isUpdatePending===!1&&(this._$Eg=this._$EP())}C(e,t,n){var r;this._$AL.has(e)||this._$AL.set(e,t),n.reflect===!0&&this._$Em!==e&&((r=this._$Ej)!=null?r:this._$Ej=new Set).add(e)}_$EP(){return Lt(this,null,function*(){this.isUpdatePending=!0;try{yield this._$Eg}catch(t){Promise.reject(t)}let e=this.scheduleUpdate();return e!=null&&(yield e),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var n;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this._$Ep){for(let[a,l]of this._$Ep)this[a]=l;this._$Ep=void 0}let r=this.constructor.elementProperties;if(r.size>0)for(let[a,l]of r)l.wrapped!==!0||this._$AL.has(a)||this[a]===void 0||this.C(a,this[a],l)}let e=!1,t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),(n=this._$ES)==null||n.forEach(r=>{var a;return(a=r.hostUpdate)==null?void 0:a.call(r)}),this.update(t)):this._$ET()}catch(r){throw e=!1,this._$ET(),r}e&&this._$AE(t)}willUpdate(e){}_$AE(e){var t;(t=this._$ES)==null||t.forEach(n=>{var r;return(r=n.hostUpdated)==null?void 0:r.call(n)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$ET(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Eg}shouldUpdate(e){return!0}update(e){this._$Ej&&(this._$Ej=this._$Ej.forEach(t=>this._$EO(t,this[t]))),this._$ET()}updated(e){}firstUpdated(e){}},Am;_i.elementStyles=[],_i.shadowRootOptions={mode:"open"},_i[Uo("elementProperties")]=new Map,_i[Uo("finalized")]=new Map,du==null||du({ReactiveElement:_i}),((Am=ri.reactiveElementVersions)!=null?Am:ri.reactiveElementVersions=[]).push("2.0.0");L();var Go=globalThis,Wa=Go.trustedTypes,wm=Wa?Wa.createPolicy("lit-html",{createHTML:s=>s}):void 0,mu="$lit$",Un=`lit$${(Math.random()+"").slice(9)}$`,gu="?"+Un,YS=`<${gu}>`,Ii=document,za=()=>Ii.createComment(""),Wo=s=>s===null||typeof s!="object"&&typeof s!="function",Pm=Array.isArray,Im=s=>Pm(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",hu=`[ 	
\f\r]`,Ho=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Tm=/-->/g,Cm=/>/g,xi=RegExp(`>|${hu}(?:([^\\s"'>=/]+)(${hu}*=${hu}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Sm=/'/g,Om=/"/g,Mm=/^(?:script|style|textarea|title)$/i,Rm=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),iM=Rm(1),rM=Rm(2),Hn=Symbol.for("lit-noChange"),xe=Symbol.for("lit-nothing"),_m=new WeakMap,Pi=Ii.createTreeWalker(Ii,129);function Lm(s,e){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return wm!==void 0?wm.createHTML(e):e}var Dm=(s,e)=>{let t=s.length-1,n=[],r,a=e===2?"<svg>":"",l=Ho;for(let c=0;c<t;c++){let u=s[c],m,g,E=-1,h=0;for(;h<u.length&&(l.lastIndex=h,g=l.exec(u),g!==null);)h=l.lastIndex,l===Ho?g[1]==="!--"?l=Tm:g[1]!==void 0?l=Cm:g[2]!==void 0?(Mm.test(g[2])&&(r=RegExp("</"+g[2],"g")),l=xi):g[3]!==void 0&&(l=xi):l===xi?g[0]===">"?(l=r!=null?r:Ho,E=-1):g[1]===void 0?E=-2:(E=l.lastIndex-g[2].length,m=g[1],l=g[3]===void 0?xi:g[3]==='"'?Om:Sm):l===Om||l===Sm?l=xi:l===Tm||l===Cm?l=Ho:(l=xi,r=void 0);let y=l===xi&&s[c+1].startsWith("/>")?" ":"";a+=l===Ho?u+YS:E>=0?(n.push(m),u.slice(0,E)+mu+u.slice(E)+Un+y):u+Un+(E===-2?c:y)}return[Lm(s,a+(s[t]||"<?>")+(e===2?"</svg>":"")),n]},Mi=class{constructor({strings:e,_$litType$:t},n){let r;this.parts=[];let a=0,l=0,c=e.length-1,u=this.parts,[m,g]=Dm(e,t);if(this.el=Mi.createElement(m,n),Pi.currentNode=this.el.content,t===2){let E=this.el.content.firstChild;E.replaceWith(...E.childNodes)}for(;(r=Pi.nextNode())!==null&&u.length<c;){if(r.nodeType===1){if(r.hasAttributes())for(let E of r.getAttributeNames())if(E.endsWith(mu)){let h=g[l++],y=r.getAttribute(E).split(Un),O=/([.?@])?(.*)/.exec(h);u.push({type:1,index:a,name:O[2],strings:y,ctor:O[1]==="."?ja:O[1]==="?"?Ja:O[1]==="@"?Ka:Di}),r.removeAttribute(E)}else E.startsWith(Un)&&(u.push({type:6,index:a}),r.removeAttribute(E));if(Mm.test(r.tagName)){let E=r.textContent.split(Un),h=E.length-1;if(h>0){r.textContent=Wa?Wa.emptyScript:"";for(let y=0;y<h;y++)r.append(E[y],za()),Pi.nextNode(),u.push({type:2,index:++a});r.append(E[h],za())}}}else if(r.nodeType===8)if(r.data===gu)u.push({type:2,index:a});else{let E=-1;for(;(E=r.data.indexOf(Un,E+1))!==-1;)u.push({type:7,index:a}),E+=Un.length-1}a++}}static createElement(e,t){let n=Ii.createElement("template");return n.innerHTML=e,n}};function Ri(s,e,t=s,n){var l,c,u;if(e===Hn)return e;let r=n!==void 0?(l=t._$Co)==null?void 0:l[n]:t._$Cl,a=Wo(e)?void 0:e._$litDirective$;return(r==null?void 0:r.constructor)!==a&&((c=r==null?void 0:r._$AO)==null||c.call(r,!1),a===void 0?r=void 0:(r=new a(s),r._$AT(s,t,n)),n!==void 0?((u=t._$Co)!=null?u:t._$Co=[])[n]=r:t._$Cl=r),r!==void 0&&(e=Ri(s,r._$AS(s,e.values),r,n)),e}var Va=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var m;let{el:{content:t},parts:n}=this._$AD,r=((m=e==null?void 0:e.creationScope)!=null?m:Ii).importNode(t,!0);Pi.currentNode=r;let a=Pi.nextNode(),l=0,c=0,u=n[0];for(;u!==void 0;){if(l===u.index){let g;u.type===2?g=new Li(a,a.nextSibling,this,e):u.type===1?g=new u.ctor(a,u.name,u.strings,this,e):u.type===6&&(g=new qa(a,this,e)),this._$AV.push(g),u=n[++c]}l!==(u==null?void 0:u.index)&&(a=Pi.nextNode(),l++)}return Pi.currentNode=Ii,r}p(e){let t=0;for(let n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}},Li=class{get _$AU(){var e,t;return(t=(e=this._$AM)==null?void 0:e._$AU)!=null?t:this._$Cv}constructor(e,t,n,r){var a;this.type=2,this._$AH=xe,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=r,this._$Cv=(a=r==null?void 0:r.isConnected)!=null?a:!0}get parentNode(){let e=this._$AA.parentNode,t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Ri(this,e,t),Wo(e)?e===xe||e==null||e===""?(this._$AH!==xe&&this._$AR(),this._$AH=xe):e!==this._$AH&&e!==Hn&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):Im(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==xe&&Wo(this._$AH)?this._$AA.nextSibling.data=e:this.$(Ii.createTextNode(e)),this._$AH=e}g(e){var a;let{values:t,_$litType$:n}=e,r=typeof n=="number"?this._$AC(e):(n.el===void 0&&(n.el=Mi.createElement(Lm(n.h,n.h[0]),this.options)),n);if(((a=this._$AH)==null?void 0:a._$AD)===r)this._$AH.p(t);else{let l=new Va(r,this),c=l.u(this.options);l.p(t),this.$(c),this._$AH=l}}_$AC(e){let t=_m.get(e.strings);return t===void 0&&_m.set(e.strings,t=new Mi(e)),t}T(e){Pm(this._$AH)||(this._$AH=[],this._$AR());let t=this._$AH,n,r=0;for(let a of e)r===t.length?t.push(n=new Li(this.k(za()),this.k(za()),this,this.options)):n=t[r],n._$AI(a),r++;r<t.length&&(this._$AR(n&&n._$AB.nextSibling,r),t.length=r)}_$AR(e=this._$AA.nextSibling,t){var n;for((n=this._$AP)==null?void 0:n.call(this,!1,!0,t);e&&e!==this._$AB;){let r=e.nextSibling;e.remove(),e=r}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}},Di=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,n,r,a){this.type=1,this._$AH=xe,this._$AN=void 0,this.element=e,this.name=t,this._$AM=r,this.options=a,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=xe}_$AI(e,t=this,n,r){let a=this.strings,l=!1;if(a===void 0)e=Ri(this,e,t,0),l=!Wo(e)||e!==this._$AH&&e!==Hn,l&&(this._$AH=e);else{let c=e,u,m;for(e=a[0],u=0;u<a.length-1;u++)m=Ri(this,c[n+u],t,u),m===Hn&&(m=this._$AH[u]),l||(l=!Wo(m)||m!==this._$AH[u]),m===xe?e=xe:e!==xe&&(e+=(m!=null?m:"")+a[u+1]),this._$AH[u]=m}l&&!r&&this.j(e)}j(e){e===xe?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e!=null?e:"")}},ja=class extends Di{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===xe?void 0:e}},Ja=class extends Di{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==xe)}},Ka=class extends Di{constructor(e,t,n,r,a){super(e,t,n,r,a),this.type=5}_$AI(e,t=this){var l;if((e=(l=Ri(this,e,t,0))!=null?l:xe)===Hn)return;let n=this._$AH,r=e===xe&&n!==xe||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,a=e!==xe&&(n===xe||r);r&&this.element.removeEventListener(this.name,this,n),a&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,n;typeof this._$AH=="function"?this._$AH.call((n=(t=this.options)==null?void 0:t.host)!=null?n:this.element,e):this._$AH.handleEvent(e)}},qa=class{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){Ri(this,e)}},Nm={S:mu,A:Un,P:gu,C:1,M:Dm,L:Va,R:Im,V:Ri,D:Li,I:Di,H:Ja,N:Ka,U:ja,B:qa},pu=Go.litHtmlPolyfillSupport,xm;pu==null||pu(Mi,Li),((xm=Go.litHtmlVersions)!=null?xm:Go.litHtmlVersions=[]).push("3.0.0");L();L();L();var Za=globalThis,Ya=Za.ShadowRoot&&(Za.ShadyCSS===void 0||Za.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,vu=Symbol(),Fm=new WeakMap,zo=class{constructor(e,t,n){if(this._$cssResult$=!0,n!==vu)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o,t=this.t;if(Ya&&e===void 0){let n=t!==void 0&&t.length===1;n&&(e=Fm.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&Fm.set(t,e))}return e}toString(){return this.cssText}},Bm=s=>new zo(typeof s=="string"?s:s+"",void 0,vu),xt=(s,...e)=>{let t=s.length===1?s[0]:e.reduce((n,r,a)=>n+(l=>{if(l._$cssResult$===!0)return l.cssText;if(typeof l=="number")return l;throw Error("Value passed to 'css' function must be a 'css' function result: "+l+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(r)+s[a+1],s[0]);return new zo(t,s,vu)},yu=(s,e)=>{if(Ya)s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(let t of e){let n=document.createElement("style"),r=Za.litNonce;r!==void 0&&n.setAttribute("nonce",r),n.textContent=t.cssText,s.appendChild(n)}},Qa=Ya?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(let n of e.cssRules)t+=n.cssText;return Bm(t)})(s):s;var{is:QS,defineProperty:XS,getOwnPropertyDescriptor:tO,getOwnPropertyNames:eO,getOwnPropertySymbols:nO,getPrototypeOf:iO}=Object,oi=globalThis,km=oi.trustedTypes,rO=km?km.emptyScript:"",bu=oi.reactiveElementPolyfillSupport,Vo=(s,e)=>s,Eu={toAttribute(s,e){switch(e){case Boolean:s=s?rO:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch(n){t=null}}return t}},Wm=(s,e)=>!QS(s,e),$m={attribute:!0,type:String,converter:Eu,reflect:!1,hasChanged:Wm},Um,Hm;(Um=Symbol.metadata)!=null||(Symbol.metadata=Symbol("metadata")),(Hm=oi.litPropertyMetadata)!=null||(oi.litPropertyMetadata=new WeakMap);var Gn=class extends HTMLElement{static addInitializer(e){var t;this._$Ei(),((t=this.l)!=null?t:this.l=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=$m){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){let n=Symbol(),r=this.getPropertyDescriptor(e,n,t);r!==void 0&&XS(this.prototype,e,r)}}static getPropertyDescriptor(e,t,n){var l;let{get:r,set:a}=(l=tO(this.prototype,e))!=null?l:{get(){return this[t]},set(c){this[t]=c}};return{get(){return r==null?void 0:r.call(this)},set(c){let u=r==null?void 0:r.call(this);a.call(this,c),this.requestUpdate(e,u,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){var t;return(t=this.elementProperties.get(e))!=null?t:$m}static _$Ei(){if(this.hasOwnProperty(Vo("elementProperties")))return;let e=iO(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(Vo("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Vo("properties"))){let t=this.properties,n=[...eO(t),...nO(t)];for(let r of n)this.createProperty(r,t[r])}let e=this[Symbol.metadata];if(e!==null){let t=litPropertyMetadata.get(e);if(t!==void 0)for(let[n,r]of t)this.elementProperties.set(n,r)}this._$Eh=new Map;for(let[t,n]of this.elementProperties){let r=this._$Eu(t,n);r!==void 0&&this._$Eh.set(r,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){let t=[];if(Array.isArray(e)){let n=new Set(e.flat(1/0).reverse());for(let r of n)t.unshift(Qa(r))}else e!==void 0&&t.push(Qa(e));return t}static _$Eu(e,t){let n=t.attribute;return n===!1?void 0:typeof n=="string"?n:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$Eg=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(t=>t(this))}addController(e){var t,n;((t=this._$ES)!=null?t:this._$ES=[]).push(e),this.renderRoot!==void 0&&this.isConnected&&((n=e.hostConnected)==null||n.call(e))}removeController(e){var t;(t=this._$ES)==null||t.splice(this._$ES.indexOf(e)>>>0,1)}_$E_(){let e=new Map,t=this.constructor.elementProperties;for(let n of t.keys())this.hasOwnProperty(n)&&(e.set(n,this[n]),delete this[n]);e.size>0&&(this._$Ep=e)}createRenderRoot(){var t;let e=(t=this.shadowRoot)!=null?t:this.attachShadow(this.constructor.shadowRootOptions);return yu(e,this.constructor.elementStyles),e}connectedCallback(){var e,t;(e=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$ES)==null||t.forEach(n=>{var r;return(r=n.hostConnected)==null?void 0:r.call(n)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$ES)==null||e.forEach(t=>{var n;return(n=t.hostDisconnected)==null?void 0:n.call(t)})}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$EO(e,t){var a;let n=this.constructor.elementProperties.get(e),r=this.constructor._$Eu(e,n);if(r!==void 0&&n.reflect===!0){let l=(((a=n.converter)==null?void 0:a.toAttribute)!==void 0?n.converter:Eu).toAttribute(t,n.type);this._$Em=e,l==null?this.removeAttribute(r):this.setAttribute(r,l),this._$Em=null}}_$AK(e,t){var a;let n=this.constructor,r=n._$Eh.get(e);if(r!==void 0&&this._$Em!==r){let l=n.getPropertyOptions(r),c=typeof l.converter=="function"?{fromAttribute:l.converter}:((a=l.converter)==null?void 0:a.fromAttribute)!==void 0?l.converter:Eu;this._$Em=r,this[r]=c.fromAttribute(t,l.type),this._$Em=null}}requestUpdate(e,t,n,r=!1,a){var l;if(e!==void 0){if(n!=null||(n=this.constructor.getPropertyOptions(e)),!((l=n.hasChanged)!=null?l:Wm)(r?a:this[e],t))return;this.C(e,t,n)}this.isUpdatePending===!1&&(this._$Eg=this._$EP())}C(e,t,n){var r;this._$AL.has(e)||this._$AL.set(e,t),n.reflect===!0&&this._$Em!==e&&((r=this._$Ej)!=null?r:this._$Ej=new Set).add(e)}_$EP(){return Lt(this,null,function*(){this.isUpdatePending=!0;try{yield this._$Eg}catch(t){Promise.reject(t)}let e=this.scheduleUpdate();return e!=null&&(yield e),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var n;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this._$Ep){for(let[a,l]of this._$Ep)this[a]=l;this._$Ep=void 0}let r=this.constructor.elementProperties;if(r.size>0)for(let[a,l]of r)l.wrapped!==!0||this._$AL.has(a)||this[a]===void 0||this.C(a,this[a],l)}let e=!1,t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),(n=this._$ES)==null||n.forEach(r=>{var a;return(a=r.hostUpdate)==null?void 0:a.call(r)}),this.update(t)):this._$ET()}catch(r){throw e=!1,this._$ET(),r}e&&this._$AE(t)}willUpdate(e){}_$AE(e){var t;(t=this._$ES)==null||t.forEach(n=>{var r;return(r=n.hostUpdated)==null?void 0:r.call(n)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$ET(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Eg}shouldUpdate(e){return!0}update(e){this._$Ej&&(this._$Ej=this._$Ej.forEach(t=>this._$EO(t,this[t]))),this._$ET()}updated(e){}firstUpdated(e){}},Gm;Gn.elementStyles=[],Gn.shadowRootOptions={mode:"open"},Gn[Vo("elementProperties")]=new Map,Gn[Vo("finalized")]=new Map,bu==null||bu({ReactiveElement:Gn}),((Gm=oi.reactiveElementVersions)!=null?Gm:oi.reactiveElementVersions=[]).push("2.0.0");L();var Jo=globalThis,Xa=Jo.trustedTypes,zm=Xa?Xa.createPolicy("lit-html",{createHTML:s=>s}):void 0,Ym="$lit$",si=`lit$${(Math.random()+"").slice(9)}$`,Qm="?"+si,oO=`<${Qm}>`,Bi=document,Ko=()=>Bi.createComment(""),qo=s=>s===null||typeof s!="object"&&typeof s!="function",Xm=Array.isArray,sO=s=>Xm(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",Au=`[ 	
\f\r]`,jo=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Vm=/-->/g,jm=/>/g,Ni=RegExp(`>|${Au}(?:([^\\s"'>=/]+)(${Au}*=${Au}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Jm=/'/g,Km=/"/g,tg=/^(?:script|style|textarea|title)$/i,eg=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),dt=eg(1),uM=eg(2),ki=Symbol.for("lit-noChange"),Pe=Symbol.for("lit-nothing"),qm=new WeakMap,Fi=Bi.createTreeWalker(Bi,129);function ng(s,e){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return zm!==void 0?zm.createHTML(e):e}var aO=(s,e)=>{let t=s.length-1,n=[],r,a=e===2?"<svg>":"",l=jo;for(let c=0;c<t;c++){let u=s[c],m,g,E=-1,h=0;for(;h<u.length&&(l.lastIndex=h,g=l.exec(u),g!==null);)h=l.lastIndex,l===jo?g[1]==="!--"?l=Vm:g[1]!==void 0?l=jm:g[2]!==void 0?(tg.test(g[2])&&(r=RegExp("</"+g[2],"g")),l=Ni):g[3]!==void 0&&(l=Ni):l===Ni?g[0]===">"?(l=r!=null?r:jo,E=-1):g[1]===void 0?E=-2:(E=l.lastIndex-g[2].length,m=g[1],l=g[3]===void 0?Ni:g[3]==='"'?Km:Jm):l===Km||l===Jm?l=Ni:l===Vm||l===jm?l=jo:(l=Ni,r=void 0);let y=l===Ni&&s[c+1].startsWith("/>")?" ":"";a+=l===jo?u+oO:E>=0?(n.push(m),u.slice(0,E)+Ym+u.slice(E)+si+y):u+si+(E===-2?c:y)}return[ng(s,a+(s[t]||"<?>")+(e===2?"</svg>":"")),n]},$i=class{constructor({strings:e,_$litType$:t},n){let r;this.parts=[];let a=0,l=0,c=e.length-1,u=this.parts,[m,g]=aO(e,t);if(this.el=$i.createElement(m,n),Fi.currentNode=this.el.content,t===2){let E=this.el.content.firstChild;E.replaceWith(...E.childNodes)}for(;(r=Fi.nextNode())!==null&&u.length<c;){if(r.nodeType===1){if(r.hasAttributes())for(let E of r.getAttributeNames())if(E.endsWith(Ym)){let h=g[l++],y=r.getAttribute(E).split(si),O=/([.?@])?(.*)/.exec(h);u.push({type:1,index:a,name:O[2],strings:y,ctor:O[1]==="."?Cu:O[1]==="?"?Su:O[1]==="@"?Ou:Lr}),r.removeAttribute(E)}else E.startsWith(si)&&(u.push({type:6,index:a}),r.removeAttribute(E));if(tg.test(r.tagName)){let E=r.textContent.split(si),h=E.length-1;if(h>0){r.textContent=Xa?Xa.emptyScript:"";for(let y=0;y<h;y++)r.append(E[y],Ko()),Fi.nextNode(),u.push({type:2,index:++a});r.append(E[h],Ko())}}}else if(r.nodeType===8)if(r.data===Qm)u.push({type:2,index:a});else{let E=-1;for(;(E=r.data.indexOf(si,E+1))!==-1;)u.push({type:7,index:a}),E+=si.length-1}a++}}static createElement(e,t){let n=Bi.createElement("template");return n.innerHTML=e,n}};function Rr(s,e,t=s,n){var l,c,u;if(e===ki)return e;let r=n!==void 0?(l=t._$Co)==null?void 0:l[n]:t._$Cl,a=qo(e)?void 0:e._$litDirective$;return(r==null?void 0:r.constructor)!==a&&((c=r==null?void 0:r._$AO)==null||c.call(r,!1),a===void 0?r=void 0:(r=new a(s),r._$AT(s,t,n)),n!==void 0?((u=t._$Co)!=null?u:t._$Co=[])[n]=r:t._$Cl=r),r!==void 0&&(e=Rr(s,r._$AS(s,e.values),r,n)),e}var Tu=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var m;let{el:{content:t},parts:n}=this._$AD,r=((m=e==null?void 0:e.creationScope)!=null?m:Bi).importNode(t,!0);Fi.currentNode=r;let a=Fi.nextNode(),l=0,c=0,u=n[0];for(;u!==void 0;){if(l===u.index){let g;u.type===2?g=new Ui(a,a.nextSibling,this,e):u.type===1?g=new u.ctor(a,u.name,u.strings,this,e):u.type===6&&(g=new _u(a,this,e)),this._$AV.push(g),u=n[++c]}l!==(u==null?void 0:u.index)&&(a=Fi.nextNode(),l++)}return Fi.currentNode=Bi,r}p(e){let t=0;for(let n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}},Ui=class{get _$AU(){var e,t;return(t=(e=this._$AM)==null?void 0:e._$AU)!=null?t:this._$Cv}constructor(e,t,n,r){var a;this.type=2,this._$AH=Pe,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=r,this._$Cv=(a=r==null?void 0:r.isConnected)!=null?a:!0}get parentNode(){let e=this._$AA.parentNode,t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Rr(this,e,t),qo(e)?e===Pe||e==null||e===""?(this._$AH!==Pe&&this._$AR(),this._$AH=Pe):e!==this._$AH&&e!==ki&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):sO(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==Pe&&qo(this._$AH)?this._$AA.nextSibling.data=e:this.$(Bi.createTextNode(e)),this._$AH=e}g(e){var a;let{values:t,_$litType$:n}=e,r=typeof n=="number"?this._$AC(e):(n.el===void 0&&(n.el=$i.createElement(ng(n.h,n.h[0]),this.options)),n);if(((a=this._$AH)==null?void 0:a._$AD)===r)this._$AH.p(t);else{let l=new Tu(r,this),c=l.u(this.options);l.p(t),this.$(c),this._$AH=l}}_$AC(e){let t=qm.get(e.strings);return t===void 0&&qm.set(e.strings,t=new $i(e)),t}T(e){Xm(this._$AH)||(this._$AH=[],this._$AR());let t=this._$AH,n,r=0;for(let a of e)r===t.length?t.push(n=new Ui(this.k(Ko()),this.k(Ko()),this,this.options)):n=t[r],n._$AI(a),r++;r<t.length&&(this._$AR(n&&n._$AB.nextSibling,r),t.length=r)}_$AR(e=this._$AA.nextSibling,t){var n;for((n=this._$AP)==null?void 0:n.call(this,!1,!0,t);e&&e!==this._$AB;){let r=e.nextSibling;e.remove(),e=r}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}},Lr=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,n,r,a){this.type=1,this._$AH=Pe,this._$AN=void 0,this.element=e,this.name=t,this._$AM=r,this.options=a,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=Pe}_$AI(e,t=this,n,r){let a=this.strings,l=!1;if(a===void 0)e=Rr(this,e,t,0),l=!qo(e)||e!==this._$AH&&e!==ki,l&&(this._$AH=e);else{let c=e,u,m;for(e=a[0],u=0;u<a.length-1;u++)m=Rr(this,c[n+u],t,u),m===ki&&(m=this._$AH[u]),l||(l=!qo(m)||m!==this._$AH[u]),m===Pe?e=Pe:e!==Pe&&(e+=(m!=null?m:"")+a[u+1]),this._$AH[u]=m}l&&!r&&this.j(e)}j(e){e===Pe?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e!=null?e:"")}},Cu=class extends Lr{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Pe?void 0:e}},Su=class extends Lr{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Pe)}},Ou=class extends Lr{constructor(e,t,n,r,a){super(e,t,n,r,a),this.type=5}_$AI(e,t=this){var l;if((e=(l=Rr(this,e,t,0))!=null?l:Pe)===ki)return;let n=this._$AH,r=e===Pe&&n!==Pe||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,a=e!==Pe&&(n===Pe||r);r&&this.element.removeEventListener(this.name,this,n),a&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,n;typeof this._$AH=="function"?this._$AH.call((n=(t=this.options)==null?void 0:t.host)!=null?n:this.element,e):this._$AH.handleEvent(e)}},_u=class{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){Rr(this,e)}};var wu=Jo.litHtmlPolyfillSupport,Zm;wu==null||wu($i,Ui),((Zm=Jo.litHtmlVersions)!=null?Zm:Jo.litHtmlVersions=[]).push("3.0.0");var ig=(s,e,t)=>{var a,l;let n=(a=t==null?void 0:t.renderBefore)!=null?a:e,r=n._$litPart$;if(r===void 0){let c=(l=t==null?void 0:t.renderBefore)!=null?l:null;n._$litPart$=r=new Ui(e.insertBefore(Ko(),c),c,void 0,t!=null?t:{})}return r._$AI(s),r};var Pt=class extends Gn{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t,n;let e=super.createRenderRoot();return(n=(t=this.renderOptions).renderBefore)!=null||(t.renderBefore=e.firstChild),e}update(e){let t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=ig(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return ki}},rg;Pt._$litElement$=!0,Pt["finalized"]=!0,(rg=globalThis.litElementHydrateSupport)==null||rg.call(globalThis,{LitElement:Pt});var xu=globalThis.litElementPolyfillSupport;xu==null||xu({LitElement:Pt});var og;((og=globalThis.litElementVersions)!=null?og:globalThis.litElementVersions=[]).push("4.0.0");L();L();L();var Ft=s=>(e,t)=>{t!==void 0?t.addInitializer(()=>{customElements.define(s,e)}):customElements.define(s,e)};L();L();L();L();L();L();L();L();L();var Hi=class extends Pt{render(){return dt` <div>Hello from SuperViz, ${this.name}</div> `}};Hi.properties={name:{type:String}},Hi.styles=xt`
    div {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      color: white;
    }
  `,Hi=Nt([Ft("superviz-hello-world")],Hi);L();L();L();L();var Pu=xt`
  * {
    --sv-primary: 98, 16, 204;
    --sv-primary-900: 56, 7, 136;
    --sv-primary-200: 193, 161, 234;
    --sv-secondary: 193, 251, 223;
    --sv-gray: 126, 122, 136;
    --sv-success: 12, 185, 71;
    --sv-danger: 229, 65, 30;
    --sv-black: 19, 18, 21;
    --sv-white: 255, 255, 255;
    --sv-gray-100: 250, 250, 252;
    --sv-gray-200: 233, 229, 239;
    --sv-gray-300: 201, 196, 209;
    --sv-gray-400: 174, 169, 184;
    --sv-gray-500: 126, 122, 136;
    --sv-gray-600: 87, 83, 95;
    --sv-gray-700: 57, 54, 62;
    --sv-gray-800: 38, 36, 42;
  }

  .sv-gray-200 {
    color: rgb(var(--sv-gray-200));
  }

  .sv-gray-400 {
    color: rgb(var(--sv-gray-400));
  }

  .sv-gray-500 {
    color: rgb(var(--sv-gray-500));
  }

  .sv-gray-600 {
    color: rgb(var(--sv-gray-600));
  }

  .sv-gray-700 {
    color: rgb(var(--sv-gray-700));
  }
`;L();var Iu=xt`
  .text {
    font-family: Roboto;
    font-size: 12px;
    font-style: normal;
    font-weight: 400;
    line-height: 20px;
  }

  .text-bold {
    font-weight: 700;
  }

  .text-big {
    font-size: 14px;
  }

  .text-small {
    font-size: 10px;
  }
`;L();var Mu=xt`
  .sv-hr {
    width: 100%;
    height: 1px;
    background: rgb(var(--sv-gray-200));
    padding: 0px;
    margin: 0px;
    position: relative;
  }
`;L();var Ru=xt`
  .icon-button {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(0, 0, 0, 0);
    border: 0px;
    width: 32px;
    height: 32px;
  }

  .icon-button > superviz-icon {
    display: flex !important;
  }

  .icon-button--xsmall {
    width: 18px;
    height: 18px;
  }

  .icon-button--small {
    width: 24px;
    height: 24px;
  }

  .icon-button--medium {
    width: 32px;
    height: 32px;
  }

  .icon-button--large {
    width: 40px;
    height: 40px;
  }

  .icon-button--clickable {
    cursor: pointer;
    border-radius: 100%;
  }

  .icon-button--clickable:hover:not(.icon-button--no-hover) {
    background: rgb(var(--sv-gray-300));
    transition: 0.25s background-color ease-in;
  }
  
  .icon-button--clickable:focus:not(.icon-button--no-hover) {
    transition: 0.25s background-color ease-in;
    background: rgb(var(--sv-gray-300));
  }
`;var kt=s=>{var t;class e extends s{connectedCallback(){setTimeout(()=>{var c,u;let r=document.getElementById("superviz-style"),a=this.createCustomColors(),l=document.createElement("style");l.innerHTML=(r==null?void 0:r.innerHTML)||"",(c=this.shadowRoot)==null||c.appendChild(l),a&&((u=this.shadowRoot)==null||u.appendChild(a))}),super.connectedCallback()}createCustomColors(){if(!wt.get("colors"))return;let r=document.createElement("style"),a=Object.entries(wt.get("colors")).map(([l,c])=>`--${l}: ${c} !important;`).join(" ");return r.innerHTML=`
      * {
        ${a}
      }
    `,r}emitEvent(r,a,l={composed:!0,bubbles:!0}){let c=new CustomEvent(r,lt({detail:a},l));this.dispatchEvent(c)}}return e.styles=[Pu,Iu,Mu,Ru,(t=s.styles)!=null?t:[]],e};L();var Lu=(a=>(a[a.xs=14]="xs",a[a.sm=18]="sm",a[a.md=24]="md",a[a.lg=36]="lg",a[a.xl=44]="xl",a))(Lu||{});var sg=kt(Pt),lO=[sg.styles],Gi=class extends sg{constructor(){super();this.name="",this.size="md"}get iconSize(){return Lu[this.size]}render(){var t;return this.color||(this.color="black"),dt`
      <i
        class="sv-icon sv-icon-${this.name}_${(t=this.suffix)!=null?t:this.size} ${this.color}"
        style="font-size: ${this.iconSize}px"
      ></i>
    `}};Gi.properties={name:{type:String},size:{type:String},color:{type:String},suffix:{type:String}},Gi.styles=[lO,xt`
      div {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: black;
        color: white;
      }

      i,
      i.black {
        color: rgba(var(--sv-gray-600));
      }

      i.white {
        color: white;
      }
    `],Gi=Nt([Ft("superviz-icon")],Gi);L();L();L();L();var el={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},nl=s=>(...e)=>({_$litDirective$:s,values:e}),Dr=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,n){this._$Ct=e,this._$AM=t,this._$Ci=n}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};var It=nl(class extends Dr{constructor(s){var e;if(super(s),s.type!==el.ATTRIBUTE||s.name!=="class"||((e=s.strings)==null?void 0:e.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(s){return" "+Object.keys(s).filter(e=>s[e]).join(" ")+" "}update(s,[e]){var n,r;if(this.it===void 0){this.it=new Set,s.strings!==void 0&&(this.st=new Set(s.strings.join(" ").split(/\s/).filter(a=>a!=="")));for(let a in e)e[a]&&!((n=this.st)!=null&&n.has(a))&&this.it.add(a);return this.render(e)}let t=s.element.classList;for(let a of this.it)a in e||(t.remove(a),this.it.delete(a));for(let a in e){let l=!!e[a];l===this.it.has(a)||((r=this.st)==null?void 0:r.has(a))||(l?(t.add(a),this.it.add(a)):(t.remove(a),this.it.delete(a)))}return Hn}});L();function ne(s){let e=document.getElementById(`superviz-${s}-styles`);if(!e)return;let t=new CSSStyleSheet;t.replaceSync(e.textContent),this.shadowRoot.adoptedStyleSheets=[...this.shadowRoot.adoptedStyleSheets,t]}L();var ag=xt`
  .dropdown {
    position: relative;
    z-index: 100;
  }

  .dropdown-content {
    display: flex;
  }

  .select-clicked {
    border: 2px #26489a solid;
  }

  .dropdown-list {
    position: relative;
    z-index: 101;
  }

  .header {
    display: grid;
    grid-template-rows: 1fr 1px;
    align-items: center;
    padding: 0 10px;
    min-height: 42px;
    font-size: 16px;
    color: rgb(var(--sv-gray-600));
  }

  .menu {
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    opacity: 0;
    display: none;
    background: #fff;
    padding: 0;
    z-index: 1;
    transition: 0.2s;
    border-radius: 3px;
  }

  .items {
    list-style: none;
    padding: 0;
    color: #9fa5b5;
    margin: 0;
  }

  .text.username {
    font-size: 14px;
    text-align: left;

    display: inline-block;
    vertical-align: middle;
    line-height: normal;
    padding: 8px 0;
  }

  .items li {
    color: rgb(var(--sv-gray-600));
    text-transform: uppercase;
    padding: 0 10px;
    cursor: pointer;
    min-width: 103px;
    min-height: 32px;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 5px;
    height: 42px;
  }

  .sv-icon {
    width: 40px;
    height: 40px;
    background-color: red;
  }

  .active {
    background: rgb(var(--sv-gray-200));
  }

  .items li:hover {
    background: rgb(var(--sv-gray-200));
  }

  .menu-open {
    display: block;
    opacity: 1;
    position: fixed;
  }

  .sv-hr {
    width: 100%;
    height: 1px;
    background: rgb(var(--sv-gray-300));
    padding: 0px;
    margin: 0px;
    justify-self: flex-end;
  }

  .option-label {
    white-space: nowrap;
    line-height: 1;
  }

  .who-is-online__controls__item__icon {
    line-height: 1;
  }

  .who-is-online__controls__item {
    align-items: center;
  }

  @media (max-width: 780px) {
    .menu--top-left,
    .menu--top-center,
    .menu--top-right {
      bottom: 36px;
    }
  }
`;var lg=kt(Pt),cO=[lg.styles,ag],Wi=class extends lg{constructor(){super();this.menu=void 0;this.onClickOutDropdown=t=>{if(t.stopPropagation(),!this.open)return;let n=t.composedPath(),r=this.shadowRoot.querySelector(".dropdown-content"),a=this.shadowRoot.querySelector(".dropdown-list"),c=this.shadowRoot.querySelector('slot[name="dropdown"]').assignedElements()[0],u=n.includes(r),m=n.includes(a),g=n.includes(c);u||m||g||this.close()};this.close=()=>{this.open=!1,this.emitEvent("close",{bubbles:!1,composed:!1})};this.callbackSelected=t=>{this.open=!1;let n=this.returnTo?t[this.returnTo]:t;this.emitEvent("selected",n,{bubbles:!1,composed:!0})};this.adjustPosition=()=>{if(!this.open){cancelAnimationFrame(this.animationFrame);return}this.setHorizontalPosition(),this.setPositionVertical(),this.animationFrame=requestAnimationFrame(this.adjustPosition)};this.tooltip=()=>{if(!this.canShowTooltip)return"";let t=this.lastParticipant?"tooltip-top":"tooltip-bottom";return dt` <superviz-tooltip
      tooltipData=${JSON.stringify(this.onHoverData)}
      ?shiftTooltipLeft=${this.shiftTooltipLeft}
      tooltipVerticalPosition=${t}
      classesPrefix="${this.tooltipPrefix}__tooltip"
      parentComponent=${this.parentComponent}
    ></superviz-tooltip>`};this.showTooltip=!1}firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{this.menu=this.shadowRoot.querySelector(".menu"),ne.call(this,[this.parentComponent])})}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("click",this.onClickOutDropdown);let t=this.shadowRoot.querySelector(".dropdown");t==null||t.removeEventListener("mouseenter",()=>{this.showTooltip=!0}),t==null||t.removeEventListener("mouseleave",()=>{this.showTooltip=!1})}updated(t){if(!!t.has("open")){if(this.emitEvent("toggle-dropdown-state",{open:this.open,font:this.name},{bubbles:!1,composed:!1}),this.open){document.addEventListener("click",this.onClickOutDropdown),this.animationFrame=requestAnimationFrame(this.adjustPosition);return}document.removeEventListener("click",this.onClickOutDropdown)}}setHorizontalPosition(){let t=this.shadowRoot.querySelector('slot[name="dropdown"]'),{left:n,right:r,width:a}=t.parentElement.getBoundingClientRect(),{width:l}=this.menu.getBoundingClientRect(),c=n-(l-a)/2<0,u=r+(l-a)/2>window.innerWidth;if(this.shiftTooltipLeft){this.menu.style.left=`${n+8}px`,this.menu.style.right="",this.menu.style.transform="translate(0, 0)";return}if(!c&&!u){this.menu.style.left=`${n}px`,this.menu.style.right="",this.menu.style.transform=`translate(calc(-50% + ${a/2}px), 0)`;return}if(!c){this.menu.style.left="",this.menu.style.right=`${window.innerWidth-r}px`,this.menu.style.transform="translate(0, 0)";return}u||(this.menu.style.right="",this.menu.style.left=`${r-a}px`,this.menu.style.transform="translate(0, 0)")}setPositionVertical(){let t=this.shadowRoot.querySelector('slot[name="dropdown"]'),{top:n,bottom:r}=t.parentElement.getBoundingClientRect(),{height:a}=this.menu.getBoundingClientRect(),l=this.shiftTooltipLeft?-2:8;if(!(r+a+l>window.innerHeight)){this.menu.style.bottom="",this.menu.style.top=`${r+l}px`;return}this.menu.style.top="auto",this.menu.style.bottom=`${window.innerHeight-n+l}px`}get renderHeader(){return this.name?dt` <div class="header ${this.getClass("header")}">
      <span class="text username ${this.getClass("title")}">${this.name}</span>
      <span class="sv-hr ${this.getClass("divisor")}"></span>
    </div>`:dt``}toggle(){this.disabled||(this.open=!this.open,this.emitEvent("open",{open:this.open}))}get supervizIcons(){var t;return(t=this.icons)==null?void 0:t.map(n=>dt`<superviz-icon name="${n}" size="sm"></superviz-icon>`)}get listOptions(){return this.options.map((t,n)=>{var a;let r={text:!0,[this.getClass("item")]:!0,"text-bold":!0,active:(t==null?void 0:t[this.returnTo])&&this.active===(t==null?void 0:t[this.returnTo])};return dt`<li @click=${()=>this.callbackSelected(t)} class=${It(r)}>
        <span class=${this.getClass("item__icon")}>${(a=this.supervizIcons)==null?void 0:a.at(n)}</span>
        <span class="option-label ${this.getClass("item__label")}">${t[this.label]}</span>
      </li>`})}getClass(t){return`${this.classesPrefix}__${t}`}render(){let t={menu:!0,"menu-open":this.open,"menu-left":this.align==="left","menu-right":this.align==="right","who-is-online-dropdown":this.name};return dt`
      <div class="dropdown">
        <div class="dropdown-content" @click=${this.toggle}>
          <slot name="dropdown"></slot>
        </div>
        ${this.tooltip()}
      </div>
      <div class="dropdown-list">
        <div class=${It(t)}>
          ${this.renderHeader}
          <ul class="${this.getClass("items")} items">
            ${this.listOptions}
          </ul>
        </div>
      </div>
    `}};Wi.styles=cO,Wi.properties={open:{type:Boolean},disabled:{type:Boolean},align:{type:String},options:{type:Array},label:{type:String},returnTo:{type:String},active:{type:[String,Object]},icons:{type:Array},name:{type:String},onHoverData:{type:Object},showTooltip:{type:Boolean},dropdown:{type:Object},canShowTooltip:{type:Boolean},drodpdownSizes:{type:Object},shiftTooltipLeft:{type:Boolean},lastParticipant:{type:Boolean},classesPrefix:{type:String},parentComponent:{type:String},tooltipPrefix:{type:String}},Wi=Nt([Ft("superviz-dropdown")],Wi);L();L();var cg=xt`
  .superviz-who-is-online__tooltip {
    --host-height: 0px;
    --host-width: 0px;
    --vertical-offset: 12px;

    background-color: rgb(var(--sv-gray-600));
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
    position: fixed;
    opacity: 0;
    border-radius: 2px;
    cursor: default;
    visibility: hidden;
    transition: opacity 0.2s ease-in-out display 0s;
    z-index: 100;
    overflow-x: clip;
  }

  .superviz-who-is-online__tooltip-arrow {
    width: 13px;
    height: 13px;
    position: absolute;
    background-color: rgb(var(--sv-gray-600));
    transform: rotate(45deg);
    border-top-left-radius: 1px;
    border-bottom-right-radius: 1px;
  }

  .show-tooltip {
    opacity: 1;
    visibility: visible;
  }

  .tooltip-name,
  .tooltip-action {
    margin: 0;
    font-family: roboto;
    white-space: nowrap;
    text-align: center;
    line-height: 1.2;
  }

  .tooltip-name {
    color: white;
    font-size: 14px;
  }

  .tooltip-action {
    color: rgb(var(--sv-gray-400));
    font-size: 12px;
  }

  .tooltip-top {
    bottom: calc(var(--host-height) + var(--vertical-offset));
  }

  .tooltip-bottom {
    bottom: auto;
  }

  .tooltip-center {
    right: auto;
  }

  .tooltip-bottom .superviz-who-is-online__tooltip-arrow {
    top: -6.5px;
  }

  .tooltip-top .superviz-who-is-online__tooltip-arrow {
    bottom: -6.5px;
  }

  .tooltip-center .superviz-who-is-online__tooltip-arrow {
    left: 0;
    margin-left: 50%;
    translate: -50% 0;
  }

  .tooltip-left .superviz-who-is-online__tooltip-arrow {
    translate: 50% 0;
    border-radius: 0;
    right: 0;
  }

  .tooltip-right .superviz-who-is-online__tooltip-arrow {
    translate: -50% 0;
    border-radius: 0;
    left: 0;
  }

  .shift-left {
    --vertical-offset: 2px;
  }
`;L();var ug=kt(Pt),uO=[ug.styles,cg],zi=class extends ug{constructor(){super();this.positionFixedTooltip=()=>{var _,C,T,x,v;if(!this.canAnimate||!this.parentElement){this.hide();return}this.adjustTooltipPosition();let{bottom:t,left:n,width:r,right:a,top:l}=this.parentElement.getBoundingClientRect(),{width:c}=this.tooltip.getBoundingClientRect(),u="auto",m="auto",g="auto",E="auto",h="",y=window.innerWidth>780,O=y?14:12;this.tooltipHorizontalPosition.includes("right")&&(g=`${n+r/2}px`),this.tooltipHorizontalPosition.includes("left")&&(E=`${window.innerWidth-(a-r/2)}px`),this.tooltipHorizontalPosition.includes("center")&&(g=`${n}px`,h=`translateX(-${(c-r)/2}px)`),this.tooltipVerticalPosition.includes("bottom")&&(u=`${t+O}px`,O=-10),this.tooltipVerticalPosition.includes("top")&&(m=`${window.innerHeight-(l-O)}px`,O=10),this.shiftTooltipLeft&&(h=`translate(-${(c-(y?18:10)-42)/2}px, ${O}px)`),(_=this.tooltip)==null||_.style.setProperty("top",u),(C=this.tooltip)==null||C.style.setProperty("left",g),(T=this.tooltip)==null||T.style.setProperty("right",E),(x=this.tooltip)==null||x.style.setProperty("bottom",m),(v=this.tooltip)==null||v.style.setProperty("transform",h),this.animationFrame=window.requestAnimationFrame(this.positionFixedTooltip)};this.hide=()=>{this.canAnimate=!1,this.showTooltip=!1,window.cancelAnimationFrame(this.animationFrame)};this.show=()=>{this.canAnimate=!0,this.showTooltip=!0,this.positionFixedTooltip()};this.adjustTooltipVerticalPosition=()=>{let{bottom:t,top:n,width:r}=this.tooltip.getBoundingClientRect(),a=window.innerHeight;if(this.tooltipVerticalPosition.includes("top")&&n<0){this.tooltipVerticalPosition=this.tooltipVerticalPosition.replace("top","bottom");return}this.tooltipVerticalPosition.includes("bottom")&&t>a&&(this.tooltipVerticalPosition=this.tooltipVerticalPosition.replace("bottom","top"))};this.adjustTooltipHorizontalPosition=()=>{let{left:t,right:n,width:r}=this.tooltip.getBoundingClientRect(),a=window.innerWidth,{left:l,width:c,right:u}=this.parentElement.getBoundingClientRect(),m=l+c/2-r/2>0,g=r/2+u-c/2<a;if(m&&g){this.tooltipHorizontalPosition=this.tooltipHorizontalPosition.replace(/left|right/,"center");return}if(t<0){this.tooltipHorizontalPosition=this.tooltipHorizontalPosition.replace("center","right");return}n>a&&(this.tooltipHorizontalPosition=this.tooltipHorizontalPosition.replace("center","left"))};this.adjustTooltipPosition=()=>{if(!this.parentElement){this.hide();return}this.tooltip||(this.tooltip=this.shadowRoot.querySelector(".superviz-who-is-online__tooltip")),this.adjustTooltipVerticalPosition(),this.adjustTooltipHorizontalPosition()};this.tooltipVerticalPosition="tooltip-bottom",this.tooltipHorizontalPosition="tooltip-center",this.showTooltip=!1,this.parentSizes={height:0,width:0}}firstUpdated(t){let{parentElement:n}=this;n==null||n.addEventListener("mouseenter",this.show),n==null||n.addEventListener("mouseleave",this.hide),this.adjustTooltipPosition(),ne.call(this,this.parentComponent)}disconnectedCallback(){super.disconnectedCallback();let{parentElement:t}=this;t==null||t.removeEventListener("mouseenter",this.show),t==null||t.removeEventListener("mouseleave",this.hide)}updated(t){if(t.has("showTooltip")&&this.showTooltip){let{parentElement:n}=this;if(!n)return;let{height:r,width:a}=n.getBoundingClientRect();(this.parentSizes.height!==r||this.parentSizes.width!==a)&&(this.parentSizes={height:r,width:a})}}getClass(t){return t?`${this.classesPrefix}__${t}`:this.classesPrefix}renderTooltip(){var a,l,c,u,m;let t=this.tooltipVerticalPosition,n=this.tooltipHorizontalPosition,r={"superviz-who-is-online__tooltip":!0,[this.getClass("")]:!0,[t]:!0,[n]:!0,"tooltip-extras":this.tooltipOnLeft,"show-tooltip":this.showTooltip,"shift-left":this.shiftTooltipLeft};return dt`<div
      class=${It(r)}
      style="--host-height: ${(a=this.parentSizes)==null?void 0:a.height}px; --host-width: ${(l=this.parentSizes)==null?void 0:l.width}px;"
    >
      <p class="tooltip-name ${this.getClass("title")}">${(c=this.tooltipData)==null?void 0:c.name}</p>
      ${(u=this.tooltipData)!=null&&u.action?dt`<p class="tooltip-action ${this.getClass("action")}">${(m=this.tooltipData)==null?void 0:m.action}</p>`:""}
      <div class="superviz-who-is-online__tooltip-arrow ${this.getClass("")}"></div>
    </div>`}render(){return dt`${this.renderTooltip()}`}};zi.styles=uO,zi.properties={tooltipData:{type:Object},tooltipOnLeft:{type:Boolean},showTooltip:{type:Boolean},tooltip:{type:Object},tooltipVerticalPosition:{type:String},tooltipHorizontalPosition:{type:String},parentSizes:{type:Object},shiftTooltipLeft:{type:Boolean},classesPrefix:{type:String},parentComponent:{type:String}},zi=Nt([Ft("superviz-tooltip")],zi);L();L();L();var il=xt`
  .modal--overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(var(--sv-gray-400), 0.8);

    z-index: 999;
  }

  .modal--container {
    display: flex;
    align-items: center;
    justify-content: center;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: transparent;

    z-index: 1000;
  }

  .modal--container > .modal {
    background: #fff;
    min-width: 370px;
    min-height: 150px;
    border-radius: 6px;
  }

  .modal--container > .modal > .modal--header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 16px;
    background: rgb(var(--sv-gray-200));
    border-radius: 6px 6px 0 0;
  }

  .modal--container > .modal > .modal--header > .text {
    display: flex;
    align-items: center;
  }

  .modal--container > .modal > .modal--header > .close {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: rgb(var(--sv-gray-600));
    cursor: pointer;
  }

  .modal--container > .modal > .modal--body {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px 24px 0 24px;
  }

  .modal--container > .modal > .modal--body > .modal--body-content {
    padding: 8px 0;
    text-align: center;
  }

  .modal--container > .modal > .modal--footer {
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    padding: 24px;
  }

  .btn {
    width: 150px;
    height: 40px;
    text-transform: uppercase;
  }

  .btn--confirm {
    background: rgb(var(--sv-primary));
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-primary));
    color: #fff;
    cursor: pointer;
  }

  .btn--cancel {
    background: transparent;
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-gray-400));
    color: rgb(var(--sv-gray-400));
    cursor: pointer;
  }
`;var dg=kt(Pt),dO=[dg.styles,il],Nr=class extends dg{constructor(){super(...arguments);this.getContainer=()=>window.document.querySelector("superviz-modal-container");this.createContainer=t=>{this.modal=document.createElement("superviz-modal-container"),this.modal.setOptions(t)};this.createModal=({detail:t})=>{this.createContainer(t),window.document.body.appendChild(this.modal)};this.destroyModal=()=>{var t;this.modal=void 0,(t=this.getContainer())==null||t.remove()}}firstUpdated(){window.document.body.addEventListener("superviz-modal--open",this.createModal),window.document.body.addEventListener("superviz-modal--close",this.destroyModal)}disconnectedCallback(){this.destroyModal(),window.document.body.removeEventListener("superviz-modal--open",this.createModal),window.document.body.removeEventListener("superviz-modal--close",this.destroyModal)}};Nr.styles=dO,Nr=Nt([Ft("superviz-modal")],Nr);L();var fg=kt(Pt),fO=[fg.styles,il],Fr=class extends fg{constructor(){super(...arguments);this.closeModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--close",{bubbles:!0,composed:!0}))};this.confirmModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--confirm",{bubbles:!0,composed:!0}))}}setOptions(t){this.options=t}render(){let t=()=>dt`
        <div class="modal--header">
          <span class="text text-bold sv-gray-600">${this.options.title}</span>
          <div class="close" @click=${this.closeModal}>
            <superviz-icon name="close" size="md"></superviz-icon>
          </div>
        </div>
      `,n=()=>dt`
        <div class="modal--body">
          <div class="modal--body-content">${this.options.body}</div>
        </div>
      `,r=()=>{if(this.options.footer)return dt` <div class="modal--footer">${this.options.footer}</div> `;let a=this.options.confirmLabel||"OK",l=this.options.cancelLabel||"Cancel";return this.options.confirm&&this.options.cancel?dt`
          <div class="modal--footer">
            <button class="text text-bold btn btn--cancel" @click=${this.closeModal}>
              ${l}
            </button>
            <button class="text text-bold btn btn--confirm" @click=${this.confirmModal}>
              ${a}
            </button>
          </div>
        `:dt`
        <div class="modal--footer">
          <button class="text text-bold btn btn--confirm" @click=${this.confirmModal}>
            ${a}
          </button>
        </div>
      `};return dt`
      <div class="modal--overlay"></div>
      <div class="modal--container">
        <div class="modal">${t()} ${n()} ${r()}</div>
      </div>
    `}};Fr.styles=fO,Fr=Nt([Ft("superviz-modal-container")],Fr);L();L();L();L();var Du=xt`
  .superviz-comments {
    --offset-left: 10px;
    --offset-right: 10px;
    --offset-top: 10px;
    --offset-bottom: 10px;

    display: flex;
    flex-direction: column;
    width: 320px;
    position: fixed;
    color: rgb(var(--sv-gray-700));
    background: rgb(var(--sv-white));
    top: 0px;
    bottom: 0;
    box-shadow: -2px 0 4px 0 rgba(0, 0, 0, 0.1);
    z-index: 100;
    overflow: hidden;
    transition: right 0.3s ease-out;
  }

  .header {
    width: 100%;
  }

  .content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .toggle {
    display: flex;
    position: fixed;
    width: 100px;
    color: rgb(var(--sv-gray-700));
    background: rgb(var(--sv-white));
    top: 0;
    right: 0;
    bottom: 0;
  }

  .threads-on-left-side {
    left: var(--offset-left);
    top: var(--offset-top);
    bottom: var(--offset-bottom);
    border-radius: 8px;
  }

  .threads-on-right-side {
    right: var(--offset-right);
    top: var(--offset-top);
    bottom: var(--offset-bottom);
    border-radius: 8px;
  }

  #superviz-comments.threads-on-right-side.hide-at-right {
    right: -330px;
  }

  #superviz-comments.threads-on-left-side.hide-at-left {
    left: -330px;
  }

  .hide-at-right,
  .hide-at-left {
    animation: keep-opacity 0.3s ease-out;
    opacity: 0;
    visibility: hidden;
  }

  @keyframes keep-opacity {
    0%,
    99% {
      visibility: visible;
      opacity: 1;
    }

    100% {
      visibility: hidden;
      opacity: 0;
    }
  }
`;L();var Nu=xt`
  .comments__topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: rgb(var(--sv-gray-200));
    height: 50px;
  }

  .comments__topbar__title {
    margin: 0 16px;
    color: rgb(var(--sv-gray-600));
  }

  .comments__topbar__close-threads {
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: 0.15s;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    box-sizing: border-box;
    margin-right: 8px;
    padding-right: 2px;
  }

  .comments__topbar__close-threads:hover {
    background: rgb(var(--sv-gray-300));
  }
`;L();var Fu=xt`
  .reply {
    padding-left: 24px !important;
  }

  .comments__comment-item {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    padding: 8px;
    gap: 4px;
  }

  .comments__comment-item__header {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    width: 100%;
    align-items: center;
    color: rgb(var(--sv-gray-500));
  }

  .comments__comment-item__actions {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .comments__comment-item__actions superviz-dropdown,
  .comments__comment-item__icons {
    width: 25px;
    height: 25px;
    border-radius: 50%;
  }

  .comments__comment-item__metadata {
    display: flex;
    width: 100%;
    gap: 8px;
    align-items: center;
  }

  .comments__comment-item__avatar-container {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    overflow: hidden;
    background-color: rgb(var(--sv-gray-300));
    border: 1px solid rgb(var(--sv-gray-500));
    color: #fff;

    display: flex;
    align-items: center;
    justify-content: center;
  }

  .comments__comment-item__avatar-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 50%;
  }

  .comments__comment-item__content {
    width: 100%;
  }

  .line-clamp {
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .comments__comment-item__content__body {
    color: rgb(var(--sv-gray-700));
    position: relative;
    display: grid;
    grid-template-rows: 0px auto;
  }

  .comments__comment-item__content__body.editing-annotation {
    grid-template-rows: auto 0px;
  }

  .hidden {
    display: none;
  }

  .mentioned {
    display: inline-block;
  }

  .annotation-content {
    transition: opacity 0ms;
    opacity: 1;
    overflow: hidden;
  }

  .editing {
    transition: opacity 400ms;
    overflow: hidden;
    opacity: 0;
    pointer-events: none;
  }

  .comments__input--editable {
    transform: translateY(0);
    opacity: 1;
    overflow: hidden;
  }

  .hide-edit-input {
    transition: opacity 500ms, transform 0 linear 300ms;
    opacity: 0;
    pointer-events: none;
    width: 100%;
  }
`;L();var Bu=xt`
  .comments {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 288px;
  }

  .hidden {
    display: none;
  }
`;L();var ku=xt`
  .comments__input {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    background: rgb(var(--sv-white));
    border-radius: 4px;
    border: 1px solid rgb(var(--sv-gray-300));
    position: relative;
    min-height: 40px;
    box-sizing: border-box;
  }

  .comments__input:focus-within {
    border: 1px solid rgb(var(--sv-gray-500));
  }

  .comments__input__textarea {
    border: 0px;
    text-align: left;
    border-radius: 4px;
    outline: none;
    font-size: 14px;
    color: rgb(var(--sv-gray-700));
    font-family: Roboto;
    white-space: pre-wrap;
    word-wrap: break-word;
    resize: none;
    line-height: 1.15rem;
    max-height: 5rem;
    appearance: none;
    height: 40px;
    width: 100%;
    box-sizing: border-box;

    padding-top: 7px;
    border-top: 8px solid transparent;
    border-bottom: 8px solid transparent;
    border-right: 11px solid transparent;
    border-left: 11px solid transparent;
  }

  .fixed-width {
    width: 288px;
  }

  .comments__input__textarea:invalid {
    border-top: 15px solid transparent;
  }

  .comments__input__textarea::placeholder {
    color: rgb(var(--sv-gray-400));
    font-size: 14px;
    line-height: 14px;
  }

  .comments__input__options {
    display: flex;
    justify-content: space-between;
    box-sizing: border-box;
    overflow: hidden;
    height: 0;
    transition: 0.25s;
    border-radius: 0 0 4px 4px;
  }

  .active-textarea {
    height: 40px;
    padding: 4px 8px;
  }

  .sv-hr {
    border: none;
    width: 100%;
    opacity: 0;
    transition: 0.25s opacity linear, 0.25s visibility;
    visibility: hidden;
    height: 0;
    position: absolute;
  }

  .comments__input__divisor {
    border-top: 1px solid rgb(var(--sv-gray-300));
    opacity: 1;
    position: relative;
    visibility: visible;
  }

  .comment-actions {
    position: absolute;
    left: 8px;
    bottom: 3px;
    opacity: 0;
    transition: 0.25s opacity linear, 0.25s visibility;
    visibility: hidden;
  }

  .active-textarea > .comment-actions {
    opacity: 1;
    visibility: visible;
  }

  .mention:hover {
    background-color: rgb(var(--sv-gray-200));
  }

  .comments__input__button {
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 100%;
    width: 32px;
    height: 32px;
    border: 0px;
  }

  .comments__input__send-button {
    background: rgb(var(--sv-primary));
    color: rgba(var(--sv-white), 1);
  }

  .align-send-btn > superviz-icon {
    cursor: pointer;
  }

  .comments__input__button:disabled {
    background: rgb(var(--sv-gray-200));
    color: rgb(var(--sv-gray-600));
  }

  .comment-input-options {
    display: flex;
    gap: 4px;
    position: absolute;
    right: 8px;
    bottom: 4px;
  }

  .comments__input__textarea:focus,
  .comments__input__textarea.active-textarea {
    border-radius: 4px 4px 0 0;
  }

  .comments__input__textarea:focus::placeholder {
    color: transparent;
  }
`;L();var $u=xt`
  .comments__thread:hover:not(.comments__thread--selected) {
    background-color: rgba(var(--sv-gray-200), 0.3);
  }

  .avatars-comments {
    display: flex;
    position: absolute;
    bottom: 8px;
    padding: 0 8px;
    opacity: 1;
    transition: opacity 0.3s linear;
  }

  .avatars-comments.invisible {
    opacity: 0;
  }

  .avatar-container {
    position: relative;
    display: flex;
    align-items: center;
    width: 100%;
  }

  .avatar {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    overflow: hidden;
    background-color: rgb(var(--sv-gray-300));
    border: 1px solid rgb(var(--sv-gray-500));
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .avatar img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 50%;
  }

  .avatar:not(:first-child) {
    margin-left: -6px;
  }

  .comments__thread--selected div:last-child {
    margin-inline: 8px;
  }

  .comments-container {
    display: flex;
    overflow: hidden;
    flex-direction: column;
  }

  .comments-container-wrapper {
    display: grid;
    grid-template-rows: 0fr;
    opacity: 0;
    overflow: hidden;
    transition: grid-template-rows 0.3s linear, opacity 0.3s linear;
  }

  .comments-container-wrapper.show {
    grid-template-rows: 1fr;
    opacity: 1;
  }

  .comments--expand {
    display: flex;
  }

  .comment-avatar--expand {
    display: block;
  }

  .hidden {
    overflow: hidden;
  }

  .comments__thread {
    grid-row: 1 / span 2;
    padding: 8px;
    position: relative;
    cursor: pointer;
    transition: padding-bottom 0.3s linear, opacity 0.3s linear;
  }

  .extra-space-bottom {
    padding-bottom: 35px;
  }

  .comments__thread--selected {
    background-color: rgba(var(--sv-gray-200), 0.5);
    padding-bottom: 16px;
  }

  .hide-input {
    display: none;
  }

  .wrapper {
    margin-inline: 0;
    display: grid;
    grid-template-rows: 0fr;
    opacity: 0;
    width: 100%;
    overflow: hidden;
    transition: grid-template-rows 0.3s linear, opacity 0.3s linear;
  }

  .show-wrapper {
    grid-template-rows: 1fr;
    opacity: 1;
  }

  .comments__complete-annotation {
    position: relative;
    width: 100%;
  }

  .comments__hide-complete-annotation {
    min-height: 0;
    opacity: 0;
    animation: hide-annotation 10s linear;
  }

  @keyframes hide-annotation {
    0%,
    95% {
      min-height: 43px;
      opacity: 1;
    }

    100% {
      opacity: 0;
      min-height: 0;
    }
  }

  .comments__resolved-annotation-message {
    position: absolute;
    width: 100%;
    top: 0;
  }
`;L();var Uu=xt`
  .comments__annotation-resolved {
    background: rgba(var(--sv-gray-200), 0.5);
    height: 26px;
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid rgb(var(--sv-gray-200));
  }
`;L();var Hu=xt`
  .preload {
    animation-duration: 0s !important;
  }

  .comments__annotation-pin,
  .comments__annotation-pin__avatar {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    pointer-events: auto;
    z-index: 10;
    transform-origin: bottom left;
  }

  .comments__annotation-pin:hover {
    transform: scale(1.2);
    animation: growing-spring 0.3s linear;
  }

  .comments__annotation-pin:not(:hover) {
    animation: shrinking-spring 0.3s linear;
  }

  .comments__annotation-pin--add {
    transform: scale(1) !important;
    animation: none !important;
  }

  .comments__annotation-pin {
    position: absolute;

    width: 32px;
    height: 32px;

    background-color: rgb(var(--sv-white));
    border-radius: 50%;
    border-bottom-left-radius: 2px;

    border: 2px solid rgb(var(--sv-white));
    box-shadow: 0px 2px 6px 0px rgba(0, 0, 0, 0.35);
    transition: border-color 0.2s ease-in-out opacity 0.2s ease-in-out;
    padding: 2px;
    box-sizing: border-box;
    cursor: pointer;
  }

  .comments__annotation-pin:hover,
  .comments__annotation-pin:focus,
  .comments__annotation-pin--active {
    border-color: rgb(var(--sv-primary));
  }

  .comments__cursor-pointer,
  .comments__cursor-pointer .comments__annotation-pin__avatar {
    pointer-events: none;
  }

  .comments__annotation-pin__avatar {
    width: 100%;
    height: 100%;

    background-color: rgb(var(--sv-gray-400));
    border-radius: 50%;

    color: rgb(var(--sv-white));
  }

  .comments__annotation-pin__avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: contain;
  }

  .comments__annotation-pin__avatar--add {
    color: rgb(var(--sv-gray-700));
    background-color: rgb(var(--sv-white));
  }

  .floating-input {
    position: absolute;
    top: -2px;
    opacity: 0;
  }

  .left .floating-input {
    right: auto;
    left: 0;
    transform: translateX(calc(-100% - 7px));
    opacity: 1;
  }

  .right .floating-input {
    left: auto;
    right: 0;
    transform: translateX(calc(100% + 7px));
    opacity: 1;
  }

  .comments__annotation-pin-wrapper {
    transform-origin: center;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    position: absolute;
  }

  .comments__annotation-pin-wrapper--new {
    animation: bounce 0.5s linear !important;
  }

  .comments__annotation-pin-wrapper--new .comments__annotation-pin__avatar {
    transform-origin: center;
    animation: avatar-bounce 0.5s linear !important;
  }

  @keyframes avatar-bounce {
    0%,
    40% {
      transform: scale(1);
    }

    48% {
      transform: scale(0.8);
    }

    55%,
    92% {
      transform: scale(1);
    }

    96% {
      transform: scale(0.9);
    }

    100% {
      transform: scale(1);
    }
  }
  @keyframes bounce {
    0% {
      transform: scale(1);
    }

    20% {
      transform: scale(1.3);
    }

    40%,
    55% {
      transform: scale(1);
    }

    75% {
      transform: scale(1.15);
    }

    92%,
    100% {
      transform: scale(1);
    }
  }

  @keyframes growing-spring {
    0% {
      transform: scale(1);
    }

    25% {
      transform: scale(1.3);
    }

    50% {
      transform: scale(1.2);
    }

    75% {
      transform: scale(1.25);
    }

    100% {
      transform: scale(1.2);
    }
  }

  @keyframes shrinking-spring {
    0% {
      transform: scale(1.2);
    }

    33% {
      transform: scale(1);
    }

    66% {
      transform: scale(1.1);
    }

    100% {
      transform: scale(1);
    }
  }
`;L();var Gu=xt`
  .comments__filter-container {
    display: flex;
    width: 100%;
    justify-content: flex-start;
    align-items: center;
  }

  .comments__filter {
    white-space: nowrap;
    padding: 12px;
    cursor: pointer;
    color: rgb(var(--sv-gray-500));
  }

  .content {
    display: flex;
    justify-content: space-between;
    flex-direction: row;
    align-items: center;
    gap: 6px;
  }

  .comments__filter__toggle-button {
    display: flex;
    flex-direction: row;
    gap: 4px;
  }

  .comments__filter__icon {
    margin-top: -2px;
  }
`;L();var Wu=xt`
  .comments__floating-button {
    position: fixed;
    border-radius: 50%;
    width: 38px;
    height: 38px;
    display: flex;
    align-items: center;
    gap: 4px;
    border: none;
    background-color: rgba(var(--sv-white));
    box-shadow: 2px 2px 15px 0px rgba(0, 0, 0, 0.2);
    color: rgb(var(--sv-gray-600));
    cursor: pointer;
    overflow: hidden;
    padding-left: 10px;
    z-index: 99;
    transition: width 300ms linear, border-radius 300ms linear;
  }

  .comments__floating-button:hover,
  .comments__floating-button.is-active {
    background-color: rgb(var(--sv-gray-400));
    color: rgba(var(--sv-white));
  }

  .comments-floating-button-hovered {
    transition: width 300ms linear 300ms, border-radius 300ms linear 300ms;
  }

  .comments__floating-button__text {
    text-align: left;
    overflow: hidden;
    position: relative;
    margin: 0;
    line-height: 1;
    right: 0px;
  }

  .not-hovered {
    animation-duration: 0s !important;
    transition-duration: 0s !important;
  }

  .hide-button {
    display: none !important;
  }

  .is-inactive:hover {
    width: 110px;
    border-radius: 30px;
  }

  .is-active:hover {
    width: 92px;
    border-radius: 30px;
    animation: decrease-width 600ms linear;
  }

  .textInactive.cancel {
    position: absolute;
    bottom: -30px;
    animation: drop-cancel-text 600ms linear;
    right: auto;
  }

  .textInactive.comment {
    position: absolute;
    top: 0;
    animation: drop-comment-text 600ms linear;
  }

  .textActive.comment {
    position: absolute;
    top: -30px;
    animation: rise-comment-text 600ms linear;
    right: auto;
  }

  .textActive.cancel {
    position: absolute;
    bottom: 0;
    animation: rise-cancel-text 600ms linear;
  }

  .comments__floating-button .comments__floating-button-text-box {
    width: 0;
  }

  .comments__floating-button.is-inactive:hover .comments__floating-button-text-box {
    width: 61.45px;
  }

  .comments__floating-button.is-active:hover .comments__floating-button-text-box {
    width: 43.0833px;
  }

  .comments__floating-button-text-box {
    position: relative;
    height: 14px;
    overflow-x: clip;
    transition: width 300ms linear;
  }

  .comments__floating-button__icon {
    position: relative;
  }

  .cross {
    position: absolute;
    top: 9px;
    left: 5.3px;
    transform: translateY(-50%);
    transform-origin: center;
    transition: transform 300ms linear 300ms;
  }

  rect {
    fill: rgba(var(--sv-gray-600));
  }

  .comments__floating-button:hover rect,
  .is-active rect {
    fill: rgba(var(--sv-white));
  }

  .cross-bar-1 {
    transform-origin: center;
    transform: rotate(0deg);
  }

  .cross-bar-2 {
    transform-origin: center;
    transform: rotate(90deg);
  }

  .is-active .cross {
    transform: translateY(-50%) rotate(45deg);
  }

  @keyframes rise-cancel-text {
    0%,
    50% {
      opacity: 0;
      bottom: -35px;
    }

    75% {
      opacity: 0;
    }

    100% {
      opacity: 1;
      bottom: 0px;
    }
  }

  @keyframes rise-comment-text {
    0% {
      opacity: 1;
      top: 0px;
    }

    35% {
      opacity: 0;
    }

    50%,
    100% {
      opacity: 0;
      top: -35px;
    }
  }

  @keyframes drop-cancel-text {
    0% {
      opacity: 1;
      bottom: 0px;
    }

    35% {
      opacity: 0;
    }

    50%,
    100% {
      opacity: 0;
      bottom: -30px;
    }
  }

  @keyframes drop-comment-text {
    0%,
    50% {
      opacity: 0;
      top: -30px;
    }

    75% {
      opacity: 0;
    }

    100% {
      opacity: 1;
      top: 0px;
    }
  }
`;L();var zu=xt`
.footer {
  bottom: 5px;
  position: absolute;
  right: 5px;
  font-family: Roboto,sans-serif;
  font-size: 10px;
  line-height: 15px;
  letter-spacing: normal;
}

.link {
  text-decoration: none;
  color: rgb(var(--sv-gray-500));
}

.powered-by {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  width: 140px;
  &--vertical {
    justify-content: flex-end;
  }
  &--horizontal {
    justify-content: center;
  }
}
`;L();var Vu=xt`
  #mention-list {
    position: absolute;
    z-index: 1;
    max-height: 200px;
    overflow-y: auto;
    overflow-x: hidden;
    background-color: white;
    display: none;
    width: 216px;
    text-align: -webkit-center;
    border-radius: 2px;
    box-shadow: 2px 2px 8px 0px rgba(0, 0, 0, 0.30);
    padding-top: 4px;
    padding-bottom: 4px;
    /* Stiling scroll WebKit (Firefox) */
    scrollbar-width: 6px; /* Firefox */
    scrollbar-color: #888; /* Firefox */
    /* Style scroll WebKit (Chrome, Safari, Edge) */
    &::-webkit-scrollbar {
      width: 6px;
    }
    &::-webkit-scrollbar-thumb {
      background-color: #888;
    }
  }

  .mention-item {
    cursor: pointer;
    align-items: center;
    display: flex;
    height: 48px;
    width: 208px;
    margin-left: 4px;
    margin-right: 4px;
  }

  .mention-item:hover {
    background: rgb(var(--sv-gray-200));
  }

  .avatar {
    width: 32px;
    height: 32px;
    object-fit: contain;
    border-radius: 32%;
    margin-right: 14px;
    margin-left: 12px;
  }

  .default-avatar {
    width: 32px;
    height: 32px;
    margin-right: 14px;
    margin-left: 12px;
    border-radius: 50%;
    overflow: hidden;
    background-color: rgb(var(--sv-gray-300));
    border: 1px solid rgb(var(--sv-gray-500));
    color: #fff;

    display: flex;
    align-items: center;
    justify-content: center;
  }

  .avatar-type {
    font-family: Roboto;
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 20px;
    color: rgb(var(--sv-gray-600));
  }
`;L();var ju;function Ju(s){let e=s.querySelector("#superviz-comments");if(e&&!ju){let t={childList:!0,attributes:!0,characterData:!0,subtree:!0};ju=new MutationObserver(n=>{n.forEach(r=>{!r.removedNodes.length||r.removedNodes.forEach(a=>{a.id==="poweredby-footer"&&hO(s)})})}),ju.observe(e,t)}}function hO(s){let e=document.createElement("div");e.id="poweredby-footer",e.className="footer";let t=document.createElement("div");t.className="powered-by powered-by--horizontal";let n=document.createElement("a");n.href="https://superviz.com/",n.target="_blank",n.className="link";let r=document.createElement("div");r.textContent="Powered by";let a=document.createElement("img");a.width=48,a.height=8.86,a.src="https://production.cdn.superviz.com/static/superviz-gray-logo.svg",t.appendChild(n),n.appendChild(r),r.appendChild(a),e.appendChild(t);let l=s.getElementById("superviz-comments");l&&l.appendChild(e),Ju(s)}var hg=kt(Pt),pO=[hg.styles,Du,zu],Vi=class extends hg{constructor(){super();this.annotations=[],this.annotationFilter="all",this.waterMarkState=!1,this.participantsList=[],this.side="left"}firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{ne.call(this,["comments"])})}updated(t){super.updated(t),this.updateComplete.then(()=>{this.waterMarkState&&Ju(this.shadowRoot),t.has("offset")&&this.applyOffset()})}participantsListed(t){this.participantsList=t}updateAnnotations(t){this.annotations=t}close(){this.emitEvent("close-threads",{})}waterMarkStatus(t){this.waterMarkState=t}setFilter({detail:t}){let{filter:n}=t;this.annotationFilter=n}getOffset(t){return t==null||t<0?"10px":`${t}px`}applyOffset(){let t=this.shadowRoot.querySelector(".superviz-comments");if(!t)return;let{left:n,right:r,top:a,bottom:l}=this.offset;t.style.setProperty("--offset-top",this.getOffset(a)),t.style.setProperty("--offset-bottom",this.getOffset(l)),t.style.setProperty("--offset-right",this.getOffset(r)),t.style.setProperty("--offset-left",this.getOffset(n))}get poweredBy(){return this.waterMarkState?dt` <div id="poweredby-footer" class="footer">
      <div class="powered-by powered-by--horizontal">
        <a href="https://superviz.com/" target="_blank" class="link">
          <div class="">
            Powered by
            <img
              width="48px"
              height="8.86px"
              src="https://production.cdn.superviz.com/static/superviz-gray-logo.svg"
            />
          </div>
        </a>
      </div>
    </div>`:dt``}render(){let t={"superviz-comments":!0,"threads-on-left-side":this.side==="left","threads-on-right-side":this.side==="right","hide-at-right":this.side==="right"&&!this.open,"hide-at-left":this.side==="left"&&!this.open};return dt`
      <div id="superviz-comments" class=${It(t)}>
        <div class="header">
          <superviz-comments-topbar
            @close-threads=${this.close}
            side=${this.side.split(":")[0]}
          ></superviz-comments-topbar>
        </div>
        <superviz-comments-annotation-filter
          filter=${this.annotationFilter}
          @select=${this.setFilter}
        >
        </superviz-comments-annotation-filter>
        <superviz-comments-content
          annotations=${JSON.stringify(this.annotations)}
          annotationFilter=${this.annotationFilter}
          participantsList=${JSON.stringify(this.participantsList)}
          class="content"
        ></superviz-comments-content>
        ${this.poweredBy}
      </div>
    `}};Vi.styles=pO,Vi.properties={open:{type:Boolean},annotations:{type:Object},annotationFilter:{type:String},waterMarkState:{type:Boolean},side:{type:String},participantsList:{type:Object},offset:{type:Object}},Vi=Nt([Ft("superviz-comments")],Vi);L();L();var mO=kt(Pt),gO=[mO.styles,Nu],ji=class extends kt(Pt){firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{ne.call(this,["comments"])})}close(){this.dispatchEvent(new CustomEvent("close-threads"))}render(){return dt`
      <div class="comments__topbar">
        <span class="text text-bold comments__topbar__title">COMMENTS</span>
        <span @click=${this.close} class="comments__topbar__close-threads">
          <superviz-icon name=${this.side}></superviz-icon>
        </span>
      </div>
    `}};ji.styles=gO,ji.properties={side:{type:String}},ji=Nt([Ft("superviz-comments-topbar")],ji);L();L();L();L();var{D:vO}=Nm;var pg=()=>document.createComment(""),Br=(s,e,t)=>{var a;let n=s._$AA.parentNode,r=e===void 0?s._$AB:e._$AA;if(t===void 0){let l=n.insertBefore(pg(),r),c=n.insertBefore(pg(),r);t=new vO(l,c,s,s.options)}else{let l=t._$AB.nextSibling,c=t._$AM,u=c!==s;if(u){let m;(a=t._$AQ)==null||a.call(t,s),t._$AM=s,t._$AP!==void 0&&(m=s._$AU)!==c._$AU&&t._$AP(m)}if(l!==r||u){let m=t._$AA;for(;m!==l;){let g=m.nextSibling;n.insertBefore(m,r),m=g}}}return t},ai=(s,e,t=s)=>(s._$AI(e,t),s),yO={},mg=(s,e=yO)=>s._$AH=e,gg=s=>s._$AH,ol=s=>{var n;(n=s._$AP)==null||n.call(s,!1,!0);let e=s._$AA,t=s._$AB.nextSibling;for(;e!==t;){let r=e.nextSibling;e.remove(),e=r}};var vg=(s,e,t)=>{let n=new Map;for(let r=e;r<=t;r++)n.set(s[r],r);return n},li=nl(class extends Dr{constructor(s){if(super(s),s.type!==el.CHILD)throw Error("repeat() can only be used in text expressions")}ht(s,e,t){let n;t===void 0?t=e:e!==void 0&&(n=e);let r=[],a=[],l=0;for(let c of s)r[l]=n?n(c,l):l,a[l]=t(c,l),l++;return{values:a,keys:r}}render(s,e,t){return this.ht(s,e,t).values}update(s,[e,t,n]){var _;let r=gg(s),{values:a,keys:l}=this.ht(e,t,n);if(!Array.isArray(r))return this.dt=l,a;let c=(_=this.dt)!=null?_:this.dt=[],u=[],m,g,E=0,h=r.length-1,y=0,O=a.length-1;for(;E<=h&&y<=O;)if(r[E]===null)E++;else if(r[h]===null)h--;else if(c[E]===l[y])u[y]=ai(r[E],a[y]),E++,y++;else if(c[h]===l[O])u[O]=ai(r[h],a[O]),h--,O--;else if(c[E]===l[O])u[O]=ai(r[E],a[O]),Br(s,u[O+1],r[E]),E++,O--;else if(c[h]===l[y])u[y]=ai(r[h],a[y]),Br(s,r[E],r[h]),h--,y++;else if(m===void 0&&(m=vg(l,y,O),g=vg(c,E,h)),m.has(c[E]))if(m.has(c[h])){let C=g.get(l[y]),T=C!==void 0?r[C]:null;if(T===null){let x=Br(s,r[E]);ai(x,a[y]),u[y]=x}else u[y]=ai(T,a[y]),Br(s,r[E],T),r[C]=null;y++}else ol(r[h]),h--;else ol(r[E]),E++;for(;y<=O;){let C=Br(s,u[O+1]);ai(C,a[y]),u[y++]=C}for(;E<=h;){let C=r[E++];C!==null&&ol(C)}return this.dt=l,mg(s,u),Hn}});var yg=kt(Pt),bO=[yg.styles,Bu],Ji=class extends yg{constructor(){super();this.unselectAnnotation=()=>{this.selectedAnnotation=null};this.unselectAnnotationEsc=t=>{t&&(t==null?void 0:t.key)!=="Escape"||(this.selectedAnnotation=null)};this.selectAnnotation=({detail:t})=>{let{uuid:n}=t;if(this.selectedAnnotation===n){this.selectedAnnotation=null;return}this.selectedAnnotation=n};this.checkLastAnnotation=t=>{var a,l;let n=this.annotations.filter(c=>c.resolved),r=this.annotations.filter(c=>!c.resolved);return this.annotationFilter==="all"?t===((a=n[n.length-1])==null?void 0:a.uuid):t===((l=r[r.length-1])==null?void 0:l.uuid)};this.annotations=[],this.participantsList=[]}updated(t){super.updated(t),this.updateComplete.then(()=>{let n=this.shadowRoot.querySelector(`[uuid='${this.selectedAnnotation}']`);if(!n)return;let r=this.lastCommentId===this.selectedAnnotation,a=r?0:-150,l=n.getClientRects()[0];!l||(this.scrollBy(0,l.y+a),r&&setTimeout(()=>{this.scrollBy(0,l.y+a)},200))})}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("select-annotation",this.selectAnnotation),window.document.body.addEventListener("keyup",this.unselectAnnotationEsc),window.document.body.addEventListener("unselect-annotation",this.unselectAnnotation)}disconnectedCallback(){super.disconnectedCallback(),window.document.body.removeEventListener("select-annotation",this.selectAnnotation),window.document.body.removeEventListener("keyup",this.unselectAnnotationEsc),window.document.body.removeEventListener("unselect-annotation",this.unselectAnnotation)}render(){return dt` ${li(this.annotations.filter(t=>{var n;return(n=t.comments)==null?void 0:n.length}),t=>t.uuid,t=>dt`
        <superviz-comments-annotation-item
          annotation=${JSON.stringify(t)}
          selected="${this.selectedAnnotation}"
          annotationFilter=${this.annotationFilter}
          uuid=${t.uuid}
          isLastComment=${this.checkLastAnnotation(t.uuid)}
          participantsList=${JSON.stringify(this.participantsList)}
        >
        </superviz-comments-annotation-item>
      `)}`}};Ji.styles=bO,Ji.properties={annotations:{type:Object},selectedAnnotation:{type:String},annotationFilter:{type:String},participantsList:{type:Object}},Ji=Nt([Ft("superviz-comments-content")],Ji);L();L();L();L();L();var Wn=class extends Error{},sl=class extends Wn{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}},al=class extends Wn{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}},ll=class extends Wn{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}},zn=class extends Wn{},kr=class extends Wn{constructor(e){super(`Invalid unit ${e}`)}},Ie=class extends Wn{},vn=class extends Wn{constructor(){super("Zone is an abstract class")}};L();L();L();var mt="numeric",yn="short",Ye="long",ci={year:mt,month:mt,day:mt},Zo={year:mt,month:yn,day:mt},Ku={year:mt,month:yn,day:mt,weekday:yn},Yo={year:mt,month:Ye,day:mt},Qo={year:mt,month:Ye,day:mt,weekday:Ye},Xo={hour:mt,minute:mt},ts={hour:mt,minute:mt,second:mt},es={hour:mt,minute:mt,second:mt,timeZoneName:yn},ns={hour:mt,minute:mt,second:mt,timeZoneName:Ye},is={hour:mt,minute:mt,hourCycle:"h23"},rs={hour:mt,minute:mt,second:mt,hourCycle:"h23"},os={hour:mt,minute:mt,second:mt,hourCycle:"h23",timeZoneName:yn},ss={hour:mt,minute:mt,second:mt,hourCycle:"h23",timeZoneName:Ye},as={year:mt,month:mt,day:mt,hour:mt,minute:mt},ls={year:mt,month:mt,day:mt,hour:mt,minute:mt,second:mt},cs={year:mt,month:yn,day:mt,hour:mt,minute:mt},us={year:mt,month:yn,day:mt,hour:mt,minute:mt,second:mt},qu={year:mt,month:yn,day:mt,weekday:yn,hour:mt,minute:mt},ds={year:mt,month:Ye,day:mt,hour:mt,minute:mt,timeZoneName:yn},fs={year:mt,month:Ye,day:mt,hour:mt,minute:mt,second:mt,timeZoneName:yn},hs={year:mt,month:Ye,day:mt,weekday:Ye,hour:mt,minute:mt,timeZoneName:Ye},ps={year:mt,month:Ye,day:mt,weekday:Ye,hour:mt,minute:mt,second:mt,timeZoneName:Ye};L();L();L();L();var We=class{get type(){throw new vn}get name(){throw new vn}get ianaName(){return this.name}get isUniversal(){throw new vn}offsetName(e,t){throw new vn}formatOffset(e,t){throw new vn}offset(e){throw new vn}equals(e){throw new vn}get isValid(){throw new vn}};var Zu=null,_n=class extends We{static get instance(){return Zu===null&&(Zu=new _n),Zu}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:n}){return ul(e,t,n)}formatOffset(e,t){return ui(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}};L();var fl={};function EO(s){return fl[s]||(fl[s]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:s,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),fl[s]}var AO={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function wO(s,e){let t=s.format(e).replace(/\u200E/g,""),n=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(t),[,r,a,l,c,u,m,g]=n;return[l,r,a,c,u,m,g]}function TO(s,e){let t=s.formatToParts(e),n=[];for(let r=0;r<t.length;r++){let{type:a,value:l}=t[r],c=AO[a];a==="era"?n[c]=l:$t(c)||(n[c]=parseInt(l,10))}return n}var dl={},Ce=class extends We{static create(e){return dl[e]||(dl[e]=new Ce(e)),dl[e]}static resetCache(){dl={},fl={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(t){return!1}}constructor(e){super(),this.zoneName=e,this.valid=Ce.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:n}){return ul(e,t,n,this.name)}formatOffset(e,t){return ui(this.offset(e),t)}offset(e){let t=new Date(e);if(isNaN(t))return NaN;let n=EO(this.name),[r,a,l,c,u,m,g]=n.formatToParts?TO(n,t):wO(n,t);c==="BC"&&(r=-Math.abs(r)+1);let h=$r({year:r,month:a,day:l,hour:u===24?0:u,minute:m,second:g,millisecond:0}),y=+t,O=y%1e3;return y-=O>=0?O:1e3+O,(h-y)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}};L();var bg={};function CO(s,e={}){let t=JSON.stringify([s,e]),n=bg[t];return n||(n=new Intl.ListFormat(s,e),bg[t]=n),n}var Yu={};function Qu(s,e={}){let t=JSON.stringify([s,e]),n=Yu[t];return n||(n=new Intl.DateTimeFormat(s,e),Yu[t]=n),n}var Xu={};function SO(s,e={}){let t=JSON.stringify([s,e]),n=Xu[t];return n||(n=new Intl.NumberFormat(s,e),Xu[t]=n),n}var td={};function OO(s,e={}){let l=e,{base:t}=l,n=Hc(l,["base"]),r=JSON.stringify([s,n]),a=td[r];return a||(a=new Intl.RelativeTimeFormat(s,e),td[r]=a),a}var ms=null;function _O(){return ms||(ms=new Intl.DateTimeFormat().resolvedOptions().locale,ms)}function xO(s){let e=s.indexOf("-x-");e!==-1&&(s=s.substring(0,e));let t=s.indexOf("-u-");if(t===-1)return[s];{let n,r;try{n=Qu(s).resolvedOptions(),r=s}catch(c){let u=s.substring(0,t);n=Qu(u).resolvedOptions(),r=u}let{numberingSystem:a,calendar:l}=n;return[r,a,l]}}function PO(s,e,t){return(t||e)&&(s.includes("-u-")||(s+="-u"),t&&(s+=`-ca-${t}`),e&&(s+=`-nu-${e}`)),s}function IO(s){let e=[];for(let t=1;t<=12;t++){let n=Tt.utc(2009,t,1);e.push(s(n))}return e}function MO(s){let e=[];for(let t=1;t<=7;t++){let n=Tt.utc(2016,11,13+t);e.push(s(n))}return e}function hl(s,e,t,n){let r=s.listingMode();return r==="error"?null:r==="en"?t(e):n(e)}function RO(s){return s.numberingSystem&&s.numberingSystem!=="latn"?!1:s.numberingSystem==="latn"||!s.locale||s.locale.startsWith("en")||new Intl.DateTimeFormat(s.intl).resolvedOptions().numberingSystem==="latn"}var ed=class{constructor(e,t,n){this.padTo=n.padTo||0,this.floor=n.floor||!1;let c=n,{padTo:r,floor:a}=c,l=Hc(c,["padTo","floor"]);if(!t||Object.keys(l).length>0){let u=lt({useGrouping:!1},n);n.padTo>0&&(u.minimumIntegerDigits=n.padTo),this.inf=SO(e,u)}}format(e){if(this.inf){let t=this.floor?Math.floor(e):e;return this.inf.format(t)}else{let t=this.floor?Math.floor(e):Ur(e,3);return fe(t,this.padTo)}}},nd=class{constructor(e,t,n){this.opts=n,this.originalZone=void 0;let r;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){let l=-1*(e.offset/60),c=l>=0?`Etc/GMT+${l}`:`Etc/GMT${l}`;e.offset!==0&&Ce.create(c).valid?(r=c,this.dt=e):(r="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,r=e.zone.name):(r="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);let a=lt({},this.opts);a.timeZone=a.timeZone||r,this.dtf=Qu(t,a)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){let e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(t=>{if(t.type==="timeZoneName"){let n=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return Mt(lt({},t),{value:n})}else return t}):e}resolvedOptions(){return this.dtf.resolvedOptions()}},id=class{constructor(e,t,n){this.opts=lt({style:"long"},n),!t&&pl()&&(this.rtf=OO(e,n))}format(e,t){return this.rtf?this.rtf.format(e,t):Eg(t,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}},qt=class{static fromOpts(e){return qt.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,t,n,r=!1){let a=e||te.defaultLocale,l=a||(r?"en-US":_O()),c=t||te.defaultNumberingSystem,u=n||te.defaultOutputCalendar;return new qt(l,c,u,a)}static resetCache(){ms=null,Yu={},Xu={},td={}}static fromObject({locale:e,numberingSystem:t,outputCalendar:n}={}){return qt.create(e,t,n)}constructor(e,t,n,r){let[a,l,c]=xO(e);this.locale=a,this.numberingSystem=t||l||null,this.outputCalendar=n||c||null,this.intl=PO(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=r,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=RO(this)),this.fastNumbersCached}listingMode(){let e=this.isEnglish(),t=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&t?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:qt.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone(Mt(lt({},e),{defaultToEN:!0}))}redefaultToSystem(e={}){return this.clone(Mt(lt({},e),{defaultToEN:!1}))}months(e,t=!1){return hl(this,e,rd,()=>{let n=t?{month:e,day:"numeric"}:{month:e},r=t?"format":"standalone";return this.monthsCache[r][e]||(this.monthsCache[r][e]=IO(a=>this.extract(a,n,"month"))),this.monthsCache[r][e]})}weekdays(e,t=!1){return hl(this,e,od,()=>{let n=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},r=t?"format":"standalone";return this.weekdaysCache[r][e]||(this.weekdaysCache[r][e]=MO(a=>this.extract(a,n,"weekday"))),this.weekdaysCache[r][e]})}meridiems(){return hl(this,void 0,()=>sd,()=>{if(!this.meridiemCache){let e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Tt.utc(2016,11,13,9),Tt.utc(2016,11,13,19)].map(t=>this.extract(t,e,"dayperiod"))}return this.meridiemCache})}eras(e){return hl(this,e,ad,()=>{let t={era:e};return this.eraCache[e]||(this.eraCache[e]=[Tt.utc(-40,1,1),Tt.utc(2017,1,1)].map(n=>this.extract(n,t,"era"))),this.eraCache[e]})}extract(e,t,n){let r=this.dtFormatter(e,t),a=r.formatToParts(),l=a.find(c=>c.type.toLowerCase()===n);return l?l.value:null}numberFormatter(e={}){return new ed(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new nd(e,this.intl,t)}relFormatter(e={}){return new id(this.intl,this.isEnglish(),e)}listFormatter(e={}){return CO(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}};L();L();var cd=null,he=class extends We{static get utcInstance(){return cd===null&&(cd=new he(0)),cd}static instance(e){return e===0?he.utcInstance:new he(e)}static parseSpecifier(e){if(e){let t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new he(Ki(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${ui(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${ui(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return ui(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}};L();var Hr=class extends We{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}};function bn(s,e){let t;if($t(s)||s===null)return e;if(s instanceof We)return s;if(Ag(s)){let n=s.toLowerCase();return n==="default"?e:n==="local"||n==="system"?_n.instance:n==="utc"||n==="gmt"?he.utcInstance:he.parseSpecifier(n)||Ce.create(s)}else return xn(s)?he.instance(s):typeof s=="object"&&"offset"in s&&typeof s.offset=="function"?s:new Hr(s)}var wg=()=>Date.now(),Tg="system",Cg=null,Sg=null,Og=null,_g=60,xg,te=class{static get now(){return wg}static set now(e){wg=e}static set defaultZone(e){Tg=e}static get defaultZone(){return bn(Tg,_n.instance)}static get defaultLocale(){return Cg}static set defaultLocale(e){Cg=e}static get defaultNumberingSystem(){return Sg}static set defaultNumberingSystem(e){Sg=e}static get defaultOutputCalendar(){return Og}static set defaultOutputCalendar(e){Og=e}static get twoDigitCutoffYear(){return _g}static set twoDigitCutoffYear(e){_g=e%100}static get throwOnInvalid(){return xg}static set throwOnInvalid(e){xg=e}static resetCaches(){qt.resetCache(),Ce.resetCache()}};function $t(s){return typeof s=="undefined"}function xn(s){return typeof s=="number"}function gs(s){return typeof s=="number"&&s%1===0}function Ag(s){return typeof s=="string"}function Pg(s){return Object.prototype.toString.call(s)==="[object Date]"}function pl(){try{return typeof Intl!="undefined"&&!!Intl.RelativeTimeFormat}catch(s){return!1}}function Ig(s){return Array.isArray(s)?s:[s]}function ud(s,e,t){if(s.length!==0)return s.reduce((n,r)=>{let a=[e(r),r];return n&&t(n[0],a[0])===n[0]?n:a},null)[1]}function Mg(s,e){return e.reduce((t,n)=>(t[n]=s[n],t),{})}function di(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function Pn(s,e,t){return gs(s)&&s>=e&&s<=t}function LO(s,e){return s-e*Math.floor(s/e)}function fe(s,e=2){let t=s<0,n;return t?n="-"+(""+-s).padStart(e,"0"):n=(""+s).padStart(e,"0"),n}function Vn(s){if(!($t(s)||s===null||s===""))return parseInt(s,10)}function fi(s){if(!($t(s)||s===null||s===""))return parseFloat(s)}function vs(s){if(!($t(s)||s===null||s==="")){let e=parseFloat("0."+s)*1e3;return Math.floor(e)}}function Ur(s,e,t=!1){let n=hp(10,e);return(t?Math.trunc:Math.round)(s*n)/n}function qi(s){return s%4===0&&(s%100!==0||s%400===0)}function Zi(s){return qi(s)?366:365}function Gr(s,e){let t=LO(e-1,12)+1,n=s+(e-t)/12;return t===2?qi(n)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][t-1]}function $r(s){let e=Date.UTC(s.year,s.month-1,s.day,s.hour,s.minute,s.second,s.millisecond);return s.year<100&&s.year>=0&&(e=new Date(e),e.setUTCFullYear(s.year,s.month-1,s.day)),+e}function Wr(s){let e=(s+Math.floor(s/4)-Math.floor(s/100)+Math.floor(s/400))%7,t=s-1,n=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7;return e===4||n===3?53:52}function ys(s){return s>99?s:s>te.twoDigitCutoffYear?1900+s:2e3+s}function ul(s,e,t,n=null){let r=new Date(s),a={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};n&&(a.timeZone=n);let l=lt({timeZoneName:e},a),c=new Intl.DateTimeFormat(t,l).formatToParts(r).find(u=>u.type.toLowerCase()==="timezonename");return c?c.value:null}function Ki(s,e){let t=parseInt(s,10);Number.isNaN(t)&&(t=0);let n=parseInt(e,10)||0,r=t<0||Object.is(t,-0)?-n:n;return t*60+r}function dd(s){let e=Number(s);if(typeof s=="boolean"||s===""||Number.isNaN(e))throw new Ie(`Invalid unit value ${s}`);return e}function zr(s,e){let t={};for(let n in s)if(di(s,n)){let r=s[n];if(r==null)continue;t[e(n)]=dd(r)}return t}function ui(s,e){let t=Math.trunc(Math.abs(s/60)),n=Math.trunc(Math.abs(s%60)),r=s>=0?"+":"-";switch(e){case"short":return`${r}${fe(t,2)}:${fe(n,2)}`;case"narrow":return`${r}${t}${n>0?`:${n}`:""}`;case"techie":return`${r}${fe(t,2)}${fe(n,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function bs(s){return Mg(s,["hour","minute","second","millisecond"])}var DO=["January","February","March","April","May","June","July","August","September","October","November","December"],fd=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],NO=["J","F","M","A","M","J","J","A","S","O","N","D"];function rd(s){switch(s){case"narrow":return[...NO];case"short":return[...fd];case"long":return[...DO];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}var hd=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],pd=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],FO=["M","T","W","T","F","S","S"];function od(s){switch(s){case"narrow":return[...FO];case"short":return[...pd];case"long":return[...hd];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}var sd=["AM","PM"],BO=["Before Christ","Anno Domini"],kO=["BC","AD"],$O=["B","A"];function ad(s){switch(s){case"narrow":return[...$O];case"short":return[...kO];case"long":return[...BO];default:return null}}function Rg(s){return sd[s.hour<12?0:1]}function Lg(s,e){return od(e)[s.weekday-1]}function Dg(s,e){return rd(e)[s.month-1]}function Ng(s,e){return ad(e)[s.year<0?0:1]}function Eg(s,e,t="always",n=!1){let r={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},a=["hours","minutes","seconds"].indexOf(s)===-1;if(t==="auto"&&a){let E=s==="days";switch(e){case 1:return E?"tomorrow":`next ${r[s][0]}`;case-1:return E?"yesterday":`last ${r[s][0]}`;case 0:return E?"today":`this ${r[s][0]}`;default:}}let l=Object.is(e,-0)||e<0,c=Math.abs(e),u=c===1,m=r[s],g=n?u?m[1]:m[2]||m[1]:u?r[s][0]:s;return l?`${c} ${g} ago`:`in ${c} ${g}`}function Fg(s,e){let t="";for(let n of s)n.literal?t+=n.val:t+=e(n.val);return t}var UO={D:ci,DD:Zo,DDD:Yo,DDDD:Qo,t:Xo,tt:ts,ttt:es,tttt:ns,T:is,TT:rs,TTT:os,TTTT:ss,f:as,ff:cs,fff:ds,ffff:hs,F:ls,FF:us,FFF:fs,FFFF:ps},pe=class{static create(e,t={}){return new pe(e,t)}static parseFormat(e){let t=null,n="",r=!1,a=[];for(let l=0;l<e.length;l++){let c=e.charAt(l);c==="'"?(n.length>0&&a.push({literal:r||/^\s+$/.test(n),val:n}),t=null,n="",r=!r):r||c===t?n+=c:(n.length>0&&a.push({literal:/^\s+$/.test(n),val:n}),n=c,t=c)}return n.length>0&&a.push({literal:r||/^\s+$/.test(n),val:n}),a}static macroTokenToFormatOpts(e){return UO[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,lt(lt({},this.opts),t)).format()}dtFormatter(e,t={}){return this.loc.dtFormatter(e,lt(lt({},this.opts),t))}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e,t=0){if(this.opts.forceSimple)return fe(e,t);let n=lt({},this.opts);return t>0&&(n.padTo=t),this.loc.numberFormatter(n).format(e)}formatDateTimeFromString(e,t){let n=this.loc.listingMode()==="en",r=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",a=(y,O)=>this.loc.extract(e,y,O),l=y=>e.isOffsetFixed&&e.offset===0&&y.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,y.format):"",c=()=>n?Rg(e):a({hour:"numeric",hourCycle:"h12"},"dayperiod"),u=(y,O)=>n?Dg(e,y):a(O?{month:y}:{month:y,day:"numeric"},"month"),m=(y,O)=>n?Lg(e,y):a(O?{weekday:y}:{weekday:y,month:"long",day:"numeric"},"weekday"),g=y=>{let O=pe.macroTokenToFormatOpts(y);return O?this.formatWithSystemDefault(e,O):y},E=y=>n?Ng(e,y):a({era:y},"era"),h=y=>{switch(y){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return l({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return l({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return l({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return c();case"d":return r?a({day:"numeric"},"day"):this.num(e.day);case"dd":return r?a({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return m("short",!0);case"cccc":return m("long",!0);case"ccccc":return m("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return m("short",!1);case"EEEE":return m("long",!1);case"EEEEE":return m("narrow",!1);case"L":return r?a({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return r?a({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return u("short",!0);case"LLLL":return u("long",!0);case"LLLLL":return u("narrow",!0);case"M":return r?a({month:"numeric"},"month"):this.num(e.month);case"MM":return r?a({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return u("short",!1);case"MMMM":return u("long",!1);case"MMMMM":return u("narrow",!1);case"y":return r?a({year:"numeric"},"year"):this.num(e.year);case"yy":return r?a({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return r?a({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return r?a({year:"numeric"},"year"):this.num(e.year,6);case"G":return E("short");case"GG":return E("long");case"GGGGG":return E("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return g(y)}};return Fg(pe.parseFormat(t),h)}formatDurationFromString(e,t){let n=u=>{switch(u[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},r=u=>m=>{let g=n(m);return g?this.num(u.get(g),m.length):m},a=pe.parseFormat(t),l=a.reduce((u,{literal:m,val:g})=>m?u:u.concat(g),[]),c=e.shiftTo(...l.map(n).filter(u=>u));return Fg(a,r(c))}};L();var Me=class{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}};L();var kg=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function jr(...s){let e=s.reduce((t,n)=>t+n.source,"");return RegExp(`^${e}$`)}function Jr(...s){return e=>s.reduce(([t,n,r],a)=>{let[l,c,u]=a(e,r);return[lt(lt({},t),l),c||n,u]},[{},null,1]).slice(0,2)}function Kr(s,...e){if(s==null)return[null,null];for(let[t,n]of e){let r=t.exec(s);if(r)return n(r)}return[null,null]}function $g(...s){return(e,t)=>{let n={},r;for(r=0;r<s.length;r++)n[s[r]]=Vn(e[t+r]);return[n,null,t+r]}}var Ug=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,HO=`(?:${Ug.source}?(?:\\[(${kg.source})\\])?)?`,md=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Hg=RegExp(`${md.source}${HO}`),gd=RegExp(`(?:T${Hg.source})?`),GO=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,WO=/(\d{4})-?W(\d\d)(?:-?(\d))?/,zO=/(\d{4})-?(\d{3})/,VO=$g("weekYear","weekNumber","weekDay"),jO=$g("year","ordinal"),JO=/(\d{4})-(\d\d)-(\d\d)/,Gg=RegExp(`${md.source} ?(?:${Ug.source}|(${kg.source}))?`),KO=RegExp(`(?: ${Gg.source})?`);function Vr(s,e,t){let n=s[e];return $t(n)?t:Vn(n)}function qO(s,e){return[{year:Vr(s,e),month:Vr(s,e+1,1),day:Vr(s,e+2,1)},null,e+3]}function qr(s,e){return[{hours:Vr(s,e,0),minutes:Vr(s,e+1,0),seconds:Vr(s,e+2,0),milliseconds:vs(s[e+3])},null,e+4]}function Es(s,e){let t=!s[e]&&!s[e+1],n=Ki(s[e+1],s[e+2]),r=t?null:he.instance(n);return[{},r,e+3]}function As(s,e){let t=s[e]?Ce.create(s[e]):null;return[{},t,e+1]}var ZO=RegExp(`^T?${md.source}$`),YO=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function QO(s){let[e,t,n,r,a,l,c,u,m]=s,g=e[0]==="-",E=u&&u[0]==="-",h=(y,O=!1)=>y!==void 0&&(O||y&&g)?-y:y;return[{years:h(fi(t)),months:h(fi(n)),weeks:h(fi(r)),days:h(fi(a)),hours:h(fi(l)),minutes:h(fi(c)),seconds:h(fi(u),u==="-0"),milliseconds:h(vs(m),E)}]}var XO={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function vd(s,e,t,n,r,a,l){let c={year:e.length===2?ys(Vn(e)):Vn(e),month:fd.indexOf(t)+1,day:Vn(n),hour:Vn(r),minute:Vn(a)};return l&&(c.second=Vn(l)),s&&(c.weekday=s.length>3?hd.indexOf(s)+1:pd.indexOf(s)+1),c}var t_=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function e_(s){let[,e,t,n,r,a,l,c,u,m,g,E]=s,h=vd(e,r,n,t,a,l,c),y;return u?y=XO[u]:m?y=0:y=Ki(g,E),[h,new he(y)]}function n_(s){return s.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}var i_=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,r_=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,o_=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Bg(s){let[,e,t,n,r,a,l,c]=s;return[vd(e,r,n,t,a,l,c),he.utcInstance]}function s_(s){let[,e,t,n,r,a,l,c]=s;return[vd(e,c,t,n,r,a,l),he.utcInstance]}var a_=jr(GO,gd),l_=jr(WO,gd),c_=jr(zO,gd),u_=jr(Hg),Wg=Jr(qO,qr,Es,As),d_=Jr(VO,qr,Es,As),f_=Jr(jO,qr,Es,As),h_=Jr(qr,Es,As);function zg(s){return Kr(s,[a_,Wg],[l_,d_],[c_,f_],[u_,h_])}function Vg(s){return Kr(n_(s),[t_,e_])}function jg(s){return Kr(s,[i_,Bg],[r_,Bg],[o_,s_])}function Jg(s){return Kr(s,[YO,QO])}var p_=Jr(qr);function Kg(s){return Kr(s,[ZO,p_])}var m_=jr(JO,KO),g_=jr(Gg),v_=Jr(qr,Es,As);function qg(s){return Kr(s,[m_,Wg],[g_,v_])}var Zg="Invalid Duration",Qg={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},y_=lt({years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3}},Qg),ln=146097/400,Zr=146097/4800,b_=lt({years:{quarters:4,months:12,weeks:ln/7,days:ln,hours:ln*24,minutes:ln*24*60,seconds:ln*24*60*60,milliseconds:ln*24*60*60*1e3},quarters:{months:3,weeks:ln/28,days:ln/4,hours:ln*24/4,minutes:ln*24*60/4,seconds:ln*24*60*60/4,milliseconds:ln*24*60*60*1e3/4},months:{weeks:Zr/7,days:Zr,hours:Zr*24,minutes:Zr*24*60,seconds:Zr*24*60*60,milliseconds:Zr*24*60*60*1e3}},Qg),Yi=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],E_=Yi.slice(0).reverse();function hi(s,e,t=!1){let n={values:t?e.values:lt(lt({},s.values),e.values||{}),loc:s.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||s.conversionAccuracy,matrix:e.matrix||s.matrix};return new Gt(n)}function Xg(s,e){var n;let t=(n=e.milliseconds)!=null?n:0;for(let r of E_.slice(1))e[r]&&(t+=e[r]*s[r].milliseconds);return t}function Yg(s,e){let t=Xg(s,e)<0?-1:1;Yi.reduceRight((n,r)=>{if($t(e[r]))return n;if(n){let a=e[n]*t,l=s[r][n],c=Math.floor(a/l);e[r]+=c*t,e[n]-=c*l*t}return r},null),Yi.reduce((n,r)=>{if($t(e[r]))return n;if(n){let a=e[n]%1;e[n]-=a,e[r]+=a*s[n][r]}return r},null)}function A_(s){let e={};for(let[t,n]of Object.entries(s))n!==0&&(e[t]=n);return e}var Gt=class{constructor(e){let t=e.conversionAccuracy==="longterm"||!1,n=t?b_:y_;e.matrix&&(n=e.matrix),this.values=e.values,this.loc=e.loc||qt.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=n,this.isLuxonDuration=!0}static fromMillis(e,t){return Gt.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(e==null||typeof e!="object")throw new Ie(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Gt({values:zr(e,Gt.normalizeUnit),loc:qt.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(xn(e))return Gt.fromMillis(e);if(Gt.isDuration(e))return e;if(typeof e=="object")return Gt.fromObject(e);throw new Ie(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){let[n]=Jg(e);return n?Gt.fromObject(n,t):Gt.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){let[n]=Kg(e);return n?Gt.fromObject(n,t):Gt.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new Ie("need to specify a reason the Duration is invalid");let n=e instanceof Me?e:new Me(e,t);if(te.throwOnInvalid)throw new ll(n);return new Gt({invalid:n})}static normalizeUnit(e){let t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!t)throw new kr(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){let n=Mt(lt({},t),{floor:t.round!==!1&&t.floor!==!1});return this.isValid?pe.create(this.loc,n).formatDurationFromString(this,e):Zg}toHuman(e={}){if(!this.isValid)return Zg;let t=Yi.map(n=>{let r=this.values[n];return $t(r)?null:this.loc.numberFormatter(Mt(lt({style:"unit",unitDisplay:"long"},e),{unit:n.slice(0,-1)})).format(r)}).filter(n=>n);return this.loc.listFormatter(lt({type:"conjunction",style:e.listStyle||"narrow"},e)).format(t)}toObject(){return this.isValid?lt({},this.values):{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Ur(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;let t=this.toMillis();return t<0||t>=864e5?null:(e=Mt(lt({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},e),{includeOffset:!1}),Tt.fromMillis(t,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.isValid?Xg(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;let t=Gt.fromDurationLike(e),n={};for(let r of Yi)(di(t.values,r)||di(this.values,r))&&(n[r]=t.get(r)+this.get(r));return hi(this,{values:n},!0)}minus(e){if(!this.isValid)return this;let t=Gt.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;let t={};for(let n of Object.keys(this.values))t[n]=dd(e(this.values[n],n));return hi(this,{values:t},!0)}get(e){return this[Gt.normalizeUnit(e)]}set(e){if(!this.isValid)return this;let t=lt(lt({},this.values),zr(e,Gt.normalizeUnit));return hi(this,{values:t})}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:n,matrix:r}={}){let l={loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:r,conversionAccuracy:n};return hi(this,l)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;let e=this.toObject();return Yg(this.matrix,e),hi(this,{values:e},!0)}rescale(){if(!this.isValid)return this;let e=A_(this.normalize().shiftToAll().toObject());return hi(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(l=>Gt.normalizeUnit(l));let t={},n={},r=this.toObject(),a;for(let l of Yi)if(e.indexOf(l)>=0){a=l;let c=0;for(let m in n)c+=this.matrix[m][l]*n[m],n[m]=0;xn(r[l])&&(c+=r[l]);let u=Math.trunc(c);t[l]=u,n[l]=(c*1e3-u*1e3)/1e3}else xn(r[l])&&(n[l]=r[l]);for(let l in n)n[l]!==0&&(t[a]+=l===a?n[l]:n[l]/this.matrix[a][l]);return Yg(this.matrix,t),hi(this,{values:t},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;let e={};for(let t of Object.keys(this.values))e[t]=this.values[t]===0?0:-this.values[t];return hi(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function t(n,r){return n===void 0||n===0?r===void 0||r===0:n===r}for(let n of Yi)if(!t(this.values[n],e.values[n]))return!1;return!0}};L();var Yr="Invalid Interval";function w_(s,e){return!s||!s.isValid?re.invalid("missing or invalid start"):!e||!e.isValid?re.invalid("missing or invalid end"):e<s?re.invalid("end before start",`The end of an interval must be after its start, but you had start=${s.toISO()} and end=${e.toISO()}`):null}var re=class{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new Ie("need to specify a reason the Interval is invalid");let n=e instanceof Me?e:new Me(e,t);if(te.throwOnInvalid)throw new al(n);return new re({invalid:n})}static fromDateTimes(e,t){let n=Qr(e),r=Qr(t),a=w_(n,r);return a==null?new re({start:n,end:r}):a}static after(e,t){let n=Gt.fromDurationLike(t),r=Qr(e);return re.fromDateTimes(r,r.plus(n))}static before(e,t){let n=Gt.fromDurationLike(t),r=Qr(e);return re.fromDateTimes(r.minus(n),r)}static fromISO(e,t){let[n,r]=(e||"").split("/",2);if(n&&r){let a,l;try{a=Tt.fromISO(n,t),l=a.isValid}catch(m){l=!1}let c,u;try{c=Tt.fromISO(r,t),u=c.isValid}catch(m){u=!1}if(l&&u)return re.fromDateTimes(a,c);if(l){let m=Gt.fromISO(r,t);if(m.isValid)return re.after(a,m)}else if(u){let m=Gt.fromISO(n,t);if(m.isValid)return re.before(c,m)}}return re.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;let t=this.start.startOf(e),n=this.end.startOf(e);return Math.floor(n.diff(t,e).get(e))+(n.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:t}={}){return this.isValid?re.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];let t=e.map(Qr).filter(l=>this.contains(l)).sort(),n=[],{s:r}=this,a=0;for(;r<this.e;){let l=t[a]||this.e,c=+l>+this.e?this.e:l;n.push(re.fromDateTimes(r,c)),r=c,a+=1}return n}splitBy(e){let t=Gt.fromDurationLike(e);if(!this.isValid||!t.isValid||t.as("milliseconds")===0)return[];let{s:n}=this,r=1,a,l=[];for(;n<this.e;){let c=this.start.plus(t.mapUnits(u=>u*r));a=+c>+this.e?this.e:c,l.push(re.fromDateTimes(n,a)),n=a,r+=1}return l}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;let t=this.s>e.s?this.s:e.s,n=this.e<e.e?this.e:e.e;return t>=n?null:re.fromDateTimes(t,n)}union(e){if(!this.isValid)return this;let t=this.s<e.s?this.s:e.s,n=this.e>e.e?this.e:e.e;return re.fromDateTimes(t,n)}static merge(e){let[t,n]=e.sort((r,a)=>r.s-a.s).reduce(([r,a],l)=>a?a.overlaps(l)||a.abutsStart(l)?[r,a.union(l)]:[r.concat([a]),l]:[r,l],[[],null]);return n&&t.push(n),t}static xor(e){let t=null,n=0,r=[],a=e.map(u=>[{time:u.s,type:"s"},{time:u.e,type:"e"}]),l=Array.prototype.concat(...a),c=l.sort((u,m)=>u.time-m.time);for(let u of c)n+=u.type==="s"?1:-1,n===1?t=u.time:(t&&+t!=+u.time&&r.push(re.fromDateTimes(t,u.time)),t=null);return re.merge(r)}difference(...e){return re.xor([this].concat(e)).map(t=>this.intersection(t)).filter(t=>t&&!t.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:Yr}toLocaleString(e=ci,t={}){return this.isValid?pe.create(this.s.loc.clone(t),e).formatInterval(this):Yr}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Yr}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Yr}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Yr}toFormat(e,{separator:t=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:Yr}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):Gt.invalid(this.invalidReason)}mapEndpoints(e){return re.fromDateTimes(e(this.s),e(this.e))}};L();var jn=class{static hasDST(e=te.defaultZone){let t=Tt.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return Ce.isValidZone(e)}static normalizeZone(e){return bn(e,te.defaultZone)}static months(e="long",{locale:t=null,numberingSystem:n=null,locObj:r=null,outputCalendar:a="gregory"}={}){return(r||qt.create(t,n,a)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:n=null,locObj:r=null,outputCalendar:a="gregory"}={}){return(r||qt.create(t,n,a)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:n=null,locObj:r=null}={}){return(r||qt.create(t,n,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:n=null,locObj:r=null}={}){return(r||qt.create(t,n,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return qt.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return qt.create(t,null,"gregory").eras(e)}static features(){return{relative:pl()}}};L();function tv(s,e){let t=r=>r.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),n=t(e)-t(s);return Math.floor(Gt.fromMillis(n).as("days"))}function T_(s,e,t){let n=[["years",(u,m)=>m.year-u.year],["quarters",(u,m)=>m.quarter-u.quarter+(m.year-u.year)*4],["months",(u,m)=>m.month-u.month+(m.year-u.year)*12],["weeks",(u,m)=>{let g=tv(u,m);return(g-g%7)/7}],["days",tv]],r={},a=s,l,c;for(let[u,m]of n)t.indexOf(u)>=0&&(l=u,r[u]=m(s,e),c=a.plus(r),c>e?(r[u]--,s=a.plus(r),s>e&&(c=s,r[u]--,s=a.plus(r))):s=c);return[s,r,c,l]}function ev(s,e,t,n){let[r,a,l,c]=T_(s,e,t),u=e-r,m=t.filter(E=>["hours","minutes","seconds","milliseconds"].indexOf(E)>=0);m.length===0&&(l<e&&(l=r.plus({[c]:1})),l!==r&&(a[c]=(a[c]||0)+u/(l-r)));let g=Gt.fromObject(a,n);return m.length>0?Gt.fromMillis(u,n).shiftTo(...m).plus(g):g}L();L();var yd={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},nv={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},C_=yd.hanidec.replace(/[\[|\]]/g,"").split("");function iv(s){let e=parseInt(s,10);if(isNaN(e)){e="";for(let t=0;t<s.length;t++){let n=s.charCodeAt(t);if(s[t].search(yd.hanidec)!==-1)e+=C_.indexOf(s[t]);else for(let r in nv){let[a,l]=nv[r];n>=a&&n<=l&&(e+=n-a)}}return parseInt(e,10)}else return e}function cn({numberingSystem:s},e=""){return new RegExp(`${yd[s||"latn"]}${e}`)}var S_="missing Intl.DateTimeFormat.formatToParts support";function Yt(s,e=t=>t){return{regex:s,deser:([t])=>e(iv(t))}}var O_=String.fromCharCode(160),sv=`[ ${O_}]`,av=new RegExp(sv,"g");function __(s){return s.replace(/\./g,"\\.?").replace(av,sv)}function rv(s){return s.replace(/\./g,"").replace(av," ").toLowerCase()}function En(s,e){return s===null?null:{regex:RegExp(s.map(__).join("|")),deser:([t])=>s.findIndex(n=>rv(t)===rv(n))+e}}function ov(s,e){return{regex:s,deser:([,t,n])=>Ki(t,n),groups:e}}function ml(s){return{regex:s,deser:([e])=>e}}function x_(s){return s.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function P_(s,e){let t=cn(e),n=cn(e,"{2}"),r=cn(e,"{3}"),a=cn(e,"{4}"),l=cn(e,"{6}"),c=cn(e,"{1,2}"),u=cn(e,"{1,3}"),m=cn(e,"{1,6}"),g=cn(e,"{1,9}"),E=cn(e,"{2,4}"),h=cn(e,"{4,6}"),y=C=>({regex:RegExp(x_(C.val)),deser:([T])=>T,literal:!0}),_=(C=>{if(s.literal)return y(C);switch(C.val){case"G":return En(e.eras("short"),0);case"GG":return En(e.eras("long"),0);case"y":return Yt(m);case"yy":return Yt(E,ys);case"yyyy":return Yt(a);case"yyyyy":return Yt(h);case"yyyyyy":return Yt(l);case"M":return Yt(c);case"MM":return Yt(n);case"MMM":return En(e.months("short",!0),1);case"MMMM":return En(e.months("long",!0),1);case"L":return Yt(c);case"LL":return Yt(n);case"LLL":return En(e.months("short",!1),1);case"LLLL":return En(e.months("long",!1),1);case"d":return Yt(c);case"dd":return Yt(n);case"o":return Yt(u);case"ooo":return Yt(r);case"HH":return Yt(n);case"H":return Yt(c);case"hh":return Yt(n);case"h":return Yt(c);case"mm":return Yt(n);case"m":return Yt(c);case"q":return Yt(c);case"qq":return Yt(n);case"s":return Yt(c);case"ss":return Yt(n);case"S":return Yt(u);case"SSS":return Yt(r);case"u":return ml(g);case"uu":return ml(c);case"uuu":return Yt(t);case"a":return En(e.meridiems(),0);case"kkkk":return Yt(a);case"kk":return Yt(E,ys);case"W":return Yt(c);case"WW":return Yt(n);case"E":case"c":return Yt(t);case"EEE":return En(e.weekdays("short",!1),1);case"EEEE":return En(e.weekdays("long",!1),1);case"ccc":return En(e.weekdays("short",!0),1);case"cccc":return En(e.weekdays("long",!0),1);case"Z":case"ZZ":return ov(new RegExp(`([+-]${c.source})(?::(${n.source}))?`),2);case"ZZZ":return ov(new RegExp(`([+-]${c.source})(${n.source})?`),2);case"z":return ml(/[a-z_+-/]{1,256}?/i);case" ":return ml(/[^\S\n\r]/);default:return y(C)}})(s)||{invalidReason:S_};return _.token=s,_}var I_={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function M_(s,e,t){let{type:n,value:r}=s;if(n==="literal"){let u=/^\s+$/.test(r);return{literal:!u,val:u?" ":r}}let a=e[n],l=n;n==="hour"&&(e.hour12!=null?l=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?l="hour12":l="hour24":l=t.hour12?"hour12":"hour24");let c=I_[l];if(typeof c=="object"&&(c=c[a]),c)return{literal:!1,val:c}}function R_(s){return[`^${s.map(t=>t.regex).reduce((t,n)=>`${t}(${n.source})`,"")}$`,s]}function L_(s,e,t){let n=s.match(e);if(n){let r={},a=1;for(let l in t)if(di(t,l)){let c=t[l],u=c.groups?c.groups+1:1;!c.literal&&c.token&&(r[c.token.val[0]]=c.deser(n.slice(a,a+u))),a+=u}return[n,r]}else return[n,{}]}function D_(s){let e=a=>{switch(a){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}},t=null,n;return $t(s.z)||(t=Ce.create(s.z)),$t(s.Z)||(t||(t=new he(s.Z)),n=s.Z),$t(s.q)||(s.M=(s.q-1)*3+1),$t(s.h)||(s.h<12&&s.a===1?s.h+=12:s.h===12&&s.a===0&&(s.h=0)),s.G===0&&s.y&&(s.y=-s.y),$t(s.u)||(s.S=vs(s.u)),[Object.keys(s).reduce((a,l)=>{let c=e(l);return c&&(a[c]=s[l]),a},{}),t,n]}var bd=null;function N_(){return bd||(bd=Tt.fromMillis(1555555555555)),bd}function F_(s,e){if(s.literal)return s;let t=pe.macroTokenToFormatOpts(s.val),n=wd(t,e);return n==null||n.includes(void 0)?s:n}function Ed(s,e){return Array.prototype.concat(...s.map(t=>F_(t,e)))}function Ad(s,e,t){let n=Ed(pe.parseFormat(t),s),r=n.map(l=>P_(l,s)),a=r.find(l=>l.invalidReason);if(a)return{input:e,tokens:n,invalidReason:a.invalidReason};{let[l,c]=R_(r),u=RegExp(l,"i"),[m,g]=L_(e,u,c),[E,h,y]=g?D_(g):[null,null,void 0];if(di(g,"a")&&di(g,"H"))throw new zn("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:n,regex:u,rawMatches:m,matches:g,result:E,zone:h,specificOffset:y}}}function lv(s,e,t){let{result:n,zone:r,specificOffset:a,invalidReason:l}=Ad(s,e,t);return[n,r,a,l]}function wd(s,e){if(!s)return null;let n=pe.create(e,s).dtFormatter(N_()),r=n.formatToParts(),a=n.resolvedOptions();return r.map(l=>M_(l,s,a))}L();var cv=[0,31,59,90,120,151,181,212,243,273,304,334],uv=[0,31,60,91,121,152,182,213,244,274,305,335];function un(s,e){return new Me("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${s}, which is invalid`)}function dv(s,e,t){let n=new Date(Date.UTC(s,e-1,t));s<100&&s>=0&&n.setUTCFullYear(n.getUTCFullYear()-1900);let r=n.getUTCDay();return r===0?7:r}function fv(s,e,t){return t+(qi(s)?uv:cv)[e-1]}function hv(s,e){let t=qi(s)?uv:cv,n=t.findIndex(a=>a<e),r=e-t[n];return{month:n+1,day:r}}function gl(s){let{year:e,month:t,day:n}=s,r=fv(e,t,n),a=dv(e,t,n),l=Math.floor((r-a+10)/7),c;return l<1?(c=e-1,l=Wr(c)):l>Wr(e)?(c=e+1,l=1):c=e,lt({weekYear:c,weekNumber:l,weekday:a},bs(s))}function Td(s){let{weekYear:e,weekNumber:t,weekday:n}=s,r=dv(e,1,4),a=Zi(e),l=t*7+n-r-3,c;l<1?(c=e-1,l+=Zi(c)):l>a?(c=e+1,l-=Zi(e)):c=e;let{month:u,day:m}=hv(c,l);return lt({year:c,month:u,day:m},bs(s))}function vl(s){let{year:e,month:t,day:n}=s,r=fv(e,t,n);return lt({year:e,ordinal:r},bs(s))}function Cd(s){let{year:e,ordinal:t}=s,{month:n,day:r}=hv(e,t);return lt({year:e,month:n,day:r},bs(s))}function pv(s){let e=gs(s.weekYear),t=Pn(s.weekNumber,1,Wr(s.weekYear)),n=Pn(s.weekday,1,7);return e?t?n?!1:un("weekday",s.weekday):un("week",s.week):un("weekYear",s.weekYear)}function mv(s){let e=gs(s.year),t=Pn(s.ordinal,1,Zi(s.year));return e?t?!1:un("ordinal",s.ordinal):un("year",s.year)}function Sd(s){let e=gs(s.year),t=Pn(s.month,1,12),n=Pn(s.day,1,Gr(s.year,s.month));return e?t?n?!1:un("day",s.day):un("month",s.month):un("year",s.year)}function Od(s){let{hour:e,minute:t,second:n,millisecond:r}=s,a=Pn(e,0,23)||e===24&&t===0&&n===0&&r===0,l=Pn(t,0,59),c=Pn(n,0,59),u=Pn(r,0,999);return a?l?c?u?!1:un("millisecond",r):un("second",n):un("minute",t):un("hour",e)}var _d="Invalid DateTime",gv=864e13;function yl(s){return new Me("unsupported zone",`the zone "${s.name}" is not supported`)}function xd(s){return s.weekData===null&&(s.weekData=gl(s.c)),s.weekData}function Qi(s,e){let t={ts:s.ts,zone:s.zone,c:s.c,o:s.o,loc:s.loc,invalid:s.invalid};return new Tt(Mt(lt(lt({},t),e),{old:t}))}function Tv(s,e,t){let n=s-e*60*1e3,r=t.offset(n);if(e===r)return[n,e];n-=(r-e)*60*1e3;let a=t.offset(n);return r===a?[n,r]:[s-Math.min(r,a)*60*1e3,Math.max(r,a)]}function bl(s,e){s+=e*60*1e3;let t=new Date(s);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds(),millisecond:t.getUTCMilliseconds()}}function Al(s,e,t){return Tv($r(s),e,t)}function vv(s,e){let t=s.o,n=s.c.year+Math.trunc(e.years),r=s.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,a=Mt(lt({},s.c),{year:n,month:r,day:Math.min(s.c.day,Gr(n,r))+Math.trunc(e.days)+Math.trunc(e.weeks)*7}),l=Gt.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),c=$r(a),[u,m]=Tv(c,t,s.zone);return l!==0&&(u+=l,m=s.zone.offset(u)),{ts:u,o:m}}function ws(s,e,t,n,r,a){let{setZone:l,zone:c}=t;if(s&&Object.keys(s).length!==0||e){let u=e||c,m=Tt.fromObject(s,Mt(lt({},t),{zone:u,specificOffset:a}));return l?m:m.setZone(c)}else return Tt.invalid(new Me("unparsable",`the input "${r}" can't be parsed as ${n}`))}function El(s,e,t=!0){return s.isValid?pe.create(qt.create("en-US"),{allowZ:t,forceSimple:!0}).formatDateTimeFromString(s,e):null}function Pd(s,e){let t=s.c.year>9999||s.c.year<0,n="";return t&&s.c.year>=0&&(n+="+"),n+=fe(s.c.year,t?6:4),e?(n+="-",n+=fe(s.c.month),n+="-",n+=fe(s.c.day)):(n+=fe(s.c.month),n+=fe(s.c.day)),n}function yv(s,e,t,n,r,a){let l=fe(s.c.hour);return e?(l+=":",l+=fe(s.c.minute),(s.c.millisecond!==0||s.c.second!==0||!t)&&(l+=":")):l+=fe(s.c.minute),(s.c.millisecond!==0||s.c.second!==0||!t)&&(l+=fe(s.c.second),(s.c.millisecond!==0||!n)&&(l+=".",l+=fe(s.c.millisecond,3))),r&&(s.isOffsetFixed&&s.offset===0&&!a?l+="Z":s.o<0?(l+="-",l+=fe(Math.trunc(-s.o/60)),l+=":",l+=fe(Math.trunc(-s.o%60))):(l+="+",l+=fe(Math.trunc(s.o/60)),l+=":",l+=fe(Math.trunc(s.o%60)))),a&&(l+="["+s.zone.ianaName+"]"),l}var Cv={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},B_={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},k_={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Sv=["year","month","day","hour","minute","second","millisecond"],$_=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],U_=["year","ordinal","hour","minute","second","millisecond"];function bv(s){let e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[s.toLowerCase()];if(!e)throw new kr(s);return e}function Ev(s,e){let t=bn(e.zone,te.defaultZone),n=qt.fromObject(e),r=te.now(),a,l;if($t(s.year))a=r;else{for(let m of Sv)$t(s[m])&&(s[m]=Cv[m]);let c=Sd(s)||Od(s);if(c)return Tt.invalid(c);let u=t.offset(r);[a,l]=Al(s,u,t)}return new Tt({ts:a,zone:t,loc:n,o:l})}function Av(s,e,t){let n=$t(t.round)?!0:t.round,r=(l,c)=>(l=Ur(l,n||t.calendary?0:2,!0),e.loc.clone(t).relFormatter(t).format(l,c)),a=l=>t.calendary?e.hasSame(s,l)?0:e.startOf(l).diff(s.startOf(l),l).get(l):e.diff(s,l).get(l);if(t.unit)return r(a(t.unit),t.unit);for(let l of t.units){let c=a(l);if(Math.abs(c)>=1)return r(c,l)}return r(s>e?-0:0,t.units[t.units.length-1])}function wv(s){let e={},t;return s.length>0&&typeof s[s.length-1]=="object"?(e=s[s.length-1],t=Array.from(s).slice(0,s.length-1)):t=Array.from(s),[e,t]}var Tt=class{constructor(e){let t=e.zone||te.defaultZone,n=e.invalid||(Number.isNaN(e.ts)?new Me("invalid input"):null)||(t.isValid?null:yl(t));this.ts=$t(e.ts)?te.now():e.ts;let r=null,a=null;if(!n)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[r,a]=[e.old.c,e.old.o];else{let c=t.offset(this.ts);r=bl(this.ts,c),n=Number.isNaN(r.year)?new Me("invalid input"):null,r=n?null:r,a=n?null:c}this._zone=t,this.loc=e.loc||qt.create(),this.invalid=n,this.weekData=null,this.c=r,this.o=a,this.isLuxonDateTime=!0}static now(){return new Tt({})}static local(){let[e,t]=wv(arguments),[n,r,a,l,c,u,m]=t;return Ev({year:n,month:r,day:a,hour:l,minute:c,second:u,millisecond:m},e)}static utc(){let[e,t]=wv(arguments),[n,r,a,l,c,u,m]=t;return e.zone=he.utcInstance,Ev({year:n,month:r,day:a,hour:l,minute:c,second:u,millisecond:m},e)}static fromJSDate(e,t={}){let n=Pg(e)?e.valueOf():NaN;if(Number.isNaN(n))return Tt.invalid("invalid input");let r=bn(t.zone,te.defaultZone);return r.isValid?new Tt({ts:n,zone:r,loc:qt.fromObject(t)}):Tt.invalid(yl(r))}static fromMillis(e,t={}){if(xn(e))return e<-gv||e>gv?Tt.invalid("Timestamp out of range"):new Tt({ts:e,zone:bn(t.zone,te.defaultZone),loc:qt.fromObject(t)});throw new Ie(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(xn(e))return new Tt({ts:e*1e3,zone:bn(t.zone,te.defaultZone),loc:qt.fromObject(t)});throw new Ie("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};let n=bn(t.zone,te.defaultZone);if(!n.isValid)return Tt.invalid(yl(n));let r=te.now(),a=$t(t.specificOffset)?n.offset(r):t.specificOffset,l=zr(e,bv),c=!$t(l.ordinal),u=!$t(l.year),m=!$t(l.month)||!$t(l.day),g=u||m,E=l.weekYear||l.weekNumber,h=qt.fromObject(t);if((g||c)&&E)throw new zn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(m&&c)throw new zn("Can't mix ordinal dates with month/day");let y=E||l.weekday&&!g,O,_,C=bl(r,a);y?(O=$_,_=B_,C=gl(C)):c?(O=U_,_=k_,C=vl(C)):(O=Sv,_=Cv);let T=!1;for(let b of O){let P=l[b];$t(P)?T?l[b]=_[b]:l[b]=C[b]:T=!0}let x=y?pv(l):c?mv(l):Sd(l),v=x||Od(l);if(v)return Tt.invalid(v);let A=y?Td(l):c?Cd(l):l,[f,p]=Al(A,a,n),S=new Tt({ts:f,zone:n,o:p,loc:h});return l.weekday&&g&&e.weekday!==S.weekday?Tt.invalid("mismatched weekday",`you can't specify both a weekday of ${l.weekday} and a date of ${S.toISO()}`):S}static fromISO(e,t={}){let[n,r]=zg(e);return ws(n,r,t,"ISO 8601",e)}static fromRFC2822(e,t={}){let[n,r]=Vg(e);return ws(n,r,t,"RFC 2822",e)}static fromHTTP(e,t={}){let[n,r]=jg(e);return ws(n,r,t,"HTTP",t)}static fromFormat(e,t,n={}){if($t(e)||$t(t))throw new Ie("fromFormat requires an input string and a format");let{locale:r=null,numberingSystem:a=null}=n,l=qt.fromOpts({locale:r,numberingSystem:a,defaultToEN:!0}),[c,u,m,g]=lv(l,e,t);return g?Tt.invalid(g):ws(c,u,n,`format ${t}`,e,m)}static fromString(e,t,n={}){return Tt.fromFormat(e,t,n)}static fromSQL(e,t={}){let[n,r]=qg(e);return ws(n,r,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new Ie("need to specify a reason the DateTime is invalid");let n=e instanceof Me?e:new Me(e,t);if(te.throwOnInvalid)throw new sl(n);return new Tt({invalid:n})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){let n=wd(e,qt.fromObject(t));return n?n.map(r=>r?r.val:null).join(""):null}static expandFormat(e,t={}){return Ed(pe.parseFormat(e),qt.fromObject(t)).map(r=>r.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?xd(this).weekYear:NaN}get weekNumber(){return this.isValid?xd(this).weekNumber:NaN}get weekday(){return this.isValid?xd(this).weekday:NaN}get ordinal(){return this.isValid?vl(this.c).ordinal:NaN}get monthShort(){return this.isValid?jn.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?jn.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?jn.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?jn.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];let e=864e5,t=6e4,n=$r(this.c),r=this.zone.offset(n-e),a=this.zone.offset(n+e),l=this.zone.offset(n-r*t),c=this.zone.offset(n-a*t);if(l===c)return[this];let u=n-l*t,m=n-c*t,g=bl(u,l),E=bl(m,c);return g.hour===E.hour&&g.minute===E.minute&&g.second===E.second&&g.millisecond===E.millisecond?[Qi(this,{ts:u}),Qi(this,{ts:m})]:[this]}get isInLeapYear(){return qi(this.year)}get daysInMonth(){return Gr(this.year,this.month)}get daysInYear(){return this.isValid?Zi(this.year):NaN}get weeksInWeekYear(){return this.isValid?Wr(this.weekYear):NaN}resolvedLocaleOptions(e={}){let{locale:t,numberingSystem:n,calendar:r}=pe.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:n,outputCalendar:r}}toUTC(e=0,t={}){return this.setZone(he.instance(e),t)}toLocal(){return this.setZone(te.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:n=!1}={}){if(e=bn(e,te.defaultZone),e.equals(this.zone))return this;if(e.isValid){let r=this.ts;if(t||n){let a=e.offset(this.ts),l=this.toObject();[r]=Al(l,a,e)}return Qi(this,{ts:r,zone:e})}else return Tt.invalid(yl(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:n}={}){let r=this.loc.clone({locale:e,numberingSystem:t,outputCalendar:n});return Qi(this,{loc:r})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;let t=zr(e,bv),n=!$t(t.weekYear)||!$t(t.weekNumber)||!$t(t.weekday),r=!$t(t.ordinal),a=!$t(t.year),l=!$t(t.month)||!$t(t.day),c=a||l,u=t.weekYear||t.weekNumber;if((c||r)&&u)throw new zn("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&r)throw new zn("Can't mix ordinal dates with month/day");let m;n?m=Td(lt(lt({},gl(this.c)),t)):$t(t.ordinal)?(m=lt(lt({},this.toObject()),t),$t(t.day)&&(m.day=Math.min(Gr(m.year,m.month),m.day))):m=Cd(lt(lt({},vl(this.c)),t));let[g,E]=Al(m,this.o,this.zone);return Qi(this,{ts:g,o:E})}plus(e){if(!this.isValid)return this;let t=Gt.fromDurationLike(e);return Qi(this,vv(this,t))}minus(e){if(!this.isValid)return this;let t=Gt.fromDurationLike(e).negate();return Qi(this,vv(this,t))}startOf(e){if(!this.isValid)return this;let t={},n=Gt.normalizeUnit(e);switch(n){case"years":t.month=1;case"quarters":case"months":t.day=1;case"weeks":case"days":t.hour=0;case"hours":t.minute=0;case"minutes":t.second=0;case"seconds":t.millisecond=0;break;case"milliseconds":break}if(n==="weeks"&&(t.weekday=1),n==="quarters"){let r=Math.ceil(this.month/3);t.month=(r-1)*3+1}return this.set(t)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,t={}){return this.isValid?pe.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):_d}toLocaleString(e=ci,t={}){return this.isValid?pe.create(this.loc.clone(t),e).formatDateTime(this):_d}toLocaleParts(e={}){return this.isValid?pe.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:n=!1,includeOffset:r=!0,extendedZone:a=!1}={}){if(!this.isValid)return null;let l=e==="extended",c=Pd(this,l);return c+="T",c+=yv(this,l,t,n,r,a),c}toISODate({format:e="extended"}={}){return this.isValid?Pd(this,e==="extended"):null}toISOWeekDate(){return El(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:n=!0,includePrefix:r=!1,extendedZone:a=!1,format:l="extended"}={}){return this.isValid?(r?"T":"")+yv(this,l==="extended",t,e,n,a):null}toRFC2822(){return El(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return El(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Pd(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:n=!0}={}){let r="HH:mm:ss.SSS";return(t||e)&&(n&&(r+=" "),t?r+="z":e&&(r+="ZZ")),El(this,r,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():_d}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};let t=lt({},this.c);return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",n={}){if(!this.isValid||!e.isValid)return Gt.invalid("created by diffing an invalid DateTime");let r=lt({locale:this.locale,numberingSystem:this.numberingSystem},n),a=Ig(t).map(Gt.normalizeUnit),l=e.valueOf()>this.valueOf(),c=l?this:e,u=l?e:this,m=ev(c,u,a,r);return l?m.negate():m}diffNow(e="milliseconds",t={}){return this.diff(Tt.now(),e,t)}until(e){return this.isValid?re.fromDateTimes(this,e):this}hasSame(e,t){if(!this.isValid)return!1;let n=e.valueOf(),r=this.setZone(e.zone,{keepLocalTime:!0});return r.startOf(t)<=n&&n<=r.endOf(t)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;let t=e.base||Tt.fromObject({},{zone:this.zone}),n=e.padding?this<t?-e.padding:e.padding:0,r=["years","months","days","hours","minutes","seconds"],a=e.unit;return Array.isArray(e.unit)&&(r=e.unit,a=void 0),Av(t,this.plus(n),Mt(lt({},e),{numeric:"always",units:r,unit:a}))}toRelativeCalendar(e={}){return this.isValid?Av(e.base||Tt.fromObject({},{zone:this.zone}),this,Mt(lt({},e),{numeric:"auto",units:["years","months","days"],calendary:!0})):null}static min(...e){if(!e.every(Tt.isDateTime))throw new Ie("min requires all arguments be DateTimes");return ud(e,t=>t.valueOf(),Math.min)}static max(...e){if(!e.every(Tt.isDateTime))throw new Ie("max requires all arguments be DateTimes");return ud(e,t=>t.valueOf(),Math.max)}static fromFormatExplain(e,t,n={}){let{locale:r=null,numberingSystem:a=null}=n,l=qt.fromOpts({locale:r,numberingSystem:a,defaultToEN:!0});return Ad(l,e,t)}static fromStringExplain(e,t,n={}){return Tt.fromFormatExplain(e,t,n)}static get DATE_SHORT(){return ci}static get DATE_MED(){return Zo}static get DATE_MED_WITH_WEEKDAY(){return Ku}static get DATE_FULL(){return Yo}static get DATE_HUGE(){return Qo}static get TIME_SIMPLE(){return Xo}static get TIME_WITH_SECONDS(){return ts}static get TIME_WITH_SHORT_OFFSET(){return es}static get TIME_WITH_LONG_OFFSET(){return ns}static get TIME_24_SIMPLE(){return is}static get TIME_24_WITH_SECONDS(){return rs}static get TIME_24_WITH_SHORT_OFFSET(){return os}static get TIME_24_WITH_LONG_OFFSET(){return ss}static get DATETIME_SHORT(){return as}static get DATETIME_SHORT_WITH_SECONDS(){return ls}static get DATETIME_MED(){return cs}static get DATETIME_MED_WITH_SECONDS(){return us}static get DATETIME_MED_WITH_WEEKDAY(){return qu}static get DATETIME_FULL(){return ds}static get DATETIME_FULL_WITH_SECONDS(){return fs}static get DATETIME_HUGE(){return hs}static get DATETIME_HUGE_WITH_SECONDS(){return ps}};function Qr(s){if(Tt.isDateTime(s))return s;if(s&&s.valueOf&&xn(s.valueOf()))return Tt.fromJSDate(s);if(s&&typeof s=="object")return Tt.fromObject(s);throw new Ie(`Unknown datetime argument: ${s}, of type ${typeof s}`)}var Ov=kt(Pt),H_=[Ov.styles,Fu],Xi=class extends Ov{constructor(){super();this.updateComment=({detail:t})=>{let{text:n,mentions:r}=t;this.text=n,this.closeEditMode(),this.emitEvent("update-comment",{uuid:this.uuid,mentions:r,text:n})};this.resolveAnnotation=t=>{t.stopPropagation(),this.emitEvent("resolve-annotation",{type:"resolve-annotation",resolved:!this.resolved},{composed:!1,bubbles:!1})};this.confirmDelete=()=>{if(this.deleteCommentModalOpen=!1,this.primaryComment)return this.emitEvent("delete-annotation",{uuid:this.annotationId});this.emitEvent("delete-comment",{annotationId:this.annotationId,uuid:this.uuid})};this.closeEditMode=()=>{this.mode="readonly",this.emitEvent("edit-comment",{editing:!1})};this.resolved=!1}firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{ne.call(this,["comments"])})}getAvatar(){var t;return this.avatar?dt` <div class=${this.getClasses("avatar-container")}>
        <img src=${this.avatar} class=${this.getClasses("avatar-image")} />
      </div>`:dt`<div class=${this.getClasses("avatar-container")}>
      <p class="text text-bold ${this.getClasses("avatar-letter")}">
        ${((t=this.username[0])==null?void 0:t.toUpperCase())||"A"}
      </p>
    </div>`}getClasses(t){return`comments__comment-item__${t} ${this.class}__${t}`}render(){let t=this.annotationFilter==="all"?"resolve":"undo",n=y=>Tt.fromISO(y).toFormat("yyyy-dd-MM"),r=this.resolvable?"comments__comment-item__resolve":"hidden",a=[{label:"EDIT"},{label:"DELETE"}],l=({detail:y})=>{y==="EDIT"&&(this.mode="editable",this.emitEvent("edit-comment",{editing:!0})),y==="DELETE"&&(this.deleteCommentModalOpen=!0)},c=()=>{this.text.length<120||(this.expandElipsis=!0)},u=()=>{let y={"comments__comment-item--editable":!0,"hide-edit-input":this.mode!=="editable"};return dt`
        <superviz-comments-comment-input
          class="${It(y)}"
          editable
          @click=${O=>O.stopPropagation()}
          text=${this.text}
          eventType="update-comment"
          participantsList=${JSON.stringify(this.participantsList)}
          mentions=${JSON.stringify(this.mentions)}
          @update-comment=${this.updateComment}
          @close-edit-mode=${this.closeEditMode}
        ></superviz-comments-comment-input>
      `},m=()=>{let y={editing:this.mode==="editable","annotation-content":!0,text:!0,"text-big":!0,"sv-gray-700":!0,[this.getClasses("content")]:!0,"line-clamp":!this.expandElipsis&&this.text.length>120};return dt`
        <span id="comment-text" @click=${c} class="${It(y)}"
          >${this.text}</span
        >
      `},g=()=>{this.deleteCommentModalOpen=!1},E={[this.class]:!0,"comments__comment-item":!0,reply:!this.primaryComment},h={"comments__comment-item__content__body":!0,"editing-annotation":this.mode==="editable"};return dt`
      <div class=${It(E)}>
        <div class=${this.getClasses("header")}>
          <div class=${this.getClasses("metadata")}>
            ${this.getAvatar()}
            <span class="text text-big text-bold sv-gray-700 ${this.getClasses("username")}"
              >${this.username}</span
            >
            <span class="text text-small sv-gray-500 ${this.getClasses("date")}"
              >${n(this.createdAt)}</span
            >
          </div>
          <div class=${this.getClasses("actions")}>
            <button
              @click=${this.resolveAnnotation}
              class="${this.getClasses("icons")} ${this.getClasses("resolve-icon")} icon-button icon-button--clickable icon-button--xsmall ${r}"
            >
              <superviz-icon
                name=${t}
                size="sm"
                suffix=${t==="undo"?"md":void 0}
              ></superviz-icon>
            </button>
            <superviz-dropdown
              options=${JSON.stringify(a)}
              label="label"
              returnTo="label"
              position="bottom-left"
              @selected=${l}
              @click=${y=>y.stopPropagation()}
              classesPrefix="comments__dropdown"
              parentComponent="comments"
            >
              <button
                slot="dropdown"
                class="${this.getClasses("icons")} ${this.getClasses("options-icon")} icon-button icon-button--clickable icon-button--small"
              >
                <superviz-icon name="more" size="sm"></superviz-icon>
              </button>
            </superviz-dropdown>
          </div>
        </div>

        <div class="comments__comment-item__content">
          <div class="${It(h)}">${u()} ${m()}</div>
        </div>
      </div>
      <superviz-comments-delete-comments-modal
        ?open=${this.deleteCommentModalOpen}
        @close=${g}
        @confirm=${this.confirmDelete}
      >
      </superviz-comments-delete-comments-modal>
    `}};Xi.styles=H_,Xi.properties={uuid:{type:String},annotationId:{type:String},avatar:{type:String},username:{type:String},text:{type:String},resolved:{type:Boolean},resolvable:{type:Boolean},createdAt:{type:String},mode:{type:String},deleteCommentModalOpen:{type:Boolean},primaryComment:{type:Boolean},expandElipsis:{type:Boolean},annotationFilter:{type:String},participantsList:{type:Object},mentions:{type:Array},class:{type:String}},Xi=Nt([Ft("superviz-comments-comment-item")],Xi);L();L();var wl=class{constructor(){this.keys=["@"];this.input=null,this.mentions=[]}setInput(e){this.event=e,this.input=e.target,this.key=e.data}getMentions(e,t=[]){return t.length>0&&(this.mentions=t),this.mentions.filter(n=>((a,l)=>l.includes(a.name))(n,e))}setMentions(e){this.mentions=e}addMention(e){this.mentions.some(n=>n.userId===e.userId)||this.mentions.push(e)}clearMentions(){this.mentions=[]}getSelectionPosition(){var r;let e=this.getSelectionStart(),t=this.getLastKeyBeforeCaret(e);return{start:((r=t==null?void 0:t.keyIndex)!=null?r:-1)+1,end:e}}getSelectionStart(){var e;return(e=this.input)==null?void 0:e.selectionStart}setCaretPosition(e){this.input.selectionEnd=e}getValue(){var e;return(e=this.input)==null?void 0:e.value}setValue(e){this.input.value=e}getLastKeyBeforeCaret(e){let[t]=this.keys.map(n=>({key:n,keyIndex:this.getValue().lastIndexOf(n,e-1)})).sort((n,r)=>r.keyIndex-n.keyIndex);return t}searchMention(e,t){return t!==-1?this.getValue().substring(t+1,e):null}isDeletion(){return this.event.inputType==="deleteContentBackward"||this.event.inputType==="deleteContentForward"||this.event.inputType==="deleteWordBackward"}insertMention(e,t,n){if(this.isDeletion())return;let{id:r,name:a}=n,l=`${this.getValue().slice(0,e)+a} ${this.getValue().slice(t,this.getValue().length)}`;this.setValue(l),this.input.focus(),this.addMention({userId:r,name:a}),this.setCaretPosition(e+a.length+1)}};L();var Id={SHOW:"show",HIDE:"hide"},G_={action:Id.HIDE,mentions:[],findDigitParticipant:!1},W_=(s,e,t)=>{var a,l;let n=[];if(n=t==null?void 0:t.filter(c=>c==null?void 0:c.email),s.length>0&&(n=n.filter(c=>(c==null?void 0:c.name.toLowerCase().search(s.toLowerCase()))!==-1),s===((l=(a=n[0])==null?void 0:a.name)==null?void 0:l.toLowerCase()))){let c=_v(n,e);return{action:Id.HIDE,mentions:c,findDigitParticipant:!0}}if(!((n==null?void 0:n.length)>0))return G_;let r=_v(n,e);return{action:Id.SHOW,mentions:r,findDigitParticipant:!1}},_v=(s,e)=>s.map(t=>({id:t.id,name:t.name,avatar:t.avatar,email:t.email,position:e})),xv={matchParticipant:(s,e,t)=>W_(s,e,t)};var Pv=kt(Pt),z_=[Pv.styles,ku],tr=class extends Pv{constructor(){super();this.pinCoordinates=null;this.autoCompleteHandler=new wl;this.addAtSymbolInCaretPosition=()=>{let t=this.shadowRoot.querySelector(".comments__input__textarea"),n=new InputEvent("input",{bubbles:!0,cancelable:!0});Object.defineProperty(n,"data",{value:"@",writable:!0}),t.dispatchEvent(n)};this.getCommentInput=()=>this.shadowRoot.querySelector(".comments__input__textarea");this.userMentionedByTextInput=t=>{this.mentionList=[];let n={detail:lt({},t[0])};this.insertMention(n)};this.buttonAtSymbol=()=>{var u;let t=this.autoCompleteHandler.getSelectionStart(),n=this.autoCompleteHandler.getValue();this.autoCompleteHandler.setValue(`${n.slice(0,t)}@${n.slice(t,n.length)}`),t+=1;let r=this.autoCompleteHandler.getLastKeyBeforeCaret(t),a=(u=r==null?void 0:r.keyIndex)!=null?u:-1,l=this.autoCompleteHandler.searchMention(t,a),c={start:a+1,end:t};return{searchText:l,position:c}};this.focusInput=()=>{this.getCommentInput().focus()};this.handleInput=t=>{var y,O;if(((y=this.commentInput)==null?void 0:y.value.length)===0?this.btnActive=!1:this.btnActive=!0,t.data===null)return;this.autoCompleteHandler.setInput(t);let n=this.autoCompleteHandler.getSelectionStart(),r=this.autoCompleteHandler.getLastKeyBeforeCaret(n),a=(O=r==null?void 0:r.keyIndex)!=null?O:-1,l=this.autoCompleteHandler.searchMention(n,a),c=this.autoCompleteHandler.getSelectionPosition(),u=t.data==="@"&&a===-1,m=t.data==="@"&&n-1!==a;if(u||m){let _=this.buttonAtSymbol();l=_.searchText,c=_.position}if(l===null){this.mentionList=[];return}let{action:g,mentions:E,findDigitParticipant:h}=xv.matchParticipant(l,c,this.participantsList);if(h){this.userMentionedByTextInput(E);return}g==="show"&&(this.mentionList=E),g==="hide"&&(this.mentionList=[])};this.insertMention=t=>{let{id:n,name:r,avatar:a,email:l,position:c}=t.detail;this.autoCompleteHandler.insertMention(c.start,c.end,{id:n,name:r,avatar:a,email:l}),this.mentionList=[],this.updateHeight()};this.sendEnter=t=>{var l;if(t.key!=="Escape"&&t.stopImmediatePropagation(),t.key==="Enter"&&!t.shiftKey&&t.preventDefault(),t.key!=="Enter"||t.shiftKey||((l=this.mentionList)==null?void 0:l.length)>0)return;let n=this.commentInput,r=n.value.trim();if(!r)return;let a=this.autoCompleteHandler.getMentions(r);this.emitEvent(this.eventType,{text:r,mentions:a,position:this.pinCoordinates},{composed:!1,bubbles:!1}),n.value="",this.sendBtn.disabled=!0,this.updateHeight()};this.closeEditMode=()=>{this.emitEvent("close-edit-mode",{},{composed:!1,bubbles:!1}),this.hideInput=!0};this.onTextareaFocus=()=>{let t=this.optionsContainer,n=this.horizontalRule,r=this.commentInput;t.classList.add("active-textarea"),n.classList.add("comments__input__divisor"),r.classList.add("active-textarea")};this.onTextareaLoseFocus=t=>{var c,u;let n=(u=(c=t.explicitOriginalTarget)==null?void 0:c.parentNode)==null?void 0:u.host;if(this.closeButton.contains(n)||this.closeButton.contains(t.explicitOriginalTarget)||this.closeButton.contains(t.relatedTarget)){this.cancelComment();return}if(!this.shadowRoot.contains(t.target))return;let r=this.optionsContainer,a=this.horizontalRule,l=this.commentInput;l.value.length||(r.classList.remove("active-textarea"),a.classList.remove("comments__input__divisor"),l.classList.remove("active-textarea"))};this.cancelComment=()=>{document.body.dispatchEvent(new KeyboardEvent("keyup",{key:"Escape"}))};this.commentInputEditableOptions=()=>{var t;if(!!this.editable)return dt`
      <button
        id="close"
        @click=${this.closeEditMode}
        class="icon-button icon-button--medium icon-button--clickable comments__input__button comments__input__close-button"
      >
        <superviz-icon name="close" size="sm"></superviz-icon>
      </button>
      <button
        id="confirm"
        class="icon-button icon-button--medium icon-button--clickable comments__input__button comments__input__send-button"
        disabled
        @click=${this.send}
      >
        <superviz-icon
          color=${((t=this.sendBtn)==null?void 0:t.disabled)||!this.sendBtn?"black":"white"}
          name="check"
          size="sm"
        ></superviz-icon>
      </button>
    `};this.commentInputOptions=()=>{var t;if(!this.editable)return dt`
      <button
        class="icon-button icon-button--medium icon-button--clickable comments__input__button comments__input__close-button align-send-btn"
        @click=${this.cancelComment}
      >
        <superviz-icon name="close" size="sm"></superviz-icon>
      </button>
      <button
        class="comments__input__button comments__input__send-button align-send-btn"
        disabled
        @click=${this.send}
      >
        <superviz-icon
          color=${((t=this.sendBtn)==null?void 0:t.disabled)||!this.sendBtn?"black":"white"}
          name="line-arrow-right"
          size="sm"
        ></superviz-icon>
      </button>
    `};this.btnActive=!1,this.text="",this.mentionList=[],this.mentions=[]}get commentInput(){return this.shadowRoot.querySelector(".comments__input__textarea")}get sendBtn(){return this.shadowRoot.querySelector(".comments__input__send-button")}get optionsContainer(){return this.shadowRoot.querySelector(".comments__input__options")}get horizontalRule(){return this.shadowRoot.querySelector(".sv-hr")}get closeButton(){return this.shadowRoot.querySelector(".comments__input__close-button")}connectedCallback(){super.connectedCallback(),["create-annotation","create-comment"].includes(this.eventType)&&this.addEventListener("keyup",this.sendEnter)}disconnectedCallback(){if(super.disconnectedCallback(),!["create-annotation","create-comment"].includes(this.eventType))return;let t=this.getCommentInput();this.removeEventListener("keyup",this.sendEnter),t.removeEventListener("keydown",this.sendEnter),t.removeEventListener("click",this.focusInput),t.addEventListener("input",this.handleInput)}firstUpdated(t){this.updateComplete.then(()=>{this.emitEvent("comment-input-ready",{},{composed:!1,bubbles:!1});let n=this.getCommentInput();if(n&&(n.addEventListener("input",this.handleInput),n.addEventListener("click",this.focusInput),n.addEventListener("keydown",this.sendEnter)),this.text.length>0){let r=this.participantsList.map(({id:a,name:l})=>({userId:a,name:l}));this.mentions=this.autoCompleteHandler.getMentions(this.text,r),this.autoCompleteHandler.setMentions(this.mentions)}this.editable&&this.focusInput(),ne.call(this,["comments"])})}updated(t){if(t.has("text")&&this.text.length>0){let n=this.commentInput;n.value=this.text,this.updateHeight()}t.has("btnActive")&&(this.sendBtn.disabled=!this.btnActive)}updateHeight(){let t=this.commentInput;t.style.height="40px";let n=t.scrollHeight+14;n===47&&(n=40),t.style.height=`${n}px`,this.sendBtn.disabled=!(t.value.length>0)}send(t){var l;if(t.preventDefault(),((l=this.mentionList)==null?void 0:l.length)>0)return;let n=this.commentInput,r=n.value,a=this.autoCompleteHandler.getMentions(r);this.emitEvent(this.eventType,{text:r,mentions:a,position:this.pinCoordinates},{composed:!1,bubbles:!1}),n.value="",this.sendBtn.disabled=!0,this.updateHeight()}render(){var r;let t={comments__input__textarea:!0,"fixed-width":this.eventType==="create-annotation"},n={comments__input:!0,"comments__input--editable":this.editable,"hide-input":this.hideInput};return dt`
      <div class="${It(n)}">
        <textarea
          id="comments__input__textarea"
          class=${It(t)}
          placeholder=${(r=this.placeholder)!=null?r:"Add comment..."}
          @input=${this.updateHeight}
          @focus=${this.onTextareaFocus}
          @blur=${this.onTextareaLoseFocus}
          spellcheck="false"
        ></textarea>
        <superviz-comments-mention-list
          .participants=${this.mentionList}
          @participant-selected=${this.insertMention}
        ></superviz-comments-mention-list>
        <div class="sv-hr"></div>
        <div class="comments__input__options">
          <button class="icon-button icon-button--medium icon-button--clickable">
            <superviz-icon
              name="mention"
              @click=${this.addAtSymbolInCaretPosition}
              size="sm"
            ></superviz-icon>
          </button>
          <div class="comment-input-options">
            ${this.commentInputOptions()} ${this.commentInputEditableOptions()}
          </div>
        </div>
      </div>
    `}};tr.styles=z_,tr.properties={eventType:{type:String},text:{type:String},btnActive:{type:Boolean},editable:{type:Boolean},placeholder:{type:String},mentions:{type:Array},mentionList:{type:Object},participantsList:{type:Object},hideInput:{type:Boolean}},tr=Nt([Ft("superviz-comments-comment-input")],tr);L();var Iv=kt(Pt),V_=[Iv.styles,Hu],er=class extends Iv{constructor(){super();this.focusInput=()=>{var t,n;this.inputElement||(this.inputElement=(n=(t=this.shadowRoot)==null?void 0:t.querySelector("superviz-comments-comment-input"))==null?void 0:n.shadowRoot.querySelector("textarea")),this.inputElement.focus()};this.setInputSide=()=>{let a=this.commentsSide==="right"?320:0,l=this.annotationSides.right+293,c=this.containerSides.right-a;if(l<c){this.horizontalSide="right";return}a=this.commentsSide==="left"?320:0;let u=this.annotationSides.left-293,m=this.containerSides.left+a;if(u>m){this.horizontalSide="left";return}this.horizontalSide=m-u>l-c?"right":"left"};this.createComment=({detail:t})=>{this.annotationSent=!0,document.body.dispatchEvent(new CustomEvent("create-annotation",{detail:Mt(lt({},t),{position:Mt(lt({},this.originalPosition),{type:"canvas"})})})),this.annotation=null};this.cancelTemporaryAnnotation=()=>{this.annotation=null};this.cancelTemporaryAnnotationEsc=t=>{this.annotation=null};this.avatar=()=>{if(this.type==="add"&&!this.showInput)return dt`<div
        class="comments__annotation-pin__avatar comments__annotation-pin__avatar--add"
      >
        <superviz-icon name="add"></superviz-icon>
      </div>`;let t=this.userAvatar;return t?dt`<div class="comments__annotation-pin__avatar">
        <img src=${t} />
      </div>`:dt`<div class="comments__annotation-pin__avatar">
      <p class="text text-bold text-big">${this.userInitial}</p>
    </div>`};this.input=()=>{if(!(!this.showInput||this.annotationSent))return dt`<div class="floating-input">
      <superviz-comments-comment-input
        @create-annotation=${this.createComment}
        eventType="create-annotation"
        @comment-input-ready=${this.focusInput}
        participantsList=${JSON.stringify(this.participantsList)}
      >
      </superviz-comments-comment-input>
    </div>`};this.position={x:0,y:0},setTimeout(()=>{this.firstLoad=!1},800)}updated(t){super.updated(t),!(!t.has("movedPosition")||!this.annotationSides)&&(this.annotationSides=this.pinAnnotation.getBoundingClientRect(),this.setInputSide(),this.inputElement&&this.focusInput())}firstUpdated(t){var n;super.firstUpdated(t),ne.call(this,["comments"]),this.showInput&&(this.originalPosition=lt({},this.position),this.pinAnnotation=(n=this.shadowRoot)==null?void 0:n.querySelector(".comments__annotation-pin"),this.annotationSides=this.pinAnnotation.getBoundingClientRect(),this.setInputSide())}connectedCallback(){super.connectedCallback(),this.type==="add"&&(window.document.body.addEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.addEventListener("keyup",t=>{t.key==="Escape"&&this.cancelTemporaryAnnotationEsc(t)}))}disconnectedCallback(){super.disconnectedCallback(),this.type==="add"&&(window.document.body.removeEventListener("close-temporary-annotation",this.cancelTemporaryAnnotation),window.document.body.removeEventListener("keyup",t=>{t.key==="Escape"&&this.cancelTemporaryAnnotationEsc(t)}))}get userAvatar(){var t,n,r,a;return((a=(r=(n=(t=this.annotation)==null?void 0:t.comments)==null?void 0:n.at(0))==null?void 0:r.participant)==null?void 0:a.avatar)||this.localAvatar}get userInitial(){var n,r,a,l,c;return(((c=(l=(a=(r=(n=this.annotation)==null?void 0:n.comments)==null?void 0:r.at(0))==null?void 0:a.participant)==null?void 0:l.name)!=null?c:this.localName)||"Anonymous")[0].toUpperCase()}emitClick(){var t;document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:(t=this.annotation)==null?void 0:t.uuid}}))}render(){let t={"comments__annotation-pin":!0,preload:this.firstLoad===void 0,"comments__annotation-pin--active":this.active,"comments__cursor-pointer":this.type==="add"&&!this.showInput,"comments__annotation-pin--add":this.type==="add"&&this.showInput,[this.horizontalSide]:!0},n={"comments__annotation-pin-wrapper":!0,"comments__annotation-pin-wrapper--new":this.newPin},r=this.keepPositionRatio?"%":"px",a=`top: ${this.position.y}${r}; left: ${this.position.x}${r};`;return this.type==="add"?dt`
        <div class=${It(t)} style=${a}>${this.avatar()} ${this.input()}</div>
      `:dt`<div class=${It(n)} style=${a}>
      <div @click=${this.emitClick} class=${It(t)}>${this.avatar()}</div>
    </div> `}};er.styles=V_,er.properties={type:{type:String},annotation:{type:Object},position:{type:Object},active:{type:Boolean},showInput:{type:Boolean},containerSides:{type:Object},horizontalSide:{type:String},commentsSide:{type:String},movedPosition:{type:String},pinAnnotation:{type:Object},localAvatar:{type:String},annotationSent:{type:Boolean},localName:{type:String},keepPositionRatio:{type:Boolean},participantsList:{type:Object},firstLoad:{type:Boolean},newPin:{type:Boolean}},er=Nt([Ft("superviz-comments-annotation-pin")],er);L();var Mv=kt(Pt),j_=[Mv.styles,$u],nr=class extends Mv{constructor(){super(...arguments);this.selectAnnotation=()=>{let{uuid:t}=this.annotation;document.body.dispatchEvent(new CustomEvent("select-annotation",{detail:{uuid:t}}))};this.resolveAnnotation=({detail:t})=>{let{uuid:n}=this.annotation,{resolved:r,type:a}=t,l=a==="resolve-annotation"&&this.annotationFilter==="all";this.resolved=r,this.emitEvent("resolve-annotation",{uuid:n,resolved:r}),l&&(this.shouldShowUndoResolved=!0)};this.hideUndoResolved=()=>{this.shouldShowUndoResolved=!1};this.generateExpandedCommentsTemplate=(t,n)=>{var r,a,l,c;return n===0?dt``:dt`
      <superviz-comments-comment-item
        uuid=${t.uuid}
        avatar=${(c=(l=(a=(r=this.annotation)==null?void 0:r.comments)==null?void 0:a.at(n))==null?void 0:l.participant)==null?void 0:c.avatar}
        username=${t.participant.name||"Anonymous"}
        text=${t.text}
        createdAt=${t.createdAt}
        annotationId=${this.annotation.uuid}
        participantsList=${JSON.stringify(this.participantsList)}
        mentions=${JSON.stringify(t.mentions)}
        class="comments__replies"
      ></superviz-comments-comment-item>
    `};this.updateEditMode=({detail:{editing:t}})=>{this.hideInput=t}}firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{this.resolved=this.annotation.resolved,ne.call(this,["comments"])})}get filterIsAll(){return this.annotationFilter==="all"}get filterIsResolved(){return this.annotationFilter==="resolved"}get shouldHideAnnotation(){return{hidden:this.resolved&&this.filterIsAll||!this.resolved&&this.filterIsResolved}}get replies(){return[...this.annotation.comments].splice(1).length}get repliesSize(){return this.replies>=5?5:this.replies}get replyText(){return this.replies!==1?"replies":"reply"}get isSelected(){return this.selected===this.annotation.uuid}get annotationClasses(){return{comments__thread:!0,"comments__thread--selected":this.isSelected,"extra-space-bottom":this.replies}}get mainAnnotationClasses(){return{"comments__main-annotation":!0,"comments__main-annotation--selected":this.isSelected}}get hrClasses(){return{"sv-hr":!0,hidden:this.isLastAnnotation}}get avatarCommentsClasses(){return{"avatars-comments":!0,"comment-avatar--expand":!this.expandComments&&this.replies>1,invisible:!(!this.expandComments&&this.replies>=1)}}get containerWrapperClasses(){return{"comments-container-wrapper":!0,show:this.isSelected&&this.expandComments}}get commentsClasses(){return{"comments-container":!0,"comment-item--expand":this.isSelected&&this.expandComments,show:this.isSelected&&this.expandComments}}updated(t){if(t.has("selected")){let n=this.selected===this.annotation.uuid;this.expandComments=n}}createComment({detail:t}){let{text:n,mentions:r}=t;this.emitEvent("create-comment",{uuid:this.annotation.uuid,mentions:r,text:n})}generateAvatarCommentsTemplate(){var n,r,a,l,c,u;let t=[];for(let m=1;m<=this.repliesSize;m++)(r=(n=this.annotation.comments[m])==null?void 0:n.participant)!=null&&r.avatar?t.push(dt`
          <div class="avatar">
            <img src=${(l=(a=this.annotation.comments[m])==null?void 0:a.participant)==null?void 0:l.avatar} />
          </div>
        `):t.push(dt`
          <div class="avatar">
            <p class="text text-bold">
              ${((u=(c=this.annotation.comments[m])==null?void 0:c.participant.name[0])==null?void 0:u.toUpperCase())||"A"}
            </p>
          </div>
        `);return dt`
      ${t}
      <div class="text text-big sv-gray-500">${this.replies} ${this.replyText}</div>
    `}annotationResolvedTemplate(){return this.shouldShowUndoResolved?dt`
      <superviz-comments-annotation-resolved
        @undo-resolve=${this.resolveAnnotation}
        @hide=${this.hideUndoResolved}
        class=${It({hidden:this.filterIsResolved,"comments__resolved-annotation-message":!0})}
      >
      </superviz-comments-annotation-resolved>
    `:dt``}get inputClasses(){return{"hide-input":this.hideInput}}get wrapperClasses(){return{wrapper:!0,"show-wrapper":!this.resolved&&this.filterIsAll||this.resolved&&this.filterIsResolved}}render(){var n,r,a,l,c,u,m,g,E,h,y;let t={"comments__complete-annotation":!0,"comments__hide-complete-annotation":this.shouldShowUndoResolved};return dt`
      <div class="${It(t)}">
        ${this.annotationResolvedTemplate()}

        <div class=${It(this.wrapperClasses)}>
          <div class=${It(this.shouldHideAnnotation)}>
            <div class=${It(this.annotationClasses)} @click=${this.selectAnnotation}>
              <div class=${It(this.mainAnnotationClasses)}>
                <superviz-comments-comment-item
                  uuid=${(n=this.annotation.comments)==null?void 0:n[0].uuid}
                  annotationId=${this.annotation.uuid}
                  username=${((a=(r=this.annotation.comments)==null?void 0:r[0].participant)==null?void 0:a.name)||"Anonymous"}
                  text=${(l=this.annotation.comments)==null?void 0:l[0].text}
                  createdAt=${(c=this.annotation.comments)==null?void 0:c[0].createdAt}
                  participantsList=${JSON.stringify(this.participantsList)}
                  primaryComment
                  avatar=${(E=(g=(m=(u=this.annotation)==null?void 0:u.comments)==null?void 0:m.at(0))==null?void 0:g.participant)==null?void 0:E.avatar}
                  resolvable
                  ?resolved=${this.resolved}
                  annotationFilter=${this.annotationFilter}
                  @resolve-annotation=${this.resolveAnnotation}
                  mentions=${JSON.stringify((h=this.annotation.comments)==null?void 0:h[0].mentions)}
                  class="comments__annotation"
                  @edit-comment=${this.updateEditMode}
                ></superviz-comments-comment-item>
              </div>

              <div class=${It(this.containerWrapperClasses)}>
                <div class=${It(this.commentsClasses)}>
                  ${(y=this.annotation.comments)==null?void 0:y.map(this.generateExpandedCommentsTemplate)}
                  <span class=${It(this.inputClasses)}>
                    <superviz-comments-comment-input
                      @create-comment=${this.createComment}
                      eventType="create-comment"
                      @click=${O=>O.stopPropagation()}
                      placeholder="Reply"
                      participantsList=${JSON.stringify(this.participantsList)}
                    ></superviz-comments-comment-input>
                  </span>
                </div>
              </div>
              <div class=${It(this.avatarCommentsClasses)}>
                <div class="avatar-container">${this.generateAvatarCommentsTemplate()}</div>
              </div>
            </div>
            <div class=${It(this.hrClasses)}></div>
          </div>
        </div>
      </div>
    `}};nr.styles=j_,nr.properties={annotation:{type:Object},expandComments:{type:Boolean},selected:{type:String,reflect:!0},resolved:{type:Boolean},shouldShowUndoResolved:{type:Boolean},isLastAnnotation:{type:Boolean},annotationFilter:{type:String},participantsList:{type:Object},hideInput:{type:Boolean}},nr=Nt([Ft("superviz-comments-annotation-item")],nr);L();var Rv=kt(Pt),J_=[Rv.styles],ir=class extends Rv{constructor(){super(...arguments);this.emitEventOpenModal=()=>{window.document.body.dispatchEvent(new CustomEvent("superviz-modal--open",{detail:{title:"DELETE COMMENT",body:dt`<span class="text text-big sv-gray-600"
            >Are you sure you want to delete this comment? <br />
            This action cannot be undone</span
          >`,confirmLabel:"DELETE",confirm:!0,cancel:!0},bubbles:!0,composed:!0}))};this.toggle=()=>{this.open=!this.open}}firstUpdated(){window.document.body.addEventListener("superviz-modal--close",()=>{!this.open||this.emitEvent("close",{},{bubbles:!1,composed:!1})}),window.document.body.addEventListener("superviz-modal--confirm",()=>{!this.open||(this.emitEvent("confirm",{},{bubbles:!1,composed:!1}),this.emitEventCloseModal())})}updated(t){t.has("open")&&(this.open&&setTimeout(()=>this.emitEventOpenModal()),this.open||setTimeout(()=>this.emitEventCloseModal()))}emitEventCloseModal(){!this.open||(window.document.body.dispatchEvent(new CustomEvent("superviz-modal--close",{detail:{open:!0},bubbles:!0,composed:!0})),this.emitEvent("close",{},{bubbles:!1,composed:!1}))}render(){let t=()=>{if(!!this.useSlot)return dt`<slot name="modal-handler" @click=${this.toggle}></slot>`},n=()=>{if(!!this.open)return dt` <superviz-modal></superviz-modal> `};return dt` ${t()} ${n()} `}};ir.styles=J_,ir.properties={open:{type:Boolean},useSlot:{type:Boolean}},ir=Nt([Ft("superviz-comments-delete-comments-modal")],ir);L();var Lv=kt(Pt),K_=[Lv.styles,Uu],q_=10*1e3,rr=class extends Lv{constructor(){super();this.setTimer=()=>{clearTimeout(this.timeout),this.isCanceled=!1,this.timeout=setTimeout(()=>{this.isCanceled||(this.timeToHide=0,this.isCanceled=!1,this.hide())},this.timeToHide)};this.timeToHide=q_,this.isCanceled=!1}firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{ne.call(this,["comments"]),this.setTimer()})}hide(){this.emitEvent("hide",{},{bubbles:!1,composed:!1})}undone(){this.isCanceled=!0,this.hide(),this.emitEvent("undo-resolve",{type:"undo-resolve",resolved:!1},{bubbles:!1,composed:!1}),clearTimeout(this.timeout)}render(){return this.timeToHide===0?dt``:this.isCanceled?dt``:dt`
      <div class="comments__annotation-resolved">
        <span class="text text-big sv-gray-700 comments__annotation-resolved__text"
          >You resolved this comment</span
        >
        <button
          id="undone"
          @click=${this.undone}
          class="icon-button icon-button--clickable icon-button--medium comments__annotation-resolved__unresolve_button"
        >
          <superviz-icon name="undo" size="md"></superviz-icon>
        </button>
      </div>
    `}};rr.styles=K_,rr.properties={timeToHide:{type:Number},isCanceled:{type:Boolean}},rr=Nt([Ft("superviz-comments-annotation-resolved")],rr);L();var Dv=kt(Pt),Z_=[Dv.styles,Gu],Ts=[{label:"All comments",code:"all"},{label:"Resolved comments",code:"resolved"}],or=class extends Dv{constructor(){super();this.caret="down"}firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{ne.call(this,["comments"])})}render(){let t=this.filter==="all"?Ts[0].label:Ts[1].label,n=({detail:c})=>{this.emitEvent("select",{filter:c}),r()},r=()=>{this.caret=this.caret==="down"?"up":"down"},a=this.filter==="all"?Ts[0].code:Ts[1].code,l={text:!0,"text-bold":!0,"select-content":!0,"comments__filter__selected-label":!0,"sv-gray-500":this.caret==="down","sv-gray-700":this.caret==="up"};return dt`
      <div class="comments__filter-container">
        <div class="comments__filter">
          <superviz-dropdown
            options=${JSON.stringify(Ts)}
            active=${a}
            label="label"
            returnTo="code"
            position="bottom-left"
            right-offset="100px"
            @click=${r}
            @selected=${n}
            @close=${r}
            classesPrefix="comments__dropdown"
            parentComponent="comments"
          >
            <div class="comments__filter__toggle-button" slot="dropdown">
              <span class=${It(l)}>${t}</span>
              <div class="comments__filter__icon">
                <superviz-icon name=${this.caret} size="xs"></superviz-icon>
              </div>
            </div>
          </superviz-dropdown>
        </div>
      </div>
    `}};or.styles=Z_,or.properties={filter:{type:String},caret:{type:String}},or=Nt([Ft("superviz-comments-annotation-filter")],or);L();var Nv=kt(Pt),Y_=[Nv.styles,Wu],sr=class extends Nv{constructor(){super();this.onTogglePinActive=({detail:{isActive:t}})=>{this.isActive=t};this.isHidden=!0,this.positionStyles="top: 20px; left: 20px;",this.shouldHide=!1,this.commentsPosition="left"}firstUpdated(t){super.firstUpdated(t),this.updateComplete.then(()=>{ne.call(this,["comments"])}),this.mouseHovering=!1;let n=this.shadowRoot.querySelector(".comments__floating-button");n.addEventListener("mouseenter",()=>{setTimeout(()=>n.classList.add("comments-floating-button-hovered"),300),this.mouseHovering=!0}),n.addEventListener("mouseleave",()=>{n.classList.remove("comments-floating-button-hovered"),this.mouseHovering=!1})}toggle(){this.emitEvent("toggle",{})}connectedCallback(){super.connectedCallback(),window.document.body.addEventListener("toggle-annotation-sidebar",()=>{this.isHidden=!this.isHidden}),window.document.body.addEventListener("toggle-pin-active",this.onTogglePinActive)}disconnectedCallback(){super.disconnectedCallback(),window.document.body.removeEventListener("toggle-annotation-sidebar",()=>{this.isHidden=!this.isHidden}),window.document.body.removeEventListener("toggle-pin-active",this.onTogglePinActive)}updated(t){super.updated(t),this.updateComplete.then(()=>{let n=this.shadowRoot.querySelector(".comments__floating-button");!n||n.setAttribute("style",this.positionStyles)})}calculateIfShouldHide(){var C;let t=(C=document.getElementsByTagName("superviz-comments")[0])==null?void 0:C.shadowRoot.querySelector(".superviz-comments"),n=this.shadowRoot.querySelector(".comments__floating-button");if(!t||!n)return;let{left:r,right:a,top:l,bottom:c}=t.getBoundingClientRect(),{left:u,right:m,top:g,bottom:E}=n.getBoundingClientRect(),h=c>g&&E>l,y=l<E&&g<c,O=a>u&&m>r,_=r<m&&u<a;this.shouldHide=(y||h)&&(O||_)}render(){this.calculateIfShouldHide();let t={"comments__floating-button":!0,"hide-button":!this.isHidden&&this.shouldHide,"is-active":this.isActive,"is-inactive":!this.isActive},n={"comments__floating-button-text-box":!0,"comments__floating-button-text-box--hovered":this.mouseHovering},r={text:!0,"text-big":!0,"text-bold":!0,"not-hovered":!this.mouseHovering,"comments__floating-button__text":!0,textActive:this.isActive,textInactive:!this.isActive};return dt` <button @click=${this.toggle} class="${It(t)}">
      <div class="comments__floating-button__icon">
        <superviz-icon
          size="sm"
          name="comment"
          color=${this.mouseHovering||this.isActive?"white":"black"}
        ></superviz-icon>
        <svg class="cross" width="8px" height="8px" viewBox="0 0 8 8">
          <rect class="cross-bar-1" x="0" y="3" width="8px" height="2px" />
          <rect class="cross-bar-2" x="0" y="3" width="8px" height="2px" />
        </svg>
      </div>
      <div class=${It(n)}>
        <p class="${It(r)} comment">Comment</p>
        <p class="${It(r)} cancel">Cancel</p>
      </div>
    </button>`}};sr.styles=Y_,sr.properties={positionStyles:{type:String},isHidden:{type:Boolean},commentsPosition:{type:String},isActive:{type:Boolean},mouseHovering:{type:Boolean}},sr=Nt([Ft("superviz-comments-button")],sr);L();var Fv=kt(Pt),Q_=[Fv.styles,Vu],ar=class extends Fv{constructor(){super();this.showMentionList=()=>{var n;let t=(n=this.shadowRoot)==null?void 0:n.getElementById("mention-list");t==null||t.style.setProperty("display","block"),t==null||t.style.setProperty("margin-top","1px"),t.addEventListener("wheel",this.stopHandleZoom)};this.hideMentionList=()=>{var n;let t=(n=this.shadowRoot)==null?void 0:n.getElementById("mention-list");t.removeEventListener("wheel",this.stopHandleZoom),t==null||t.style.setProperty("display","none")};this.selectParticipant=t=>{this.emitEvent("participant-selected",t,{bubbles:!1,composed:!1}),this.hideMentionList()};this.stopHandleZoom=t=>{var r;let n=(r=this.shadowRoot)==null?void 0:r.getElementById("mention-list");n.scrollTop+=t.deltaY,t.preventDefault()};this.participants=[]}updated(t){if(t.has("participants")&&this.participants.length>0){this.showMentionList();return}this.hideMentionList()}getAvatar(t){var n;return t.avatar?dt`<img class="avatar" src=${t.avatar} />`:dt`<div class="default-avatar">
      <p class="text text-bold">${((n=t.name[0])==null?void 0:n.toUpperCase())||"A"}</p>
    </div>`}render(){let t=n=>dt`
      <div class="mention-item" @click=${()=>this.selectParticipant(n)}>
          ${this.getAvatar(n)}
        <div class="avatar-type">${n.name}</div>
      </div>
    `;return dt`
      <div id="mention-list">
        ${li(this.participants,n=>n.id,n=>dt`
          ${t(n)}
        `)}
      </div>
    `}};ar.styles=Q_,ar.properties={participants:{type:Object}},ar=Nt([Ft("superviz-comments-mention-list")],ar);L();L();L();var Cs=(m=>(m.GOTO="go to",m.LOCAL_FOLLOW="follow",m.LOCAL_UNFOLLOW="unfollow",m.FOLLOW="everyone follows me",m.UNFOLLOW="stop followers",m.PRIVATE="private mode",m.LEAVE_PRIVATE="leave private mode",m.GATHER="gather all",m.STOP_GATHER="stop gather all",m))(Cs||{});L();L();var Md=xt`
  .who-is-online__participant-list {
    display: flex;
    align-items: center;
    gap: 4px;
    position: relative;
  }

  .who-is-online {
    display: flex;
    flex-direction: column;
    position: fixed;
    z-index: 99;
  }

  .who-is-online__presence-control-message__text {
    margin: 0;
  }

  .who-is-online__participant {
    border-radius: 50%;
    box-sizing: border-box;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    cursor: pointer;
    transition: opacity 0.3s ease-in-out;
    border: 2px solid #878291;
    border-radius: 50%;
    max-width: 40px;
    flex: 1 0 40px;
  }

  .followed {
    border-style: dashed !important;
    animation: rotate 15s linear infinite;
  }

  .followed .who-is-online__participant__avatar {
    animation: nullifyRotate 15s linear infinite;
  }

  .private {
    opacity: 0.3;
  }

  @keyframes rotate {
    100% {
      transform: rotate(1turn);
    }
  }

  @keyframes nullifyRotate {
    100% {
      transform: rotate(-1turn);
    }
  }

  .who-is-online__participant.disable-dropdown {
    cursor: default;
  }

  .who-is-online__participant__avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Open Sans';
    font-size: 14px;
    line-height: 14px;
    line-height: 14px;
    font-weight: bold;
    color: #26242a;
    object-fit: contain;
  }

  .superviz-who-is-online__excess {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: Roboto;
    font-size: 14px;
    line-height: 16px;
    text-align: center;
    font-weight: bold;
    cursor: pointer;
    color: #aea9b8;
  }

  .excess_participants:hover,
  .excess_participants--open {
    background-color: #aea9b8 !important;
  }

  .excess_participants:hover > div,
  .excess_participants--open > div {
    color: #fff !important;
  }

  @media (max-width: 780px) {
    .who-is-online__participant {
      width: 32px;
      height: 32px;
    }

    .who-is-online__participant {
      flex: 1 0 32px;
      max-width: 32px;
    }

    .who-is-online__participant__avatar {
      width: 24px;
      height: 24px;
    }

    .who-is-online__participant-list {
      gap: 8px;
    }

    .superviz-who-is-online__excess {
      width: 24px;
      height: 24px;
      font-size: 12px;
      line-height: 12px;
    }
  }
`;L();var Rd=xt`
  .dropdown {
    position: relative;
  }

  .who-is-online__extra-participant {
    display: flex;
    user-select: none;
    align-items: center;
    justify-items: start;
    gap: 4px;
    width: 100%;
    padding: 10px;
    border-radius: 2px;
    position: relative;
    cursor: pointer;
  }

  .who-is-online__extra-participant.disable-dropdown {
    cursor: default;
  }

  .who-is-online__extra-participant:hover,
  .who-is-online__extra-participant--selected {
    background-color: rgb(var(--sv-gray-200));
  }

  .who-is-online__participant {
    border-radius: 50%;
    box-sizing: border-box;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border: 2px solid #878291;
    border-radius: 50%;
    max-width: 40px;
    flex: 1 0 40px;
  }

  .who-is-online__participant__avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Open Sans';
    font-size: 14px;
    line-height: 14px;
    font-weight: bold;
    color: #26242a;
    object-fit: contain;
  }

  .dropdown-list {
    position: relative;
    display: flex;
    flex-direction: column;
    z-index: 100;
  }

  .dropdown-list > div {
    padding: 4px;
    width: 216px;
    box-sizing: border-box;
  }

  .who-is-online__extras-dropdown {
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    opacity: 0;
    display: none;
    background: #fff;
    padding: 0;
    z-index: 1;
    transition: 0.2s;
    border-radius: 3px;
    max-height: 240px;
    overflow: auto;
  }

  .who-is-online__extras__arrow-icon {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .menu--bottom {
    top: 4px;
    min-width: 103px;
    position: absolute;
    right: 0;
  }

  .menu--top {
    bottom: 44px;
    min-width: 103px;
    position: absolute;
    right: 0px;
  }

  .menu-open {
    display: block;
    opacity: 1;
  }

  .superviz-who-is-online-dropdown__tooltip {
    background-color: rgb(var(--sv-gray-600));
    padding: 8px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
    position: absolute;
    top: 52px;
    left: 50%;
    transform: translateX(-50%);
    border-radius: 2px;
    opacity: 0;
    cursor: default;
    display: none;
    transition: opacity 0.2s ease-in-out display 0s;
  }

  .superviz-who-is-online-dropdown__tooltip-arrow {
    width: 13px;
    height: 13px;
    position: absolute;
    top: 0px;
    left: 50%;
    transform: rotate(45deg) translateX(-50%);
    background-color: rgb(var(--sv-gray-600));
    border-top-left-radius: 3px;
  }

  .dropdown-content:hover + .superviz-who-is-online-dropdown__tooltip {
    opacity: 1;
    display: block;
  }

  .tooltip-content {
    margin: 0;
    font-family: roboto;
    white-space: nowrap;
    text-align: center;
    color: white;
    font-size: 14px;
  }

  .who-is-online__extras__username {
    font-size: 14px;
    line-height: 20px;
    font-family: 'Open sans';
    color: rgb(var(--sv-gray-600));
  }

  .icon {
    flex: 1;
    justify-content: flex-end;
    display: flex;
  }

  .hide-icon {
    display: none;
  }

  @media (max-width: 780px) {
    .sv-icon,
    .who-is-online__participant {
      width: 32px;
      height: 32px;
    }

    .who-is-online__participant {
      flex: 1 0 32px;
      max-width: 32px;
    }

    .who-is-online__participant__avatar {
      width: 24px;
      height: 24px;
    }

    .dropdown-list > div {
      width: 192px;
    }

    .menu--top {
      bottom: 36px;
    }

    .superviz-who-is-online-dropdown__tooltip {
      top: 44px;
    }
  }
`;L();var Ld=xt`
  .who-is-online__controls-messages {
    position: absolute;
    right: 0;
    display: flex;
    flex-direction: column;
    gap: 5px;
    margin-top: 4px;
  }

  .who-is-online__presence-control-message {
    box-sizing: border-box;
    font-size: 12px;
    padding: 8px 10px;
    font-family: 'Roboto';
    border-radius: 6px;
    background-color: #fff;
    color: rgb(var(--sv-gray-700));
    border: 2px solid #e0e0e0;
    white-space: nowrap;
  }

  .who-is-online__pcm__text {
    margin: 0;
  }

  .who-is-online__presence-control-message span {
    margin-left: 3px;
    text-decoration: underline;
    cursor: pointer;
  }

  .left-side {
    left: 0;
  }

  .right-side {
    right: 0;
  }

  .left-side .who-is-online__presence-control-message {
    align-self: flex-start;
  }

  .right-side .who-is-online__presence-control-message {
    align-self: flex-end;
  }

  .bottom-side {
    bottom: auto;
    top: calc(100% + 5px);
  }

  .top-side {
    top: auto;
    bottom: calc(100% + 5px);
  }
`;var Bv=kt(Pt),X_=[Bv.styles,Md],lr=class extends Bv{constructor(){super();this.onClickOutDropdown=({detail:t})=>{this.open=t.open};this.dropdownOptionsHandler=({detail:t})=>{var u;let{id:n,label:r,name:a,color:l,slotIndex:c}=t;if(r==="go to"&&this.emitEvent("realtime.go-to-participant",{id:n}),["follow","unfollow"].includes(r)){if(((u=this.following)==null?void 0:u.id)===n){this.stopFollowing();return}this.everyoneFollowsMe&&this.stopEveryoneFollowsMe(),this.following={name:a,id:n,color:l},this.swapParticipantBeingFollowedPosition(),this.emitEvent("realtime.local-follow-participant",{id:n})}if(["private mode","leave private mode"].includes(r)&&(this.isPrivate=r==="private mode",this.everyoneFollowsMe&&this.stopEveryoneFollowsMe(),this.emitEvent("realtime.private-mode",{id:n,isPrivate:this.isPrivate}),this.everyoneFollowsMe=!1),["everyone follows me","stop followers"].includes(r)){if(this.everyoneFollowsMe){this.stopEveryoneFollowsMe();return}this.following&&this.stopFollowing(),this.isPrivate&&this.cancelPrivate(),this.everyoneFollowsMe=!0,this.following=void 0,this.emitEvent("realtime.follow-participant",{id:n,name:a,color:l,slotIndex:c})}r==="gather all"&&this.emitEvent("realtime.gather",{id:n})};this.toggleShowTooltip=()=>{this.showTooltip=!this.showTooltip};this.position="top: 20px; right: 40px;",this.showTooltip=!0,this.open=!1}firstUpdated(t){super.firstUpdated(t),ne.call(this,"who-is-online")}updateParticipants(t){this.participants=t}toggleOpen(){this.open=!this.open}dropdownPosition(t){if(this.participants.length===1)return"bottom-center";if(t===0)return"bottom-right";let n=this.participants.length>4,r=t+1===this.participants.length;return n||!r?"bottom-center":"bottom-left"}renderExcessParticipants(){var l;let t=this.participants.length-4;if(t<=0)return dt``;let n=this.participants.slice(4).map(({name:c,color:u,id:m,slotIndex:g,isLocal:E,avatar:h,joinedPresence:y})=>({name:c,color:u,id:m,slotIndex:g,avatar:h,isLocal:E,joinedPresence:y})),r={"who-is-online__participant":!0,excess_participants:!0,"excess_participants--open":this.open};return dt`
      <superviz-who-is-online-dropdown
        label="label"
        returnTo="label"
        position="bottom"
        @selected=${this.dropdownOptionsHandler}
        participants=${JSON.stringify(n)}
        @clickout=${this.onClickOutDropdown}
        ?disableDropdown=${this.disableDropdown}
        following=${JSON.stringify(this.following)}
        ?showSeeMoreTooltip=${this.showTooltip}
        @toggle=${this.toggleOpen}
        @toggle-dropdown-state=${this.toggleShowTooltip}
        ?localParticipantJoinedPresence=${(l=this.localParticipantData)==null?void 0:l.joinedPresence}
        classesPrefix="who-is-online__controls"
        parentComponent="who-is-online"
        tooltipPrefix="who-is-online"
      >
        <div class=${It(r)} slot="dropdown">
          <div class="superviz-who-is-online__excess who-is-online__extras">+${t}</div>
        </div>
      </superviz-who-is-online-dropdown>
    `}stopEveryoneFollowsMe(){this.everyoneFollowsMe=!1,this.emitEvent("realtime.follow-participant",void 0)}getAvatar(t){var r,a;if((r=t.avatar)!=null&&r.imageUrl)return dt` <img
        class="who-is-online__participant__avatar"
        style="background-color: ${t.color}"
        src=${t.avatar.imageUrl}
      />`;let n=Pr.includes(t.slotIndex)?"#FFFFFF":"#26242A";return dt`<div
      class="who-is-online__participant__avatar"
      style="background-color: ${t.color}; color: ${n}"
    >
      ${(a=t.name)==null?void 0:a.at(0).toUpperCase()}
    </div>`}getOptions(t,n,r){let{id:a,slotIndex:l,name:c,color:u}=t,m={id:a,name:c,color:u,slotIndex:l},{isPrivate:g}=this;return(r?["GATHER",this.everyoneFollowsMe?"UNFOLLOW":"FOLLOW",g?"LEAVE_PRIVATE":"PRIVATE"]:["GOTO",n?"LOCAL_UNFOLLOW":"LOCAL_FOLLOW"]).map(y=>Mt(lt({},m),{label:Cs[y]}))}getIcons(t,n){return t?["gather",this.everyoneFollowsMe?"send-off":"send","eye_inative"]:["place",n?"send-off":"send"]}putLocalParticipationFirst(){var a;if(this.participants[0].isLocal)return;let t=(a=this.participants)==null?void 0:a.find(({isLocal:l})=>l);if(!t)return;let n=[...this.participants],r=n.indexOf(t);n.splice(r,1),n.unshift(t),this.participants=n}swapParticipantBeingFollowedPosition(){var l;let t=(l=this.participants)==null?void 0:l.findIndex(({id:c})=>{var u;return c===((u=this.following)==null?void 0:u.id)}),n=1;if(t<4||!t)return;let r=[...this.participants],a=r[t];r[t]=r[n],r[n]=a,this.participants=r}stopFollowing(){this.following=void 0,this.emitEvent("realtime.local-follow-participant",{id:void 0})}cancelPrivate(){this.isPrivate=void 0,this.emitEvent("realtime.private-mode",{id:this.localParticipantData.id})}renderParticipants(){return this.participants?(this.putLocalParticipationFirst(),this.swapParticipantBeingFollowedPosition(),dt`<div class="who-is-online__participant-list">
      ${li(this.participants.slice(0,4),t=>t.id,(t,n)=>{var x,v;let{joinedPresence:r,isLocal:a,id:l,name:c,color:u}=t,m=((x=this.following)==null?void 0:x.id)===l,g=this.getOptions(t,m,a),E=this.getIcons(a,m),h=this.dropdownPosition(n),y=!r||this.disableDropdown,O={"who-is-online__participant":!0,"disable-dropdown":y,followed:m||a&&this.everyoneFollowsMe,private:a&&this.isPrivate},C=c+(a?" (you)":""),T={name:c};return((v=this.localParticipantData)==null?void 0:v.joinedPresence)&&r&&!a&&(T.action="Click to Follow"),a&&(T.action="You"),dt`
            <superviz-dropdown
              options=${JSON.stringify(g)}
              label="label"
              position="${h}"
              @selected=${this.dropdownOptionsHandler}
              @toggle-dropdown-state=${this.toggleShowTooltip}
              icons="${JSON.stringify(E)}"
              name="${C}"
              ?disabled=${y}
              ?canShowTooltip=${this.showTooltip}
              onHoverData=${JSON.stringify(T)}
              classesPrefix="who-is-online__controls"
              parentComponent="who-is-online"
              tooltipPrefix="who-is-online"
            >
              <div slot="dropdown" class=${It(O)} style="border-color: ${u}">
                ${this.getAvatar(t)}
              </div>
            </superviz-dropdown>
          `})}
      ${this.renderExcessParticipants()}
    </div>`):dt``}updated(t){super.updated(t),this.updateComplete.then(()=>{let n=this.shadowRoot.querySelector(".who-is-online");if(!n)return;let r=this.position.includes("left")?"flex-start":"flex-end",a=`${this.position} align-items: ${r};`;n.setAttribute("style",a)})}render(){var t;return dt`<div class="who-is-online who-is-online">
      ${this.renderParticipants()}
      <superviz-who-is-online-messages
        following=${JSON.stringify(this.following)}
        ?everyoneFollowsMe=${this.everyoneFollowsMe}
        ?isPrivate=${this.isPrivate}
        participantColor=${(t=this.localParticipantData)==null?void 0:t.color}
        @stop-following=${this.stopFollowing}
        @cancel-private=${this.cancelPrivate}
        @stop-everyone-follows-me=${this.stopEveryoneFollowsMe}
      ></superviz-who-is-online-messages>
    </div> `}};lr.styles=X_,lr.properties={position:{type:String},participants:{type:Object},open:{type:Boolean},disableDropdown:{type:Boolean},following:{type:Object},localParticipantColor:{type:String},isPrivate:{type:Boolean},everyoneFollowsMe:{type:Boolean},showTooltip:{type:Boolean}},lr=Nt([Ft("superviz-who-is-online")],lr);L();L();var kv=kt(Pt),ex=[kv.styles,Ld],cr=class extends kv{constructor(){super(...arguments);this.repositionMessages=()=>{let{following:t,everyoneFollowsMe:n,isPrivate:r}=this;if(t||n||r){this.repositionInVerticalDirection(),this.repositionInHorizontalDirection(),this.animationFrame=window.requestAnimationFrame(this.repositionMessages);return}window.cancelAnimationFrame(this.animationFrame)}}firstUpdated(t){super.firstUpdated(t),ne.call(this,"who-is-online")}updated(t){super.updated(t),["following","everyoneFollowsMe","isPrivate"].some(r=>t.has(r))&&this.repositionMessages()}repositionInVerticalDirection(){let t=window.innerHeight/2,{top:n}=this.parentElement.getBoundingClientRect();if(n<t){this.verticalSide="bottom-side";return}this.verticalSide="top-side"}repositionInHorizontalDirection(){let t=window.innerWidth/2,{left:n}=this.parentElement.getBoundingClientRect();if(n<t){this.horizontalSide="left-side";return}this.horizontalSide="right-side"}stopFollowing(){this.emitEvent("stop-following",{})}cancelPrivate(){this.emitEvent("cancel-private",{})}stopEveryoneFollowsMe(){this.emitEvent("stop-everyone-follows-me",{})}followingMessage(){if(!this.following)return"";let{name:t,color:n}=this.following;return dt`<div
      class="who-is-online__following-message who-is-online__presence-control-message who-is-online__pcm"
      style="border-color: ${n}"
    >
      <p class="who-is-online__presence-control-message__text who-is-online__pcm__text">
        Following: ${t}
        <span
          class="who-is-online__presence-control-message__cancel-action-button who-is-online__pcm__cancel-action-button"
          @click=${this.stopFollowing}
          >Stop</span
        >
      </p>
    </div>`}everyoneFollowsMeMessage(){return this.everyoneFollowsMe?dt`<div
      class="who-is-online__follow-me-message who-is-online__presence-control-message who-is-online__pcm"
      style="border-color: ${this.participantColor}"
    >
      <p class="who-is-online__presence-control-message__text who-is-online__pcm__text">
        Everyone is following you
        <span
          class="who-is-online__presence-control-message__cancel-action-button who-is-online__pcm__cancel-action-button"
          @click=${this.stopEveryoneFollowsMe}
          >Stop</span
        >
      </p>
    </div>`:""}privateMessage(){return this.isPrivate?dt`<div
      class="who-is-online__private-mode-message who-is-online__presence-control-message who-is-online__pcm"
      style="border-color: ${this.participantColor}"
    >
      <p class="who-is-online__presence-control-message__text who-is-online__pcm__text">
        You are in Private Mode
        <span
          class="who-is-online__presence-control-message__cancel-action-button who-is-online__pcm__cancel-action-button"
          @click=${this.cancelPrivate}
          >Cancel</span
        >
      </p>
    </div>`:""}render(){let t={"who-is-online__controls-messages":!0,[this.verticalSide]:!0,[this.horizontalSide]:!0};return dt` <div class=${It(t)}>
      ${this.followingMessage()} ${this.everyoneFollowsMeMessage()} ${this.privateMessage()}
    </div>`}};cr.styles=ex,cr.properties={following:{type:Object},everyoneFollowsMe:{type:Boolean},isPrivate:{type:Boolean},participantColor:{type:String},verticalSide:{type:String},horizontalSide:{type:String}},cr=Nt([Ft("superviz-who-is-online-messages")],cr);L();var $v=kt(Pt),nx=[$v.styles,Rd],ur=class extends $v{constructor(){super();this.onClickOutDropdown=t=>{if(t.stopPropagation(),!this.open)return;let n=t.composedPath(),r=this.shadowRoot.querySelector(".dropdown-content"),a=this.shadowRoot.querySelector(".dropdown-list"),c=this.shadowRoot.querySelector('slot[name="dropdown"]').assignedElements()[0],u=n.includes(r),m=n.includes(a),g=n.includes(c);u||m||g||this.close()};this.close=()=>{this.open=!1,this.selected="",this.emitEvent("clickout",{bubbles:!1,composed:!1})};this.selectParticipant=t=>()=>{this.selected=t};this.toggleShowTooltip=({detail:{open:t}})=>{this.showParticipantTooltip=!this.showParticipantTooltip,t||(this.selected="")};this.tooltip=()=>this.showSeeMoreTooltip?dt`<superviz-tooltip
      tooltipData=${JSON.stringify({name:"See more"})}
      classesPrefix="who-is-online__tooltip"
      parentComponent="who-is-online"
    ></superviz-tooltip>`:"";this.repositionDropdown=()=>{if(!this.open){window.cancelAnimationFrame(this.animationFrame);return}this.repositionInVerticalDirection(),this.repositionInHorizontalDirection(),this.animationFrame=window.requestAnimationFrame(this.repositionDropdown)};this.repositionInVerticalDirection=()=>{let{bottom:t,top:n,height:r}=this.parentElement.getBoundingClientRect(),a=window.innerHeight/2;if(n+r/2>a){this.dropdownList.style.setProperty("bottom",`${window.innerHeight-n+8}px`),this.dropdownList.style.setProperty("top","");return}this.dropdownList.style.setProperty("top",`${t+8}px`),this.dropdownList.style.setProperty("bottom","")};this.repositionInHorizontalDirection=()=>{let{right:t,left:n}=this.parentElement.getBoundingClientRect();this.dropdownList.style.setProperty("right",`${window.innerWidth-t}px`),this.dropdownList.style.setProperty("left",`${n}px`)};this.selected="",this.showParticipantTooltip=!0}firstUpdated(t){this.shadowRoot.querySelector(".who-is-online__extras-dropdown").scrollTop=0,ne.call(this,"who-is-online"),this.dropdownList=this.shadowRoot.querySelector(".dropdown-list"),this.dropdownList.style.position="fixed"}updated(t){if(!!t.has("open")){if(this.emitEvent("toggle-dropdown-state",{open:this.open,font:"toggle"}),this.open){document.addEventListener("click",this.onClickOutDropdown);return}document.removeEventListener("click",this.onClickOutDropdown)}}getAvatar(t){var r,a;if((r=t.avatar)!=null&&r.imageUrl)return dt` <img
        class="who-is-online__participant__avatar"
        style="background-color: ${t.color}"
        src=${t.avatar.imageUrl}
      />`;let n=Pr.includes(t.slotIndex)?"#FFFFFF":"#26242A";return dt`<div
      class="who-is-online__participant__avatar"
      style="background-color: ${t.color}; color: ${n}"
    >
      ${(a=t.name)==null?void 0:a.at(0).toUpperCase()}
    </div>`}renderParticipants(){if(!this.participants)return;let t=["place","send"],n=this.participants.length-1;return li(this.participants,r=>r.id,(r,a)=>{var v,A;let{id:l,slotIndex:c,joinedPresence:u,isLocal:m,color:g,name:E}=r,h=!u||m||this.disableDropdown,y={"who-is-online__extra-participant":!0,"who-is-online__extra-participant--selected":this.selected===l,"disable-dropdown":h,followed:((v=this.following)==null?void 0:v.id)===l},O={"who-is-online__extras__arrow-icon":!0,"hide-icon":h},_=((A=this.following)==null?void 0:A.id)===l,C=Object.values(Cs).map((f,p)=>({label:_&&p?"UNFOLLOW":f,id:l,name:E,color:g,slotIndex:c})).slice(0,2),T={name:E};this.localParticipantJoinedPresence&&u&&(T.action="Click to Follow");let x=a===n;return dt`
        <superviz-dropdown
        options=${JSON.stringify(C)}
        label="label"
        position="bottom-right"
        @selected=${this.close}
        icons="${JSON.stringify(t)}"
        ?disabled=${h}
        onHoverData=${JSON.stringify(T)}
        ?canShowTooltip=${this.showParticipantTooltip}
        ?shiftTooltipLeft=${!0}
        ?lastParticipant=${x}
        @toggle-dropdown-state=${this.toggleShowTooltip}
        classesPrefix="who-is-online__controls"
        parentComponent="who-is-online"
        tooltipPrefix="who-is-online"
        >
        <div 
          class=${It(y)} 
          @click=${this.selectParticipant(l)} slot="dropdown">
            <div class="who-is-online__participant" style="border-color: 
            ${g}">
              ${this.getAvatar(r)}
            </div>
            <span class="who-is-online__extras__username">${E}</span>
            <superviz-icon 
              class=${It(O)} 
              name="right" 
              color="var(--sv-gray-600)"
              size="sm"
            >
          </superviz-icon>
          </div>
        </div>
      </superviz-dropdown>
      `})}toggle(){this.open=!this.open,this.open&&(this.selected="",this.repositionDropdown())}get menuClasses(){return{"who-is-online__extras-dropdown":!0,"menu--bottom":this.position==="bottom-side","menu--top":this.position==="top-side","menu-open":this.open}}render(){return dt`
      <div class="dropdown">
        <div class="dropdown-content" @click=${this.toggle}>
          <slot name="dropdown"></slot>
        </div>
        ${this.tooltip()}
      </div>
      <div class="dropdown-list">
        <div class=${It(this.menuClasses)}>${this.renderParticipants()}</div>
      </div>
    `}};ur.styles=nx,ur.properties={open:{type:Boolean},align:{type:String},position:{type:String},participants:{type:Array},selected:{type:String},disableDropdown:{type:Boolean},following:{type:Object},showSeeMoreTooltip:{type:Boolean},showParticipantTooltip:{type:Boolean},localParticipantJoinedPresence:{type:Boolean},dropdownList:{type:Object}},ur=Nt([Ft("superviz-who-is-online-dropdown")],ur);L();L();function Uv(s){if(typeof document!="undefined"){let e=document.createElement("style");e.id="superviz-style";let t=document.createTextNode(s);e.appendChild(t),document.head.appendChild(e)}}var Hv=`@import"https://unpkg.com/@superviz/sv-icons@0.8.12/css/style.css";@import"https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap";:root{--sv-primary: 98, 16, 204}html,body{width:100%;height:100%;overflow:hidden}#sv-video-wrapper iframe{position:fixed;border:none;margin:0;padding:0;overflow:hidden;z-index:5}#sv-video-wrapper iframe.sv-video-frame--right{top:var(--superviz-offset-top);right:var(--superviz-offset-right)}#sv-video-wrapper iframe.sv-video-frame--left{top:var(--superviz-offset-top);left:var(--superviz-offset-left)}#sv-video-wrapper iframe.sv-video-frame--bottom{bottom:var(--superviz-offset-bottom);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--top{top:var(--superviz-offset-top);right:var(--superviz-offset-right);width:100%}#sv-video-wrapper iframe.sv-video-frame--no-overlay{display:none}.pointer-mouse{display:flex;height:17px;width:17px;background-image:url(https://production.cdn.superviz.com/static/pointers/0.svg)}.mouse-user-name{display:block;position:absolute;border-radius:30px;padding:2px 8px;font-weight:700;font-size:14px;font-family:Roboto,sans-serif;line-height:22px;margin-left:10px;margin-top:-6px;background:yellow;white-space:nowrap}.mouse-follower{position:absolute;display:block;z-index:2;transition:all .3s ease-in-out}
`;Uv(Hv);L();L();L();window&&(window.SuperVizRoom={init:cu,CommentEvent:ga,MeetingEvent:vo,DeviceEvent:Wc,RealtimeEvent:gn,MeetingState:pa,MeetingConnectionStatus:Eo,MeetingControlsEvent:bo,ParticipantEvent:ma,FrameEvent:yo,LayoutMode:Sa,VideoConference:Do,MousePointers:No,Realtime:Fo,Comments:Co,CanvasPin:_o,HTMLPin:xo,WhoIsOnline:Bo,ParticipantType:Cr,LayoutPosition:Mo,CamerasPosition:Oa,RealtimeComponentState:La,RealtimeComponentEvent:Da,ComponentLifeCycleEvent:va,WhoIsOnlineEvent:ya});var c$=cu;export{Io as BrowserService,Oa as CamerasPosition,ga as CommentEvent,va as ComponentLifeCycleEvent,Wc as DeviceEvent,yo as FrameEvent,Sa as LayoutMode,Mo as LayoutPosition,Eo as MeetingConnectionStatus,bo as MeetingControlsEvent,vo as MeetingEvent,pa as MeetingState,At as Observer,ma as ParticipantEvent,Cr as ParticipantType,Oo as PinMode,Da as RealtimeComponentEvent,La as RealtimeComponentState,gn as RealtimeEvent,ya as WhoIsOnlineEvent,c$ as default};
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.45
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
